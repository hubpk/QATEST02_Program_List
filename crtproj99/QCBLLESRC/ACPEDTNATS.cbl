       PROCESS APOST.                                                   CBLHDRK1
      ***************************************************************   CBLHDRK1
       IDENTIFICATION DIVISION.                                         CBLHDRK1
     H/TITLE Edit Ledger Nature        Edit file                        CBLHDRK1
     Z* CRTCBLPGM                                                       CBLHDRK1
     Z* OPTION(*SRCDBG) CVTOPT(*DATETIME)                               CBLHDRK1
      *                                                                 CBLHDRK1
     H* SYNOPSIS :                                                      EDTFILK1
     H* - Maintain database file using subfile display                  EDTFILK1
     H* - Existing records may be updated                               EDTFILK1
     H* - Key changes are not allowed                                   EDTFILK1
     H* - Program functions in two modes : *ADD and *CHANGE             EDTFILK1
     H*  - MULTIPLE NEW RECORDS MAY BE ADDED BY CHANGING TO ADD MODE    EDTFILK1
     H* Generated by  : COOL:2E  Version:  1135                         CBLHDRK1
     H* Function type : Edit file  Version:   0.1                       CBLHDRK1
      *                                                                 CBLHDRK1
     H* Company    : Vehicle Finance                                    CBLHDRK1
     H* System     : Vehicle Finance                                    CBLHDRK1
     H* User name  : PG00543                                            CBLHDRK1
     H* Date       : 17/03/06 time: 16:54:22                            CBLHDRK1
     H* Copyright  : Vehicle Finance                                    CBLHDRK1
      *                                                                 CBLHDRK1
      *==============================================================   CBLHDRK1
     M* MAINTENANCE   :                                                 CBLHDRK1
      *==============================================================   CBLHDRK1
       PROGRAM-ID.  ACPEDTNATS.                                         CBLHDRK1
       SECURITY.    (C) COPYRIGHT Renault UK Ltd. 2006                  CBLUFNK1
                    Reproduction is not allowed without prior permissionCBLUFNK1
      /EJECT                                                            CBLHDRK1
      ***************************************************************   CBLHDRK1
       ENVIRONMENT DIVISION.                                            CBLHDRK1
       CONFIGURATION SECTION.                                           CBLHDRK1
       SOURCE-COMPUTER.  IBM-AS400.                                     CBLHDRK1
       OBJECT-COMPUTER.  IBM-AS400.                                     CBLHDRK1
       SPECIAL-NAMES.  OPEN-FEEDBACK IS OPEN-FEEDBACK-AREA,             CBLHDRK1
           I-O-FEEDBACK IS I-O-FEEDBACK-AREA.                           CBLHDRK1
      /EJECT                                                            CBLHDRK1
      ***************************************************************   CBLHDRK1
       INPUT-OUTPUT SECTION.                                            CBLHDRK1
       FILE-CONTROL.                                                    CBLHDRK1
      *                                                                 CBLHDRK1
           SELECT ACPEDTNATD                                            CBLUPDK1
             ASSIGN TO WORKSTATION-ACPEDTNATD-SI                        CBLUPDK1
             ORGANIZATION IS TRANSACTION                                CBLUPDK1
             ACCESS MODE IS DYNAMIC                                     CBLUPDK1
             RELATIVE KEY IS ZZRR                                       CBLUPDK1
             FILE STATUS IS FILE-STATUS, MAJOR-MINOR-CODE.              CBLUPDK1
      *    DSP: Edit Ledger Nature        Edit file                     CBLUPDK1
      *                                                                 CBLUPDK1
           SELECT JSVLLSL9                                              CVTSTSK1
             ASSIGN TO DATABASE-JSVLLSL9                                CVTSTSK1
             ORGANIZATION IS INDEXED                                    CVTSTSK1
             ACCESS MODE IS DYNAMIC                                     CVTSTSK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CVTSTSK1
             FILE STATUS IS FILE-STATUS.                                CVTSTSK1
      *    Values list details file                                     CVTSTSK1
      *                                                                 CVTSTSK1
           SELECT ACLDGNATL0                                            CBLUPDK1
             ASSIGN TO DATABASE-ACLDGNATL0                              CBLUPDK1
             ORGANIZATION IS INDEXED                                    CBLUPDK1
             ACCESS MODE IS DYNAMIC                                     CBLUPDK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CBLUPDK1
             FILE STATUS IS FILE-STATUS.                                CBLUPDK1
      *    RTV : Ledger Nature             Retrieval index              CBLUPDK1
      *                                                                 CBLUPDK1
           SELECT ACBATPRML2                                            CBLUPDK1
             ASSIGN TO DATABASE-ACBATPRML2                              CBLUPDK1
             ORGANIZATION IS INDEXED                                    CBLUPDK1
             ACCESS MODE IS DYNAMIC                                     CBLUPDK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CBLUPDK1
             FILE STATUS IS FILE-STATUS.                                CBLUPDK1
      *    RSQ : Batch Parameter           Ledger,Nature,App,TranTy     CBLUPDK1
      *                                                                 CBLUPDK1
           SELECT ACLDGTYPL1                                            CBLUPDK1
             ASSIGN TO DATABASE-ACLDGTYPL1                              CBLUPDK1
             ORGANIZATION IS INDEXED                                    CBLUPDK1
             ACCESS MODE IS DYNAMIC                                     CBLUPDK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CBLUPDK1
             FILE STATUS IS FILE-STATUS.                                CBLUPDK1
      *    RTV : Ledger Type               Retrieval index              CBLUPDK1
      *                                                                 CBLUPDK1
           SELECT ACLDGNATL1                                            CBLUPDK1
             ASSIGN TO DATABASE-ACLDGNATL1                              CBLUPDK1
             ORGANIZATION IS INDEXED                                    CBLUPDK1
             ACCESS MODE IS DYNAMIC                                     CBLUPDK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CBLUPDK1
             FILE STATUS IS FILE-STATUS.                                CBLUPDK1
      *    UPD : Ledger Nature             Update index                 CBLUPDK1
      *                                                                 CBLUPDK1
       I-O-CONTROL.                                                     CBLHDRK1
      *                                                                 CBLHDRK1
      /EJECT                                                            CBLHDRK1
      ***************************************************************   CBLHDRK1
       DATA DIVISION.                                                   CBLHDRK1
       FILE SECTION.                                                    CBLHDRK1
      *                                                                 CBLHDRK1
      *                                                                 CVTSTSK1
       FD  JSVLLSL9                                                     CVTSTSK1
           LABEL RECORDS ARE STANDARD.                                  CVTSTSK1
       01  JSVLLSL9-R.                                                  CVTSTSK1
           COPY DD-ALL-FORMATS OF JSVLLSL9.                             CVTSTSK1
      *                                                                 CBLUPDK1
       FD  ACPEDTNATD                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  ACPEDTNATD-F.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF ACPEDTNATD.                          CBLUPDK1
           05 FILLER            PIC X(100).                             CBLUPDK1
      *                                                                 CBLUPDK1
       FD  ACLDGNATL0                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  ACLDGNATL0-R.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF ACLDGNATL0.                          CBLUPDK1
      *                                                                 CBLUPDK1
       FD  ACBATPRML2                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  ACBATPRML2-R.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF ACBATPRML2.                          CBLUPDK1
      *                                                                 CBLUPDK1
       FD  ACLDGTYPL1                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  ACLDGTYPL1-R.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF ACLDGTYPL1.                          CBLUPDK1
      *                                                                 CBLUPDK1
       FD  ACLDGNATL1                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  ACLDGNATL1-R.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF ACLDGNATL1.                          CBLUPDK1
      /EJECT                                                            CBLHDRK1
      ***************************************************************   CBLHDRK1
       WORKING-STORAGE SECTION.                                         CBLHDRK1
      *                                                                 CBLHDRK1
      *    Job context                                                  CBLHDRK1
       01  JOB-CONTEXT.                                                 CBLHDRK1
           COPY DDS-ALL-FORMATS OF Y2PGDSPK.                            CBLHDRK1
      *    Job date/time                                                CBLHDRK1
           03  IJBDTTM.                                                 CBLHDRK1
           05  ZZJDT PIC S9(7).                                         CBLHDRK1
           05  ZZJDTE REDEFINES ZZJDT.                                  CBLHDRK1
           07  ZZJCC PIC S9(1).                                         CBLHDRK1
           07  ZZJYY PIC S9(2).                                         CBLHDRK1
           07  ZZJMM PIC S9(2).                                         CBLHDRK1
           07  ZZJDD PIC S9(2).                                         CBLHDRK1
           05  ZZJTM PIC S9(6).                                         CBLHDRK1
           05  ZZJTME REDEFINES ZZJTM.                                  CBLHDRK1
           07  ZZJHH PIC S9(2).                                         CBLHDRK1
           07  ZZJNN PIC S9(2).                                         CBLHDRK1
           07  ZZJSS PIC S9(2).                                         CBLHDRK1
           03  ZZFQL PIC X(21).                                         CBLHDRK1
           03  ZZFLB PIC X(10).                                         CBLHDRK1
           03  ZZFFL PIC X(10).                                         CBLHDRK1
           03  ZZFMB PIC X(10).                                         CBLHDRK1
           03  ZZCDB PIC X(18).                                         CBLHDRK1
           03  ZZLDB PIC X(18).                                         CBLHDRK1
           03  ZZTMS PIC X(26).                                         CBLHDRK1
       01  ZZTIME.                                                      CBLHDRK1
           03  ZZHNS PIC S9(6).                                         CBLHDRK1
           03  ZZHH PIC S9(2).                                          CBLHDRK1
      *                                                                 CBLHDRK1
       77  C-IND-OFF PIC 1(1) VALUE B'0'.                               CBLHDRK1
       77  C-IND-ON PIC 1(1) VALUE B'1'.                                CBLHDRK1
      *                                                                 CBLHDRK1
       01  FILE-STATUS PIC X(2).                                        CBLHDRK1
           88  C-IO-OK VALUE '00'.                                      CBLHDRK1
           88  C-EOF VALUE '10' '46'.                                   CBLHDRK1
           88  C-NO-MOD-SFLRCDS VALUE '12'.                             CBLHDRK1
           88  C-IO-ERR VALUE '21' '22' '24' '30' '34' '90' '91' '92' '9CBLHDRK1
      -     '4' '95' '9A' '9H' '9I' '9K' '9M' '9N' '9P'.                CBLHDRK1
           88  C-NO-RECORD VALUE '23'.                                  CBLHDRK1
           88  C-RECORD-LOCKED VALUE '9D'.                              CBLHDRK1
      *                                                                 CBLHDRK1
       01  UNTIL-CONDITION PIC 1(1).                                    CBLHDRK1
           88  C-UNTIL-FALSE VALUE B'0'.                                CBLHDRK1
           88  C-UNTIL-TRUE VALUE B'1'.                                 CBLHDRK1
      *                                                                 CBLHDRK1
       01  FOREVER PIC 1(1) VALUE B'1'.                                 CBLHDRK1
           88  C-FOREVER VALUE B'1'.                                    CBLHDRK1
      *                                                                 CBLHDRK1
       01  WRK-IO-TRASH-AREA PIC X(1).                                  CBLHDRK1
      *                                                                 CBLHDRK1
       01  P2PARM.                                                      DCLPARK1
      *    Ledger Type Description                                      DCLPARK1
           03  P2LDGDES PIC X(35).                                      DCLPARK1
       01  W0RTN PIC X(7).                                              CBLHDRK1
       01  W0RSF PIC X(1).                                              CBLHDRK1
       01  W0ENV PIC X(3).                                              CBLHDRK1
       01  W0RTW PIC S9(9) COMP-4.                                      CBLHDRK1
       01  W0ICL PIC X(1).                                              CBLHDRK1
       01  Y1DBRC.                                                      CBLISVK1
           03  ASLDGTYP PIC X(1).                                       CBLISVK1
           03  ASLDGNAT PIC X(1).                                       CBLISVK1
           03  ASNATDES PIC X(35).                                      CBLISVK1
           03  ASLDGLOC PIC X(2).                                       CBLISVK1
      *                                                                 CBLISVK1
       01  ZZRRMX PIC S9(5) COMP-3.                                     EDTFILK1
       01  KPOS.                                                        KEYLSTK1
      *    Ledger Type Code                                             KEYLSTK1
           03  ASLDGTYP PIC X(1).                                       KEYLSTK1
      *    Ledger Nature Code                                           KEYLSTK1
           03  ASLDGNAT PIC X(1).                                       KEYLSTK1
       01  KPOS-TMP.                                                    KEYLSTK1
      *    Ledger Type Code                                             KEYLSTK1
           03  ASLDGTYP PIC X(1).                                       KEYLSTK1
      *    Ledger Nature Code                                           KEYLSTK1
           03  ASLDGNAT PIC X(1).                                       KEYLSTK1
      *                                                                 EDTFILK1
      *..............................................................   EDTFILK1
      *    Define Full Externally Described Keylist                     EDTFILK1
       01  KPOS-EXT.                                                    EDTFILK1
      *    Ledger Type Code                                             EDTFILK1
           03  ASLDGTYP PIC X(1).                                       EDTFILK1
      *    Ledger Nature Code                                           EDTFILK1
           03  ASLDGNAT PIC X(1).                                       EDTFILK1
      *..............................................................   EDTFILK1
       01  KRST.                                                        KEYLSTK1
      *    Ledger Type Code                                             KEYLSTK1
           03  ASLDGTYP PIC X(1).                                       KEYLSTK1
       01  KRST-TMP.                                                    KEYLSTK1
      *    Ledger Type Code                                             KEYLSTK1
           03  ASLDGTYP PIC X(1).                                       KEYLSTK1
      *                                                                 EDTFILK1
      *..............................................................   EDTFILK1
      *    Define Full Externally Described Keylist                     EDTFILK1
       01  KRST-EXT.                                                    EDTFILK1
      *    Ledger Type Code                                             EDTFILK1
           03  ASLDGTYP PIC X(1).                                       EDTFILK1
      *    Ledger Nature Code                                           EDTFILK1
           03  ASLDGNAT PIC X(1).                                       EDTFILK1
      *..............................................................   EDTFILK1
       01  WKIND0-A.                                                    EDTFILK1
           03  WKIND0 PIC 1(1) OCCURS 4.                                EDTFILK1
       01  WKIND1-A.                                                    EDTFILK1
           03  WKIND1 PIC 1(1) OCCURS 4.                                EDTFILK1
       01  ZZRROK PIC S9(5) COMP-3.                                     EDTFILK1
       01  ZZSPG PIC S9(3) COMP-3.                                      EDTFILK1
       01  ZZSLIN PIC S9(3) COMP-3.                                     EDTFILK1
       01  W0SPG PIC S9(3) COMP-3.                                      EDTFILK1
       01  W0RR0 PIC S9(4) COMP-3.                                      EDTFILK1
       01  ZZSFLN PIC S9(9) COMP-3.                                     EDTFILK1
       01  W0RSL PIC X(1).                                              EDTFILK1
       01  RECORD-DROPPED-STATUS PIC 1(1).                              EDTFILK1
           88  RECORD-DROPPED VALUE B'1'.                               EDTFILK1
           88  RECORD-NOT-DROPPED VALUE B'0'.                           EDTFILK1
       01  Y2LSTN PIC S9(7) COMP-3.                                     CBLCNMK1
       01  W0INVL PIC X(25).                                            CBLCNMK1
       01  W0VLMP PIC X(1).                                             CBLCNMK1
       01  W0CNNM PIC X(25).                                            CBLCNMK1
       01  CAIN89 PIC 1(1).                                             EDTFILK1
       01  CAIN81 PIC 1(1).                                             EDTFILK1
       01  W0HLP PIC X(1).                                              DSPHLPK1
       01  W0HPMB PIC X(10).                                            DSPHLPK1
       01  YYHPFL PIC X(10).                                            DSPHLPK1
       01  YYHPLB PIC X(10).                                            DSPHLPK1
       01  ZHCSRW PIC S9(5) COMP-3.                                     DSPHLPK1
       01  ZHCSCL PIC S9(5) COMP-3.                                     DSPHLPK1
       01  ZZZCSRW PIC S9(3) COMP-3.                                    DSPHLPK1
       01  ZZZCSCL PIC S9(3) COMP-3.                                    DSPHLPK1
       01  YYHLVN PIC X(10).                                            DSPHLPK1
       01  W0GRP PIC X(10).                                             DSPHLPK1
       01  YYUSOP PIC X(10).                                            DSPHLPK1
       01  YYRW PIC S9(5) COMP-3.                                       DSPHLPK1
       01  YYCL PIC S9(5) COMP-3.                                       DSPHLPK1
       01  YYLGCT PIC S9(5) COMP-3.                                     DSPHLPK1
       01  YYLGVN PIC X(10).                                            DSPHLPK1
       01  ZAPGMQ PIC X(10).                                            EDTFILK1
       01  ZAPGRL PIC X(5).                                             EDTFILK1
       01  ZAFSMS PIC X(1).                                             EDTFILK1
       01  WKIPIN PIC X(1).                                             EDTFILK1
       01  W0DCF PIC X(1).                                              EDTFILK1
       01  W0NLR PIC X(1).                                              EDTFILK1
       01  W0EXVL PIC X(25).                                            CHKSTSK1
      *    Define keylist                                               CBLRTVK2
       01  KRSSA1.                                                      CBLRTVK2
      *    Ledger Type Code                                             CBLRTVK2
           03  APLDGTYP PIC X(1).                                       CBLRTVK2
      *    Ledger Nature Code                                           CBLRTVK2
           03  APLDGNAT PIC X(1).                                       CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSA1-TMP.                                                  CBLRTVK2
      *    Ledger Type Code                                             CBLRTVK2
           03  APLDGTYP PIC X(1).                                       CBLRTVK2
      *    Ledger Nature Code                                           CBLRTVK2
           03  APLDGNAT PIC X(1).                                       CBLRTVK2
      *                                                                 CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define Full Externally Described Keylist                     CBLRTVK2
       01  EXTSA1.                                                      CBLRTVK2
      *    Ledger Type Code                                             CBLRTVK2
           03  APLDGTYP PIC X(1).                                       CBLRTVK2
      *    Ledger Nature Code                                           CBLRTVK2
           03  APLDGNAT PIC X(1).                                       CBLRTVK2
      *    Application Code                                             CBLRTVK2
           03  APAPPCDE PIC X(2).                                       CBLRTVK2
      *    Transaction Type                                             CBLRTVK2
           03  APTRNTYP PIC S9(3) COMP-3.                               CBLRTVK2
      *..............................................................   CBLRTVK2
       01  WN30-A.                                                      CNFPMTK2
           03  WN30 PIC 1(1) OCCURS 30.                                 CNFPMTK2
       01  IND-COUNT PIC S9(5) COMP-3.                                  CNFPMTK2
      *    Message data for message Y2U0009.                            CBLDLTK1
       01  MD0009.                                                      CBLDLTK1
           03  MDPGM PIC X(10).                                         CBLDLTK1
           03  MDACP PIC X(10).                                         CBLDLTK1
           03  MDFMT PIC X(10).                                         CBLDLTK1
           03  MDACT PIC X(4).                                          CBLDLTK1
           03  MDLBL PIC X(6).                                          CBLDLTK1
       01  WK1X01 PIC X(1).                                             CHKRELK2
      *    Ledger Type Code                                             CBLCLLK1
       01  WQ0001 PIC X(1).                                             CBLCLLK1
       01  W0CLPG PIC X(10).                                            CBLCLLK1
       01  KLVA1A.                                                      KEYLSTK1
      *    Ledger Type Code                                             KEYLSTK1
           03  ARLDGTYP PIC X(1).                                       KEYLSTK1
       01  KLVA1A-TMP.                                                  KEYLSTK1
      *    Ledger Type Code                                             KEYLSTK1
           03  ARLDGTYP PIC X(1).                                       KEYLSTK1
      *                                                                 CHKRELK2
      *..............................................................   CHKRELK2
      *    Define Full Externally Described Keylist                     CHKRELK2
       01  KLVA1A-EXT.                                                  CHKRELK2
      *    Ledger Type Code                                             CHKRELK2
           03  ASLDGTYP PIC X(1).                                       CHKRELK2
      *    Ledger Nature Code                                           CHKRELK2
           03  ASLDGNAT PIC X(1).                                       CHKRELK2
      *..............................................................   CHKRELK2
       01  YPMTFD PIC X(10).                                            GENF4K10
       01  YAFSCH PIC S9(4) COMP-3.                                     GENF4K10
       01  YZSFRC PIC S9(4) COMP-3.                                     GENF4K10
       01  YZSFDL PIC S9(4) COMP-3.                                     GENF4K10
       01  ZHSTRW PIC S9(4) COMP-3.                                     GENF4K10
       01  ZHNDRW PIC S9(4) COMP-3.                                     GENF4K10
       01  ZHRLEN PIC S9(4) COMP-3.                                     GENF4K10
       01  YPMRRN PIC S9(4) COMP-3.                                     GENF4K10
       01  ZHF4RW PIC S9(4) COMP-3.                                     GENF4K10
       01  ZHWK1Z PIC S9(4) COMP-3.                                     GENF4K10
       01  ZZSFPG PIC S9(3).                                            EDTFILK1
       01  W0SLM PIC S9(5) COMP-3.                                      EDTFILK1
       01  W0PMD PIC X(3).                                              EDTFILK1
           88  C-ADD-MODE VALUE 'ADD'.                                  EDTFILK1
           88  C-CHANGE-MODE VALUE 'CHG'.                               EDTFILK1
           88  C-SELECT-MODE VALUE 'SEL'.                               EDTFILK1
       01  W0APM PIC X(1).                                              EDTFILK1
       01  YSETCS PIC X(1).                                             CBLSETK2
       01  WCSRLC PIC X(3).                                             CBLSETK2
      *    *Cursor field                                                ACTCTXK4
       01  W0CFL PIC X(10).                                             ACTCTXK4
      *    *Cursor row                                                  ACTCTXK4
       01  W0CRW PIC S9(5) COMP-3.                                      ACTCTXK4
      *    *Cursor column                                               ACTCTXK4
       01  W0CCL PIC S9(5) COMP-3.                                      ACTCTXK4
       01  ZINPOS PIC S9(5) COMP-3.                                     CBLCSRK1
       01  ZADFMF PIC X(10).                                            CBLUPDK1
       01  DATA-AREA-NAME PIC X(10).                                    CBLUPDK1
       01  ZAMSID PIC X(7).                                             CBLUPDK1
       01  ZAMSGF PIC X(10).                                            CBLUPDK1
       01  ZAMSDA PIC X(132).                                           CBLUPDK1
       01  ZAMSTP PIC X(7).                                             CBLUPDK1
       01  ZZRR PIC 9(5) COMP-3.                                        CBLUPDK1
      *                                                                 CBLUPDK1
       01  ACPEDTNATD-I-O-DSPF.                                         CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IDSPFIO.                           CBLUPDK1
      *    Subfile I/O feedback area                                    CBLUPDK1
      *                                                                 CBLUPDK1
       01  MAJOR-MINOR-CODE.                                            CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IMAJMIN.                           CBLUPDK1
      *    Display major/minor code for timeouts                        CBLUPDK1
      *                                                                 CBLUPDK1
       01  ACLDGNATL0-OPEN.                                             CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IOPEN.                             CBLUPDK1
      *    Open feedback area                                           CBLUPDK1
      *                                                                 CBLUPDK1
       01  ACBATPRML2-OPEN.                                             CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IOPEN.                             CBLUPDK1
      *    Open feedback area                                           CBLUPDK1
      *                                                                 CBLUPDK1
       01  ACLDGTYPL1-OPEN.                                             CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IOPEN.                             CBLUPDK1
      *    Open feedback area                                           CBLUPDK1
      *                                                                 CBLUPDK1
       01  ACLDGNATL1-OPEN.                                             CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IOPEN.                             CBLUPDK1
      *    Open feedback area                                           CBLUPDK1
      *                                                                 CBLUPDK1
       01  ACPEDTNATD-WS-O.                                             CBLUPDK1
           03  ZSFLRCD-WS-O.                                            CBLUPDK1
           COPY DDS-ZSFLRCD-O OF ACPEDTNATD.                            CBLUPDK1
             06 FILLER            PIC X(1).                             CBLUPDK1
           03  ZSFLCTL-WS-O.                                            CBLUPDK1
           COPY DDS-ZSFLCTL-O OF ACPEDTNATD.                            CBLUPDK1
             06 FILLER            PIC X(1).                             CBLUPDK1
           03  ZCMDTXT1-WS-O.                                           CBLUPDK1
           COPY DDS-ZCMDTXT1-O OF ACPEDTNATD.                           CBLUPDK1
             06 FILLER            PIC X(1).                             CBLUPDK1
           03  ZMSGCTL-WS-O.                                            CBLUPDK1
           COPY DDS-ZMSGCTL-O OF ACPEDTNATD.                            CBLUPDK1
             06 FILLER            PIC X(1).                             CBLUPDK1
           03  ZCONFIRM-WS-O.                                           CBLUPDK1
           COPY DDS-ZCONFIRM-O OF ACPEDTNATD.                           CBLUPDK1
             06 FILLER            PIC X(1).                             CBLUPDK1
       01  ACPEDTNATD-WS-I.                                             CBLUPDK1
           03  ZSFLRCD-WS-I.                                            CBLUPDK1
           COPY DDS-ZSFLRCD-I OF ACPEDTNATD.                            CBLUPDK1
             06  FILLER        PIC X.                                   CBLUPDK1
           03  ZSFLCTL-WS-I.                                            CBLUPDK1
           COPY DDS-ZSFLCTL-I OF ACPEDTNATD.                            CBLUPDK1
             06  FILLER        PIC X.                                   CBLUPDK1
           03  ZCMDTXT1-WS-I.                                           CBLUPDK1
           COPY DDS-ZCMDTXT1-I OF ACPEDTNATD.                           CBLUPDK1
             06  FILLER        PIC X.                                   CBLUPDK1
           03  ZMSGCTL-WS-I.                                            CBLUPDK1
           COPY DDS-ZMSGCTL-I OF ACPEDTNATD.                            CBLUPDK1
             06  FILLER        PIC X.                                   CBLUPDK1
           03  ZCONFIRM-WS-I.                                           CBLUPDK1
           COPY DDS-ZCONFIRM-I OF ACPEDTNATD.                           CBLUPDK1
             06  FILLER        PIC X.                                   CBLUPDK1
       01  W0OPN PIC X(1).                                              CBLUPDK1
       01  W0PMT PIC X(1).                                              CBLUPDK1
      *    U:update (Y/N)                                               ACTCTXK4
       01  WORK-CONTEXT.                                                ACTCTXK4
           03  WUUPDYN PIC X(1).                                        ACTCTXK4
       01  KEXIN.                                                       CHKSTSK1
      *    List number                                                  CHKSTSK1
           03  Y2LSNO PIC S9(7) COMP-3.                                 CHKSTSK1
      *    External value                                               CHKSTSK1
           03  Y2EXVL PIC X(25).                                        CHKSTSK1
       01  W0NSRQ PIC X(1).                                             CHKSTSK1
       01  KINEX.                                                       CVTSTSK1
      *    List number                                                  CVTSTSK1
           03  Y2LSNO PIC S9(7) COMP-3.                                 CVTSTSK1
      *    Internal value                                               CVTSTSK1
           03  Y2INVL PIC X(25).                                        CVTSTSK1
      *    List number                                                  CHKSTSK1
      *    Higher level already exists                                  CHKSTSK1
      *    External value                                               CHKSTSK1
      *    Higher level already exists                                  CHKSTSK1
      *                                                                 CBLHDRK1
      *    Indicators                                                   CBLHDRK1
       01  INDICS.                                                      CBLHDRK1
           03  IND PIC 1(1) OCCURS 99 INDICATOR 1.                      CBLHDRK1
           88  C-INDICATOR-ON VALUE B'1'.                               CBLHDRK1
           88  C-INDICATOR-OFF VALUE B'0'.                              CBLHDRK1
      *                                                                 CBLHDRK1
      /EJECT                                                            DCLPARK1
      *    Parameter declarations                                       DCLPARK1
      * Utl set screen sysid (Fle                                       CBLUFNK1
      *.Start.of.User.source........................................... CBLUFNK1
       01  RUK-DTAARA-NAME             PIC X(10).                       CBLUFNK1
      *.End.of.user.source............................................. CBLUFNK1
      /EJECT                                                            DCLPARK1
      ***************************************************************   DCLPARK1
       LINKAGE SECTION.                                                 DCLPARK1
      *    Return code                                                  DCLPARK1
       01  P0RTN PIC X(7).                                              DCLPARK1
       01  P1PARM.                                                      DCLPARK1
      *    Ledger Type Code                                             DCLPARK1
           03  P1LDGTYP PIC X(1).                                       DCLPARK1
      *    Ledger Type Description                                      DCLPARK1
       01  WP0001 PIC X(35).                                            DCLPARK1
      ***************************************************************   CBLHDRK1
       PROCEDURE DIVISION USING                                         CBLHDRK1
             P0RTN                                                      DCLPARK1
      *    KEY: Ledger Nature             Retrieval index               DCLPARK1
      *    I : RST Ledger Type Code                                     DCLPARK1
      *    I : MAP Ledger Type Description                              DCLPARK1
      *    KEY : Ledger Nature                                          DCLPARK1
             P1PARM                                                     DCLPARK1
      *    Ledger Type Description                                      DCLPARK1
             WP0001                                                     DCLPARK1
           .                                                            DCLPARK1
      *    Initialise work fields from entry parameters                 DCLPARK1
           MOVE WP0001 TO P2LDGDES                                      DCLPARK1
      ***************************************************************   CBLHDRK1
           CONTINUE.                                                    CBLHDRK1
       MAINLINE SECTION.                                                CBLHDRK1
      *    Initialize                                                   CBLHDRK1
           PERFORM ZZINIT                                               CBLHDRK1
      *                                                                 CBLHDRK1
      *    Main loop                                                    EDTFILK1
           PERFORM UNTIL NOT (C-FOREVER)                                EDTFILK1
      *        Initialise and load subfile page                         EDTFILK1
               PERFORM BAIZSF                                           EDTFILK1
               MOVE 'N' TO W0RSF                                        EDTFILK1
      *        Display screen until reload requested                    EDTFILK1
               PERFORM UNTIL NOT (W0RSF = 'N')                          EDTFILK1
      *            Display screen                                       EDTFILK1
                   PERFORM CAEXFM                                       EDTFILK1
      *            Process response                                     EDTFILK1
      *            EVALUATE                                             EDTFILK1
      *                Cancel & exit program                            EDTFILK1
                       IF (C-INDICATOR-ON(03) OR                        EDTFILK1
                           C-INDICATOR-ON(12)) THEN                     EDTFILK1
                           PERFORM ZXEXPG                               EDTFILK1
      *                HOME: Request subfile reload                     EDTFILK1
                       ELSE IF (C-INDICATOR-ON(05)) THEN                EDTFILK1
                           PERFORM FBRQRL                               EDTFILK1
      *                Display next SFL page                            EDTFILK1
                       ELSE IF (C-INDICATOR-ON(27)) THEN                EDTFILK1
                           PERFORM BBLDSF                               EDTFILK1
      *                Process screen input                             EDTFILK1
                       ELSE                                             EDTFILK1
                           PERFORM DAPRZZ                               EDTFILK1
      *                                                                 EDTFILK1
                   END-IF END-IF END-IF                                 EDTFILK1
               END-PERFORM                                              EDTFILK1
      *                                                                 EDTFILK1
           END-PERFORM                                                  EDTFILK1
           .                                                            EDTFILK1
           EXIT.                                                        EDTFILK1
      ***************************************************************   EDTFILK1
      /EJECT                                                            EDTFILK1
       BAIZSF SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Initialise & load subfile page                               EDTFILK1
      *==============================================================   EDTFILK1
      *    Clear subfile                                                EDTFILK1
           SET C-INDICATOR-ON(80) TO TRUE                               EDTFILK1
           WRITE ACPEDTNATD-F FROM ZSFLCTL-WS-O                         EDTFILK1
             FORMAT IS 'ZSFLCTL' INDICATORS ARE INDICS                  EDTFILK1
           END-WRITE                                                    EDTFILK1
           SET C-INDICATOR-OFF(80) TO TRUE                              EDTFILK1
      *    Reset count of SFL records                                   EDTFILK1
           MOVE ZERO TO ZZRRMX                                          EDTFILK1
           SET C-INDICATOR-OFF(81) TO TRUE                              EDTFILK1
      *    If CHANGE mode, then position file:                          EDTFILK1
           IF (NOT C-ADD-MODE) THEN                                     EDTFILK1
      *        Setup key                                                KEYLSTK1
      *        Ledger Type Code                                         KEYLSTK1
               MOVE Z2LDGTYP OF ZSFLCTL-WS-O TO ASLDGTYP OF KPOS        KEYLSTK1
      *        Ledger Nature Code                                       KEYLSTK1
               MOVE SPACES TO ASLDGNAT OF KPOS                          KEYLSTK1
      *        Initialise Full Externally Described Keylist             EDTFILK1
      *        Ledger Type Code                                         EDTFILK1
               MOVE SPACES TO ASLDGTYP OF KPOS-EXT                      EDTFILK1
      *        Ledger Nature Code                                       EDTFILK1
               MOVE SPACES TO ASLDGNAT OF KPOS-EXT                      EDTFILK1
               MOVE CORRESPONDING                                       EDTFILK1
                 KPOS-EXT TO                                            EDTFILK1
                 FLDGNB8 OF ACLDGNATL0-R                                EDTFILK1
               MOVE CORRESPONDING                                       EDTFILK1
                 KPOS TO                                                EDTFILK1
                 FLDGNB8 OF ACLDGNATL0-R                                EDTFILK1
               START ACLDGNATL0 KEY NOT < EXTERNALLY-DESCRIBED-KEY      EDTFILK1
                 FORMAT IS 'FLDGNB8'                                    EDTFILK1
               END-START                                                EDTFILK1
               IF (C-IO-ERR) THEN                                       EDTFILK1
                   STOP RUN                                             EDTFILK1
               END-IF                                                   EDTFILK1
               IF (C-EOF) THEN                                          EDTFILK1
                   SET C-INDICATOR-ON(82) TO TRUE                       EDTFILK1
               ELSE                                                     EDTFILK1
                   SET C-INDICATOR-OFF(82) TO TRUE                      EDTFILK1
               END-IF                                                   EDTFILK1
      *        Setup key                                                KEYLSTK1
      *        Ledger Type Code                                         KEYLSTK1
               MOVE Z2LDGTYP OF ZSFLCTL-WS-O TO ASLDGTYP OF KRST        KEYLSTK1
      *        Initialise Full Externally Described Keylist             EDTFILK1
      *        Ledger Type Code                                         EDTFILK1
               MOVE SPACES TO ASLDGTYP OF KRST-EXT                      EDTFILK1
      *        Ledger Nature Code                                       EDTFILK1
               MOVE SPACES TO ASLDGNAT OF KRST-EXT                      EDTFILK1
               IF (C-INDICATOR-OFF(82)) THEN                            EDTFILK1
                   SET C-INDICATOR-OFF(82) TO TRUE                      EDTFILK1
                   SET C-INDICATOR-OFF(91) TO TRUE                      EDTFILK1
                   READ ACLDGNATL0 NEXT                                 EDTFILK1
                     FORMAT IS 'FLDGNB8'                                EDTFILK1
                   END-READ                                             EDTFILK1
                   IF (C-EOF) THEN                                      EDTFILK1
                       SET C-INDICATOR-ON(82) TO TRUE                   EDTFILK1
                   ELSE                                                 EDTFILK1
                       IF (C-IO-ERR) THEN                               EDTFILK1
                           SET C-INDICATOR-ON(91) TO TRUE               EDTFILK1
                       ELSE                                             EDTFILK1
                           MOVE CORRESPONDING                           EDTFILK1
                             FLDGNB8 OF ACLDGNATL0-R TO                 EDTFILK1
                             KRST-EXT                                   EDTFILK1
                           MOVE KRST-EXT TO KRST-TMP                    EDTFILK1
                           IF (KRST NOT = KRST-TMP) THEN                EDTFILK1
                               SET C-INDICATOR-ON(82) TO TRUE           EDTFILK1
                           END-IF                                       EDTFILK1
                       END-IF                                           EDTFILK1
                   END-IF                                               EDTFILK1
      *            Initialise Full Externally Described Keylist         EDTFILK1
      *            Ledger Type Code                                     EDTFILK1
                   MOVE SPACES TO ASLDGTYP OF KRST-EXT                  EDTFILK1
      *            Ledger Nature Code                                   EDTFILK1
                   MOVE SPACES TO ASLDGNAT OF KRST-EXT                  EDTFILK1
                   IF (C-IO-OK) THEN                                    EDTFILK1
                       MOVE CORRESPONDING                               EDTFILK1
                         FLDGNB8 OF ACLDGNATL0 TO Y1DBRC                EDTFILK1
                   END-IF                                               EDTFILK1
               END-IF                                                   EDTFILK1
      *                                                                 EDTFILK1
           ELSE                                                         EDTFILK1
               SET C-INDICATOR-OFF(82) TO TRUE                          EDTFILK1
      *                                                                 EDTFILK1
           END-IF                                                       EDTFILK1
      *    Load subfile page                                            EDTFILK1
           PERFORM BBLDSF                                               EDTFILK1
      *    If no records (first time only), switch to add mode and      EDTFILK1
      *      load again                                                 EDTFILK1
           IF (W0APM = 'Y' AND                                          EDTFILK1
               ZZRR = ZERO) THEN                                        EDTFILK1
               SET C-ADD-MODE TO TRUE                                   EDTFILK1
               SET C-INDICATOR-OFF(82) TO TRUE                          EDTFILK1
               PERFORM BBLDSF                                           EDTFILK1
           END-IF                                                       EDTFILK1
           MOVE 'N' TO W0APM                                            EDTFILK1
      *..............................................................   EDTFILK1
      *    If no records found, display error message                   EDTFILK1
           IF (C-INDICATOR-ON(82) AND                                   EDTFILK1
               ZZRR = ZERO) THEN                                        EDTFILK1
      *        Send message '*No data to display'                       SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'Y2U0008' TO ZAMSID                                 SNDMSGK1
      *        Message file                                             SNDMSGK1
               MOVE 'Y2USRMSG' TO ZAMSGF                                SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
           END-IF                                                       EDTFILK1
      *                                                                 EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       BAEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       BBLDSF SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    LOAD SUBFILE PAGE (WRITE EMPTY PAGE IF ADD MODE).            EDTFILK1
      *==============================================================   EDTFILK1
           SET C-INDICATOR-OFF(84) TO TRUE                              EDTFILK1
      *    No SFLNXTCHG                                                 EDTFILK1
      *    Re-establish fields in read-ahead record                     EDTFILK1
           IF (C-INDICATOR-ON(27)) THEN                                 EDTFILK1
               IF (C-INDICATOR-OFF(82) AND                              EDTFILK1
                   NOT C-ADD-MODE) THEN                                 EDTFILK1
                   SET C-INDICATOR-OFF(90) TO TRUE                      EDTFILK1
                   READ ACLDGNATL0 PRIOR                                EDTFILK1
                     FORMAT IS 'FLDGNB8'                                EDTFILK1
                   END-READ                                             EDTFILK1
                   IF (C-EOF) THEN                                      EDTFILK1
                       SET C-INDICATOR-ON(90) TO TRUE                   EDTFILK1
                   ELSE                                                 EDTFILK1
                       IF (C-IO-ERR) THEN                               EDTFILK1
                           STOP RUN                                     EDTFILK1
                       END-IF                                           EDTFILK1
                   END-IF                                               EDTFILK1
                   SET C-INDICATOR-OFF(90) TO TRUE                      EDTFILK1
                   READ ACLDGNATL0 NEXT                                 EDTFILK1
                     FORMAT IS 'FLDGNB8'                                EDTFILK1
                   END-READ                                             EDTFILK1
                   IF (C-EOF) THEN                                      EDTFILK1
                       SET C-INDICATOR-ON(90) TO TRUE                   EDTFILK1
                   ELSE                                                 EDTFILK1
                       IF (C-IO-ERR) THEN                               EDTFILK1
                           STOP RUN                                     EDTFILK1
                       END-IF                                           EDTFILK1
                   END-IF                                               EDTFILK1
                   MOVE CORRESPONDING                                   EDTFILK1
                     FLDGNB8 OF ACLDGNATL0 TO Y1DBRC                    EDTFILK1
               END-IF                                                   EDTFILK1
           END-IF                                                       EDTFILK1
      *                                                                 EDTFILK1
      *    Setof record error indicators                                EDTFILK1
           MOVE ALL B'0' TO WKIND0-A                                    EDTFILK1
           MOVE ALL B'1' TO WKIND1-A                                    EDTFILK1
      *    Start at previous highest record in SFL                      EDTFILK1
           MOVE ZZRRMX TO ZZRR                                          EDTFILK1
           MOVE ZERO TO ZZRROK                                          EDTFILK1
      *    Set required pages based on *Set Cursor or *Subfile Pages    EDTFILK1
           IF (W0RR0 > 0) THEN                                          EDTFILK1
               DIVIDE W0RR0 BY ZZSFPG GIVING ZZSPG REMAINDER ZZSLIN     EDTFILK1
               IF (ZZSLIN > 0) THEN                                     EDTFILK1
                   ADD 1 TO ZZSPG                                       EDTFILK1
               END-IF                                                   EDTFILK1
               IF (W0SPG > ZZSPG) THEN                                  EDTFILK1
                   MOVE W0SPG TO ZZSPG                                  EDTFILK1
               END-IF                                                   EDTFILK1
           ELSE                                                         EDTFILK1
               MOVE W0SPG TO ZZSPG                                      EDTFILK1
           END-IF                                                       EDTFILK1
      *    Compute lines required based on pages                        EDTFILK1
           MULTIPLY ZZSPG BY ZZSFPG GIVING ZZSFLN                       EDTFILK1
           IF (ZZSFLN > 999) THEN                                       EDTFILK1
               MOVE 999 TO ZZSFLN                                       EDTFILK1
           END-IF                                                       EDTFILK1
      *..............................................................   EDTFILK1
      *    Load next page of subfile:                                   EDTFILK1
           PERFORM UNTIL NOT (C-INDICATOR-OFF(82) AND                   EDTFILK1
                              ZZRROK < ZZSFLN)                          EDTFILK1
               ADD 1 TO ZZRR                                            EDTFILK1
               MOVE WKIND0(1) TO IND(31)                                EDTFILK1
               MOVE WKIND0(2) TO IND(32)                                EDTFILK1
               MOVE WKIND0(3) TO IND(33)                                EDTFILK1
               MOVE WKIND0(4) TO IND(34)                                EDTFILK1
               SET C-INDICATOR-OFF(87) TO TRUE                          EDTFILK1
      *        Clear subfile fields                                     EDTFILK1
               PERFORM MAIZZ1                                           EDTFILK1
      *        Record will be selected unless overridden                EDTFILK1
               MOVE 'Y' TO W0RSL                                        EDTFILK1
               SET RECORD-NOT-DROPPED TO TRUE                           EDTFILK1
      *        If CHANGE mode, load subfile fields                      EDTFILK1
               IF (NOT C-ADD-MODE) THEN                                 EDTFILK1
                   PERFORM MBFLZ1                                       EDTFILK1
                   IF (YPMTFD = SPACES) THEN                            EDTFILK1
      *                Initialise derived fields                        EDTFILK1
                       PERFORM MFIZZ2                                   EDTFILK1
                   END-IF                                               EDTFILK1
      *            Calculate function fields                            EDTFILK1
                   PERFORM DGZ2FN                                       EDTFILK1
      *            USER: Initialize subfile record (existing record)    MSGACTK2
      *            D:Ledger Location Desc                               DRVFLDK1
                   MOVE SPACES TO ZRLDGLCDES OF ZSFLRCD-WS-O            DRVFLDK1
      *            D:Ledger Location Desc                               MSGACTK2
      *            PAR.D:Ledger Location Desc = Condition name of       CBLCNMK1
      *              PAR.Ledger Location                                CBLCNMK1
                   MOVE 1106498 TO Y2LSTN                               CBLCNMK1
                   MOVE Z1LDGLOC OF ZSFLRCD-WS-O TO W0INVL              CBLCNMK1
                   MOVE ' ' TO W0VLMP                                   CBLCNMK1
                   CALL 'JSRVC2R' USING                                 CBLCNMK1
      *            Return code                                          CBLCNMK1
                     W0RTN                                              CBLCNMK1
      *            List number                                          CBLCNMK1
                     Y2LSTN                                             CBLCNMK1
      *            Ledger Location                                      CBLCNMK1
                     W0INVL                                             CBLCNMK1
      *            Value mapped                                         CBLCNMK1
                     W0VLMP                                             CBLCNMK1
      *            D:Ledger Location Desc                               CBLCNMK1
                     W0CNNM                                             CBLCNMK1
                   END-CALL                                             CBLCNMK1
                   MOVE W0CNNM TO ZRLDGLCDES OF ZSFLRCD-WS-O            CBLCNMK1
      *                                                                 CBLCNMK1
      *            Error on program call will terminate run unit        CBLCNMK1
      *                                                                 CBLCNMK1
      *            If record dropped...                                 EDTFILK1
                   IF (W0RSL NOT = 'Y') THEN                            EDTFILK1
                       SET RECORD-DROPPED TO TRUE                       EDTFILK1
                   ELSE                                                 EDTFILK1
                       SET RECORD-NOT-DROPPED TO TRUE                   EDTFILK1
                   END-IF                                               EDTFILK1
                   SUBTRACT 1 FROM ZZRR                                 EDTFILK1
                   IF (RECORD-NOT-DROPPED) THEN                         EDTFILK1
                       ADD 1 TO ZZRR                                    EDTFILK1
      *                Validate subfile record and calculate derived    EDTFILK1
      *                  fields                                         EDTFILK1
                       PERFORM DFV2RC                                   EDTFILK1
                   END-IF                                               EDTFILK1
               ELSE                                                     EDTFILK1
                   IF (YPMTFD = SPACES) THEN                            EDTFILK1
      *                USER: Initialize subfile record (new record)     MSGACTK2
      *                Ledger Location                                  CBLMOVK1
                       MOVE SPACES TO Z1LDGLOC OF ZSFLRCD-WS-O          CBLMOVK1
      *                D:Ledger Location Desc                           CBLMOVK1
                       MOVE SPACES TO ZRLDGLCDES OF ZSFLRCD-WS-O        CBLMOVK1
                   END-IF                                               EDTFILK1
               END-IF                                                   EDTFILK1
               IF (RECORD-NOT-DROPPED) THEN                             EDTFILK1
      *            Output to subfile                                    EDTFILK1
                   IF (ZZRR > ZERO) THEN                                EDTFILK1
                       SET C-INDICATOR-ON(81) TO TRUE                   EDTFILK1
                   ELSE                                                 EDTFILK1
                       SET C-INDICATOR-OFF(81) TO TRUE                  EDTFILK1
                   END-IF                                               EDTFILK1
                   ADD 1 TO ZZRROK                                      EDTFILK1
      *            If SFLRCD invalid, note that errors present          EDTFILK1
                   IF (C-INDICATOR-ON(98) AND                           EDTFILK1
                       C-INDICATOR-OFF(99)) THEN                        EDTFILK1
                       SET C-INDICATOR-ON(99) TO TRUE                   EDTFILK1
                   END-IF                                               EDTFILK1
      *            Set screen conditioning indicators                   EDTFILK1
                   PERFORM GADSA1                                       EDTFILK1
                   WRITE SUBFILE ACPEDTNATD-F FROM ZSFLRCD-WS-O         EDTFILK1
                     FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS          EDTFILK1
                   END-WRITE                                            EDTFILK1
               END-IF                                                   EDTFILK1
               IF (NOT C-ADD-MODE) THEN                                 EDTFILK1
                   SET C-INDICATOR-OFF(82) TO TRUE                      EDTFILK1
                   READ ACLDGNATL0 NEXT                                 EDTFILK1
                     FORMAT IS 'FLDGNB8'                                EDTFILK1
                   END-READ                                             EDTFILK1
                   IF (C-EOF) THEN                                      EDTFILK1
                       SET C-INDICATOR-ON(82) TO TRUE                   EDTFILK1
                   ELSE                                                 EDTFILK1
                       IF (C-IO-ERR) THEN                               EDTFILK1
                           STOP RUN                                     EDTFILK1
                       ELSE                                             EDTFILK1
                           MOVE CORRESPONDING                           EDTFILK1
                             FLDGNB8 OF ACLDGNATL0-R TO                 EDTFILK1
                             KRST-EXT                                   EDTFILK1
                           MOVE KRST-EXT TO KRST-TMP                    EDTFILK1
                           IF (KRST NOT = KRST-TMP) THEN                EDTFILK1
                               SET C-INDICATOR-ON(82) TO TRUE           EDTFILK1
                           END-IF                                       EDTFILK1
                       END-IF                                           EDTFILK1
                   END-IF                                               EDTFILK1
      *            Initialise Full Externally Described Keylist         EDTFILK1
      *            Ledger Type Code                                     EDTFILK1
                   MOVE SPACES TO ASLDGTYP OF KRST-EXT                  EDTFILK1
      *            Ledger Nature Code                                   EDTFILK1
                   MOVE SPACES TO ASLDGNAT OF KRST-EXT                  EDTFILK1
                   MOVE CORRESPONDING                                   EDTFILK1
                     FLDGNB8 OF ACLDGNATL0 TO Y1DBRC                    EDTFILK1
               END-IF                                                   EDTFILK1
           END-PERFORM                                                  EDTFILK1
      *..............................................................   EDTFILK1
      *    Save highest SFL record so load can continue at end point    EDTFILK1
           IF (ZZRR > ZZRRMX) THEN                                      EDTFILK1
      *        Calculate top line                                       EDTFILK1
               DIVIDE ZZRROK BY ZZSFPG GIVING ZZSPG REMAINDER ZZSLIN    EDTFILK1
               IF (ZZSLIN > 0) THEN                                     EDTFILK1
                   SUBTRACT ZZSLIN FROM ZZRR GIVING ZZSFRC OF           EDTFILK1
                     ZSFLCTL-WS-O                                       EDTFILK1
               ELSE                                                     EDTFILK1
                   SUBTRACT ZZSFPG FROM ZZRR GIVING ZZSFRC OF           EDTFILK1
                     ZSFLCTL-WS-O                                       EDTFILK1
               END-IF                                                   EDTFILK1
               ADD 1 TO ZZSFRC OF ZSFLCTL-WS-O                          EDTFILK1
               MOVE ZZRR TO ZZRRMX                                      EDTFILK1
           END-IF                                                       EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       BBEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       CAEXFM SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Display screen and process HELP requests                     EDTFILK1
      *==============================================================   EDTFILK1
      *    Set screen conditioning indicators                           EDTFILK1
           PERFORM GBDSA2                                               EDTFILK1
           SET C-UNTIL-FALSE TO TRUE                                    EDTFILK1
           PERFORM UNTIL (C-UNTIL-TRUE)                                 EDTFILK1
               MOVE 'N' TO W0HLP                                        EDTFILK1
      *        PUTOVR unless conditioned fields change                  EDTFILK1
               SET C-INDICATOR-ON(86) TO TRUE                           EDTFILK1
               IF (IND(89) NOT = CAIN89 OR                              EDTFILK1
                   IND(81) NOT = CAIN81) THEN                           EDTFILK1
                   SET C-INDICATOR-OFF(86) TO TRUE                      EDTFILK1
               END-IF                                                   EDTFILK1
               MOVE IND(89) TO CAIN89                                   EDTFILK1
               MOVE IND(81) TO CAIN81                                   EDTFILK1
      *        Set cursor by *SET CURSOR data                           CBLEXFK1
               IF (YSETCS = 'Y') THEN                                   CBLEXFK1
                   PERFORM Y0SET                                        CBLEXFK1
               END-IF                                                   CBLEXFK1
               WRITE ACPEDTNATD-F FROM ZMSGCTL-WS-O                     CBLEXFK1
                 FORMAT IS 'ZMSGCTL' INDICATORS ARE INDICS              CBLEXFK1
               END-WRITE                                                CBLEXFK1
               WRITE ACPEDTNATD-F FROM ZCMDTXT1-WS-O                    CBLEXFK1
                 FORMAT IS 'ZCMDTXT1' INDICATORS ARE INDICS             CBLEXFK1
               END-WRITE                                                CBLEXFK1
               WRITE ACPEDTNATD-F FROM ZSFLCTL-WS-O                     CBLEXFK1
                 FORMAT IS 'ZSFLCTL' INDICATORS ARE INDICS              CBLEXFK1
               END-WRITE                                                CBLEXFK1
               READ ACPEDTNATD                                          CBLEXFK1
                 FORMAT IS 'ZSFLCTL' INDICATORS ARE INDICS              CBLEXFK1
               END-READ                                                 CBLEXFK1
               MOVE ACPEDTNATD-F TO                                     CBLEXFK1
                 ZSFLCTL-WS-I                                           CBLEXFK1
      *        Maintain subfile position where possible                 EDTFILK1
               ACCEPT ACPEDTNATD-I-O-DSPF FROM I-O-FEEDBACK-AREA        EDTFILK1
                 FOR ACPEDTNATD                                         EDTFILK1
               IF (ZZSFRC OF ACPEDTNATD-I-O-DSPF > ZERO) THEN           EDTFILK1
                   MOVE ZZSFRC OF ACPEDTNATD-I-O-DSPF TO ZZSFRC OF      EDTFILK1
                     ZSFLCTL-WS-O                                       EDTFILK1
               END-IF                                                   EDTFILK1
      *                                                                 EDTFILK1
      *        Test cursor                                              EDTFILK1
               PERFORM Y8TST                                            EDTFILK1
      *        Check if prompt requested                                EDTFILK1
               PERFORM ZDVPMT                                           EDTFILK1
      *        Reset help request                                       DSPHLPK1
      *        Clear set cursor DDS indicator                           DSPHLPK1
               IF (WCSRLC = 'OFF') THEN                                 DSPHLPK1
                   SET C-INDICATOR-OFF(94) TO TRUE                      DSPHLPK1
               END-IF                                                   DSPHLPK1
               MOVE SPACES TO WCSRLC                                    DSPHLPK1
      *        If help requested, display help text                     DSPHLPK1
               IF (C-INDICATOR-ON(25)) THEN                             DSPHLPK1
                   PERFORM ZHHPKY                                       DSPHLPK1
               END-IF                                                   DSPHLPK1
           IF (W0HLP = 'N')                                             EDTFILK1
             SET C-UNTIL-TRUE TO TRUE                                   EDTFILK1
           END-IF                                                       EDTFILK1
           END-PERFORM                                                  EDTFILK1
      *    Update job time                                              EDTFILK1
           ACCEPT ZZTIME FROM TIME                                      EDTFILK1
           MOVE ZZHNS TO ZZJTM                                          EDTFILK1
      *    Clear messages from program message queue                    EDTFILK1
           MOVE ZZPGM OF JOB-CONTEXT TO ZAPGMQ                          EDTFILK1
           MOVE '*SAME' TO ZAPGRL                                       EDTFILK1
           CALL 'Y2CLMSC' USING                                         EDTFILK1
             ZAPGMQ                                                     EDTFILK1
             ZAPGRL                                                     EDTFILK1
           END-CALL                                                     EDTFILK1
      *    Reset first message only flag                                EDTFILK1
           MOVE 'Y' TO ZAFSMS                                           EDTFILK1
           SET C-INDICATOR-OFF(99) TO TRUE                              EDTFILK1
           IF (YSETCS = 'Y') THEN                                       EDTFILK1
               PERFORM Y9CLR                                            EDTFILK1
           END-IF                                                       EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       CAEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       DAPRZZ SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Process screen input                                         EDTFILK1
      *==============================================================   EDTFILK1
           IF (YPMTFD = SPACES) THEN                                    EDTFILK1
      *        USER: Validate subfile control                           MSGACTK2
      *        CASE: CTL.*CMD key is *Previous panel                    MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (C-INDICATOR-ON(12)) THEN                             CBLIFXK1
      *            *Return code                                         CBLEXTK1
                   MOVE SPACES TO P0RTN                                 CBLEXTK1
                   PERFORM ZYEXPG                                       CBLEXTK1
               END-IF                                                   MSGACTK2
           END-IF                                                       EDTFILK1
      *    Quit if reload requested                                     EDTFILK1
           IF (W0RSF = 'Y') THEN                                        EDTFILK1
             GO DAEXIT                                                  EDTFILK1
           END-IF                                                       EDTFILK1
      *                                                                 EDTFILK1
           IF (C-INDICATOR-ON(81)) THEN                                 EDTFILK1
      *        No data entered as yet                                   EDTFILK1
               MOVE 'N' TO WKIPIN                                       EDTFILK1
      *        Confirm/update is not deferred                           EDTFILK1
               MOVE 'N' TO W0DCF                                        EDTFILK1
      *        Process subfile records                                  EDTFILK1
               PERFORM DBPRSF                                           EDTFILK1
      *        If error, exit                                           EDTFILK1
               IF (C-INDICATOR-ON(99)) THEN                             EDTFILK1
                 GO DAEXIT                                              EDTFILK1
               END-IF                                                   EDTFILK1
               IF (YPMTFD NOT = SPACES) THEN                            EDTFILK1
                   GO DAEXIT                                            EDTFILK1
               END-IF                                                   EDTFILK1
      *        Defer confirm/update requested                           EDTFILK1
               IF (W0DCF = 'Y') THEN                                    EDTFILK1
                 GO DAEXIT                                              EDTFILK1
               END-IF                                                   EDTFILK1
      *        If data entered                                          EDTFILK1
               IF (WKIPIN = 'Y') THEN                                   EDTFILK1
      *            Prompt for confirmation                              EDTFILK1
                   PERFORM DHPRCF                                       EDTFILK1
      *            Exit if not confirmed                                EDTFILK1
                   IF (C-INDICATOR-ON(99)) THEN                         EDTFILK1
                       SET C-INDICATOR-OFF(99) TO TRUE                  EDTFILK1
                       GO DAEXIT                                        EDTFILK1
                   END-IF                                               EDTFILK1
      *            Update DBF from subfile                              EDTFILK1
                   PERFORM EAPRSF                                       EDTFILK1
      *            If error during update, exit:                        EDTFILK1
                   IF (C-INDICATOR-ON(99)) THEN                         EDTFILK1
                     GO DAEXIT                                          EDTFILK1
                   END-IF                                               EDTFILK1
               END-IF                                                   EDTFILK1
           END-IF                                                       EDTFILK1
      *    =========Process function keys=========                      EDTFILK1
      *    Switch between *ADD/*CHANGE modes                            EDTFILK1
           IF (C-INDICATOR-ON(09)) THEN                                 EDTFILK1
               PERFORM FACHMD                                           EDTFILK1
           END-IF                                                       EDTFILK1
           IF (YPMTFD = SPACES) THEN                                    EDTFILK1
      *        USER: Process command keys                               MSGACTK2
      *        go to Change mode automatically afer add                 MSGACTK2
      *        CASE:                                                    MSGACTK2
      *        - c1ANDc2                                                MSGACTK2
      *        |- c1    : PGM.*Program mode is *ADD                     MSGACTK2
      *        |- c2    : WRK.U:update (Y/N) is Yes                     MSGACTK2
      *        '-                                                       MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (W0PMD = 'ADD' AND                                    CBLIFXK1
                   WUUPDYN OF WORK-CONTEXT = 'Y') THEN                  CBLIFXK1
      *            *Program mode                                        CBLMOVK1
                   MOVE 'CHG' TO W0PMD                                  CBLMOVK1
      *            U:update (Y/N)                                       CBLMOVK1
                   MOVE 'N' TO WUUPDYN OF WORK-CONTEXT                  CBLMOVK1
               END-IF                                                   MSGACTK2
      *        *Reload subfile                                          CBLMOVK1
               MOVE 'Y' TO W0RSF                                        CBLMOVK1
           END-IF                                                       EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       DAEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       DBPRSF SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Process modified subfile record                              EDTFILK1
      *==============================================================   EDTFILK1
           IF (YAFSCH NOT = ZERO) THEN                                  EDTFILK1
               MOVE YAFSCH TO ZZRR                                      EDTFILK1
               READ SUBFILE ACPEDTNATD                                  EDTFILK1
                 FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS              EDTFILK1
               END-READ                                                 EDTFILK1
               MOVE ACPEDTNATD-F TO                                     EDTFILK1
                 ZSFLRCD-WS-I                                           EDTFILK1
               IF (C-NO-RECORD) THEN                                    EDTFILK1
                   SET C-INDICATOR-ON(92) TO TRUE                       EDTFILK1
               ELSE                                                     EDTFILK1
                   SET C-INDICATOR-OFF(92) TO TRUE                      EDTFILK1
               END-IF                                                   EDTFILK1
           ELSE                                                         EDTFILK1
               READ SUBFILE ACPEDTNATD NEXT MODIFIED                    EDTFILK1
                 FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS              EDTFILK1
               END-READ                                                 EDTFILK1
               MOVE ACPEDTNATD-F TO                                     EDTFILK1
                 ZSFLRCD-WS-I                                           EDTFILK1
               IF (C-NO-MOD-SFLRCDS) THEN                               EDTFILK1
                   SET C-INDICATOR-ON(92) TO TRUE                       EDTFILK1
               ELSE                                                     EDTFILK1
                   SET C-INDICATOR-OFF(92) TO TRUE                      EDTFILK1
               END-IF                                                   EDTFILK1
           END-IF                                                       EDTFILK1
           PERFORM UNTIL NOT (C-INDICATOR-OFF(92))                      EDTFILK1
               MOVE CORRESPONDING                                       EDTFILK1
                 ZSFLRCD-I OF ZSFLRCD-WS-I TO                           EDTFILK1
                 ZSFLRCD-O OF ZSFLRCD-WS-O                              EDTFILK1
               PERFORM DCPRSR                                           EDTFILK1
               SET C-INDICATOR-OFF(87) TO TRUE                          EDTFILK1
      *        Set screen conditioning indicators                       EDTFILK1
               PERFORM GADSA1                                           EDTFILK1
               REWRITE SUBFILE ACPEDTNATD-F FROM ZSFLRCD-WS-O           EDTFILK1
                 FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS              EDTFILK1
               END-REWRITE                                              EDTFILK1
               READ SUBFILE ACPEDTNATD NEXT MODIFIED                    EDTFILK1
                 FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS              EDTFILK1
               END-READ                                                 EDTFILK1
               MOVE ACPEDTNATD-F TO                                     EDTFILK1
                 ZSFLRCD-WS-I                                           EDTFILK1
               IF (C-NO-MOD-SFLRCDS) THEN                               EDTFILK1
                   SET C-INDICATOR-ON(92) TO TRUE                       EDTFILK1
               ELSE                                                     EDTFILK1
                   SET C-INDICATOR-OFF(92) TO TRUE                      EDTFILK1
               END-IF                                                   EDTFILK1
           END-PERFORM                                                  EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       DBEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       DCPRSR SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Process subfile record                                       EDTFILK1
      *==============================================================   EDTFILK1
      *    Set off error indicators                                     EDTFILK1
           MOVE WKIND0(1) TO IND(31)                                    EDTFILK1
           MOVE WKIND0(2) TO IND(32)                                    EDTFILK1
           MOVE WKIND0(3) TO IND(33)                                    EDTFILK1
           MOVE WKIND0(4) TO IND(34)                                    EDTFILK1
      *    SFLRCD error                                                 EDTFILK1
           SET C-INDICATOR-OFF(98) TO TRUE                              EDTFILK1
      *    No SFLNXTCHG                                                 EDTFILK1
           SET C-INDICATOR-OFF(84) TO TRUE                              EDTFILK1
      *    Initialise derived fields                                    EDTFILK1
           IF (YPMTFD = SPACES) THEN                                    EDTFILK1
               PERFORM MFIZZ2                                           EDTFILK1
           END-IF                                                       EDTFILK1
           IF (C-ADD-MODE) THEN                                         EDTFILK1
      *        Check for null record                                    EDTFILK1
               PERFORM DDNLRC                                           EDTFILK1
               IF (W0NLR = 'Y' AND                                      EDTFILK1
                   ZZRR NOT = YPMRRN) THEN                              EDTFILK1
                   GO DCEXIT                                            EDTFILK1
               END-IF                                                   EDTFILK1
      *        If not null record, continue                             EDTFILK1
           END-IF                                                       EDTFILK1
      *    Data entered                                                 EDTFILK1
           MOVE 'Y' TO WKIPIN                                           EDTFILK1
      *    Condition SFLNXTCHG                                          EDTFILK1
           SET C-INDICATOR-ON(84) TO TRUE                               EDTFILK1
      *    Validate subfile record                                      EDTFILK1
           PERFORM DEV1RC                                               EDTFILK1
      *    If SFLRCD invalid, note the fact                             EDTFILK1
           IF (C-INDICATOR-ON(98) AND                                   EDTFILK1
               C-INDICATOR-OFF(99)) THEN                                EDTFILK1
               MOVE ZZRR TO ZZSFRC OF ZSFLCTL-WS-O                      EDTFILK1
               IF (ZZSFRC OF ZSFLCTL-WS-O > ZERO) THEN                  EDTFILK1
                   SET C-INDICATOR-ON(99) TO TRUE                       EDTFILK1
               ELSE                                                     EDTFILK1
                   SET C-INDICATOR-OFF(99) TO TRUE                      EDTFILK1
               END-IF                                                   EDTFILK1
           END-IF                                                       EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       DCEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       DDNLRC SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Check for null record                                        EDTFILK1
      *==============================================================   EDTFILK1
           MOVE 'N' TO W0NLR                                            EDTFILK1
      *    Ledger Nature Code                                           EDTFILK1
           IF (Z1LDGNAT OF ZSFLRCD-WS-O NOT = SPACES) THEN              EDTFILK1
             GO DDEXIT                                                  EDTFILK1
           END-IF                                                       EDTFILK1
      *    Ledger Nature Description                                    EDTFILK1
           IF (Z1NATDES OF ZSFLRCD-WS-O NOT = SPACES) THEN              EDTFILK1
             GO DDEXIT                                                  EDTFILK1
           END-IF                                                       EDTFILK1
      *    Ledger Location                                              EDTFILK1
           IF (Z1LDGLOC OF ZSFLRCD-WS-O NOT = SPACES) THEN              EDTFILK1
             GO DDEXIT                                                  EDTFILK1
           END-IF                                                       EDTFILK1
           MOVE 'Y' TO W0NLR                                            EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       DDEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       DEV1RC SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Validate subfile record                                      EDTFILK1
      *==============================================================   EDTFILK1
      *    Validate Ledger Location                                     CHKSTSK1
           MOVE SPACES TO W0RTN                                         CHKSTSK1
      *    Name search required?                                        CHKSTSK1
      *    Ledger Location                                              CHKSTSK1
           MOVE Z1LDGLOC OF ZSFLRCD-WS-O TO W0NSRQ                      CHKSTSK1
      *    Search required                                              CHKSTSK1
           IF (W0NSRQ = '?' OR                                          CHKSTSK1
               'Z1LDGLOC O' = YPMTFD AND                                CHKSTSK1
               ZZRR = YPMRRN) THEN                                      CHKSTSK1
               MOVE Z1LDGLOC OF ZSFLRCD-WS-O TO W0EXVL                  CHKSTSK1
               MOVE 1106498 TO Y2LSNO OF KEXIN                          CHKSTSK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CHKSTSK1
               CALL 'JSVLLSR' USING                                     CHKSTSK1
      *        Return code                                              CHKSTSK1
                 W0RTN                                                  CHKSTSK1
      *        List number                                              CHKSTSK1
                 Y2LSNO OF KEXIN                                        CHKSTSK1
      *        Ledger Location                                          CHKSTSK1
                 W0EXVL                                                 CHKSTSK1
                    ON OVERFLOW                                         CHKSTSK1
                       SET C-INDICATOR-ON(90) TO TRUE                   CHKSTSK1
               END-CALL                                                 CHKSTSK1
      *                                                                 CHKSTSK1
               IF (C-INDICATOR-ON(90)) THEN                             CHKSTSK1
                   MOVE 'Y2U0021' TO W0RTN                              CHKSTSK1
               END-IF                                                   CHKSTSK1
      *        Error on program call will terminate run unit            CHKSTSK1
               MOVE W0EXVL TO Z1LDGLOC OF ZSFLRCD-WS-O                  CHKSTSK1
      *        Defer confirm                                            CHKSTSK1
               MOVE 'Y' TO W0DCF                                        CHKSTSK1
               IF (W0NSRQ NOT = '?') THEN                               CHKSTSK1
                   MOVE '*DONE' TO YPMTFD                               CHKSTSK1
               END-IF                                                   CHKSTSK1
           END-IF                                                       CHKSTSK1
      *                                                                 CHKSTSK1
           IF (YPMTFD = SPACES) THEN                                    EDTFILK1
      *        USER: Validate subfile record fields                     MSGACTK2
      *        CASE: RCD.*SFLSEL is *Delete                             MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (Z1SEL OF ZSFLRCD-WS-O = '4') THEN                    CBLIFXK1
      *            Rtv Check if nature used? - Batch Parameter  *       CBLRTVK2
                   PERFORM SA1RVGN                                      CBLRTVK2
      *            Check return code                                    MSGACTK2
      *            CASE: PGM.*Return code is *Normal                    MSGACTK2
      *            *IF                                                  CBLIFXK1
                   IF (W0RTN = SPACES) THEN                             CBLIFXK1
      *                Send message 'Nature not deleted'                SNDMSGK1
      *                Message ID                                       SNDMSGK1
                       MOVE 'JSM0087' TO ZAMSID                         SNDMSGK1
                       PERFORM ZASNMS                                   SNDMSGK1
                       SET C-INDICATOR-ON(98) TO TRUE                   SNDMSGK2
      *                                                                 SNDMSGK2
                   ELSE                                                 MSGACTK2
      *                CASE: *OTHERWISE                                 MSGACTK2
      *                *Return code                                     CBLMOVK1
                       MOVE SPACES TO W0RTN                             CBLMOVK1
                   END-IF                                               MSGACTK2
               END-IF                                                   MSGACTK2
           END-IF                                                       EDTFILK1
      *    Validate subfile record relations                            EDTFILK1
           PERFORM DFV2RC                                               EDTFILK1
      *    Ledger Nature Code required                                  EDTFILK1
           IF (Z1LDGNAT OF ZSFLRCD-WS-O = SPACES AND                    EDTFILK1
               YPMTFD = SPACES) THEN                                    EDTFILK1
               SET C-INDICATOR-ON(98) TO TRUE                           EDTFILK1
               SET C-INDICATOR-ON(32) TO TRUE                           EDTFILK1
      *        Send message '*Value required'                           SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'Y2U0001' TO ZAMSID                                 SNDMSGK1
      *        Message file                                             SNDMSGK1
               MOVE 'Y2USRMSG' TO ZAMSGF                                SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
           END-IF                                                       EDTFILK1
      *    Ledger Nature Description required                           EDTFILK1
           IF (Z1NATDES OF ZSFLRCD-WS-O = SPACES AND                    EDTFILK1
               YPMTFD = SPACES) THEN                                    EDTFILK1
               SET C-INDICATOR-ON(98) TO TRUE                           EDTFILK1
               SET C-INDICATOR-ON(33) TO TRUE                           EDTFILK1
      *        Send message '*Value required'                           SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'Y2U0001' TO ZAMSID                                 SNDMSGK1
      *        Message file                                             SNDMSGK1
               MOVE 'Y2USRMSG' TO ZAMSGF                                SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
           END-IF                                                       EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       DEEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       DFV2RC SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Validate subfile record relations                            EDTFILK1
      *==============================================================   EDTFILK1
      *    Calculate function fields                                    EDTFILK1
           PERFORM DGZ2FN                                               EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       DFEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       DGZ2FN SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Calculate subfile record function fields                     EDTFILK1
      *==============================================================   EDTFILK1
           IF (YPMTFD = SPACES) THEN                                    EDTFILK1
      *        CALC: Subfile record function fields                     MSGACTK2
      *        D:Ledger Location Desc                                   DRVFLDK1
               MOVE SPACES TO ZRLDGLCDES OF ZSFLRCD-WS-O                DRVFLDK1
      *        D:Ledger Location Desc                                   MSGACTK2
      *        PAR.D:Ledger Location Desc = Condition name of           CBLCNMK1
      *          PAR.Ledger Location                                    CBLCNMK1
               MOVE 1106498 TO Y2LSTN                                   CBLCNMK1
               MOVE Z1LDGLOC OF ZSFLRCD-WS-O TO W0INVL                  CBLCNMK1
               MOVE ' ' TO W0VLMP                                       CBLCNMK1
               CALL 'JSRVC2R' USING                                     CBLCNMK1
      *        Return code                                              CBLCNMK1
                 W0RTN                                                  CBLCNMK1
      *        List number                                              CBLCNMK1
                 Y2LSTN                                                 CBLCNMK1
      *        Ledger Location                                          CBLCNMK1
                 W0INVL                                                 CBLCNMK1
      *        Value mapped                                             CBLCNMK1
                 W0VLMP                                                 CBLCNMK1
      *        D:Ledger Location Desc                                   CBLCNMK1
                 W0CNNM                                                 CBLCNMK1
               END-CALL                                                 CBLCNMK1
               MOVE W0CNNM TO ZRLDGLCDES OF ZSFLRCD-WS-O                CBLCNMK1
      *                                                                 CBLCNMK1
      *        Error on program call will terminate run unit            CBLCNMK1
      *                                                                 CBLCNMK1
           END-IF                                                       EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       DGEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       DHPRCF SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Prompt for confirmation                                      EDTFILK1
      *==============================================================   EDTFILK1
      *    Set screen conditioning indicators                           EDTFILK1
           PERFORM GBDSA2                                               EDTFILK1
      *    Force PUTOVR                                                 EDTFILK1
           SET C-INDICATOR-ON(86) TO TRUE                               EDTFILK1
           MOVE 'N' TO ZZCFCD OF ACPEDTNATD-WS-O                        CNFPMTK2
      *    Save CMD keys                                                CNFPMTK2
           MOVE INDICS TO WN30-A                                        CNFPMTK2
      *    Convert *CONFIRM to external value                           CVTSTSK1
      *    List number                                                  CVTSTSK1
           MOVE 1001713 TO Y2LSNO OF KINEX                              CVTSTSK1
      *    Internal value                                               CVTSTSK1
           MOVE SPACES TO Y2INVL OF KINEX                               CVTSTSK1
      *    *CONFIRM                                                     CVTSTSK1
           MOVE ZZCFCD OF ACPEDTNATD-WS-O TO Y2INVL OF KINEX            CVTSTSK1
           MOVE CORRESPONDING                                           CVTSTSK1
             KINEX TO                                                   CVTSTSK1
             YY2INEX OF JSVLLSL9-R                                      CVTSTSK1
           MOVE 'Y' TO Y2VLMP OF YY2INEX                                CVTSTSK1
           READ JSVLLSL9                                                CVTSTSK1
             FORMAT IS 'YY2INEX'                                        CVTSTSK1
           END-READ                                                     CVTSTSK1
           IF (C-NO-RECORD) THEN                                        CVTSTSK1
               SET C-INDICATOR-ON(90) TO TRUE                           CVTSTSK1
           ELSE                                                         CVTSTSK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CVTSTSK1
           END-IF                                                       CVTSTSK1
      *                                                                 CVTSTSK1
           IF (C-INDICATOR-OFF(90)) THEN                                CVTSTSK1
      *        *CONFIRM                                                 CVTSTSK1
               MOVE Y2EXVL OF YY2INEX OF JSVLLSL9 TO VZCFCD OF          CVTSTSK1
                 ACPEDTNATD-WS-O                                        CVTSTSK1
           END-IF                                                       CVTSTSK1
      *                                                                 CVTSTSK1
           SET C-UNTIL-FALSE TO TRUE                                    CNFPMTK2
           PERFORM UNTIL (C-UNTIL-TRUE)                                 CNFPMTK2
               SET C-INDICATOR-OFF(29) TO TRUE                          CNFPMTK2
               WRITE ACPEDTNATD-F FROM ZMSGCTL-WS-O                     CBLEXFK1
                 FORMAT IS 'ZMSGCTL' INDICATORS ARE INDICS              CBLEXFK1
               END-WRITE                                                CBLEXFK1
               WRITE ACPEDTNATD-F FROM ZCMDTXT1-WS-O                    CBLEXFK1
                 FORMAT IS 'ZCMDTXT1' INDICATORS ARE INDICS             CBLEXFK1
               END-WRITE                                                CBLEXFK1
               WRITE ACPEDTNATD-F FROM ZSFLCTL-WS-O                     CBLEXFK1
                 FORMAT IS 'ZSFLCTL' INDICATORS ARE INDICS              CBLEXFK1
               END-WRITE                                                CBLEXFK1
               WRITE ACPEDTNATD-F FROM ZCONFIRM-WS-O                    CBLEXFK1
                 FORMAT IS 'ZCONFIRM' INDICATORS ARE INDICS             CBLEXFK1
               END-WRITE                                                CBLEXFK1
               READ ACPEDTNATD                                          CBLEXFK1
                 FORMAT IS 'ZCONFIRM' INDICATORS ARE INDICS             CBLEXFK1
               END-READ                                                 CBLEXFK1
               MOVE ACPEDTNATD-F TO                                     CBLEXFK1
                 ZCONFIRM-WS-I                                          CBLEXFK1
               MOVE CORRESPONDING                                       CBLEXFK1
                 ZCONFIRM-I OF ZCONFIRM-WS-I TO                         CBLEXFK1
                 ZCONFIRM-O OF ZCONFIRM-WS-O                            CBLEXFK1
      *        Reset help request                                       DSPHLPK1
      *        Clear set cursor DDS indicator                           DSPHLPK1
               IF (WCSRLC = 'OFF') THEN                                 DSPHLPK1
                   SET C-INDICATOR-OFF(94) TO TRUE                      DSPHLPK1
               END-IF                                                   DSPHLPK1
               MOVE SPACES TO WCSRLC                                    DSPHLPK1
      *        If help requested, display help text                     DSPHLPK1
               IF (C-INDICATOR-ON(25)) THEN                             DSPHLPK1
                   PERFORM ZHHPKY                                       DSPHLPK1
               END-IF                                                   DSPHLPK1
      *        Validate *CONFIRM                                        CHKSTSK1
               MOVE SPACES TO W0RTN                                     CHKSTSK1
      *        Name search required?                                    CHKSTSK1
      *        *CONFIRM                                                 CHKSTSK1
               MOVE VZCFCD OF ACPEDTNATD-WS-O TO W0NSRQ                 CHKSTSK1
      *        Search required                                          CHKSTSK1
               IF (W0NSRQ = '?' OR                                      CHKSTSK1
                   'VZCFCD OF ' = YPMTFD) THEN                          CHKSTSK1
                   MOVE VZCFCD OF ACPEDTNATD-WS-O TO W0EXVL             CHKSTSK1
                   MOVE 1001713 TO Y2LSNO OF KEXIN                      CHKSTSK1
                   SET C-INDICATOR-OFF(90) TO TRUE                      CHKSTSK1
                   CALL 'JSVLLSR' USING                                 CHKSTSK1
      *            Return code                                          CHKSTSK1
                     W0RTN                                              CHKSTSK1
      *            List number                                          CHKSTSK1
                     Y2LSNO OF KEXIN                                    CHKSTSK1
      *            *CONFIRM                                             CHKSTSK1
                     W0EXVL                                             CHKSTSK1
                        ON OVERFLOW                                     CHKSTSK1
                           SET C-INDICATOR-ON(90) TO TRUE               CHKSTSK1
                   END-CALL                                             CHKSTSK1
      *                                                                 CHKSTSK1
                   IF (C-INDICATOR-ON(90)) THEN                         CHKSTSK1
                       MOVE 'Y2U0021' TO W0RTN                          CHKSTSK1
                   END-IF                                               CHKSTSK1
      *            Error on program call will terminate run unit        CHKSTSK1
                   MOVE W0EXVL TO VZCFCD OF ACPEDTNATD-WS-O             CHKSTSK1
      *            Defer confirm                                        CHKSTSK1
                   MOVE 'Y' TO W0DCF                                    CHKSTSK1
                   IF (W0NSRQ NOT = '?') THEN                           CHKSTSK1
                       MOVE '*DONE' TO YPMTFD                           CHKSTSK1
                   END-IF                                               CHKSTSK1
               END-IF                                                   CHKSTSK1
      *        Check external value of *CONFIRM                         CHKSTSK1
      *        Convert *CONFIRM to internal value                       CHKSTSK1
      *        List number                                              CHKSTSK1
               MOVE 1001713 TO Y2LSNO OF KEXIN                          CHKSTSK1
      *        External value                                           CHKSTSK1
               MOVE SPACES TO Y2EXVL OF KEXIN                           CHKSTSK1
      *        *CONFIRM                                                 CHKSTSK1
               MOVE VZCFCD OF ACPEDTNATD-WS-O TO Y2EXVL OF KEXIN        CHKSTSK1
               MOVE CORRESPONDING                                       CHKSTSK1
                 KEXIN TO                                               CHKSTSK1
                 YY2EXIN OF JSVLLSL9-R                                  CHKSTSK1
               READ JSVLLSL9                                            CHKSTSK1
                 FORMAT IS 'YY2EXIN'                                    CHKSTSK1
               END-READ                                                 CHKSTSK1
               MOVE CORRESPONDING                                       CHKSTSK1
                 YY2EXIN OF JSVLLSL9-R TO                               CHKSTSK1
                 KINEX                                                  CHKSTSK1
               IF (C-NO-RECORD) THEN                                    CHKSTSK1
                   SET C-INDICATOR-ON(90) TO TRUE                       CHKSTSK1
               ELSE                                                     CHKSTSK1
                   SET C-INDICATOR-OFF(90) TO TRUE                      CHKSTSK1
               END-IF                                                   CHKSTSK1
      *                                                                 CHKSTSK1
      *                                                                 CHKSTSK1
               IF (C-INDICATOR-ON(90)) THEN                             CHKSTSK1
      *            Not found                                            CHKSTSK1
                   MOVE SPACES TO ZZCFCD OF ACPEDTNATD-WS-O             CHKSTSK1
                   IF (YPMTFD = SPACES) THEN                            CHKSTSK1
                       SET C-INDICATOR-ON(96) TO TRUE                   CHKSTSK1
                       WRITE ACPEDTNATD-F FROM ZCONFIRM-WS-O            CHKSTSK1
                         FORMAT IS 'ZCONFIRM' INDICATORS ARE INDICS     CHKSTSK1
                       END-WRITE                                        CHKSTSK1
                       SET C-INDICATOR-OFF(96) TO TRUE                  CHKSTSK1
                   END-IF                                               CHKSTSK1
               ELSE                                                     CHKSTSK1
      *            *CONFIRM                                             CHKSTSK1
                   MOVE Y2INVL OF KINEX TO ZZCFCD OF ACPEDTNATD-WS-O    CHKSTSK1
               END-IF                                                   CHKSTSK1
      *                                                                 CHKSTSK1
           IF (W0HLP = 'N' AND                                          CNFPMTK2
               C-INDICATOR-OFF(90) AND                                  CNFPMTK2
               C-INDICATOR-OFF(29))                                     CNFPMTK2
             SET C-UNTIL-TRUE TO TRUE                                   CNFPMTK2
           END-IF                                                       CNFPMTK2
           END-PERFORM                                                  CNFPMTK2
      *    Restore CMD keys                                             CNFPMTK2
           MOVE 1 TO IND-COUNT                                          CNFPMTK2
           SET C-UNTIL-FALSE TO TRUE                                    CNFPMTK2
           PERFORM UNTIL (C-UNTIL-TRUE)                                 CNFPMTK2
               MOVE WN30(IND-COUNT) TO IND(IND-COUNT)                   CNFPMTK2
               ADD 1 TO IND-COUNT                                       CNFPMTK2
           IF (IND-COUNT > 30)                                          CNFPMTK2
             SET C-UNTIL-TRUE TO TRUE                                   CNFPMTK2
           END-IF                                                       CNFPMTK2
           END-PERFORM                                                  CNFPMTK2
      *    Update job time                                              CNFPMTK2
           ACCEPT ZZTIME FROM TIME                                      CNFPMTK2
           MOVE ZZHNS TO ZZJTM OF JOB-CONTEXT                           CNFPMTK2
           IF (ZZCFCD OF ACPEDTNATD-WS-O NOT = 'Y') THEN                CNFPMTK2
                 SET C-INDICATOR-ON(99) TO TRUE                         CNFPMTK2
           ELSE                                                         CNFPMTK2
      *        Clear messages from program message queue                CNFPMTK2
               MOVE ZZPGM OF JOB-CONTEXT TO ZAPGMQ                      CNFPMTK2
               MOVE '*SAME' TO ZAPGRL                                   CNFPMTK2
               CALL 'Y2CLMSC' USING                                     CNFPMTK2
                 ZAPGMQ                                                 CNFPMTK2
                 ZAPGRL                                                 CNFPMTK2
               END-CALL                                                 CNFPMTK2
      *        Reset first message only flag                            CNFPMTK2
               MOVE 'Y' TO ZAFSMS                                       CNFPMTK2
                 SET C-INDICATOR-OFF(99) TO TRUE                        CNFPMTK2
           END-IF                                                       CNFPMTK2
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       DHEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       EAPRSF SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Update DBF from subfile                                      EDTFILK1
      *==============================================================   EDTFILK1
      *    Initialise subfile reload flag                               EDTFILK1
           IF (C-ADD-MODE) THEN                                         EDTFILK1
               MOVE 'Y' TO W0RSF                                        EDTFILK1
           ELSE                                                         EDTFILK1
               MOVE 'N' TO W0RSF                                        EDTFILK1
           END-IF                                                       EDTFILK1
      *    Process all modified subfile records                         EDTFILK1
           READ SUBFILE ACPEDTNATD NEXT MODIFIED                        EDTFILK1
             FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS                  EDTFILK1
           END-READ                                                     EDTFILK1
           MOVE ACPEDTNATD-F TO                                         EDTFILK1
             ZSFLRCD-WS-I                                               EDTFILK1
           IF (C-NO-MOD-SFLRCDS) THEN                                   EDTFILK1
               SET C-INDICATOR-ON(92) TO TRUE                           EDTFILK1
           ELSE                                                         EDTFILK1
               SET C-INDICATOR-OFF(92) TO TRUE                          EDTFILK1
           END-IF                                                       EDTFILK1
           PERFORM UNTIL NOT (C-INDICATOR-OFF(92))                      EDTFILK1
               MOVE CORRESPONDING                                       EDTFILK1
                 ZSFLRCD-I OF ZSFLRCD-WS-I TO                           EDTFILK1
                 ZSFLRCD-O OF ZSFLRCD-WS-O                              EDTFILK1
      *        Process modified subfile record                          EDTFILK1
               PERFORM EBPRSR                                           EDTFILK1
               MOVE SPACES TO Z1SEL OF ZSFLRCD-WS-O                     EDTFILK1
      *        Set screen conditioning indicators                       EDTFILK1
               PERFORM GADSA1                                           EDTFILK1
               REWRITE SUBFILE ACPEDTNATD-F FROM ZSFLRCD-WS-O           EDTFILK1
                 FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS              EDTFILK1
               END-REWRITE                                              EDTFILK1
               READ SUBFILE ACPEDTNATD NEXT MODIFIED                    EDTFILK1
                 FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS              EDTFILK1
               END-READ                                                 EDTFILK1
               MOVE ACPEDTNATD-F TO                                     EDTFILK1
                 ZSFLRCD-WS-I                                           EDTFILK1
               IF (C-NO-MOD-SFLRCDS) THEN                               EDTFILK1
                   SET C-INDICATOR-ON(92) TO TRUE                       EDTFILK1
               ELSE                                                     EDTFILK1
                   SET C-INDICATOR-OFF(92) TO TRUE                      EDTFILK1
               END-IF                                                   EDTFILK1
           END-PERFORM                                                  EDTFILK1
      *    If any errors, cancel reload                                 EDTFILK1
           IF (C-INDICATOR-ON(99)) THEN                                 EDTFILK1
               MOVE 'N' TO W0RSF                                        EDTFILK1
           END-IF                                                       EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       EAEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       EBPRSR SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Process modified subfile record                              EDTFILK1
      *==============================================================   EDTFILK1
      *    Set off error indicators                                     EDTFILK1
      *    Clear errors                                                 EDTFILK1
           MOVE WKIND0(1) TO IND(31)                                    EDTFILK1
           MOVE WKIND0(2) TO IND(32)                                    EDTFILK1
           MOVE WKIND0(3) TO IND(33)                                    EDTFILK1
           MOVE WKIND0(4) TO IND(34)                                    EDTFILK1
           SET C-INDICATOR-OFF(98) TO TRUE                              EDTFILK1
      *                                                                 EDTFILK1
           IF (C-ADD-MODE) THEN                                         EDTFILK1
      *        Process add request                                      EDTFILK1
               PERFORM DDNLRC                                           EDTFILK1
               IF (W0NLR NOT = 'Y') THEN                                EDTFILK1
                   PERFORM ECADRQ                                       EDTFILK1
               END-IF                                                   EDTFILK1
           ELSE                                                         EDTFILK1
      *        Process change request                                   EDTFILK1
               PERFORM EECHRQ                                           EDTFILK1
           END-IF                                                       EDTFILK1
      *    If error occurred on update, note the fact                   EDTFILK1
           IF (C-INDICATOR-ON(98) AND                                   EDTFILK1
               C-INDICATOR-OFF(99)) THEN                                EDTFILK1
               MOVE ZZRR TO ZZSFRC OF ZSFLCTL-WS-O                      EDTFILK1
      *        Error on update                                          EDTFILK1
               IF (ZZSFRC OF ZSFLCTL-WS-O > ZERO) THEN                  EDTFILK1
                   SET C-INDICATOR-ON(99) TO TRUE                       EDTFILK1
               ELSE                                                     EDTFILK1
                   SET C-INDICATOR-OFF(99) TO TRUE                      EDTFILK1
               END-IF                                                   EDTFILK1
           ELSE                                                         EDTFILK1
      *        USER: Extra processing after DBF update                  MSGACTK2
      *        Set flag after *add                                      MSGACTK2
      *        CASE: PGM.*Program mode is *ADD                          MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (W0PMD = 'ADD') THEN                                  CBLIFXK1
      *            U:update (Y/N)                                       CBLMOVK1
                   MOVE 'Y' TO WUUPDYN OF WORK-CONTEXT                  CBLMOVK1
               ELSE                                                     MSGACTK2
      *            CASE: *OTHERWISE                                     MSGACTK2
      *            U:update (Y/N)                                       CBLMOVK1
                   MOVE 'N' TO WUUPDYN OF WORK-CONTEXT                  CBLMOVK1
               END-IF                                                   MSGACTK2
           END-IF                                                       EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       EBEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       ECADRQ SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Process add request                                          EDTFILK1
      *==============================================================   EDTFILK1
      *    USER: Create DBF record                                      MSGACTK2
     W* Y2W0053 - One or more arguments defaulted to available contexts CBLERRK1
      *    Field '(RCD) Z1LDGLOC OF ZSFLRCD-WS-O' defaulted for         GENPARK1
      *      'Ledger Location'.                                         GENPARK1
      *    Create Ledger Nature - Ledger Nature  *                      CBLCRTK1
           PERFORM SA2CRRC                                              CBLCRTK1
           IF (W0RTN NOT = SPACES) THEN                                 EDTFILK1
      *        Write error detected                                     EDTFILK1
      *        Screen errors                                            EDTFILK1
               MOVE WKIND1(1) TO IND(31)                                EDTFILK1
               MOVE WKIND1(2) TO IND(32)                                EDTFILK1
               MOVE WKIND1(3) TO IND(33)                                EDTFILK1
               MOVE WKIND1(4) TO IND(34)                                EDTFILK1
      *        Format error                                             EDTFILK1
               SET C-INDICATOR-ON(98) TO TRUE                           EDTFILK1
      *        Enable entry                                             EDTFILK1
               SET C-INDICATOR-OFF(87) TO TRUE                          EDTFILK1
      *        Condition SFLNXTCHG                                      EDTFILK1
               SET C-INDICATOR-ON(84) TO TRUE                           EDTFILK1
           ELSE                                                         EDTFILK1
      *        DBF write successful                                     EDTFILK1
      *        disable entry                                            EDTFILK1
               SET C-INDICATOR-ON(87) TO TRUE                           EDTFILK1
      *        No SFLNXTCHG                                             EDTFILK1
               SET C-INDICATOR-OFF(84) TO TRUE                          EDTFILK1
           END-IF                                                       EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       ECEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       EECHRQ SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Process update request                                       EDTFILK1
      *==============================================================   EDTFILK1
      *    USER: Change DBF record                                      MSGACTK2
      *    Chg Dlt Ledger Nature - Ledger Nature  *                     CBLCHGK1
           PERFORM SA3CHRC                                              CBLCHGK1
           IF (W0RTN NOT = SPACES) THEN                                 EDTFILK1
      *        DBF update error detected                                EDTFILK1
      *        Screen errors                                            EDTFILK1
               MOVE WKIND1(1) TO IND(31)                                EDTFILK1
               MOVE WKIND1(2) TO IND(32)                                EDTFILK1
               MOVE WKIND1(3) TO IND(33)                                EDTFILK1
               MOVE WKIND1(4) TO IND(34)                                EDTFILK1
      *        Format error                                             EDTFILK1
               SET C-INDICATOR-ON(98) TO TRUE                           EDTFILK1
      *        Enable entry                                             EDTFILK1
               SET C-INDICATOR-OFF(87) TO TRUE                          EDTFILK1
      *        Condition SFLNXTCHG                                      EDTFILK1
               SET C-INDICATOR-ON(84) TO TRUE                           EDTFILK1
      *        Reset subfile record if changed record                   EDTFILK1
               IF (W0RTN = 'Y2U0007') THEN                              EDTFILK1
                   MOVE CORRESPONDING                                   EDTFILK1
                     FLDGNB9 OF ACLDGNATL1 TO                           EDTFILK1
                     FLDGNB8                                            EDTFILK1
                   PERFORM MBFLZ1                                       EDTFILK1
               END-IF                                                   EDTFILK1
           ELSE                                                         EDTFILK1
      *        DBF update successful                                    EDTFILK1
      *        Enable entry                                             EDTFILK1
               SET C-INDICATOR-OFF(87) TO TRUE                          EDTFILK1
      *        No SFLNXTCHG                                             EDTFILK1
               SET C-INDICATOR-OFF(84) TO TRUE                          EDTFILK1
           END-IF                                                       EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       EEEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       FACHMD SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Switch between *ADD/*CHANGE modes                            EDTFILK1
      *==============================================================   EDTFILK1
           IF (NOT C-ADD-MODE) THEN                                     EDTFILK1
               SET C-ADD-MODE TO TRUE                                   EDTFILK1
           ELSE                                                         EDTFILK1
               SET C-CHANGE-MODE TO TRUE                                EDTFILK1
           END-IF                                                       EDTFILK1
           PERFORM FBRQRL                                               EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       FAEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       FBRQRL SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Request subfile reload                                       EDTFILK1
      *==============================================================   EDTFILK1
           MOVE 'Y' TO W0RSF                                            EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       FBEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       GADSA1 SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Set display attributes for Subfile record                    EDTFILK1
      *==============================================================   EDTFILK1
           IF (C-ADD-MODE) THEN                                         EDTFILK1
               SET C-INDICATOR-ON(89) TO TRUE                           EDTFILK1
           ELSE                                                         EDTFILK1
               SET C-INDICATOR-OFF(89) TO TRUE                          EDTFILK1
           END-IF                                                       EDTFILK1
      *    Protect keys if change mode or updated record                EDTFILK1
           SET C-INDICATOR-ON(88) TO TRUE                               EDTFILK1
           IF (C-INDICATOR-ON(89) AND                                   EDTFILK1
               C-INDICATOR-OFF(87)) THEN                                EDTFILK1
               SET C-INDICATOR-OFF(88) TO TRUE                          EDTFILK1
           END-IF                                                       EDTFILK1
           MOVE IND(87) TO IND(78)                                      SCRCNDK1
      *    *IF                                                          CBLIFXK1
           IF (W0PMD = 'ADD') THEN                                      CBLIFXK1
               SET C-INDICATOR-ON(78) TO TRUE                           SCRCNDK1
           END-IF                                                       SCRCNDK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       GAEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       GBDSA2 SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Set display attributes for Subfile control                   EDTFILK1
      *==============================================================   EDTFILK1
           IF (C-ADD-MODE) THEN                                         EDTFILK1
               SET C-INDICATOR-ON(89) TO TRUE                           EDTFILK1
           ELSE                                                         EDTFILK1
               SET C-INDICATOR-OFF(89) TO TRUE                          EDTFILK1
           END-IF                                                       EDTFILK1
           SET C-INDICATOR-OFF(79) TO TRUE                              SCRCNDK1
      *    *IF                                                          CBLIFXK1
           IF (W0PMD = 'ADD') THEN                                      CBLIFXK1
               SET C-INDICATOR-ON(79) TO TRUE                           SCRCNDK1
           END-IF                                                       SCRCNDK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       GBEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       MAIZZ1 SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Initialise subfile record                                    EDTFILK1
      *==============================================================   EDTFILK1
           MOVE SPACES TO Z1DBRC OF ACPEDTNATD-WS-O                     EDTFILK1
      *    Ledger Type Code                                             EDTFILK1
           MOVE P1LDGTYP TO Z1LDGTYP OF ZSFLRCD-WS-O                    EDTFILK1
      *    *SFLSEL                                                      EDTFILK1
           MOVE SPACES TO Z1SEL OF ZSFLRCD-WS-O                         EDTFILK1
      *    Ledger Nature Code                                           EDTFILK1
           MOVE SPACES TO Z1LDGNAT OF ZSFLRCD-WS-O                      EDTFILK1
      *    Ledger Nature Description                                    EDTFILK1
           MOVE SPACES TO Z1NATDES OF ZSFLRCD-WS-O                      EDTFILK1
      *    Ledger Location                                              EDTFILK1
           MOVE SPACES TO Z1LDGLOC OF ZSFLRCD-WS-O                      EDTFILK1
      *    D:Ledger Location Desc                                       EDTFILK1
           MOVE SPACES TO ZRLDGLCDES OF ZSFLRCD-WS-O                    EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       MAEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       MBFLZ1 SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Move FLDGNB8 fields to subfile                               EDTFILK1
      *==============================================================   EDTFILK1
      *    Ledger Type Code                                             EDTFILK1
           MOVE ASLDGTYP OF FLDGNB8 TO Z1LDGTYP OF ZSFLRCD-WS-O         EDTFILK1
      *    Ledger Nature Code                                           EDTFILK1
           MOVE ASLDGNAT OF FLDGNB8 TO Z1LDGNAT OF ZSFLRCD-WS-O         EDTFILK1
      *    Ledger Nature Description                                    EDTFILK1
           MOVE ASNATDES OF FLDGNB8 TO Z1NATDES OF ZSFLRCD-WS-O         EDTFILK1
      *    Ledger Location                                              EDTFILK1
           MOVE ASLDGLOC OF FLDGNB8 TO Z1LDGLOC OF ZSFLRCD-WS-O         EDTFILK1
      *    Hold current record image for change detection               EDTFILK1
           MOVE Y1DBRC TO Z1DBRC OF ZSFLRCD-WS-O                        EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       MBEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       MEIZZ2 SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Initialise subfile control                                   EDTFILK1
      *==============================================================   EDTFILK1
      *    Ledger Type Code                                             EDTFILK1
           MOVE P1LDGTYP TO Z2LDGTYP OF ZSFLCTL-WS-O                    EDTFILK1
      *    Ledger Type Description                                      EDTFILK1
           MOVE P2LDGDES TO ZPLDGDES OF ZSFLCTL-WS-O                    EDTFILK1
      *                                                                 CHKRELK2
      *    CHECK RESTRICTION WITHIN Ledger Type.                        CHKRELK2
           PERFORM VA1CKRL                                              CHKRELK2
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       MEEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            EDTFILK1
       MFIZZ2 SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Initialise derived fields                                    EDTFILK1
      *==============================================================   EDTFILK1
      *    D:Ledger Location Desc                                       EDTFILK1
           MOVE SPACES TO ZRLDGLCDES OF ZSFLRCD-WS-O                    EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       MFEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            CBLRTVK2
       SA1RVGN SECTION.                                                 CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Rtv Check if nature used? - Batch Parameter  *               CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Initialize return code                                       CBLRTVK2
           MOVE SPACES TO W0RTN                                         CBLRTVK2
      *    Setup key                                                    CBLRTVK2
      *    Ledger Type Code                                             CBLRTVK2
           MOVE Z1LDGTYP OF ZSFLRCD-WS-O TO APLDGTYP OF KRSSA1          CBLRTVK2
      *    Ledger Nature Code                                           CBLRTVK2
           MOVE Z1LDGNAT OF ZSFLRCD-WS-O TO APLDGNAT OF KRSSA1          CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    Ledger Type Code                                             CBLRTVK2
           MOVE LOW-VALUES TO APLDGTYP OF EXTSA1                        CBLRTVK2
      *    Ledger Nature Code                                           CBLRTVK2
           MOVE LOW-VALUES TO APLDGNAT OF EXTSA1                        CBLRTVK2
      *    Application Code                                             CBLRTVK2
           MOVE LOW-VALUES TO APAPPCDE OF EXTSA1                        CBLRTVK2
      *    Transaction Type                                             CBLRTVK2
           MOVE -999 TO APTRNTYP OF EXTSA1                              CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             EXTSA1 TO                                                  CBLRTVK2
             FBATPCF OF ACBATPRML2-R                                    CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             KRSSA1 TO                                                  CBLRTVK2
             FBATPCF OF ACBATPRML2-R                                    CBLRTVK2
           START ACBATPRML2 KEY NOT < EXTERNALLY-DESCRIBED-KEY          CBLRTVK2
             FORMAT IS 'FBATPCF'                                        CBLRTVK2
           END-START                                                    CBLRTVK2
           IF (C-IO-ERR) THEN                                           CBLRTVK2
               STOP RUN                                                 CBLRTVK2
           END-IF                                                       CBLRTVK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CBLRTVK2
           READ ACBATPRML2 NEXT                                         CBLRTVK2
             FORMAT IS 'FBATPCF'                                        CBLRTVK2
           END-READ                                                     CBLRTVK2
           IF (C-EOF) THEN                                              CBLRTVK2
               SET C-INDICATOR-ON(90) TO TRUE                           CBLRTVK2
           ELSE                                                         CBLRTVK2
               IF (C-IO-ERR) THEN                                       CBLRTVK2
                   STOP RUN                                             CBLRTVK2
               ELSE                                                     CBLRTVK2
                   MOVE CORRESPONDING                                   CBLRTVK2
                     FBATPCF OF ACBATPRML2-R TO                         CBLRTVK2
                     EXTSA1                                             CBLRTVK2
                   MOVE EXTSA1 TO KRSSA1-TMP                            CBLRTVK2
                   IF (KRSSA1 NOT = KRSSA1-TMP) THEN                    CBLRTVK2
                       SET C-INDICATOR-ON(90) TO TRUE                   CBLRTVK2
                   END-IF                                               CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-IF                                                       CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    Ledger Type Code                                             CBLRTVK2
           MOVE LOW-VALUES TO APLDGTYP OF EXTSA1                        CBLRTVK2
      *    Ledger Nature Code                                           CBLRTVK2
           MOVE LOW-VALUES TO APLDGNAT OF EXTSA1                        CBLRTVK2
      *    Application Code                                             CBLRTVK2
           MOVE LOW-VALUES TO APAPPCDE OF EXTSA1                        CBLRTVK2
      *    Transaction Type                                             CBLRTVK2
           MOVE -999 TO APTRNTYP OF EXTSA1                              CBLRTVK2
           IF (C-INDICATOR-ON(90)) THEN                                 CBLRTVK2
      *        Data record not found                                    CBLRTVK2
               MOVE 'JSM0059' TO W0RTN                                  CBLRTVK2
           END-IF                                                       CBLRTVK2
      *==============================================================   CBLRTVK2
           CONTINUE.                                                    CBLRTVK2
       SA1EXIT.                                                         CBLRTVK2
           EXIT.                                                        CBLRTVK2
      /EJECT                                                            CBLCRTK1
       SA2CRRC SECTION.                                                 CBLCRTK1
      *==============================================================   CBLCRTK1
      *    Create Ledger Nature - Ledger Nature  *                      CBLCRTK1
      *==============================================================   CBLCRTK1
      *    Initialize return code                                       CBLCRTK1
           MOVE SPACES TO W0RTN                                         CBLCRTK1
      *                                                                 CBLCRTK1
      *    Move all fields to FLDGNB9                                   CBLCRTK1
      *    Ledger Type Code                                             CBLCRTK1
           MOVE Z1LDGTYP OF ZSFLRCD-WS-O TO ASLDGTYP OF ACLDGNATL1-R    CBLCRTK1
      *    Ledger Nature Code                                           CBLCRTK1
           MOVE Z1LDGNAT OF ZSFLRCD-WS-O TO ASLDGNAT OF ACLDGNATL1-R    CBLCRTK1
      *    Ledger Nature Description                                    CBLCRTK1
           MOVE Z1NATDES OF ZSFLRCD-WS-O TO ASNATDES OF ACLDGNATL1-R    CBLCRTK1
      *    Ledger Location                                              CBLCRTK1
           MOVE Z1LDGLOC OF ZSFLRCD-WS-O TO ASLDGLOC OF ACLDGNATL1-R    CBLCRTK1
      *    Check for duplicate primary key                              CBLCRTK1
           START ACLDGNATL1 KEY = EXTERNALLY-DESCRIBED-KEY              CBLCRTK1
             FORMAT IS 'FLDGNB9'                                        CBLCRTK1
           END-START                                                    CBLCRTK1
           IF (NOT C-NO-RECORD) THEN                                    CBLCRTK1
               SET C-INDICATOR-ON(90) TO TRUE                           CBLCRTK1
           ELSE                                                         CBLCRTK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLCRTK1
           END-IF                                                       CBLCRTK1
           IF (C-INDICATOR-ON(90)) THEN                                 CBLCRTK1
               MOVE 'JSM0075' TO W0RTN                                  CBLCRTK1
      *        Send message 'Ledger Nature          EX'                 SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'JSM0075' TO ZAMSID                                 SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
               GO SA2EXIT                                               CBLCRTK1
           END-IF                                                       CBLCRTK1
      *                                                                 CBLCRTK1
           WRITE ACLDGNATL1-R END-WRITE                                 CBLCRTK1
           IF (C-IO-ERR) THEN                                           CBLCRTK1
               SET C-INDICATOR-ON(91) TO TRUE                           CBLCRTK1
           ELSE                                                         CBLCRTK1
               SET C-INDICATOR-OFF(91) TO TRUE                          CBLCRTK1
           END-IF                                                       CBLCRTK1
      *                                                                 CBLCRTK1
           IF (C-INDICATOR-ON(91)) THEN                                 CBLCRTK1
      *        Write error detected                                     CBLCRTK1
               MOVE 'Y2U0004' TO W0RTN                                  CBLCRTK1
           ELSE                                                         CBLCRTK1
      *        DBF write successful                                     CBLCRTK1
      *        Update saved record image                                CBLCRTK1
               MOVE CORRESPONDING                                       CBLCRTK1
                 FLDGNB9 OF ACLDGNATL1 TO Y1DBRC                        CBLCRTK1
           END-IF                                                       CBLCRTK1
      *==============================================================   CBLCRTK1
           CONTINUE.                                                    CBLCRTK1
       SA2EXIT.                                                         CBLCRTK1
           EXIT.                                                        CBLCRTK1
      /EJECT                                                            CBLCHGK1
       SA3CHRC SECTION.                                                 CBLCHGK1
      *==============================================================   CBLCHGK1
      *    Chg Dlt Ledger Nature - Ledger Nature  *                     CBLCHGK1
      *==============================================================   CBLCHGK1
      *    Initialize return code                                       CBLCHGK1
           MOVE SPACES TO W0RTN                                         CBLCHGK1
      *    USER: Processing before Data read                            MSGACTK2
      *    CASE: PAR.*SFLSEL is *Delete                                 MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (Z1SEL OF ZSFLRCD-WS-O = '4') THEN                        CBLIFXK1
      *        Delete Ledger Nature - Ledger Nature  *                  CBLDLTK1
               PERFORM SA4DLRC                                          CBLDLTK1
      *        *Return code                                             CBLMOVK1
               MOVE SPACES TO W0RTN                                     CBLMOVK1
      *        *QUIT                                                    CBLQUTK1
               GO SA3EXIT                                               CBLQUTK1
           END-IF                                                       MSGACTK2
      *    Move key fields to FLDGNB9                                   CBLCHGK1
      *    Ledger Type Code                                             CBLCHGK1
           MOVE Z1LDGTYP OF ZSFLRCD-WS-O TO ASLDGTYP OF ACLDGNATL1-R    CBLCHGK1
      *    Ledger Nature Code                                           CBLCHGK1
           MOVE Z1LDGNAT OF ZSFLRCD-WS-O TO ASLDGNAT OF ACLDGNATL1-R    CBLCHGK1
      *                                                                 CBLCHGK1
           READ ACLDGNATL1 END-READ                                     CBLCHGK1
           IF (C-NO-RECORD) THEN                                        CBLCHGK1
               SET C-INDICATOR-ON(90) TO TRUE                           CBLCHGK1
           ELSE                                                         CBLCHGK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLCHGK1
           END-IF                                                       CBLCHGK1
           IF (C-IO-ERR OR                                              CBLCHGK1
               C-RECORD-LOCKED) THEN                                    CBLCHGK1
               SET C-INDICATOR-ON(91) TO TRUE                           CBLCHGK1
           ELSE                                                         CBLCHGK1
               SET C-INDICATOR-OFF(91) TO TRUE                          CBLCHGK1
           END-IF                                                       CBLCHGK1
           IF (C-IO-OK) THEN                                            CBLCHGK1
               MOVE CORRESPONDING                                       CBLCHGK1
                 FLDGNB9 OF ACLDGNATL1 TO Y1DBRC                        CBLCHGK1
           END-IF                                                       CBLCHGK1
      *                                                                 CBLCHGK1
           IF (C-INDICATOR-ON(90)) THEN                                 CBLCHGK1
      *        Data record not found                                    CBLCHGK1
               MOVE 'Y2U0009' TO W0RTN                                  CBLCHGK1
               MOVE ZZPGM  OF JOB-CONTEXT TO MDPGM OF MD0009            CBLCHGK1
               MOVE 'ACLDGNATL1' TO MDACP OF MD0009                     CBLCHGK1
               MOVE 'FLDGNB9' TO MDFMT OF MD0009                        CBLCHGK1
               MOVE '*CHG' TO MDACT OF MD0009                           CBLCHGK1
      *        Record not found label: LBL002.                          CBLCHGK1
               MOVE 'LBL002' TO MDLBL OF MD0009                         CBLCHGK1
      *        Send message '*Record no longer on file'                 SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'Y2U0009' TO ZAMSID                                 SNDMSGK1
      *        Message file                                             SNDMSGK1
               MOVE 'Y2USRMSG' TO ZAMSGF                                SNDMSGK1
      *        Message data                                             SNDMSGK1
               MOVE MD0009 TO ZAMSDA                                    SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
               MOVE SPACES TO MD0009                                    CBLCHGK1
               GO SA3EXIT                                               CBLCHGK1
           END-IF                                                       CBLCHGK1
      *                                                                 CBLCHGK1
           IF (C-INDICATOR-ON(91)) THEN                                 CBLCHGK1
      *        Record locked                                            CBLCHGK1
               MOVE 'Y2U0004' TO W0RTN                                  CBLCHGK1
      *        Send message '*Database operation error'                 SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'Y2U0004' TO ZAMSID                                 SNDMSGK1
      *        Message file                                             SNDMSGK1
               MOVE 'Y2USRMSG' TO ZAMSGF                                SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
               GO SA3EXIT                                               CBLCHGK1
           END-IF                                                       CBLCHGK1
      *                                                                 CBLCHGK1
      *    Check for changed record                                     CBLCHGK1
           IF (Z1DBRC OF ZSFLRCD-WS-O NOT = Y1DBRC) THEN                CBLCHGK1
               MOVE 'Y2U0007' TO W0RTN                                  CBLCHGK1
      *        Send message '*Update not accepted'                      SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'Y2U0007' TO ZAMSID                                 SNDMSGK1
      *        Message file                                             SNDMSGK1
               MOVE 'Y2USRMSG' TO ZAMSGF                                SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
      *        Release record lock                                      CBLCHGK1
               READ ACLDGNATL1 WITH NO LOCK                             CBLCHGK1
                FORMAT IS 'ACLDGNATL1-R'                                CBLCHGK1
               END-READ                                                 CBLCHGK1
               IF (C-NO-RECORD) THEN                                    CBLCHGK1
                   SET C-INDICATOR-ON(90) TO TRUE                       CBLCHGK1
               ELSE                                                     CBLCHGK1
                   SET C-INDICATOR-OFF(90) TO TRUE                      CBLCHGK1
               END-IF                                                   CBLCHGK1
               IF (C-IO-ERR OR                                          CBLCHGK1
                   C-RECORD-LOCKED) THEN                                CBLCHGK1
                   SET C-INDICATOR-ON(91) TO TRUE                       CBLCHGK1
               ELSE                                                     CBLCHGK1
                   SET C-INDICATOR-OFF(91) TO TRUE                      CBLCHGK1
               END-IF                                                   CBLCHGK1
               GO SA3EXIT                                               CBLCHGK1
           END-IF                                                       CBLCHGK1
      *    Move all fields to FLDGNB9                                   CBLCHGK1
      *    Ledger Nature Description                                    CBLCHGK1
           MOVE Z1NATDES OF ZSFLRCD-WS-O TO ASNATDES OF ACLDGNATL1-R    CBLCHGK1
      *    Ledger Location                                              CBLCHGK1
           MOVE Z1LDGLOC OF ZSFLRCD-WS-O TO ASLDGLOC OF ACLDGNATL1-R    CBLCHGK1
      *                                                                 CBLCHGK1
           REWRITE ACLDGNATL1-R END-REWRITE                             CBLCHGK1
           IF (NOT C-IO-OK) THEN                                        CBLCHGK1
               SET C-INDICATOR-ON(91) TO TRUE                           CBLCHGK1
           ELSE                                                         CBLCHGK1
               SET C-INDICATOR-OFF(91) TO TRUE                          CBLCHGK1
           END-IF                                                       CBLCHGK1
           IF (C-INDICATOR-ON(91)) THEN                                 CBLCHGK1
      *        Change error detected                                    CBLCHGK1
               MOVE 'Y2U0004' TO W0RTN                                  CBLCHGK1
           ELSE                                                         CBLCHGK1
      *        DBF change successful                                    CBLCHGK1
      *        Update saved record image                                CBLCHGK1
               MOVE CORRESPONDING                                       CBLCHGK1
                 FLDGNB9 OF ACLDGNATL1 TO Y1DBRC                        CBLCHGK1
               MOVE Y1DBRC TO Z1DBRC OF ZSFLRCD-WS-O                    CBLCHGK1
           END-IF                                                       CBLCHGK1
      *==============================================================   CBLCHGK1
           CONTINUE.                                                    CBLCHGK1
       SA3EXIT.                                                         CBLCHGK1
           EXIT.                                                        CBLCHGK1
      /EJECT                                                            CBLDLTK1
       SA4DLRC SECTION.                                                 CBLDLTK1
      *==============================================================   CBLDLTK1
      *    Delete Ledger Nature - Ledger Nature  *                      CBLDLTK1
      *==============================================================   CBLDLTK1
      *    Initialize return code                                       CBLDLTK1
           MOVE SPACES TO W0RTN                                         CBLDLTK1
      *    Move key fields to FLDGNB9                                   CBLDLTK1
      *    Ledger Type Code                                             CBLDLTK1
           MOVE Z1LDGTYP OF ZSFLRCD-WS-O TO ASLDGTYP OF ACLDGNATL1-R    CBLDLTK1
      *    Ledger Nature Code                                           CBLDLTK1
           MOVE Z1LDGNAT OF ZSFLRCD-WS-O TO ASLDGNAT OF ACLDGNATL1-R    CBLDLTK1
      *                                                                 CBLDLTK1
           READ ACLDGNATL1 END-READ                                     CBLDLTK1
           IF (C-NO-RECORD) THEN                                        CBLDLTK1
               SET C-INDICATOR-ON(90) TO TRUE                           CBLDLTK1
           ELSE                                                         CBLDLTK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLDLTK1
           END-IF                                                       CBLDLTK1
           IF (C-IO-ERR OR                                              CBLDLTK1
               C-RECORD-LOCKED) THEN                                    CBLDLTK1
               SET C-INDICATOR-ON(91) TO TRUE                           CBLDLTK1
           ELSE                                                         CBLDLTK1
               SET C-INDICATOR-OFF(91) TO TRUE                          CBLDLTK1
           END-IF                                                       CBLDLTK1
      *                                                                 CBLDLTK1
           IF (C-INDICATOR-ON(90)) THEN                                 CBLDLTK1
      *        Record already deleted                                   CBLDLTK1
               MOVE 'Y2U0009' TO W0RTN                                  CBLDLTK1
               MOVE ZZPGM  OF JOB-CONTEXT TO MDPGM OF MD0009            CBLDLTK1
               MOVE 'ACLDGNATL1' TO MDACP OF MD0009                     CBLDLTK1
               MOVE 'FLDGNB9' TO MDFMT OF MD0009                        CBLDLTK1
               MOVE '*DLT' TO MDACT OF MD0009                           CBLDLTK1
      *        Record not found label: LBL001.                          CBLDLTK1
               MOVE 'LBL001' TO MDLBL OF MD0009                         CBLDLTK1
      *        Send message '*Record no longer on file'                 SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'Y2U0009' TO ZAMSID                                 SNDMSGK1
      *        Message file                                             SNDMSGK1
               MOVE 'Y2USRMSG' TO ZAMSGF                                SNDMSGK1
      *        Message data                                             SNDMSGK1
               MOVE MD0009 TO ZAMSDA                                    SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
               MOVE SPACES TO MD0009                                    CBLDLTK1
               GO SA4EXIT                                               CBLDLTK1
           END-IF                                                       CBLDLTK1
           IF (C-INDICATOR-ON(91)) THEN                                 CBLDLTK1
      *        Record locked                                            CBLDLTK1
               MOVE 'Y2U0004' TO W0RTN                                  CBLDLTK1
               GO SA4EXIT                                               CBLDLTK1
           END-IF                                                       CBLDLTK1
      *                                                                 CBLDLTK1
           DELETE ACLDGNATL1 END-DELETE                                 CBLDLTK1
           IF (C-IO-ERR OR                                              CBLDLTK1
               C-RECORD-LOCKED) THEN                                    CBLDLTK1
               SET C-INDICATOR-ON(91) TO TRUE                           CBLDLTK1
           ELSE                                                         CBLDLTK1
               SET C-INDICATOR-OFF(91) TO TRUE                          CBLDLTK1
           END-IF                                                       CBLDLTK1
           IF (C-INDICATOR-ON(91)) THEN                                 CBLDLTK1
      *        Delete error detected                                    CBLDLTK1
               MOVE 'Y2U0004' TO W0RTN                                  CBLDLTK1
           END-IF                                                       CBLDLTK1
      *==============================================================   CBLDLTK1
           CONTINUE.                                                    CBLDLTK1
       SA4EXIT.                                                         CBLDLTK1
           EXIT.                                                        CBLDLTK1
      /EJECT                                                            CHKRELK2
       VA1CKRL SECTION.                                                 CHKRELK2
      *==============================================================   CHKRELK2
      *    CHECK RESTRICTION WITHIN Ledger Type.                        CHKRELK2
      *==============================================================   CHKRELK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CHKRELK2
      *    Name search required?                                        CHKRELK2
      *    Ledger Type Code                                             CHKRELK2
           MOVE Z2LDGTYP OF ZSFLCTL-WS-O TO WK1X01                      CHKRELK2
      *    Ledger Type Code                                             CHKRELK2
           IF (WK1X01 = '?' OR                                          CHKRELK2
               WK1X01 = '?' OR                                          CHKRELK2
               YPMTFD = 'Z2LDGTYP O') THEN                              CHKRELK2
     W* Y2W0053 - One or more arguments defaulted to available contexts CBLERRK1
      *        Field '(CTL) Z2LDGTYP OF ZSFLCTL-WS-O' defaulted for     CHKRELK2
      *          'Ledger Type Code'.                                    CHKRELK2
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLCLLK1
               MOVE Z2LDGTYP OF ZSFLCTL-WS-O TO WQ0001                  CBLCLLK1
      *                                                                 CBLCLLK1
               CALL 'ACPSELLDGS' USING                                  CBLCLLK1
      *        Return code                                              CBLCLLK1
                 W0RTN                                                  CBLCLLK1
      *        Ledger Type Code                                         CBLCLLK1
                 WQ0001                                                 CBLCLLK1
                        ON OVERFLOW                                     CBLCLLK1
                        SET C-INDICATOR-ON(90) TO TRUE                  CBLCLLK1
               END-CALL                                                 CBLCLLK1
      *                                                                 CBLCLLK1
               MOVE WQ0001 TO Z2LDGTYP OF ZSFLCTL-WS-O                  CBLCLLK1
      *                                                                 CBLCLLK1
      *        Error on program call will terminate run unit            CBLCLLK1
               IF (C-INDICATOR-ON(90)) THEN                             CBLCLLK1
                   MOVE 'Y2U0032' TO W0RTN                              CBLCLLK1
                   MOVE 'ACPSELLDGS' TO W0CLPG                          CBLCLLK1
      *            Send message '*Error occured on CALL...'             SNDMSGK1
      *            Message ID                                           SNDMSGK1
                   MOVE 'Y2U0032' TO ZAMSID                             SNDMSGK1
      *            Message file                                         SNDMSGK1
                   MOVE 'Y2USRMSG' TO ZAMSGF                            SNDMSGK1
      *            Message data                                         SNDMSGK1
                   MOVE W0CLPG TO ZAMSDA                                SNDMSGK1
                   PERFORM ZASNMS                                       SNDMSGK1
               END-IF                                                   CBLCLLK1
      *        Error detected?                                          CBLCLLK1
               IF (W0RTN        NOT = SPACES AND                        CBLCLLK1
                   W0RTN        NOT = 'Y2U0016') THEN                   CBLCLLK1
                   SET C-INDICATOR-ON(99) TO TRUE                       CBLCLLK1
               END-IF                                                   CBLCLLK1
      *                                                                 CHKRELK2
      *                                                                 CHKRELK2
      *                                                                 CHKRELK2
      *        Ledger Type Code                                         CHKRELK2
               IF (Z2LDGTYP OF ZSFLCTL-WS-O NOT = SPACES AND            CHKRELK2
                   YPMTFD NOT = SPACES AND                              CHKRELK2
                   W0RTN = SPACES AND                                   CHKRELK2
                   WK1X01 NOT = '?') THEN                               CHKRELK2
                   MOVE '*DONE' TO YPMTFD                               CHKRELK2
               END-IF                                                   CHKRELK2
      *        Defer confirm                                            CHKRELK2
               MOVE 'Y' TO W0DCF                                        CHKRELK2
      *        No value selected, exit                                  CHKRELK2
               IF (W0RTN NOT = SPACES AND                               CHKRELK2
                   YPMTFD = SPACES) THEN                                CHKRELK2
                   GO VA1999                                            CHKRELK2
               END-IF                                                   CHKRELK2
           END-IF                                                       CHKRELK2
      *..............................................................   CHKRELK2
      *                                                                 CHKRELK2
      *    Setup key                                                    KEYLSTK1
      *    Ledger Type Code                                             KEYLSTK1
           MOVE Z2LDGTYP OF ZSFLCTL-WS-O TO ARLDGTYP OF KLVA1A          KEYLSTK1
      *    Initialise Full Externally Described Keylist                 CHKRELK2
      *    Ledger Type Code                                             CHKRELK2
           MOVE SPACES TO ASLDGTYP OF KLVA1A-EXT                        CHKRELK2
      *    Ledger Nature Code                                           CHKRELK2
           MOVE SPACES TO ASLDGNAT OF KLVA1A-EXT                        CHKRELK2
           MOVE CORRESPONDING                                           CHKRELK2
             KLVA1A TO                                                  CHKRELK2
             FLEDTB4 OF ACLDGTYPL1-R                                    CHKRELK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CHKRELK2
           SET C-INDICATOR-OFF(91) TO TRUE                              CHKRELK2
           READ ACLDGTYPL1                                              CHKRELK2
             FORMAT IS 'FLEDTB4'                                        CHKRELK2
           END-READ                                                     CHKRELK2
           IF (C-NO-RECORD) THEN                                        CHKRELK2
               SET C-INDICATOR-ON(90) TO TRUE                           CHKRELK2
           ELSE                                                         CHKRELK2
               IF (C-IO-ERR) THEN                                       CHKRELK2
                   SET C-INDICATOR-ON(91) TO TRUE                       CHKRELK2
               END-IF                                                   CHKRELK2
           END-IF                                                       CHKRELK2
           IF (C-INDICATOR-OFF(90)) THEN                                CHKRELK2
      *        Record found - move back any virtuals                    CHKRELK2
               GO VA1EXIT                                               CHKRELK2
           END-IF                                                       CHKRELK2
           IF (YPMTFD NOT = SPACES) THEN                                CHKRELK2
               SET C-INDICATOR-OFF(90) TO TRUE                          CHKRELK2
               SET C-INDICATOR-OFF(91) TO TRUE                          CHKRELK2
               GO VA1EXIT                                               CHKRELK2
           END-IF                                                       CHKRELK2
           CONTINUE.                                                    CHKRELK2
       VA1999.                                                          CHKRELK2
      *    Restrictor relation not satisfied                            CHKRELK2
      *    Send message 'Ledger Type            NF'                     SNDMSGK1
      *    Message ID                                                   SNDMSGK1
           MOVE 'JSM0072' TO ZAMSID                                     SNDMSGK1
      *    Pgmq rel                                                     SNDMSGK1
           MOVE '*PRV ' TO ZAPGRL                                       SNDMSGK1
           PERFORM ZASNMS                                               SNDMSGK1
           MOVE 'JSM0072' TO P0RTN                                      SNDMSGK1
           PERFORM ZYEXPG                                               CHKRELK2
      *==============================================================   CHKRELK2
           CONTINUE.                                                    CHKRELK2
       VA1EXIT.                                                         CHKRELK2
           EXIT.                                                        CHKRELK2
      /EJECT                                                            CBLSETK2
       Y0SET  SECTION.                                                  CBLSETK2
      *==============================================================   CBLSETK2
      *    Set cursor by *SET CURSOR data                               CBLSETK2
      *==============================================================   CBLSETK2
      *==============================================================   CBLSETK2
           CONTINUE.                                                    CBLSETK2
       Y0EXIT.                                                          CBLSETK2
           EXIT.                                                        CBLSETK2
      /EJECT                                                            CBLCSRK1
       Y8TST  SECTION.                                                  CBLCSRK1
      *==============================================================   CBLCSRK1
      *    Test cursor                                                  CBLCSRK1
      *==============================================================   CBLCSRK1
           ACCEPT ACPEDTNATD-I-O-DSPF FROM I-O-FEEDBACK-AREA            CBLCSRK1
            FOR ACPEDTNATD                                              CBLCSRK1
           MOVE ZZRWCL OF ACPEDTNATD-I-O-DSPF TO ZINPOS                 CBLCSRK1
           MOVE SPACES TO W0CFL                                         CBLCSRK1
           DIVIDE ZINPOS BY 256 GIVING W0CRW REMAINDER W0CCL            CBLCSRK1
      *==============================================================   CBLCSRK1
           CONTINUE.                                                    CBLCSRK1
       Y8EXIT.                                                          CBLCSRK1
           EXIT.                                                        CBLCSRK1
      /EJECT                                                            CBLSETK2
       Y9CLR  SECTION.                                                  CBLSETK2
      *==============================================================   CBLSETK2
      *    Clear *SET CURSOR data                                       CBLSETK2
      *==============================================================   CBLSETK2
      *==============================================================   CBLSETK2
           CONTINUE.                                                    CBLSETK2
       Y9EXIT.                                                          CBLSETK2
           EXIT.                                                        CBLSETK2
      /EJECT                                                            CBLUPDK1
       ZASNMS SECTION.                                                  CBLUPDK1
      *==============================================================   CBLUPDK1
      *    Send message to program's message queue                      CBLUPDK1
      *==============================================================   CBLUPDK1
      *    Send if first error message or not an error message          CBLUPDK1
           IF (ZAMSTP NOT = SPACES OR                                   CBLUPDK1
               ZAFSMS NOT = 'N') THEN                                   CBLUPDK1
               IF (ZAMSTP = SPACES) THEN                                CBLUPDK1
      *            Signal first error message sent                      CBLUPDK1
                   MOVE 'N' TO ZAFSMS                                   CBLUPDK1
               END-IF                                                   CBLUPDK1
               IF (ZAPGMQ = SPACES) THEN                                CBLUPDK1
                   MOVE ZZPGM OF JOB-CONTEXT TO ZAPGMQ                  CBLUPDK1
               END-IF                                                   CBLUPDK1
      *        If no message file specified, use default                CBLUPDK1
               IF (ZAMSGF = SPACES) THEN                                CBLUPDK1
                   MOVE ZADFMF TO ZAMSGF                                CBLUPDK1
               END-IF                                                   CBLUPDK1
               CALL 'Y2SNMGC' USING                                     CBLUPDK1
      *        Program queue                                            CBLUPDK1
                 ZAPGMQ                                                 CBLUPDK1
      *        Relative queue                                           CBLUPDK1
                 ZAPGRL                                                 CBLUPDK1
      *        Message ID                                               CBLUPDK1
                 ZAMSID                                                 CBLUPDK1
      *        Message file                                             CBLUPDK1
                 ZAMSGF                                                 CBLUPDK1
      *        Message data                                             CBLUPDK1
                 ZAMSDA                                                 CBLUPDK1
      *        Message type                                             CBLUPDK1
                 ZAMSTP                                                 CBLUPDK1
               END-CALL                                                 CBLUPDK1
           END-IF                                                       CBLUPDK1
      *    Clear all fields for default mechanism next time             CBLUPDK1
      *    Program queue                                                CBLUPDK1
           MOVE SPACES TO ZAPGMQ                                        CBLUPDK1
      *    Relative queue                                               CBLUPDK1
           MOVE SPACES TO ZAPGRL                                        CBLUPDK1
      *    Message ID                                                   CBLUPDK1
           MOVE SPACES TO ZAMSID                                        CBLUPDK1
      *    Message file                                                 CBLUPDK1
           MOVE SPACES TO ZAMSGF                                        CBLUPDK1
      *    Message data                                                 CBLUPDK1
           MOVE SPACES TO ZAMSDA                                        CBLUPDK1
      *    Message type                                                 CBLUPDK1
           MOVE SPACES TO ZAMSTP                                        CBLUPDK1
      *==============================================================   CBLUPDK1
           CONTINUE.                                                    CBLUPDK1
       ZAEXIT.                                                          CBLUPDK1
           EXIT.                                                        CBLUPDK1
      /EJECT                                                            GENF4K10
       ZDVPMT SECTION.                                                  GENF4K10
      *==============================================================   GENF4K10
      *    Process prompt request                                       GENF4K10
      *==============================================================   GENF4K10
      *                                                                 GENF4K10
      *    Initialise prompt workfields                                 GENF4K10
           MOVE SPACES TO YPMTFD                                        GENF4K10
           MOVE ZERO TO YAFSCH                                          GENF4K10
           MOVE ZERO TO YPMRRN                                          GENF4K10
      *                                                                 GENF4K10
           IF (C-INDICATOR-ON(04)) THEN                                 GENF4K10
               SET C-INDICATOR-ON(04) TO TRUE                           GENF4K10
      *                                                                 GENF4K10
      *        Extract cursor row and column                            GENF4K10
               ACCEPT ACPEDTNATD-I-O-DSPF                               GENF4K10
               FROM I-O-FEEDBACK-AREA FOR ACPEDTNATD                    GENF4K10
               DIVIDE ZZRWCL BY 256 GIVING ZHCSRW REMAINDER ZHCSCL      GENF4K10
      *        Save cursor position for redisplay                       GENF4K10
      *        Row                                                      GENF4K10
               MOVE ZEROS TO ZZZCSRW                                    GENF4K10
               MOVE ZHCSRW TO ZZZCSRW                                   GENF4K10
      *        Column                                                   GENF4K10
               MOVE ZEROS TO ZZZCSCL                                    GENF4K10
               MOVE ZHCSCL TO ZZZCSCL                                   GENF4K10
      *                                                                 GENF4K10
      *        Save sfl rrn at top of page                              GENF4K10
               IF (ZZSFRC OF ACPEDTNATD-I-O-DSPF > ZERO) THEN           GENF4K10
                   MOVE ZZSFRC OF ACPEDTNATD-I-O-DSPF TO ZZSFRC OF      GENF4K10
                     ZSFLCTL-WS-O                                       GENF4K10
               END-IF                                                   GENF4K10
               MOVE ZZSFRC OF ACPEDTNATD-I-O-DSPF TO YZSFRC             GENF4K10
      *                                                                 GENF4K10
      *        Initialise sfl workfields                                GENF4K10
               MOVE 008 TO ZHSTRW                                       GENF4K10
               MOVE 020 TO ZHNDRW                                       GENF4K10
               MOVE 001 TO ZHRLEN                                       GENF4K10
               MOVE ZERO TO ZHF4RW                                      GENF4K10
               MOVE ZERO TO ZHWK1Z                                      GENF4K10
      *                                                                 GENF4K10
      *        Resolve prompt row number on sfl                         GENF4K10
               IF (ZHCSRW NOT < ZHSTRW AND                              GENF4K10
                   ZHCSRW NOT > ZHNDRW) THEN                            GENF4K10
                   SUBTRACT ZHSTRW FROM ZHCSRW GIVING ZHWK1Z            GENF4K10
                   DIVIDE ZHWK1Z BY ZHRLEN GIVING ZHWK1Z                GENF4K10
                   ADD ZHWK1Z TO YZSFRC GIVING YPMRRN                   GENF4K10
                   MOVE ZHWK1Z TO YZSFDL                                GENF4K10
                   MULTIPLY ZHWK1Z BY ZHRLEN GIVING ZHWK1Z              GENF4K10
                   SUBTRACT ZHWK1Z FROM ZHCSRW GIVING ZHF4RW            GENF4K10
      *                                                                 GENF4K10
                   IF (YPMRRN > ZERO) THEN                              GENF4K10
      *                Chain to sfl record                              GENF4K10
                       MOVE YPMRRN TO ZZRR                              GENF4K10
                       READ SUBFILE ACPEDTNATD                          GENF4K10
                         FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS      GENF4K10
                       END-READ                                         GENF4K10
                       MOVE ACPEDTNATD-F TO                             GENF4K10
                         ZSFLRCD-WS-I                                   GENF4K10
                       IF (C-IO-OK) THEN                                GENF4K10
                           MOVE CORRESPONDING                           GENF4K10
                             ZSFLRCD-I OF ZSFLRCD-WS-I TO               GENF4K10
                             ZSFLRCD-O OF ZSFLRCD-WS-O                  GENF4K10
      *                    Set screen conditioning indicators           GENF4K10
                           PERFORM GADSA1                               GENF4K10
                       ELSE                                             GENF4K10
                           MOVE ZERO TO YPMRRN                          GENF4K10
                           MOVE ZERO TO ZZRR                            GENF4K10
                       END-IF                                           GENF4K10
                   END-IF                                               GENF4K10
               END-IF                                                   GENF4K10
      *                                                                 GENF4K10
               IF (ZHF4RW = 008 AND                                     GENF4K10
                   ZHCSCL NOT < 052 AND                                 GENF4K10
                   ZHCSCL NOT > 053) THEN                               GENF4K10
      *            Ledger Location                                      GENF4K10
                   MOVE 'Z1LDGLOC O' TO YPMTFD                          GENF4K10
               END-IF                                                   GENF4K10
      *                                                                 GENF4K10
               IF (YPMTFD = SPACES) THEN                                GENF4K10
      *            Error if user defined prompting is not specified.    GENF4K10
                   IF (W0PMT = 'N') THEN                                GENF4K10
                       MOVE '*NONE' TO YPMTFD                           GENF4K10
                       MOVE 'Y' TO W0HLP                                GENF4K10
                       MOVE 'Y' TO ZAFSMS                               GENF4K10
      *                Send error message.                              SNDMSGK1
      *                Message ID                                       SNDMSGK1
                       MOVE 'Y2U0101' TO ZAMSID                         SNDMSGK1
      *                Message file                                     SNDMSGK1
                       MOVE 'Y2USRMSG' TO ZAMSGF                        SNDMSGK1
                       PERFORM ZASNMS                                   SNDMSGK1
                   END-IF                                               GENF4K10
               END-IF                                                   GENF4K10
      *                                                                 GENF4K10
      *        Save first changed  rrn                                  GENF4K10
               IF (ZHCSRW NOT < ZHSTRW AND                              GENF4K10
                   ZHCSRW NOT > ZHNDRW AND                              GENF4K10
                   YPMTFD NOT = '*NONE') THEN                           GENF4K10
      *                                                                 GENF4K10
                   IF (ZZRR NOT = ZERO) THEN                            GENF4K10
                       READ SUBFILE ACPEDTNATD NEXT MODIFIED            GENF4K10
                         FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS      GENF4K10
                       END-READ                                         GENF4K10
                       MOVE ACPEDTNATD-F TO                             GENF4K10
                         ZSFLRCD-WS-I                                   GENF4K10
                       IF (NOT C-NO-MOD-SFLRCDS) THEN                   GENF4K10
                           MOVE CORRESPONDING                           GENF4K10
                             ZSFLRCD-I OF ZSFLRCD-WS-I TO               GENF4K10
                             ZSFLRCD-O OF ZSFLRCD-WS-O                  GENF4K10
                           MOVE ZZRR TO YAFSCH                          GENF4K10
                           SET C-INDICATOR-ON(84) TO TRUE               GENF4K10
                           REWRITE SUBFILE ACPEDTNATD-F FROM            GENF4K10
                             ZSFLRCD-WS-O                               GENF4K10
                             FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS  GENF4K10
                           END-REWRITE                                  GENF4K10
                       END-IF                                           GENF4K10
                   END-IF                                               GENF4K10
      *                                                                 GENF4K10
      *            Calculate rrn for prompt slf record                  GENF4K10
                   SUBTRACT ZHSTRW FROM ZHCSRW GIVING ZHWK1Z            GENF4K10
                   DIVIDE ZHWK1Z BY ZHRLEN GIVING ZHWK1Z                GENF4K10
                   ADD ZHWK1Z TO YZSFRC GIVING YPMRRN                   GENF4K10
      *                                                                 GENF4K10
      *            Chain to sfl record                                  GENF4K10
                   MOVE YPMRRN TO ZZRR                                  GENF4K10
                   READ SUBFILE ACPEDTNATD                              GENF4K10
                     FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS          GENF4K10
                   END-READ                                             GENF4K10
                   MOVE ACPEDTNATD-F TO                                 GENF4K10
                     ZSFLRCD-WS-I                                       GENF4K10
                   IF (NOT C-NO-RECORD) THEN                            GENF4K10
                       MOVE CORRESPONDING                               GENF4K10
                         ZSFLRCD-I OF ZSFLRCD-WS-I TO                   GENF4K10
                         ZSFLRCD-O OF ZSFLRCD-WS-O                      GENF4K10
                       SET C-INDICATOR-ON(84) TO TRUE                   GENF4K10
                       REWRITE SUBFILE ACPEDTNATD-F FROM ZSFLRCD-WS-O   GENF4K10
                         FORMAT IS 'ZSFLRCD' INDICATORS ARE INDICS      GENF4K10
                       END-REWRITE                                      GENF4K10
                   ELSE                                                 GENF4K10
                       MOVE ZERO TO YPMRRN                              GENF4K10
                   END-IF                                               GENF4K10
      *                                                                 GENF4K10
      *            Test first changed rrn/prompt rrn                    GENF4K10
                   IF (YAFSCH = ZERO) THEN                              GENF4K10
                       MOVE YPMRRN TO YAFSCH                            GENF4K10
                   END-IF                                               GENF4K10
      *                                                                 GENF4K10
      *            If prompt rrn < first changed rrn                    GENF4K10
                   IF (YPMRRN NOT = ZERO AND                            GENF4K10
                       YPMRRN < YAFSCH) THEN                            GENF4K10
                       MOVE YPMRRN TO YAFSCH                            GENF4K10
                   END-IF                                               GENF4K10
      *                                                                 GENF4K10
               END-IF                                                   GENF4K10
      *                                                                 GENF4K10
           END-IF                                                       GENF4K10
      *==============================================================   GENF4K10
           CONTINUE.                                                    GENF4K10
       ZDEXIT.                                                          GENF4K10
           EXIT.                                                        GENF4K10
      /EJECT                                                            DSPHLPK1
       ZHHPKY SECTION.                                                  DSPHLPK1
      *==============================================================   DSPHLPK1
      *    Display HELP text                                            DSPHLPK1
      *==============================================================   DSPHLPK1
      *    Signal help request                                          DSPHLPK1
           MOVE 'Y' TO W0HLP                                            DSPHLPK1
      *                                                                 DSPHLPK1
      *    Extract cursor row and column                                DSPHLPK1
           ACCEPT ACPEDTNATD-I-O-DSPF FROM I-O-FEEDBACK-AREA FOR        DSPHLPK1
             ACPEDTNATD                                                 DSPHLPK1
           DIVIDE ZZRWCL BY 256 GIVING ZHCSRW REMAINDER ZHCSCL          DSPHLPK1
      *                                                                 DSPHLPK1
      *    Save cursor position for redisplay                           DSPHLPK1
      *    Row                                                          DSPHLPK1
           MOVE ZEROS TO ZZZCSRW                                        DSPHLPK1
           ADD ZHCSRW TO ZZZCSRW                                        DSPHLPK1
      *    Column                                                       DSPHLPK1
           MOVE ZEROS TO ZZZCSCL                                        DSPHLPK1
           ADD ZHCSCL TO ZZZCSCL                                        DSPHLPK1
      *                                                                 DSPHLPK1
           MOVE 'ACPEDTLN' TO W0HPMB                                    DSPHLPK1
           MOVE SPACES TO YYHPFL                                        DSPHLPK1
           MOVE SPACES TO YYHPLB                                        DSPHLPK1
           MOVE '*START' TO YYHLVN                                      DSPHLPK1
           MOVE '*NORMAL' TO YYUSOP                                     DSPHLPK1
           MOVE ZHCSRW TO YYRW                                          DSPHLPK1
           MOVE ZHCSCL TO YYCL                                          DSPHLPK1
           MOVE ZEROS  TO YYLGCT                                        DSPHLPK1
           MOVE SPACES TO YYLGVN                                        DSPHLPK1
           CALL 'YDDSHPR' USING                                         DSPHLPK1
      *    Member name                                                  DSPHLPK1
             W0HPMB                                                     DSPHLPK1
      *    *DFT text file                                               DSPHLPK1
             YYHPFL                                                     DSPHLPK1
      *    Help text library                                            DSPHLPK1
             YYHPLB                                                     DSPHLPK1
      *    Return code                                                  DSPHLPK1
             W0RTN                                                      DSPHLPK1
      *    Help label                                                   DSPHLPK1
             YYHLVN                                                     DSPHLPK1
      *    Options                                                      DSPHLPK1
             YYUSOP                                                     DSPHLPK1
      *    Row                                                          DSPHLPK1
             YYRW                                                       DSPHLPK1
      *    Column                                                       DSPHLPK1
             YYCL                                                       DSPHLPK1
      *    # of grps                                                    DSPHLPK1
             YYLGCT                                                     DSPHLPK1
      *    Label grps                                                   DSPHLPK1
             YYLGVN                                                     DSPHLPK1
           END-CALL                                                     DSPHLPK1
      *                                                                 DSPHLPK1
      *    Clear set cursor DDS indicator                               DSPHLPK1
           IF (C-INDICATOR-OFF(94)) THEN                                DSPHLPK1
               MOVE 'OFF' TO WCSRLC                                     DSPHLPK1
               SET C-INDICATOR-ON(94) TO TRUE                           DSPHLPK1
           END-IF                                                       DSPHLPK1
      *==============================================================   DSPHLPK1
           CONTINUE.                                                    DSPHLPK1
       ZHEXIT.                                                          DSPHLPK1
           EXIT.                                                        DSPHLPK1
      /EJECT                                                            EDTFILK1
       ZXEXPG SECTION.                                                  EDTFILK1
      *==============================================================   EDTFILK1
      *    Exit program: Normal                                         EDTFILK1
      *==============================================================   EDTFILK1
      *    USER: Exit program processing                                MSGACTK2
      *    CASE: CTL.*CMD key is *Fast Exit                             MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (C-INDICATOR-ON(03)) THEN                                 CBLIFXK1
      *        *Return code                                             CBLEXTK1
               MOVE 'Y2U9999' TO P0RTN                                  CBLEXTK1
               PERFORM ZYEXPG                                           CBLEXTK1
           END-IF                                                       MSGACTK2
           MOVE SPACES TO P0RTN                                         EDTFILK1
           PERFORM ZYEXPG                                               EDTFILK1
      *==============================================================   EDTFILK1
           CONTINUE.                                                    EDTFILK1
       ZXEXIT.                                                          EDTFILK1
           EXIT.                                                        EDTFILK1
      /EJECT                                                            CBLUPDK1
       ZYEXPG SECTION.                                                  CBLUPDK1
      *==============================================================   CBLUPDK1
      *    Exit program: Direct                                         CBLUPDK1
      *==============================================================   CBLUPDK1
           CLOSE ACPEDTNATD                                             CBLUPDK1
           CLOSE ACLDGNATL0                                             CBLUPDK1
           CLOSE ACBATPRML2                                             CBLUPDK1
           CLOSE ACLDGTYPL1                                             CBLUPDK1
           CLOSE ACLDGNATL1                                             CBLUPDK1
      *    Reset entry parameters as appropriate                        CBLUPDK1
           PERFORM ZZEXPM.                                              CBLUPDK1
      *    Exit program                                                 CBLUPDK1
           CONTINUE.                                                    CBLUPDK1
       ZYEXPG-EXIT.                                                     CBLUPDK1
           GOBACK.                                                      CBLUPDK1
      *==============================================================   CBLUPDK1
           CONTINUE.                                                    CBLUPDK1
       ZYEXIT.                                                          CBLUPDK1
           EXIT.                                                        CBLUPDK1
      /EJECT                                                            DCLPARK1
       ZZEXPM SECTION.                                                  DCLPARK1
      *==============================================================   DCLPARK1
      *    Return parameters from work fields                           DCLPARK1
      *==============================================================   DCLPARK1
      *==============================================================   DCLPARK1
           CONTINUE.                                                    DCLPARK1
       ZZPEXT.                                                          DCLPARK1
           EXIT.                                                        DCLPARK1
      /EJECT                                                            CBLHDRK1
       ZZINIT SECTION.                                                  CBLHDRK1
      *==============================================================   CBLHDRK1
      *    Initialisation                                               CBLHDRK1
      *==============================================================   CBLHDRK1
           IF (W0ICL = SPACES) THEN                                     CBLHDRK1
      *        *Initial call                                            CBLHDRK1
               MOVE 'Y' TO W0ICL                                        CBLHDRK1
           ELSE                                                         CBLHDRK1
               MOVE 'N' TO W0ICL                                        CBLHDRK1
           END-IF                                                       CBLHDRK1
           MOVE SPACES TO P0RTN                                         CBLHDRK1
           MOVE SPACES TO W0RTN                                         CBLHDRK1
           MOVE ZEROS  TO W0RTW                                         CBLHDRK1
           MOVE SPACES TO W0RSF                                         CBLHDRK1
           MOVE '400' TO W0ENV                                          CBLHDRK1
           MOVE ALL B'0' TO INDICS                                      CBLHDRK1
           MOVE SPACES TO ZZPGM OF JOB-CONTEXT                          CBLHDRK1
      *    Retrieve job attributes                                      CBLHDRK1
           CALL 'Y2RTJCR' USING                                         CBLHDRK1
             JOB-CONTEXT                                                CBLHDRK1
           END-CALL                                                     CBLHDRK1
      *    Setup job date/time                                          CBLHDRK1
           MOVE ZZSD7 OF JOB-CONTEXT TO ZZJDT                           CBLHDRK1
           ACCEPT ZZTIME FROM TIME                                      CBLHDRK1
           MOVE ZZHNS TO ZZJTM OF JOB-CONTEXT                           CBLHDRK1
           MOVE 'ACPEDTNATS' TO ZZPGM OF JOB-CONTEXT                    CBLHDRK1
           MOVE ZEROS TO ZZCSRW OF ZSFLCTL-WS-O                         CBLEXFK1
           MOVE ZEROS TO ZZCSCL OF ZSFLCTL-WS-O                         CBLEXFK1
      *    Define work field U:update (Y/N)                             ACTCTXK4
           MOVE SPACES TO WUUPDYN OF WORK-CONTEXT                       ACTCTXK4
           OPEN INPUT JSVLLSL9                                          CVTSTSK1
      *                                                                 CBLSETK2
      *    Initialize array variables                                   CBLSETK2
      *    Flag no *SET CURSOR in the program                           CBLSETK2
           MOVE 'N' TO YSETCS                                           CBLSETK2
           MOVE SPACES TO WCSRLC                                        CBLSETK2
      *                                                                 CBLSETK2
      *    Obtain default message file                                  CBLUPDK1
           MOVE 'JSMGFLA' TO DATA-AREA-NAME                             CBLUPDK1
           CALL 'Y2RTDAC' USING                                         CBLUPDK1
             DATA-AREA-NAME                                             CBLUPDK1
             ZADFMF                                                     CBLUPDK1
           END-CALL                                                     CBLUPDK1
      *    Signal first error message outstanding                       CBLUPDK1
           MOVE 'Y' TO ZAFSMS                                           CBLUPDK1
      *    Open files                                                   CBLUPDK1
           OPEN I-O ACPEDTNATD                                          CBLUPDK1
           OPEN INPUT ACLDGNATL0                                        CBLUPDK1
           ACCEPT ACLDGNATL0-OPEN FROM OPEN-FEEDBACK-AREA FOR ACLDGNATL0CBLUPDK1
      *    Move main file information to JOB context                    CBLUPDK1
           MOVE CORRESPONDING OPENFA OF ACLDGNATL0-OPEN TO JOB-CONTEXT  CBLUPDK1
           CALL 'Y2QLVNR' USING                                         CBLUPDK1
             ZZFFL OF JOB-CONTEXT                                       CBLUPDK1
             ZZFLB OF JOB-CONTEXT                                       CBLUPDK1
             ZZFQL OF JOB-CONTEXT                                       CBLUPDK1
           END-CALL                                                     CBLUPDK1
           OPEN INPUT ACBATPRML2                                        CBLUPDK1
           ACCEPT ACBATPRML2-OPEN FROM OPEN-FEEDBACK-AREA FOR ACBATPRML2CBLUPDK1
           OPEN INPUT ACLDGTYPL1                                        CBLUPDK1
           ACCEPT ACLDGTYPL1-OPEN FROM OPEN-FEEDBACK-AREA FOR ACLDGTYPL1CBLUPDK1
           OPEN I-O ACLDGNATL1                                          CBLUPDK1
           ACCEPT ACLDGNATL1-OPEN FROM OPEN-FEEDBACK-AREA FOR ACLDGNATL1CBLUPDK1
           MOVE 'Y' TO W0OPN                                            CBLUPDK1
           MOVE 'N' TO W0PMT                                            CBLUPDK1
      *                                                                 EDTFILK1
           MOVE 'ACPEDTNATS' TO ZZPGM OF ZSFLCTL-WS-O                   EDTFILK1
           MOVE ZZUSR OF JOB-CONTEXT TO ZZUSR OF ACPEDTNATD-WS-O        EDTFILK1
           MOVE ZZJOB OF JOB-CONTEXT TO ZZJOB OF ACPEDTNATD-WS-O        EDTFILK1
      *    Set program name in message subfile control record           EDTFILK1
           MOVE ZZPGM OF JOB-CONTEXT TO ZZPGM OF ZMSGCTL-WS-O           EDTFILK1
           MOVE 13 TO ZZSFPG                                            EDTFILK1
      *    Subfile record number                                        EDTFILK1
           MOVE 1 TO ZZSFRC OF ZSFLCTL-WS-O                             EDTFILK1
      *    Maximum record number                                        EDTFILK1
           MOVE ZERO TO ZZRRMX                                          EDTFILK1
      *    Scan limit                                                   EDTFILK1
           MOVE 500 TO W0SLM                                            EDTFILK1
      *    Subfile pages                                                EDTFILK1
           MOVE 1 TO W0SPG                                              EDTFILK1
      *    Processed Subfile record                                     EDTFILK1
           MOVE ZERO TO W0RR0                                           EDTFILK1
      *..............................................................   EDTFILK1
      *    Set to *CHANGE mode                                          EDTFILK1
      *    Change mode                                                  EDTFILK1
           SET C-CHANGE-MODE TO TRUE                                    EDTFILK1
      *    First time                                                   EDTFILK1
           MOVE 'Y' TO W0APM                                            EDTFILK1
      *    USER: Initialize program                                     MSGACTK2
      *    Utl @Copyright - #Standard Functions  *                      MSGACTK2
      *    Utl set screen sysid (Fle - #Standard Functions  *           MSGACTK2
      *.Start.of.User.source........................................... CBLUFNK1
           MOVE 'SYSNAME'  TO RUK-DTAARA-NAME                           CBLUFNK1
           CALL 'Y2RTDAC'                                               CBLUFNK1
             USING RUK-DTAARA-NAME                                      CBLUFNK1
                   ZZSNAM  OF ZSFLCTL-WS-O                              CBLUFNK1
           END-CALL                                                     CBLUFNK1
      *.End.of.user.source............................................. CBLUFNK1
      *    Initialise subfile control                                   EDTFILK1
           PERFORM MEIZZ2                                               EDTFILK1
      *==============================================================   CBLHDRK1
           CONTINUE.                                                    CBLHDRK1
       ZZEXIT.                                                          CBLHDRK1
           EXIT.                                                        CBLHDRK1
