       PROCESS APOST.                                                   CBLHDRK1
      ***************************************************************   CBLHDRK1
       IDENTIFICATION DIVISION.                                         CBLHDRK1
     H/TITLE Pmt Inv/Crd/Posti20120416 Prompt & validate record         CBLHDRK1
     Z* CRTCBLPGM                                                       CBLHDRK1
     Z* OPTION(*SRCDBG) CVTOPT(*DATETIME)                               CBLHDRK1
      *                                                                 CBLHDRK1
     H* SYNOPSIS :                                                      PMTVALK1
     H* - Prompts fields, allowing user changes                         PMTVALK1
     H* - Validates fields                                              PMTVALK1
     H* - If valid, performs an action                                  PMTVALK1
     H* Generated by  : COOL:2E  Version:  1135                         CBLHDRK1
     H* Function type : Prompt & validate record  Version:   0.1        CBLHDRK1
      *                                                                 CBLHDRK1
     H* Company    : Renault (UK) Applications                          CBLHDRK1
     H* System     : Renault (UK) Applications                          CBLHDRK1
     H* User name  : PRAGTSK                                            CBLHDRK1
     H* Date       : 16/04/12 time: 14:49:05                            CBLHDRK1
     H* Copyright  : Renault (UK) Applications                          CBLHDRK1
      *                                                                 CBLHDRK1
      *==============================================================   CBLHDRK1
     M* MAINTENANCE   :                                                 CBLHDRK1
      *==============================================================   CBLHDRK1
       PROGRAM-ID.  AABCCCCCDS.                                         CBLHDRK1
      /EJECT                                                            CBLHDRK1
      ***************************************************************   CBLHDRK1
       ENVIRONMENT DIVISION.                                            CBLHDRK1
       CONFIGURATION SECTION.                                           CBLHDRK1
       SOURCE-COMPUTER.  IBM-AS400.                                     CBLHDRK1
       OBJECT-COMPUTER.  IBM-AS400.                                     CBLHDRK1
       SPECIAL-NAMES.  OPEN-FEEDBACK IS OPEN-FEEDBACK-AREA,             CBLHDRK1
           I-O-FEEDBACK IS I-O-FEEDBACK-AREA.                           CBLHDRK1
      /EJECT                                                            CBLHDRK1
      ***************************************************************   CBLHDRK1
       INPUT-OUTPUT SECTION.                                            CBLHDRK1
       FILE-CONTROL.                                                    CBLHDRK1
      *                                                                 CBLHDRK1
           SELECT AABCCCCCDD                                            CBLUPDK1
             ASSIGN TO WORKSTATION-AABCCCCCDD-SI                        CBLUPDK1
             ORGANIZATION IS TRANSACTION                                CBLUPDK1
             FILE STATUS IS FILE-STATUS, MAJOR-MINOR-CODE.              CBLUPDK1
      *    DSP: Pmt Inv/Crd/Posti20120416 Prompt & validate record      CBLUPDK1
      *                                                                 CBLUPDK1
           SELECT RAVLLSL9                                              CVTSTSK1
             ASSIGN TO DATABASE-RAVLLSL9                                CVTSTSK1
             ORGANIZATION IS INDEXED                                    CVTSTSK1
             ACCESS MODE IS DYNAMIC                                     CVTSTSK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CVTSTSK1
             FILE STATUS IS FILE-STATUS.                                CVTSTSK1
      *    Values list details file                                     CVTSTSK1
      *                                                                 CVTSTSK1
           SELECT FBACTIONL0                                            CBLUPDK1
             ASSIGN TO DATABASE-FBACTIONL0                              CBLUPDK1
             ORGANIZATION IS INDEXED                                    CBLUPDK1
             ACCESS MODE IS DYNAMIC                                     CBLUPDK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CBLUPDK1
             FILE STATUS IS FILE-STATUS.                                CBLUPDK1
      *    UPD : FB Action                 Update index                 CBLUPDK1
      *                                                                 CBLUPDK1
           SELECT FBACTIONL1                                            CBLUPDK1
             ASSIGN TO DATABASE-FBACTIONL1                              CBLUPDK1
             ORGANIZATION IS INDEXED                                    CBLUPDK1
             ACCESS MODE IS DYNAMIC                                     CBLUPDK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CBLUPDK1
             FILE STATUS IS FILE-STATUS.                                CBLUPDK1
      *    RTV : FB Action                 Retrieval index              CBLUPDK1
      *                                                                 CBLUPDK1
           SELECT FBRUNCONL2                                            CBLUPDK1
             ASSIGN TO DATABASE-FBRUNCONL2                              CBLUPDK1
             ORGANIZATION IS INDEXED                                    CBLUPDK1
             ACCESS MODE IS DYNAMIC                                     CBLUPDK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CBLUPDK1
             FILE STATUS IS FILE-STATUS.                                CBLUPDK1
      *    RSQ : FB Run Control            Month/FON                    CBLUPDK1
      *                                                                 CBLUPDK1
           SELECT FBRUNCONL0                                            CBLUPDK1
             ASSIGN TO DATABASE-FBRUNCONL0                              CBLUPDK1
             ORGANIZATION IS INDEXED                                    CBLUPDK1
             ACCESS MODE IS DYNAMIC                                     CBLUPDK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CBLUPDK1
             FILE STATUS IS FILE-STATUS.                                CBLUPDK1
      *    RTV : FB Run Control            Retrieval index              CBLUPDK1
      *                                                                 CBLUPDK1
           SELECT FBACTIONL2                                            CBLUPDK1
             ASSIGN TO DATABASE-FBACTIONL2                              CBLUPDK1
             ORGANIZATION IS INDEXED                                    CBLUPDK1
             ACCESS MODE IS DYNAMIC                                     CBLUPDK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CBLUPDK1
             FILE STATUS IS FILE-STATUS.                                CBLUPDK1
      *    RSQ : FB Action                 Sts/Date/Time/Mth/Fon/Pg     CBLUPDK1
      *                                                                 CBLUPDK1
           SELECT FBFLTACCL1                                            CBLUPDK1
             ASSIGN TO DATABASE-FBFLTACCL1                              CBLUPDK1
             ORGANIZATION IS INDEXED                                    CBLUPDK1
             ACCESS MODE IS DYNAMIC                                     CBLUPDK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CBLUPDK1
             FILE STATUS IS FILE-STATUS.                                CBLUPDK1
      *    RTV : FB Fleet Operator Account Retrieval index              CBLUPDK1
      *                                                                 CBLUPDK1
           SELECT FBRUNCONL3                                            CBLUPDK1
             ASSIGN TO DATABASE-FBRUNCONL3                              CBLUPDK1
             ORGANIZATION IS INDEXED                                    CBLUPDK1
             ACCESS MODE IS DYNAMIC                                     CBLUPDK1
             RECORD KEY IS EXTERNALLY-DESCRIBED-KEY                     CBLUPDK1
             FILE STATUS IS FILE-STATUS.                                CBLUPDK1
      *    RSQ : FB Run Control            Month(D)/FON                 CBLUPDK1
      *                                                                 CBLUPDK1
       I-O-CONTROL.                                                     CBLHDRK1
      *                                                                 CBLHDRK1
      /EJECT                                                            CBLHDRK1
      ***************************************************************   CBLHDRK1
       DATA DIVISION.                                                   CBLHDRK1
       FILE SECTION.                                                    CBLHDRK1
      *                                                                 CBLHDRK1
      *                                                                 CVTSTSK1
       FD  RAVLLSL9                                                     CVTSTSK1
           LABEL RECORDS ARE STANDARD.                                  CVTSTSK1
       01  RAVLLSL9-R.                                                  CVTSTSK1
           COPY DD-ALL-FORMATS OF RAVLLSL9.                             CVTSTSK1
      *                                                                 CBLUPDK1
       FD  AABCCCCCDD                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  AABCCCCCDD-F.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF AABCCCCCDD.                          CBLUPDK1
           05 FILLER            PIC X(100).                             CBLUPDK1
      *                                                                 CBLUPDK1
       FD  FBACTIONL0                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  FBACTIONL0-R.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF FBACTIONL0.                          CBLUPDK1
      *                                                                 CBLUPDK1
       FD  FBACTIONL1                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  FBACTIONL1-R.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF FBACTIONL1.                          CBLUPDK1
      *                                                                 CBLUPDK1
       FD  FBRUNCONL2                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  FBRUNCONL2-R.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF FBRUNCONL2.                          CBLUPDK1
      *                                                                 CBLUPDK1
       FD  FBRUNCONL0                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  FBRUNCONL0-R.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF FBRUNCONL0.                          CBLUPDK1
      *                                                                 CBLUPDK1
       FD  FBACTIONL2                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  FBACTIONL2-R.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF FBACTIONL2.                          CBLUPDK1
      *                                                                 CBLUPDK1
       FD  FBFLTACCL1                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  FBFLTACCL1-R.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF FBFLTACCL1.                          CBLUPDK1
      *                                                                 CBLUPDK1
       FD  FBRUNCONL3                                                   CBLUPDK1
           LABEL RECORDS ARE STANDARD.                                  CBLUPDK1
       01  FBRUNCONL3-R.                                                CBLUPDK1
           COPY DDS-ALL-FORMATS OF FBRUNCONL3.                          CBLUPDK1
      /EJECT                                                            CBLHDRK1
      ***************************************************************   CBLHDRK1
       WORKING-STORAGE SECTION.                                         CBLHDRK1
      *                                                                 CBLHDRK1
      *    Job context                                                  CBLHDRK1
       01  JOB-CONTEXT.                                                 CBLHDRK1
           COPY DDS-ALL-FORMATS OF Y2PGDSPK.                            CBLHDRK1
      *    Job date/time                                                CBLHDRK1
           03  IJBDTTM.                                                 CBLHDRK1
           05  ZZJDT PIC S9(7).                                         CBLHDRK1
           05  ZZJDTE REDEFINES ZZJDT.                                  CBLHDRK1
           07  ZZJCC PIC S9(1).                                         CBLHDRK1
           07  ZZJYY PIC S9(2).                                         CBLHDRK1
           07  ZZJMM PIC S9(2).                                         CBLHDRK1
           07  ZZJDD PIC S9(2).                                         CBLHDRK1
           05  ZZJTM PIC S9(6).                                         CBLHDRK1
           05  ZZJTME REDEFINES ZZJTM.                                  CBLHDRK1
           07  ZZJHH PIC S9(2).                                         CBLHDRK1
           07  ZZJNN PIC S9(2).                                         CBLHDRK1
           07  ZZJSS PIC S9(2).                                         CBLHDRK1
           03  ZZFQL PIC X(21).                                         CBLHDRK1
           03  ZZFLB PIC X(10).                                         CBLHDRK1
           03  ZZFFL PIC X(10).                                         CBLHDRK1
           03  ZZFMB PIC X(10).                                         CBLHDRK1
           03  ZZCDB PIC X(18).                                         CBLHDRK1
           03  ZZLDB PIC X(18).                                         CBLHDRK1
           03  ZZTMS PIC X(26).                                         CBLHDRK1
       01  ZZTIME.                                                      CBLHDRK1
           03  ZZHNS PIC S9(6).                                         CBLHDRK1
           03  ZZHH PIC S9(2).                                          CBLHDRK1
      *                                                                 CBLHDRK1
       77  C-IND-OFF PIC 1(1) VALUE B'0'.                               CBLHDRK1
       77  C-IND-ON PIC 1(1) VALUE B'1'.                                CBLHDRK1
      *                                                                 CBLHDRK1
       01  FILE-STATUS PIC X(2).                                        CBLHDRK1
           88  C-IO-OK VALUE '00'.                                      CBLHDRK1
           88  C-EOF VALUE '10' '46'.                                   CBLHDRK1
           88  C-NO-MOD-SFLRCDS VALUE '12'.                             CBLHDRK1
           88  C-IO-ERR VALUE '21' '22' '24' '30' '34' '90' '91' '92' '9CBLHDRK1
      -     '4' '95' '9A' '9H' '9I' '9K' '9M' '9N' '9P'.                CBLHDRK1
           88  C-NO-RECORD VALUE '23'.                                  CBLHDRK1
           88  C-RECORD-LOCKED VALUE '9D'.                              CBLHDRK1
      *                                                                 CBLHDRK1
       01  UNTIL-CONDITION PIC 1(1).                                    CBLHDRK1
           88  C-UNTIL-FALSE VALUE B'0'.                                CBLHDRK1
           88  C-UNTIL-TRUE VALUE B'1'.                                 CBLHDRK1
      *                                                                 CBLHDRK1
       01  FOREVER PIC 1(1) VALUE B'1'.                                 CBLHDRK1
           88  C-FOREVER VALUE B'1'.                                    CBLHDRK1
      *                                                                 CBLHDRK1
       01  WRK-IO-TRASH-AREA PIC X(1).                                  CBLHDRK1
      *                                                                 CBLHDRK1
       01  W0RTN PIC X(7).                                              CBLHDRK1
       01  W0RSF PIC X(1).                                              CBLHDRK1
       01  W0ENV PIC X(3).                                              CBLHDRK1
       01  W0RTW PIC S9(9) COMP-4.                                      CBLHDRK1
       01  W0ICL PIC X(1).                                              CBLHDRK1
       01  W0TRN PIC X(1).                                              PMTVALK1
       01  W0HLP PIC X(1).                                              DSPHLPK1
       01  W0HPMB PIC X(10).                                            DSPHLPK1
       01  YYHPFL PIC X(10).                                            DSPHLPK1
       01  YYHPLB PIC X(10).                                            DSPHLPK1
       01  ZHCSRW PIC S9(5) COMP-3.                                     DSPHLPK1
       01  ZHCSCL PIC S9(5) COMP-3.                                     DSPHLPK1
       01  ZZZCSRW PIC S9(3) COMP-3.                                    DSPHLPK1
       01  ZZZCSCL PIC S9(3) COMP-3.                                    DSPHLPK1
       01  YYHLVN PIC X(10).                                            DSPHLPK1
       01  W0GRP PIC X(10).                                             DSPHLPK1
       01  YYUSOP PIC X(10).                                            DSPHLPK1
       01  YYRW PIC S9(5) COMP-3.                                       DSPHLPK1
       01  YYCL PIC S9(5) COMP-3.                                       DSPHLPK1
       01  YYLGCT PIC S9(5) COMP-3.                                     DSPHLPK1
       01  YYLGVN PIC X(10).                                            DSPHLPK1
       01  ZAPGMQ PIC X(10).                                            PMTVALK1
       01  ZAPGRL PIC X(5).                                             PMTVALK1
       01  ZAFSMS PIC X(1).                                             PMTVALK1
       01  W0DCF PIC X(1).                                              PMTVALK1
       01  ZAMSDA PIC X(132).                                           CBLMDAK1
      *    Message data for 'Processing'                                CBLMDAK1
       01  ZA0001-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0001 PIC X(25).                                        CBLMDAK1
      *    Outward parameters                                           CBLIDSK1
       01  PARC.                                                        CBLIDSK1
      *    KEY : FB Action                 Retrieval index              CBLIDSK1
      *    I : MAP Fleet Operator Number                                CBLIDSK1
      *    Fleet Operator Number                                        CBLIDSK1
           03  PAFLOPNO PIC X(5).                                       CBLIDSK1
      *    I : MAP FB Month of Parts Data                               CBLIDSK1
      *    FB Month of Parts Data                                       CBLIDSK1
           03  PADIDM PIC S9(6) COMP-3.                                 CBLIDSK1
      *    I : MAP FB Action Date                                       CBLIDSK1
      *    FB Action Date                                               CBLIDSK1
           03  PAACTDTE PIC S9(8) COMP-3.                               CBLIDSK1
      *    I : MAP FB Action Time                                       CBLIDSK1
      *    FB Action Time                                               CBLIDSK1
           03  PAACTTIME PIC S9(6) COMP-3.                              CBLIDSK1
      *    I : MAP Program Name                                         CBLIDSK1
      *    Program Name                                                 CBLIDSK1
           03  PAPGMNAM PIC X(10).                                      CBLIDSK1
      *                                                                 CBLIDSK1
       01  W0CLPG PIC X(10).                                            CBLCLLK1
      *    Define keylist                                               CBLRTVK2
       01  KRSSA2.                                                      CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSA2-TMP.                                                  CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *                                                                 CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define Full Externally Described Keylist                     CBLRTVK2
       01  EXTSA2.                                                      CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSA4.                                                      CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSA4-TMP.                                                  CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *                                                                 CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define Full Externally Described Keylist                     CBLRTVK2
       01  EXTSA4.                                                      CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Message data for 'Error in called program'                   CBLMDAK1
       01  ZA0002-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0002 PIC X(7).                                         CBLMDAK1
           03  ZA0003 PIC X(10).                                        CBLMDAK1
      *    Message data for 'Error in called program'                   CBLMDAK1
       01  ZA0004-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0004 PIC X(7).                                         CBLMDAK1
           03  ZA0005 PIC X(10).                                        CBLMDAK1
      *    Define keylist                                               CBLRTVK2
       01  KRSSA5.                                                      CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FDDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FDFLOPNO PIC X(5).                                       CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSA5-TMP.                                                  CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FDDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FDFLOPNO PIC X(5).                                       CBLRTVK2
      *                                                                 CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define Full Externally Described Keylist                     CBLRTVK2
       01  EXTSA5.                                                      CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FDDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FDFLOPNO PIC X(5).                                       CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Message data for 'Processing'                                CBLMDAK1
       01  ZA0006-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0006 PIC X(25).                                        CBLMDAK1
      *    Define keylist                                               CBLRTVK2
       01  KRSSA7.                                                      CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSA7-TMP.                                                  CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *                                                                 CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define Full Externally Described Keylist                     CBLRTVK2
       01  EXTSA7.                                                      CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSA9.                                                      CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSA9-TMP.                                                  CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *                                                                 CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define Full Externally Described Keylist                     CBLRTVK2
       01  EXTSA9.                                                      CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Message data for 'Error in called program'                   CBLMDAK1
       01  ZA0007-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0007 PIC X(7).                                         CBLMDAK1
           03  ZA0008 PIC X(10).                                        CBLMDAK1
      *    Message data for 'Error in called program'                   CBLMDAK1
       01  ZA0009-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0009 PIC X(7).                                         CBLMDAK1
           03  ZA0010 PIC X(10).                                        CBLMDAK1
      *    Message data for 'Error in called program'                   CBLMDAK1
       01  ZA0011-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0011 PIC X(7).                                         CBLMDAK1
           03  ZA0012 PIC X(10).                                        CBLMDAK1
      *    Define keylist                                               CBLRTVK2
       01  KRSSB1.                                                      CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FDDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FDFLOPNO PIC X(5).                                       CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSB1-TMP.                                                  CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FDDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FDFLOPNO PIC X(5).                                       CBLRTVK2
      *                                                                 CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define Full Externally Described Keylist                     CBLRTVK2
       01  EXTSB1.                                                      CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FDDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FDFLOPNO PIC X(5).                                       CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Message data for 'Processing'                                CBLMDAK1
       01  ZA0013-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0013 PIC X(25).                                        CBLMDAK1
      *    Define keylist                                               CBLRTVK2
       01  KRSSB3.                                                      CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSB3-TMP.                                                  CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *                                                                 CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define Full Externally Described Keylist                     CBLRTVK2
       01  EXTSB3.                                                      CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Message data for 'Program ran successfuly'                   CBLMDAK1
       01  ZA0014-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0014 PIC X(25).                                        CBLMDAK1
      *    Message data for 'Error in called program'                   CBLMDAK1
       01  ZA0015-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0015 PIC X(7).                                         CBLMDAK1
           03  ZA0016 PIC X(10).                                        CBLMDAK1
      *    Message data for 'Error in called program'                   CBLMDAK1
       01  ZA0017-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0017 PIC X(7).                                         CBLMDAK1
           03  ZA0018 PIC X(10).                                        CBLMDAK1
      *    Message data for 'DTM invalid'                               CBLMDAK1
       01  ZA0019-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0019 PIC S9(6) COMP-3.                                 CBLMDAK1
       01  W0EXVL PIC X(25).                                            CHKSTSK1
      *    Message data for 'Value required (*Numeric)'                 CBLMDAK1
       01  ZA0020-01 REDEFINES ZAMSDA.                                  CBLMDAK1
           03  ZA0020 PIC S9(7) COMP-3.                                 CBLMDAK1
      *    Define keylist                                               CBLRTVK2
       01  KRSSB4.                                                      CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FDDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FDFLOPNO PIC X(5).                                       CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSB4-TMP.                                                  CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FDDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FDFLOPNO PIC X(5).                                       CBLRTVK2
      *                                                                 CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define Full Externally Described Keylist                     CBLRTVK2
       01  EXTSB4.                                                      CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FDDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FDFLOPNO PIC X(5).                                       CBLRTVK2
      *..............................................................   CBLRTVK2
       01  Y2LSTN PIC S9(7) COMP-3.                                     CBLCNMK1
       01  W0INVL PIC X(25).                                            CBLCNMK1
       01  W0VLMP PIC X(1).                                             CBLCNMK1
       01  W0CNNM PIC X(25).                                            CBLCNMK1
       01  WK1X01 PIC X(1).                                             CHKRELK2
      *    Fleet Operator Number                                        CBLCLLK1
       01  WQ0001 PIC X(5).                                             CBLCLLK1
      *    FB Month of Parts Data                                       CBLCLLK1
       01  WQ0002 PIC S9(6) COMP-3.                                     CBLCLLK1
       01  KLVA1F.                                                      KEYLSTK1
      *    Fleet Operator Number                                        KEYLSTK1
           03  FDFLOPNO PIC X(5).                                       KEYLSTK1
      *    FB Month of Parts Data                                       KEYLSTK1
           03  FDDIDM PIC S9(6) COMP-3.                                 KEYLSTK1
       01  KLVA1F-TMP.                                                  KEYLSTK1
      *    Fleet Operator Number                                        KEYLSTK1
           03  FDFLOPNO PIC X(5).                                       KEYLSTK1
      *    FB Month of Parts Data                                       KEYLSTK1
           03  FDDIDM PIC S9(6) COMP-3.                                 KEYLSTK1
      *                                                                 CHKRELK2
      *..............................................................   CHKRELK2
      *    Define Full Externally Described Keylist                     CHKRELK2
       01  KLVA1F-EXT.                                                  CHKRELK2
      *    Fleet Operator Number                                        CHKRELK2
           03  FBFLOPNO PIC X(5).                                       CHKRELK2
      *    FB Month of Parts Data                                       CHKRELK2
           03  FBDIDM PIC S9(6) COMP-3.                                 CHKRELK2
      *    FB Action Date                                               CHKRELK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CHKRELK2
      *    FB Action Time                                               CHKRELK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CHKRELK2
      *    Program Name                                                 CHKRELK2
           03  FBPGMNAM PIC X(10).                                      CHKRELK2
      *..............................................................   CHKRELK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSB5.                                                      CBLRTVK2
      *    FB Action Status                                             CBLRTVK2
           03  FBFBSTS PIC X(2).                                        CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSB5-TMP.                                                  CBLRTVK2
      *    FB Action Status                                             CBLRTVK2
           03  FBFBSTS PIC X(2).                                        CBLRTVK2
      *                                                                 CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define Full Externally Described Keylist                     CBLRTVK2
       01  EXTSB5.                                                      CBLRTVK2
      *    FB Action Status                                             CBLRTVK2
           03  FBFBSTS PIC X(2).                                        CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           03  FBACTDTE PIC S9(8) COMP-3.                               CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           03  FBACTTIME PIC S9(6) COMP-3.                              CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FBFLOPNO PIC X(5).                                       CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           03  FBPGMNAM PIC X(10).                                      CBLRTVK2
      *..............................................................   CBLRTVK2
       01  WN30-A.                                                      CNFPMTK2
           03  WN30 PIC 1(1) OCCURS 30.                                 CNFPMTK2
       01  IND-COUNT PIC S9(5) COMP-3.                                  CNFPMTK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSB6.                                                      CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  GTFLOPNO PIC X(5).                                       CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KRSSB6-TMP.                                                  CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  GTFLOPNO PIC X(5).                                       CBLRTVK2
      *                                                                 CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define Full Externally Described Keylist                     CBLRTVK2
       01  EXTSB6.                                                      CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  GTFLOPNO PIC X(5).                                       CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KPSSB7.                                                      CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FDDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    Define keylist                                               CBLRTVK2
       01  KPSSB7-TMP.                                                  CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FDDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *                                                                 CBLRTVK2
      *..............................................................   CBLRTVK2
      *    Define Full Externally Described Keylist                     CBLRTVK2
       01  EXTSB7.                                                      CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           03  FDDIDM PIC S9(6) COMP-3.                                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           03  FDFLOPNO PIC X(5).                                       CBLRTVK2
      *..............................................................   CBLRTVK2
       01  YPMTFD PIC X(10).                                            GENF4K10
       01  YAFSCH PIC S9(4) COMP-3.                                     GENF4K10
       01  YZSFRC PIC S9(4) COMP-3.                                     GENF4K10
       01  YZSFDL PIC S9(4) COMP-3.                                     GENF4K10
       01  ZHSTRW PIC S9(4) COMP-3.                                     GENF4K10
       01  ZHNDRW PIC S9(4) COMP-3.                                     GENF4K10
       01  ZHRLEN PIC S9(4) COMP-3.                                     GENF4K10
       01  YPMRRN PIC S9(4) COMP-3.                                     GENF4K10
       01  ZHF4RW PIC S9(4) COMP-3.                                     GENF4K10
       01  ZHWK1Z PIC S9(4) COMP-3.                                     GENF4K10
       01  DATA-AREA-NAME PIC X(10).                                    PMTVALK1
       01  YSETCS PIC X(1).                                             CBLSETK2
       01  W0ROW0 PIC S9(3) COMP-3.                                     CBLSETK2
       01  W0COL0 PIC S9(3) COMP-3.                                     CBLSETK2
       01  W0OVR0 PIC X(1).                                             CBLSETK2
       01  WCSRLC PIC X(3).                                             CBLSETK2
      *    *Cursor field                                                ACTCTXK4
       01  W0CFL PIC X(10).                                             ACTCTXK4
      *    *Cursor row                                                  ACTCTXK4
       01  W0CRW PIC S9(5) COMP-3.                                      ACTCTXK4
      *    *Cursor column                                               ACTCTXK4
       01  W0CCL PIC S9(5) COMP-3.                                      ACTCTXK4
       01  ZINPOS PIC S9(5) COMP-3.                                     CBLCSRK1
       01  ZADFMF PIC X(10).                                            CBLUPDK1
       01  ZAMSID PIC X(7).                                             CBLUPDK1
       01  ZAMSGF PIC X(10).                                            CBLUPDK1
       01  ZAMSTP PIC X(7).                                             CBLUPDK1
      *                                                                 CBLUPDK1
       01  AABCCCCCDD-I-O-DSPF.                                         CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IDSPFIO.                           CBLUPDK1
      *    Subfile I/O feedback area                                    CBLUPDK1
      *                                                                 CBLUPDK1
       01  MAJOR-MINOR-CODE.                                            CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IMAJMIN.                           CBLUPDK1
      *    Display major/minor code for timeouts                        CBLUPDK1
      *                                                                 CBLUPDK1
       01  FBACTIONL0-OPEN.                                             CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IOPEN.                             CBLUPDK1
      *    Open feedback area                                           CBLUPDK1
      *                                                                 CBLUPDK1
       01  FBACTIONL1-OPEN.                                             CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IOPEN.                             CBLUPDK1
      *    Open feedback area                                           CBLUPDK1
      *                                                                 CBLUPDK1
       01  FBRUNCONL2-OPEN.                                             CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IOPEN.                             CBLUPDK1
      *    Open feedback area                                           CBLUPDK1
      *                                                                 CBLUPDK1
       01  FBRUNCONL0-OPEN.                                             CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IOPEN.                             CBLUPDK1
      *    Open feedback area                                           CBLUPDK1
      *                                                                 CBLUPDK1
       01  FBACTIONL2-OPEN.                                             CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IOPEN.                             CBLUPDK1
      *    Open feedback area                                           CBLUPDK1
      *                                                                 CBLUPDK1
       01  FBFLTACCL1-OPEN.                                             CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IOPEN.                             CBLUPDK1
      *    Open feedback area                                           CBLUPDK1
      *                                                                 CBLUPDK1
       01  FBRUNCONL3-OPEN.                                             CBLUPDK1
           COPY DDS-ALL-FORMATS OF Y2IOPEN.                             CBLUPDK1
      *    Open feedback area                                           CBLUPDK1
      *                                                                 CBLUPDK1
       01  AABCCCCCDD-WS-O.                                             CBLUPDK1
           03  ZRCDDTL1-WS-O.                                           CBLUPDK1
           COPY DDS-ZRCDDTL1-O OF AABCCCCCDD.                           CBLUPDK1
             06 FILLER            PIC X(1).                             CBLUPDK1
           03  ZCMDTXT1-WS-O.                                           CBLUPDK1
           COPY DDS-ZCMDTXT1-O OF AABCCCCCDD.                           CBLUPDK1
             06 FILLER            PIC X(1).                             CBLUPDK1
           03  ZMSGCTL-WS-O.                                            CBLUPDK1
           COPY DDS-ZMSGCTL-O OF AABCCCCCDD.                            CBLUPDK1
             06 FILLER            PIC X(1).                             CBLUPDK1
           03  ZCONFIRM-WS-O.                                           CBLUPDK1
           COPY DDS-ZCONFIRM-O OF AABCCCCCDD.                           CBLUPDK1
             06 FILLER            PIC X(1).                             CBLUPDK1
       01  AABCCCCCDD-WS-I.                                             CBLUPDK1
           03  ZRCDDTL1-WS-I.                                           CBLUPDK1
           COPY DDS-ZRCDDTL1-I OF AABCCCCCDD.                           CBLUPDK1
             06  FILLER        PIC X.                                   CBLUPDK1
           03  ZCMDTXT1-WS-I.                                           CBLUPDK1
           COPY DDS-ZCMDTXT1-I OF AABCCCCCDD.                           CBLUPDK1
             06  FILLER        PIC X.                                   CBLUPDK1
           03  ZMSGCTL-WS-I.                                            CBLUPDK1
           COPY DDS-ZMSGCTL-I OF AABCCCCCDD.                            CBLUPDK1
             06  FILLER        PIC X.                                   CBLUPDK1
           03  ZCONFIRM-WS-I.                                           CBLUPDK1
           COPY DDS-ZCONFIRM-I OF AABCCCCCDD.                           CBLUPDK1
             06  FILLER        PIC X.                                   CBLUPDK1
       01  W0OPN PIC X(1).                                              CBLUPDK1
       01  W0PMT PIC X(1).                                              CBLUPDK1
      *    U:Job date D8#                                               ACTCTXK4
       01  WORK-CONTEXT.                                                ACTCTXK4
           03  YL0001 PIC S9(8) COMP-3.                                 ACTCTXK4
      *    U:Date                                                       ACTCTXK4
           03  WUDATE PIC S9(7) COMP-3.                                 ACTCTXK4
      *    FB Action Status                                             ACTCTXK4
           03  YL0002 PIC X(2).                                         ACTCTXK4
      *    Job Start TS#                                                ACTCTXK4
           03  YN0001 PIC X(26).                                        ACTCTXK4
      *    Job End TS#                                                  ACTCTXK4
           03  YN0002 PIC X(26).                                        ACTCTXK4
      *    FB Frequency                                                 ACTCTXK4
           03  YN0003 PIC X(1).                                         ACTCTXK4
      *    FB Days to Delay                                             ACTCTXK4
           03  YN0004 PIC S9(3) COMP-3.                                 ACTCTXK4
      *    FB Delay incl Non-WrkDays                                    ACTCTXK4
           03  YN0005 PIC X(1).                                         ACTCTXK4
      *    Next Program Name                                            ACTCTXK4
           03  YN0006 PIC X(10).                                        ACTCTXK4
      *    Create Date D8#                                              ACTCTXK4
           03  YN0007 PIC S9(8) COMP-3.                                 ACTCTXK4
      *    Create Time                                                  ACTCTXK4
           03  YN0008 PIC S9(6) COMP-3.                                 ACTCTXK4
      *    Create User                                                  ACTCTXK4
           03  YN0009 PIC X(10).                                        ACTCTXK4
      *    Create Program                                               ACTCTXK4
           03  YN0010 PIC X(10).                                        ACTCTXK4
      *    Create Job                                                   ACTCTXK4
           03  YN0011 PIC X(10).                                        ACTCTXK4
      *    Date Last Changed D8#                                        ACTCTXK4
           03  YN0012 PIC S9(8) COMP-3.                                 ACTCTXK4
      *    Time Last Changed                                            ACTCTXK4
           03  YN0013 PIC S9(6) COMP-3.                                 ACTCTXK4
      *    User Last Changed                                            ACTCTXK4
           03  YN0014 PIC X(10).                                        ACTCTXK4
      *    Program Last Changed                                         ACTCTXK4
           03  YN0015 PIC X(10).                                        ACTCTXK4
      *    Job Last Changed                                             ACTCTXK4
           03  YN0016 PIC X(10).                                        ACTCTXK4
      *    U:DTM valid ?                                                ACTCTXK4
           03  WUUDTMVLD PIC X(1).                                      ACTCTXK4
      *    U:Display (Y/N)                                              ACTCTXK4
           03  YL0003 PIC X(1).                                         ACTCTXK4
      *    Account Number                                               ACTCTXK4
           03  YN0017 PIC S9(6).                                        ACTCTXK4
      *    SAP Tax Code                                                 ACTCTXK4
           03  YN0018 PIC X(2).                                         ACTCTXK4
      *    Active Status(Y/N)                                           ACTCTXK4
           03  YN0019 PIC X(1).                                         ACTCTXK4
       01  IXDITS.                                                      CVTDTMK1
      /EJECT                                                            CVTDTMK1
      *    Internal date                                                CVTDTMK1
           03  XDITSM.                                                  CVTDTMK1
           05  XDITSD PIC X(10).                                        CVTDTMK1
           05  XDITSX PIC X(1).                                         CVTDTMK1
           05  XDITST PIC X(8).                                         CVTDTMK1
           05  XDITSZ PIC X(1).                                         CVTDTMK1
           05  XDITSN PIC S9(6).                                        CVTDTMK1
       01  IXDIN.                                                       CVTDTMK1
      /EJECT                                                            CVTDTMK1
      *    Internal date                                                CVTDTMK1
           03  XDINDTS.                                                 CVTDTMK1
           05  XDINYY PIC S9(3).                                        CVTDTMK1
           05  XDINMM PIC S9(2).                                        CVTDTMK1
           05  XDINDD PIC S9(2).                                        CVTDTMK1
           03  XDINDT REDEFINES XDINDTS PIC S9(7).                      CVTDTMK1
           03  XDINDTZ REDEFINES XDINDTS.                               CVTDTMK1
           05  XDINDI PIC X(1).                                         CVTDTMK1
           05  XDIND6 PIC X(6).                                         CVTDTMK1
       01  IXDI2T.                                                      CVTDTMK1
      /EJECT                                                            CVTDTMK1
      *    Internal date                                                CVTDTMK1
           03  XDI2DT.                                                  CVTDTMK1
           05  XDI2CY PIC S9(4).                                        CVTDTMK1
           05  FILLER REDEFINES XDI2CY.                                 CVTDTMK1
           07  XDI2CC PIC S9(1).                                        CVTDTMK1
           07  XDI2YY PIC S9(3).                                        CVTDTMK1
           05  XDDLM1 PIC X(1).                                         CVTDTMK1
           05  XDI2MM PIC S9(2).                                        CVTDTMK1
           05  XDDLM2 PIC X(1).                                         CVTDTMK1
           05  XDI2DD PIC S9(2).                                        CVTDTMK1
       01  KEXIN.                                                       CHKSTSK1
      *    List number                                                  CHKSTSK1
           03  Y2LSNO PIC S9(7) COMP-3.                                 CHKSTSK1
      *    External value                                               CHKSTSK1
           03  Y2EXVL PIC X(25).                                        CHKSTSK1
       01  W0NSRQ PIC X(1).                                             CHKSTSK1
      *    List number                                                  CHKSTSK1
      *    Higher level already exists                                  CHKSTSK1
      *    External value                                               CHKSTSK1
      *    Higher level already exists                                  CHKSTSK1
      *    List number                                                  CHKSTSK1
      *    Higher level already exists                                  CHKSTSK1
      *    External value                                               CHKSTSK1
      *    Higher level already exists                                  CHKSTSK1
       01  KINEX.                                                       CVTSTSK1
      *    List number                                                  CVTSTSK1
           03  Y2LSNO PIC S9(7) COMP-3.                                 CVTSTSK1
      *    Internal value                                               CVTSTSK1
           03  Y2INVL PIC X(25).                                        CVTSTSK1
      *    List number                                                  CHKSTSK1
      *    Higher level already exists                                  CHKSTSK1
      *    External value                                               CHKSTSK1
      *    Higher level already exists                                  CHKSTSK1
      *                                                                 CBLHDRK1
      *    Indicators                                                   CBLHDRK1
       01  INDICS.                                                      CBLHDRK1
           03  IND PIC 1(1) OCCURS 99 INDICATOR 1.                      CBLHDRK1
           88  C-INDICATOR-ON VALUE B'1'.                               CBLHDRK1
           88  C-INDICATOR-OFF VALUE B'0'.                              CBLHDRK1
      *                                                                 CBLHDRK1
      /EJECT                                                            DCLPARK1
      *    Parameter declarations                                       DCLPARK1
      *.Start.of.user.source.for.DTM.field.processing.................. CBLUFNK1
       01  U-UFDCNVDTMS.                                                CBLUFNK1
           05  U-DTM-MCY               PIC 9(6).                        CBLUFNK1
           05  U-DTM-MCY-X             REDEFINES U-DTM-MCY.             CBLUFNK1
               15  U-MM                PIC 9(2).                        CBLUFNK1
               15  U-CCYY              PIC 9(4).                        CBLUFNK1
           05  U-DTM-CYM               PIC 9(6).                        CBLUFNK1
           05  U-DTM-CYM-X             REDEFINES U-DTM-CYM.             CBLUFNK1
               15  U-CCYY              PIC 9(4).                        CBLUFNK1
               15  U-MM                PIC 9(2).                        CBLUFNK1
           05  U-DTM-VALID-FLAG        PIC X.                           CBLUFNK1
               88  U-DTM-VALID                        VALUE 'Y'.        CBLUFNK1
               88  U-DTM-INVALID                      VALUE 'N'.        CBLUFNK1
      *.End.of.user.source.for.DTM.field.processing.................... CBLUFNK1
      /EJECT                                                            DCLPARK1
      ***************************************************************   DCLPARK1
       LINKAGE SECTION.                                                 DCLPARK1
      *    Return code                                                  DCLPARK1
       01  P0RTN PIC X(7).                                              DCLPARK1
       01  P1PARM.                                                      DCLPARK1
      *    Fleet Operator Number                                        DCLPARK1
           03  P1FLOPNO PIC X(5).                                       DCLPARK1
      ***************************************************************   CBLHDRK1
       PROCEDURE DIVISION USING                                         CBLHDRK1
             P0RTN                                                      DCLPARK1
      *    RCD: FB Action                 Retrieval index               DCLPARK1
      *    I : MAP Fleet Operator Number                                DCLPARK1
      *    RCD : FB Action                                              DCLPARK1
             P1PARM                                                     DCLPARK1
           .                                                            DCLPARK1
      ***************************************************************   CBLHDRK1
           CONTINUE.                                                    CBLHDRK1
       MAINLINE SECTION.                                                CBLHDRK1
      *    Initialize                                                   CBLHDRK1
           PERFORM ZZINIT                                               CBLHDRK1
      *                                                                 CBLHDRK1
      *    Conduct screen conversation                                  PMTVALK1
           PERFORM UNTIL NOT (C-FOREVER)                                PMTVALK1
      *        Start new transaction                                    PMTVALK1
               MOVE 'Y' TO W0TRN                                        PMTVALK1
      *        Process current transaction                              PMTVALK1
               PERFORM UNTIL NOT (W0TRN = 'Y')                          PMTVALK1
      *            Convert fields to external form                      PMTVALK1
                   PERFORM MNCVZ1                                       PMTVALK1
      *            Display screen                                       PMTVALK1
                   PERFORM CAEXFM                                       PMTVALK1
      *            Process response                                     PMTVALK1
      *            EVALUATE                                             PMTVALK1
      *                Cancel & exit program                            PMTVALK1
                       IF (C-INDICATOR-ON(03)) THEN                     PMTVALK1
                           PERFORM ZXEXPG                               PMTVALK1
      *                HOME: Reset screen fields                        PMTVALK1
                       ELSE IF (C-INDICATOR-ON(30)) THEN                PMTVALK1
                           PERFORM MALDSC                               PMTVALK1
      *                Process screen input                             PMTVALK1
                       ELSE                                             PMTVALK1
                           PERFORM DAPRSC                               PMTVALK1
                   END-IF END-IF                                        PMTVALK1
      *                                                                 PMTVALK1
               END-PERFORM                                              PMTVALK1
      *                                                                 PMTVALK1
           END-PERFORM                                                  PMTVALK1
           .                                                            PMTVALK1
      ***************************************************************   PMTVALK1
      /EJECT                                                            PMTVALK1
       CAEXFM SECTION.                                                  PMTVALK1
      *==============================================================   PMTVALK1
      *    Display screen and process HELP requests                     PMTVALK1
      *==============================================================   PMTVALK1
      *    Set screen conditioning indicators                           PMTVALK1
           PERFORM GADSA1                                               PMTVALK1
           SET C-UNTIL-FALSE TO TRUE                                    PMTVALK1
           PERFORM UNTIL (C-UNTIL-TRUE)                                 PMTVALK1
               MOVE 'N' TO W0HLP                                        PMTVALK1
      *        Enable PUTOVR                                            PMTVALK1
               SET C-INDICATOR-ON(86) TO TRUE                           PMTVALK1
               MOVE ZZZCSRW TO ZZCSRW OF ZRCDDTL1-WS-O                  CBLEXFK1
               MOVE ZZZCSCL TO ZZCSCL OF ZRCDDTL1-WS-O                  CBLEXFK1
      *        Set cursor by *SET CURSOR data                           CBLEXFK1
               IF (YSETCS = 'Y') THEN                                   CBLEXFK1
                   PERFORM Y0SET                                        CBLEXFK1
               END-IF                                                   CBLEXFK1
               WRITE AABCCCCCDD-F FROM ZMSGCTL-WS-O                     CBLEXFK1
                 FORMAT IS 'ZMSGCTL' INDICATORS ARE INDICS              CBLEXFK1
               END-WRITE                                                CBLEXFK1
               WRITE AABCCCCCDD-F FROM ZCMDTXT1-WS-O                    CBLEXFK1
                 FORMAT IS 'ZCMDTXT1' INDICATORS ARE INDICS             CBLEXFK1
               END-WRITE                                                CBLEXFK1
               WRITE AABCCCCCDD-F FROM ZRCDDTL1-WS-O                    CBLEXFK1
                 FORMAT IS 'ZRCDDTL1' INDICATORS ARE INDICS             CBLEXFK1
               END-WRITE                                                CBLEXFK1
               READ AABCCCCCDD                                          CBLEXFK1
                 FORMAT IS 'ZRCDDTL1' INDICATORS ARE INDICS             CBLEXFK1
               END-READ                                                 CBLEXFK1
               MOVE AABCCCCCDD-F TO                                     CBLEXFK1
                 ZRCDDTL1-WS-I                                          CBLEXFK1
               MOVE CORRESPONDING                                       CBLEXFK1
                 ZRCDDTL1-I OF ZRCDDTL1-WS-I TO                         CBLEXFK1
                 ZRCDDTL1-O OF ZRCDDTL1-WS-O                            CBLEXFK1
      *        Test cursor                                              PMTVALK1
               PERFORM Y8TST                                            PMTVALK1
      *        Check if prompt requested                                PMTVALK1
               PERFORM ZDVPMT                                           PMTVALK1
      *        Reset help request                                       DSPHLPK1
      *        Clear set cursor DDS indicator                           DSPHLPK1
               IF (WCSRLC = 'OFF') THEN                                 DSPHLPK1
                   SET C-INDICATOR-OFF(94) TO TRUE                      DSPHLPK1
               END-IF                                                   DSPHLPK1
               MOVE SPACES TO WCSRLC                                    DSPHLPK1
      *        If help requested, display help text                     DSPHLPK1
               IF (C-INDICATOR-ON(25)) THEN                             DSPHLPK1
                   PERFORM ZHHPKY                                       DSPHLPK1
               END-IF                                                   DSPHLPK1
           IF (W0HLP = 'N')                                             PMTVALK1
             SET C-UNTIL-TRUE TO TRUE                                   PMTVALK1
           END-IF                                                       PMTVALK1
           END-PERFORM                                                  PMTVALK1
      *    Update job time                                              PMTVALK1
           ACCEPT ZZTIME FROM TIME                                      PMTVALK1
           MOVE ZZHNS TO ZZJTM                                          PMTVALK1
      *    Clear messages from program message queue                    PMTVALK1
           MOVE ZZPGM OF JOB-CONTEXT TO ZAPGMQ                          PMTVALK1
           MOVE '*SAME' TO ZAPGRL                                       PMTVALK1
           CALL 'Y2CLMSC' USING                                         PMTVALK1
             ZAPGMQ                                                     PMTVALK1
             ZAPGRL                                                     PMTVALK1
           END-CALL                                                     PMTVALK1
      *    Reset first message only flag                                PMTVALK1
           MOVE 'Y' TO ZAFSMS                                           PMTVALK1
           SET C-INDICATOR-OFF(99) TO TRUE                              PMTVALK1
           IF (YSETCS = 'Y') THEN                                       PMTVALK1
               PERFORM Y9CLR                                            PMTVALK1
           END-IF                                                       PMTVALK1
      *==============================================================   PMTVALK1
           CONTINUE.                                                    PMTVALK1
       CAEXIT.                                                          PMTVALK1
           EXIT.                                                        PMTVALK1
      /EJECT                                                            PMTVALK1
       DAPRSC SECTION.                                                  PMTVALK1
      *==============================================================   PMTVALK1
      *    Process screen input                                         PMTVALK1
      *==============================================================   PMTVALK1
      *    Confirm/update is not deferred                               PMTVALK1
           MOVE 'N' TO W0DCF                                            PMTVALK1
           IF (YPMTFD = SPACES) THEN                                    PMTVALK1
      *        USER: Process command keys                               MSGACTK2
      *        * F12 from this screen.                                  MSGACTK2
      *        CASE: DTL.*CMD key is *Previous panel                    MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (C-INDICATOR-ON(12)) THEN                             CBLIFXK1
      *            *Return code                                         CBLEXTK1
                   MOVE 'Y2U9998' TO P0RTN                              CBLEXTK1
                   PERFORM ZYEXPG                                       CBLEXTK1
               END-IF                                                   MSGACTK2
           END-IF                                                       PMTVALK1
      *    Validate screen input                                        PMTVALK1
           PERFORM DBVLSC                                               PMTVALK1
      *    If error, exit                                               PMTVALK1
           IF (C-INDICATOR-ON(99)) THEN                                 PMTVALK1
             GO DAEXIT                                                  PMTVALK1
           END-IF                                                       PMTVALK1
      *    Defer confirm/update requested                               PMTVALK1
           IF (W0DCF = 'Y') THEN                                        PMTVALK1
             GO DAEXIT                                                  PMTVALK1
           END-IF                                                       PMTVALK1
      *    Prompt for confirmation                                      PMTVALK1
           PERFORM DHPMCF                                               PMTVALK1
      *    Quit if not confirmed                                        PMTVALK1
           IF (C-INDICATOR-ON(99)) THEN                                 PMTVALK1
             GO DAEXIT                                                  PMTVALK1
           END-IF                                                       PMTVALK1
      *    USER: User defined action                                    MSGACTK2
      *    Process invoices and credit notes                            MSGACTK2
      *    CASE: DTL.U:Process Inv/Crd is Yes                           MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (ZDUPRCINV OF ZRCDDTL1-WS-O = 'Y') THEN                   CBLIFXK1
      *        Create FB Action - FB Action  *                          CBLCRTK1
               PERFORM SA1CRRC                                          CBLCRTK1
      *        Setup message data for message                           SNDMSGK2
               MOVE 'invoices and credits' TO ZA0001                    SNDMSGK2
      *        Send message 'Processing'                                SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'USR7153' TO ZAMSID                                 SNDMSGK1
      *        Pgmq rel                                                 SNDMSGK1
               MOVE '*EXT ' TO ZAPGRL                                   SNDMSGK1
      *        Message type                                             SNDMSGK1
               MOVE '*STATUS' TO ZAMSTP                                 SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
      *                                                                 SNDMSGK2
      *        Exc FB Run Processes - FB Run Control  *                 MSGACTK2
               INITIALIZE PARC                                          CBLCLLK1
               MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO PAFLOPNO               CBLCLLK1
               ADD Z1DIDM OF ZRCDDTL1-WS-O TO PADIDM                    CBLCLLK1
               ADD Z1ACTDTE OF ZRCDDTL1-WS-O TO PAACTDTE                CBLCLLK1
               ADD Z1ACTTIME OF ZRCDDTL1-WS-O TO PAACTTIME              CBLCLLK1
               MOVE ZDUPGM1 OF ZRCDDTL1-WS-O TO PAPGMNAM                CBLCLLK1
      *                                                                 CBLCLLK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLCLLK1
      *                                                                 CBLCLLK1
               CALL 'FBC001300S' USING                                  CBLCLLK1
      *        Return code                                              CBLCLLK1
                 W0RTN                                                  CBLCLLK1
      *        KEY : FB Action                                          CBLCLLK1
                 PARC                                                   CBLCLLK1
                        ON OVERFLOW                                     CBLCLLK1
                        SET C-INDICATOR-ON(90) TO TRUE                  CBLCLLK1
               END-CALL                                                 CBLCLLK1
      *                                                                 CBLCLLK1
      *                                                                 CBLCLLK1
      *        Error on program call will terminate run unit            CBLCLLK1
               IF (C-INDICATOR-ON(90)) THEN                             CBLCLLK1
                   MOVE 'Y2U0032' TO W0RTN                              CBLCLLK1
                   MOVE 'FBC001300S' TO W0CLPG                          CBLCLLK1
      *            Send message '*Error occured on CALL...'             SNDMSGK1
      *            Message ID                                           SNDMSGK1
                   MOVE 'Y2U0032' TO ZAMSID                             SNDMSGK1
      *            Message file                                         SNDMSGK1
                   MOVE 'Y2USRMSG' TO ZAMSGF                            SNDMSGK1
      *            Message data                                         SNDMSGK1
                   MOVE W0CLPG TO ZAMSDA                                SNDMSGK1
                   PERFORM ZASNMS                                       SNDMSGK1
               END-IF                                                   CBLCLLK1
      *        Error detected?                                          CBLCLLK1
               IF (W0RTN        NOT = SPACES) THEN                      CBLCLLK1
                   SET C-INDICATOR-ON(99) TO TRUE                       CBLCLLK1
                   SET C-INDICATOR-ON(31) TO TRUE                       CBLCLLK1
               END-IF                                                   CBLCLLK1
      *        Check run completed and status is OK                     MSGACTK2
      *        Rtv all fields - FB Action  *                            CBLRTVK2
               PERFORM SA2RVGN                                          CBLRTVK2
      *        Check completion and run credit notes                    MSGACTK2
      *        CASE: LCL.FB Action Status is Ran OK                     MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (YL0002 OF WORK-CONTEXT = 'OK') THEN                  CBLIFXK1
      *            Create FB Action - FB Action  *                      CBLCRTK1
                   PERFORM SA3CRRC                                      CBLCRTK1
      *            Exc FB Run Processes - FB Run Control  *             MSGACTK2
                   INITIALIZE PARC                                      CBLCLLK1
                   MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO PAFLOPNO           CBLCLLK1
                   ADD Z1DIDM OF ZRCDDTL1-WS-O TO PADIDM                CBLCLLK1
                   ADD Z1ACTDTE OF ZRCDDTL1-WS-O TO PAACTDTE            CBLCLLK1
                   ADD Z1ACTTIME OF ZRCDDTL1-WS-O TO PAACTTIME          CBLCLLK1
                   MOVE ZDUPGM2 OF ZRCDDTL1-WS-O TO PAPGMNAM            CBLCLLK1
      *                                                                 CBLCLLK1
                   SET C-INDICATOR-OFF(90) TO TRUE                      CBLCLLK1
      *                                                                 CBLCLLK1
                   CALL 'FBC001300S' USING                              CBLCLLK1
      *            Return code                                          CBLCLLK1
                     W0RTN                                              CBLCLLK1
      *            KEY : FB Action                                      CBLCLLK1
                     PARC                                               CBLCLLK1
                            ON OVERFLOW                                 CBLCLLK1
                            SET C-INDICATOR-ON(90) TO TRUE              CBLCLLK1
                   END-CALL                                             CBLCLLK1
      *                                                                 CBLCLLK1
      *                                                                 CBLCLLK1
      *            Error on program call will terminate run unit        CBLCLLK1
                   IF (C-INDICATOR-ON(90)) THEN                         CBLCLLK1
                       MOVE 'Y2U0032' TO W0RTN                          CBLCLLK1
                       MOVE 'FBC001300S' TO W0CLPG                      CBLCLLK1
      *                Send message '*Error occured on CALL...'         SNDMSGK1
      *                Message ID                                       SNDMSGK1
                       MOVE 'Y2U0032' TO ZAMSID                         SNDMSGK1
      *                Message file                                     SNDMSGK1
                       MOVE 'Y2USRMSG' TO ZAMSGF                        SNDMSGK1
      *                Message data                                     SNDMSGK1
                       MOVE W0CLPG TO ZAMSDA                            SNDMSGK1
                       PERFORM ZASNMS                                   SNDMSGK1
                   END-IF                                               CBLCLLK1
      *            Error detected?                                      CBLCLLK1
                   IF (W0RTN        NOT = SPACES) THEN                  CBLCLLK1
                       SET C-INDICATOR-ON(99) TO TRUE                   CBLCLLK1
                       SET C-INDICATOR-ON(31) TO TRUE                   CBLCLLK1
                   END-IF                                               CBLCLLK1
      *            Check run completed and status is OK                 MSGACTK2
      *            Rtv all fields - FB Action  *                        CBLRTVK2
                   PERFORM SA4RVGN                                      CBLRTVK2
      *            Check completion                                     MSGACTK2
      *            CASE: LCL.FB Action Status is Ran OK                 MSGACTK2
      *            *IF                                                  CBLIFXK1
                   IF (YL0002 OF WORK-CONTEXT = 'OK') THEN              CBLIFXK1
                       CONTINUE                                         MSGACTK2
                   ELSE                                                 MSGACTK2
      *                CASE: *OTHERWISE                                 MSGACTK2
      *                Setup message data for message                   SNDMSGK2
                       MOVE W0RTN TO ZA0002                             SNDMSGK2
                       MOVE ZDUPGM1 OF ZRCDDTL1-WS-O TO ZA0003          SNDMSGK2
      *                Send message 'Error in called program'           SNDMSGK1
      *                Message ID                                       SNDMSGK1
                       MOVE 'USR6103' TO ZAMSID                         SNDMSGK1
      *                Pgmq rel                                         SNDMSGK1
                       MOVE '*PRV ' TO ZAPGRL                           SNDMSGK1
      *                Message type                                     SNDMSGK1
                       MOVE '*COMP  ' TO ZAMSTP                         SNDMSGK1
                       PERFORM ZASNMS                                   SNDMSGK1
      *                                                                 SNDMSGK2
      *                *Return code                                     CBLMOVK1
                       MOVE SPACES TO W0RTN                             CBLMOVK1
                       MOVE 'ERROR' TO W0RTN                            CBLMOVK1
                   END-IF                                               MSGACTK2
               ELSE                                                     MSGACTK2
      *            CASE: *OTHERWISE                                     MSGACTK2
      *            Setup message data for message                       SNDMSGK2
                   MOVE W0RTN TO ZA0004                                 SNDMSGK2
                   MOVE ZDUPGM1 OF ZRCDDTL1-WS-O TO ZA0005              SNDMSGK2
      *            Send message 'Error in called program'               SNDMSGK1
      *            Message ID                                           SNDMSGK1
                   MOVE 'USR6103' TO ZAMSID                             SNDMSGK1
      *            Pgmq rel                                             SNDMSGK1
                   MOVE '*PRV ' TO ZAPGRL                               SNDMSGK1
      *            Message type                                         SNDMSGK1
                   MOVE '*COMP  ' TO ZAMSTP                             SNDMSGK1
                   PERFORM ZASNMS                                       SNDMSGK1
      *                                                                 SNDMSGK2
      *            *Return code                                         CBLMOVK1
                   MOVE SPACES TO W0RTN                                 CBLMOVK1
                   MOVE 'ERROR' TO W0RTN                                CBLMOVK1
               END-IF                                                   MSGACTK2
           END-IF                                                       MSGACTK2
      *    Process posting to accounts                                  MSGACTK2
      *    CASE: DTL.U:Process Posting to A/Cs is Yes                   MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (ZDUPRCPOST OF ZRCDDTL1-WS-O = 'Y') THEN                  CBLIFXK1
      *        CASE: PGM.*Return code is *Normal                        MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (W0RTN = SPACES) THEN                                 CBLIFXK1
      *            Rtv FB Run Status - FB Run Control  *                CBLRTVK2
                   PERFORM SA5RVGN                                      CBLRTVK2
      *            Check status is dealer credits complete and run      MSGACTK2
      *              posting                                            MSGACTK2
      *            CASE: DTL.FB Run Status is Dealer Credit Complete    MSGACTK2
      *            *IF                                                  CBLIFXK1
                   IF (ZDRUNSTAT OF ZRCDDTL1-WS-O = '9') THEN           CBLIFXK1
      *                OK ready for posting BT invoice                  MSGACTK2
      *                Create FB Action - FB Action  *                  CBLCRTK1
                       PERFORM SA6CRRC                                  CBLCRTK1
      *                Setup message data for message                   SNDMSGK2
                       MOVE 'interface for posting' TO ZA0006           SNDMSGK2
      *                Send message 'Processing'                        SNDMSGK1
      *                Message ID                                       SNDMSGK1
                       MOVE 'USR7153' TO ZAMSID                         SNDMSGK1
      *                Pgmq rel                                         SNDMSGK1
                       MOVE '*EXT ' TO ZAPGRL                           SNDMSGK1
      *                Message type                                     SNDMSGK1
                       MOVE '*STATUS' TO ZAMSTP                         SNDMSGK1
                       PERFORM ZASNMS                                   SNDMSGK1
      *                                                                 SNDMSGK2
      *                Exc FB Run Processes - FB Run Control  *         MSGACTK2
                       INITIALIZE PARC                                  CBLCLLK1
                       MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO PAFLOPNO       CBLCLLK1
                       ADD Z1DIDM OF ZRCDDTL1-WS-O TO PADIDM            CBLCLLK1
                       ADD Z1ACTDTE OF ZRCDDTL1-WS-O TO PAACTDTE        CBLCLLK1
                       ADD Z1ACTTIME OF ZRCDDTL1-WS-O TO PAACTTIME      CBLCLLK1
                       MOVE ZDUPGM3 OF ZRCDDTL1-WS-O TO PAPGMNAM        CBLCLLK1
      *                                                                 CBLCLLK1
                       SET C-INDICATOR-OFF(90) TO TRUE                  CBLCLLK1
      *                                                                 CBLCLLK1
                       CALL 'FBC001300S' USING                          CBLCLLK1
      *                Return code                                      CBLCLLK1
                         W0RTN                                          CBLCLLK1
      *                KEY : FB Action                                  CBLCLLK1
                         PARC                                           CBLCLLK1
                                ON OVERFLOW                             CBLCLLK1
                                SET C-INDICATOR-ON(90) TO TRUE          CBLCLLK1
                       END-CALL                                         CBLCLLK1
      *                                                                 CBLCLLK1
      *                                                                 CBLCLLK1
      *                Error on program call will terminate run unit    CBLCLLK1
                       IF (C-INDICATOR-ON(90)) THEN                     CBLCLLK1
                           MOVE 'Y2U0032' TO W0RTN                      CBLCLLK1
                           MOVE 'FBC001300S' TO W0CLPG                  CBLCLLK1
      *                    Send message '*Error occured on CALL...'     SNDMSGK1
      *                    Message ID                                   SNDMSGK1
                           MOVE 'Y2U0032' TO ZAMSID                     SNDMSGK1
      *                    Message file                                 SNDMSGK1
                           MOVE 'Y2USRMSG' TO ZAMSGF                    SNDMSGK1
      *                    Message data                                 SNDMSGK1
                           MOVE W0CLPG TO ZAMSDA                        SNDMSGK1
                           PERFORM ZASNMS                               SNDMSGK1
                       END-IF                                           CBLCLLK1
      *                Error detected?                                  CBLCLLK1
                       IF (W0RTN        NOT = SPACES) THEN              CBLCLLK1
                           SET C-INDICATOR-ON(99) TO TRUE               CBLCLLK1
                           SET C-INDICATOR-ON(31) TO TRUE               CBLCLLK1
                       END-IF                                           CBLCLLK1
      *                Check run completed and status is OK             MSGACTK2
      *                Rtv all fields - FB Action  *                    CBLRTVK2
                       PERFORM SA7RVGN                                  CBLRTVK2
      *                Check return and run dealer posting              MSGACTK2
      *                CASE: LCL.FB Action Status is Ran OK             MSGACTK2
      *                *IF                                              CBLIFXK1
                       IF (YL0002 OF WORK-CONTEXT = 'OK') THEN          CBLIFXK1
      *                    Post dealer credit notes                     MSGACTK2
      *                    Create FB Action - FB Action  *              CBLCRTK1
                           PERFORM SA8CRRC                              CBLCRTK1
      *                    Exc FB Run Processes - FB Run Control  *     MSGACTK2
                           INITIALIZE PARC                              CBLCLLK1
                           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO PAFLOPNO   CBLCLLK1
                           ADD Z1DIDM OF ZRCDDTL1-WS-O TO PADIDM        CBLCLLK1
                           ADD Z1ACTDTE OF ZRCDDTL1-WS-O TO PAACTDTE    CBLCLLK1
                           ADD Z1ACTTIME OF ZRCDDTL1-WS-O TO PAACTTIME  CBLCLLK1
                           MOVE ZDUPGM4 OF ZRCDDTL1-WS-O TO PAPGMNAM    CBLCLLK1
      *                                                                 CBLCLLK1
                           SET C-INDICATOR-OFF(90) TO TRUE              CBLCLLK1
      *                                                                 CBLCLLK1
                           CALL 'FBC001300S' USING                      CBLCLLK1
      *                    Return code                                  CBLCLLK1
                             W0RTN                                      CBLCLLK1
      *                    KEY : FB Action                              CBLCLLK1
                             PARC                                       CBLCLLK1
                                    ON OVERFLOW                         CBLCLLK1
                                    SET C-INDICATOR-ON(90) TO TRUE      CBLCLLK1
                           END-CALL                                     CBLCLLK1
      *                                                                 CBLCLLK1
      *                                                                 CBLCLLK1
      *                    Error on program call will terminate run unitCBLCLLK1
                           IF (C-INDICATOR-ON(90)) THEN                 CBLCLLK1
                               MOVE 'Y2U0032' TO W0RTN                  CBLCLLK1
                               MOVE 'FBC001300S' TO W0CLPG              CBLCLLK1
      *                        Send message '*Error occured on CALL...' SNDMSGK1
      *                        Message ID                               SNDMSGK1
                               MOVE 'Y2U0032' TO ZAMSID                 SNDMSGK1
      *                        Message file                             SNDMSGK1
                               MOVE 'Y2USRMSG' TO ZAMSGF                SNDMSGK1
      *                        Message data                             SNDMSGK1
                               MOVE W0CLPG TO ZAMSDA                    SNDMSGK1
                               PERFORM ZASNMS                           SNDMSGK1
                           END-IF                                       CBLCLLK1
      *                    Error detected?                              CBLCLLK1
                           IF (W0RTN        NOT = SPACES) THEN          CBLCLLK1
                               SET C-INDICATOR-ON(99) TO TRUE           CBLCLLK1
                               SET C-INDICATOR-ON(31) TO TRUE           CBLCLLK1
                           END-IF                                       CBLCLLK1
      *                    Check run completed and status is OK         MSGACTK2
      *                    Rtv all fields - FB Action  *                CBLRTVK2
                           PERFORM SA9RVGN                              CBLRTVK2
      *                    CASE: LCL.FB Action Status is Ran OK         MSGACTK2
      *                    *IF                                          CBLIFXK1
                           IF (YL0002 OF WORK-CONTEXT = 'OK') THEN      CBLIFXK1
                               CONTINUE                                 MSGACTK2
                           ELSE                                         MSGACTK2
      *                        CASE: *OTHERWISE                         MSGACTK2
      *                        *Return code                             CBLMOVK1
                               MOVE SPACES TO W0RTN                     CBLMOVK1
                               MOVE 'ERROR' TO W0RTN                    CBLMOVK1
      *                        Setup message data for message           SNDMSGK2
                               MOVE W0RTN TO ZA0007                     SNDMSGK2
                               MOVE ZDUPGM3 OF ZRCDDTL1-WS-O TO ZA0008  SNDMSGK2
      *                        Send message 'Error in called program'   SNDMSGK1
      *                        Message ID                               SNDMSGK1
                               MOVE 'USR6103' TO ZAMSID                 SNDMSGK1
      *                        Pgmq rel                                 SNDMSGK1
                               MOVE '*PRV ' TO ZAPGRL                   SNDMSGK1
      *                        Message type                             SNDMSGK1
                               MOVE '*COMP  ' TO ZAMSTP                 SNDMSGK1
                               PERFORM ZASNMS                           SNDMSGK1
      *                                                                 SNDMSGK2
                           END-IF                                       MSGACTK2
                       ELSE                                             MSGACTK2
      *                    CASE: *OTHERWISE                             MSGACTK2
      *                    *Return code                                 CBLMOVK1
                           MOVE SPACES TO W0RTN                         CBLMOVK1
                           MOVE 'ERROR' TO W0RTN                        CBLMOVK1
      *                    Setup message data for message               SNDMSGK2
                           MOVE W0RTN TO ZA0009                         SNDMSGK2
                           MOVE ZDUPGM3 OF ZRCDDTL1-WS-O TO ZA0010      SNDMSGK2
      *                    Send message 'Error in called program'       SNDMSGK1
      *                    Message ID                                   SNDMSGK1
                           MOVE 'USR6103' TO ZAMSID                     SNDMSGK1
      *                    Pgmq rel                                     SNDMSGK1
                           MOVE '*PRV ' TO ZAPGRL                       SNDMSGK1
      *                    Message type                                 SNDMSGK1
                           MOVE '*COMP  ' TO ZAMSTP                     SNDMSGK1
                           PERFORM ZASNMS                               SNDMSGK1
      *                                                                 SNDMSGK2
                       END-IF                                           MSGACTK2
                   ELSE                                                 MSGACTK2
      *                CASE: *OTHERWISE                                 MSGACTK2
      *                Send message 'Status not valid for act.'         SNDMSGK1
      *                Message ID                                       SNDMSGK1
                       MOVE 'USR6032' TO ZAMSID                         SNDMSGK1
                       PERFORM ZASNMS                                   SNDMSGK1
                       SET C-INDICATOR-ON(99) TO TRUE                   SNDMSGK2
      *                                                                 SNDMSGK2
                   END-IF                                               MSGACTK2
               ELSE                                                     MSGACTK2
      *            CASE: *OTHERWISE                                     MSGACTK2
      *            Setup message data for message                       SNDMSGK2
                   MOVE W0RTN TO ZA0011                                 SNDMSGK2
                   MOVE ZDUPGM2 OF ZRCDDTL1-WS-O TO ZA0012              SNDMSGK2
      *            Send message 'Error in called program'               SNDMSGK1
      *            Message ID                                           SNDMSGK1
                   MOVE 'USR6103' TO ZAMSID                             SNDMSGK1
      *            Pgmq rel                                             SNDMSGK1
                   MOVE '*PRV ' TO ZAPGRL                               SNDMSGK1
      *            Message type                                         SNDMSGK1
                   MOVE '*COMP  ' TO ZAMSTP                             SNDMSGK1
                   PERFORM ZASNMS                                       SNDMSGK1
      *                                                                 SNDMSGK2
               END-IF                                                   MSGACTK2
           END-IF                                                       MSGACTK2
      *    Process extract                                              MSGACTK2
      *    CASE: DTL.U:Process Extract & Email is Yes                   MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (ZDUPRCEXT OF ZRCDDTL1-WS-O = 'Y') THEN                   CBLIFXK1
      *        Rtv FB Run Status - FB Run Control  *                    CBLRTVK2
               PERFORM SB1RVGN                                          CBLRTVK2
      *        Check status is sent to accounting system                MSGACTK2
      *        CASE: DTL.FB Run Status is Sent to Accounting System     MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (ZDRUNSTAT OF ZRCDDTL1-WS-O = 'Y') THEN               CBLIFXK1
      *            OK ready for extract                                 MSGACTK2
      *            Run extract                                          MSGACTK2
      *            CASE: PGM.*Return code is *Normal                    MSGACTK2
      *            *IF                                                  CBLIFXK1
                   IF (W0RTN = SPACES) THEN                             CBLIFXK1
      *                Create FB Action - FB Action  *                  CBLCRTK1
                       PERFORM SB2CRRC                                  CBLCRTK1
      *                Setup message data for message                   SNDMSGK2
                       MOVE 'extract to email' TO ZA0013                SNDMSGK2
      *                Send message 'Processing'                        SNDMSGK1
      *                Message ID                                       SNDMSGK1
                       MOVE 'USR7153' TO ZAMSID                         SNDMSGK1
      *                Pgmq rel                                         SNDMSGK1
                       MOVE '*EXT ' TO ZAPGRL                           SNDMSGK1
      *                Message type                                     SNDMSGK1
                       MOVE '*STATUS' TO ZAMSTP                         SNDMSGK1
                       PERFORM ZASNMS                                   SNDMSGK1
      *                                                                 SNDMSGK2
      *                Exc FB Run Processes - FB Run Control  *         MSGACTK2
                       INITIALIZE PARC                                  CBLCLLK1
                       MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO PAFLOPNO       CBLCLLK1
                       ADD Z1DIDM OF ZRCDDTL1-WS-O TO PADIDM            CBLCLLK1
                       ADD Z1ACTDTE OF ZRCDDTL1-WS-O TO PAACTDTE        CBLCLLK1
                       ADD Z1ACTTIME OF ZRCDDTL1-WS-O TO PAACTTIME      CBLCLLK1
                       MOVE ZDUPGM5 OF ZRCDDTL1-WS-O TO PAPGMNAM        CBLCLLK1
      *                                                                 CBLCLLK1
                       SET C-INDICATOR-OFF(90) TO TRUE                  CBLCLLK1
      *                                                                 CBLCLLK1
                       CALL 'FBC001300S' USING                          CBLCLLK1
      *                Return code                                      CBLCLLK1
                         W0RTN                                          CBLCLLK1
      *                KEY : FB Action                                  CBLCLLK1
                         PARC                                           CBLCLLK1
                                ON OVERFLOW                             CBLCLLK1
                                SET C-INDICATOR-ON(90) TO TRUE          CBLCLLK1
                       END-CALL                                         CBLCLLK1
      *                                                                 CBLCLLK1
      *                                                                 CBLCLLK1
      *                Error on program call will terminate run unit    CBLCLLK1
                       IF (C-INDICATOR-ON(90)) THEN                     CBLCLLK1
                           MOVE 'Y2U0032' TO W0RTN                      CBLCLLK1
                           MOVE 'FBC001300S' TO W0CLPG                  CBLCLLK1
      *                    Send message '*Error occured on CALL...'     SNDMSGK1
      *                    Message ID                                   SNDMSGK1
                           MOVE 'Y2U0032' TO ZAMSID                     SNDMSGK1
      *                    Message file                                 SNDMSGK1
                           MOVE 'Y2USRMSG' TO ZAMSGF                    SNDMSGK1
      *                    Message data                                 SNDMSGK1
                           MOVE W0CLPG TO ZAMSDA                        SNDMSGK1
                           PERFORM ZASNMS                               SNDMSGK1
                       END-IF                                           CBLCLLK1
      *                Error detected?                                  CBLCLLK1
                       IF (W0RTN        NOT = SPACES) THEN              CBLCLLK1
                           SET C-INDICATOR-ON(99) TO TRUE               CBLCLLK1
                           SET C-INDICATOR-ON(31) TO TRUE               CBLCLLK1
                       END-IF                                           CBLCLLK1
      *                Rtv all fields - FB Action  *                    CBLRTVK2
                       PERFORM SB3RVGN                                  CBLRTVK2
      *                CASE: LCL.FB Action Status is Ran OK             MSGACTK2
      *                *IF                                              CBLIFXK1
                       IF (YL0002 OF WORK-CONTEXT = 'OK') THEN          CBLIFXK1
      *                    Setup message data for message               SNDMSGK2
                           MOVE 'Fleet Billing' TO ZA0014               SNDMSGK2
      *                    Send message 'Program ran successfuly'       SNDMSGK1
      *                    Message ID                                   SNDMSGK1
                           MOVE 'USR6713' TO ZAMSID                     SNDMSGK1
      *                    Message type                                 SNDMSGK1
                           MOVE '*INFO  ' TO ZAMSTP                     SNDMSGK1
                           PERFORM ZASNMS                               SNDMSGK1
      *                                                                 SNDMSGK2
                       ELSE                                             MSGACTK2
      *                    CASE: *OTHERWISE                             MSGACTK2
      *                    Setup message data for message               SNDMSGK2
                           MOVE W0RTN TO ZA0015                         SNDMSGK2
                           MOVE ZDUPGM5 OF ZRCDDTL1-WS-O TO ZA0016      SNDMSGK2
      *                    Send message 'Error in called program'       SNDMSGK1
      *                    Message ID                                   SNDMSGK1
                           MOVE 'USR6103' TO ZAMSID                     SNDMSGK1
      *                    Pgmq rel                                     SNDMSGK1
                           MOVE '*PRV ' TO ZAPGRL                       SNDMSGK1
      *                    Message type                                 SNDMSGK1
                           MOVE '*COMP  ' TO ZAMSTP                     SNDMSGK1
                           PERFORM ZASNMS                               SNDMSGK1
      *                                                                 SNDMSGK2
                       END-IF                                           MSGACTK2
                   ELSE                                                 MSGACTK2
      *                CASE: *OTHERWISE                                 MSGACTK2
      *                Setup message data for message                   SNDMSGK2
                       MOVE W0RTN TO ZA0017                             SNDMSGK2
                       MOVE ZDUPGM4 OF ZRCDDTL1-WS-O TO ZA0018          SNDMSGK2
      *                Send message 'Error in called program'           SNDMSGK1
      *                Message ID                                       SNDMSGK1
                       MOVE 'USR6103' TO ZAMSID                         SNDMSGK1
      *                Pgmq rel                                         SNDMSGK1
                       MOVE '*PRV ' TO ZAPGRL                           SNDMSGK1
      *                Message type                                     SNDMSGK1
                       MOVE '*COMP  ' TO ZAMSTP                         SNDMSGK1
                       PERFORM ZASNMS                                   SNDMSGK1
      *                                                                 SNDMSGK2
                   END-IF                                               MSGACTK2
               ELSE                                                     MSGACTK2
      *            CASE: *OTHERWISE                                     MSGACTK2
      *            Send message 'Status not valid for act.'             SNDMSGK1
      *            Message ID                                           SNDMSGK1
                   MOVE 'USR6032' TO ZAMSID                             SNDMSGK1
                   PERFORM ZASNMS                                       SNDMSGK1
                   SET C-INDICATOR-ON(99) TO TRUE                       SNDMSGK2
      *                                                                 SNDMSGK2
               END-IF                                                   MSGACTK2
           END-IF                                                       MSGACTK2
      *    Request new transaction                                      PMTVALK1
           MOVE 'N' TO W0TRN                                            PMTVALK1
      *==============================================================   PMTVALK1
           CONTINUE.                                                    PMTVALK1
       DAEXIT.                                                          PMTVALK1
           EXIT.                                                        PMTVALK1
      /EJECT                                                            PMTVALK1
       DBVLSC SECTION.                                                  PMTVALK1
      *==============================================================   PMTVALK1
      *    Validate screen input                                        PMTVALK1
      *==============================================================   PMTVALK1
      *    Validate FB Month of Parts Data and convert to internal.     MSGACTK2
      *    Check DTM                                                    MSGACTK2
      *    CASE: PAR.U:DTM external is *Zero                            MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (V1DIDM OF ZRCDDTL1-WS-O = ZEROS) THEN                    CBLIFXK1
      *        U:DTM internal                                           CBLMOVK1
               MOVE ZEROS TO Z1DIDM OF ZRCDDTL1-WS-O                    CBLMOVK1
           ELSE                                                         MSGACTK2
      *        CASE: *OTHERWISE                                         MSGACTK2
      *        Check DTM valid - *Field attribute types  *              MSGACTK2
               MOVE V1DIDM OF ZRCDDTL1-WS-O                             CBLUFNK1
                 TO U-DTM-MCY  OF U-UFDCNVDTMS                          CBLUFNK1
               PERFORM U-UFDCHKDTMS                                     CBLUFNK1
               MOVE U-DTM-VALID-FLAG  OF U-UFDCNVDTMS                   CBLUFNK1
                 TO WUUDTMVLD OF WORK-CONTEXT                           CBLUFNK1
               MOVE U-DTM-CYM  OF U-UFDCNVDTMS                          CBLUFNK1
                 TO Z1DIDM OF ZRCDDTL1-WS-O                             CBLUFNK1
      *.End.of.user.source.for.DTM.field.processing.................... CBLUFNK1
      *        CASE: WRK.U:DTM valid ? is No                            MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (WUUDTMVLD OF WORK-CONTEXT = 'N') THEN                CBLIFXK1
      *            Setup message data for message                       SNDMSGK2
                   MOVE V1DIDM OF ZRCDDTL1-WS-O TO ZA0019               SNDMSGK2
      *            Send message 'DTM invalid'                           SNDMSGK1
      *            Message ID                                           SNDMSGK1
                   MOVE 'USR4917' TO ZAMSID                             SNDMSGK1
                   PERFORM ZASNMS                                       SNDMSGK1
                   SET C-INDICATOR-ON(99) TO TRUE                       SNDMSGK2
                   SET C-INDICATOR-ON(31) TO TRUE                       SNDMSGK2
      *                                                                 SNDMSGK2
               END-IF                                                   MSGACTK2
           END-IF                                                       MSGACTK2
      *    Validate U:Process Inv/Crd                                   CHKSTSK1
           MOVE SPACES TO W0RTN                                         CHKSTSK1
      *    Name search required?                                        CHKSTSK1
      *    U:Process Inv/Crd                                            CHKSTSK1
           MOVE ZDUPRCINV OF ZRCDDTL1-WS-O TO W0NSRQ                    CHKSTSK1
      *    Search required                                              CHKSTSK1
           IF (W0NSRQ = '?' OR                                          CHKSTSK1
               'ZDUPRCINV ' = YPMTFD) THEN                              CHKSTSK1
               MOVE ZDUPRCINV OF ZRCDDTL1-WS-O TO W0EXVL                CHKSTSK1
               MOVE 1727934 TO Y2LSNO OF KEXIN                          CHKSTSK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CHKSTSK1
               CALL 'RAVLLSR' USING                                     CHKSTSK1
      *        Return code                                              CHKSTSK1
                 W0RTN                                                  CHKSTSK1
      *        List number                                              CHKSTSK1
                 Y2LSNO OF KEXIN                                        CHKSTSK1
      *        U:Process Inv/Crd                                        CHKSTSK1
                 W0EXVL                                                 CHKSTSK1
                    ON OVERFLOW                                         CHKSTSK1
                       SET C-INDICATOR-ON(90) TO TRUE                   CHKSTSK1
               END-CALL                                                 CHKSTSK1
      *                                                                 CHKSTSK1
               IF (C-INDICATOR-ON(90)) THEN                             CHKSTSK1
                   MOVE 'Y2U0021' TO W0RTN                              CHKSTSK1
               END-IF                                                   CHKSTSK1
      *        Error on program call will terminate run unit            CHKSTSK1
               MOVE W0EXVL TO ZDUPRCINV OF ZRCDDTL1-WS-O                CHKSTSK1
      *        Defer confirm                                            CHKSTSK1
               MOVE 'Y' TO W0DCF                                        CHKSTSK1
               IF (W0NSRQ NOT = '?') THEN                               CHKSTSK1
                   MOVE '*DONE' TO YPMTFD                               CHKSTSK1
               END-IF                                                   CHKSTSK1
           END-IF                                                       CHKSTSK1
      *                                                                 CHKSTSK1
      *    Validate U:Process Posting to A/Cs                           CHKSTSK1
           MOVE SPACES TO W0RTN                                         CHKSTSK1
      *    Name search required?                                        CHKSTSK1
      *    U:Process Posting to A/Cs                                    CHKSTSK1
           MOVE ZDUPRCPOST OF ZRCDDTL1-WS-O TO W0NSRQ                   CHKSTSK1
      *    Search required                                              CHKSTSK1
           IF (W0NSRQ = '?' OR                                          CHKSTSK1
               'ZDUPRCPOST' = YPMTFD) THEN                              CHKSTSK1
               MOVE ZDUPRCPOST OF ZRCDDTL1-WS-O TO W0EXVL               CHKSTSK1
               MOVE 1727934 TO Y2LSNO OF KEXIN                          CHKSTSK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CHKSTSK1
               CALL 'RAVLLSR' USING                                     CHKSTSK1
      *        Return code                                              CHKSTSK1
                 W0RTN                                                  CHKSTSK1
      *        List number                                              CHKSTSK1
                 Y2LSNO OF KEXIN                                        CHKSTSK1
      *        U:Process Posting to A/Cs                                CHKSTSK1
                 W0EXVL                                                 CHKSTSK1
                    ON OVERFLOW                                         CHKSTSK1
                       SET C-INDICATOR-ON(90) TO TRUE                   CHKSTSK1
               END-CALL                                                 CHKSTSK1
      *                                                                 CHKSTSK1
               IF (C-INDICATOR-ON(90)) THEN                             CHKSTSK1
                   MOVE 'Y2U0021' TO W0RTN                              CHKSTSK1
               END-IF                                                   CHKSTSK1
      *        Error on program call will terminate run unit            CHKSTSK1
               MOVE W0EXVL TO ZDUPRCPOST OF ZRCDDTL1-WS-O               CHKSTSK1
      *        Defer confirm                                            CHKSTSK1
               MOVE 'Y' TO W0DCF                                        CHKSTSK1
               IF (W0NSRQ NOT = '?') THEN                               CHKSTSK1
                   MOVE '*DONE' TO YPMTFD                               CHKSTSK1
               END-IF                                                   CHKSTSK1
           END-IF                                                       CHKSTSK1
      *                                                                 CHKSTSK1
      *    Validate U:Process Extract & Email                           CHKSTSK1
           MOVE SPACES TO W0RTN                                         CHKSTSK1
      *    Name search required?                                        CHKSTSK1
      *    U:Process Extract & Email                                    CHKSTSK1
           MOVE ZDUPRCEXT OF ZRCDDTL1-WS-O TO W0NSRQ                    CHKSTSK1
      *    Search required                                              CHKSTSK1
           IF (W0NSRQ = '?' OR                                          CHKSTSK1
               'ZDUPRCEXT ' = YPMTFD) THEN                              CHKSTSK1
               MOVE ZDUPRCEXT OF ZRCDDTL1-WS-O TO W0EXVL                CHKSTSK1
               MOVE 1727934 TO Y2LSNO OF KEXIN                          CHKSTSK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CHKSTSK1
               CALL 'RAVLLSR' USING                                     CHKSTSK1
      *        Return code                                              CHKSTSK1
                 W0RTN                                                  CHKSTSK1
      *        List number                                              CHKSTSK1
                 Y2LSNO OF KEXIN                                        CHKSTSK1
      *        U:Process Extract & Email                                CHKSTSK1
                 W0EXVL                                                 CHKSTSK1
                    ON OVERFLOW                                         CHKSTSK1
                       SET C-INDICATOR-ON(90) TO TRUE                   CHKSTSK1
               END-CALL                                                 CHKSTSK1
      *                                                                 CHKSTSK1
               IF (C-INDICATOR-ON(90)) THEN                             CHKSTSK1
                   MOVE 'Y2U0021' TO W0RTN                              CHKSTSK1
               END-IF                                                   CHKSTSK1
      *        Error on program call will terminate run unit            CHKSTSK1
               MOVE W0EXVL TO ZDUPRCEXT OF ZRCDDTL1-WS-O                CHKSTSK1
      *        Defer confirm                                            CHKSTSK1
               MOVE 'Y' TO W0DCF                                        CHKSTSK1
               IF (W0NSRQ NOT = '?') THEN                               CHKSTSK1
                   MOVE '*DONE' TO YPMTFD                               CHKSTSK1
               END-IF                                                   CHKSTSK1
           END-IF                                                       CHKSTSK1
      *                                                                 CHKSTSK1
           IF (YPMTFD = SPACES) THEN                                    PMTVALK1
      *        USER: Validate fields                                    MSGACTK2
      *        CASE: All actions = no                                   MSGACTK2
      *        - c1ANDc2ANDc3                                           MSGACTK2
      *        |- c1    : DTL.U:Process Inv/Crd is No                   MSGACTK2
      *        |- c2    : DTL.U:Process Posting to A/Cs is No           MSGACTK2
      *        |- c3    : DTL.U:Process Extract & Email is No           MSGACTK2
      *        '-                                                       MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (ZDUPRCINV OF ZRCDDTL1-WS-O = 'N' AND                 CBLIFXK1
                   ZDUPRCPOST OF ZRCDDTL1-WS-O = 'N' AND                CBLIFXK1
                   ZDUPRCEXT OF ZRCDDTL1-WS-O = 'N') THEN               CBLIFXK1
      *            Send message 'Option choice is Required'             SNDMSGK1
      *            Message ID                                           SNDMSGK1
                   MOVE 'USR0346' TO ZAMSID                             SNDMSGK1
                   PERFORM ZASNMS                                       SNDMSGK1
                   SET C-INDICATOR-ON(99) TO TRUE                       SNDMSGK2
      *                                                                 SNDMSGK2
               END-IF                                                   MSGACTK2
      *        CASE: DTL.FB Month of Parts Data is Zeros                MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (Z1DIDM OF ZRCDDTL1-WS-O = ZEROS) THEN                CBLIFXK1
      *            Setup message data for message                       SNDMSGK2
      *            Convert FB Month of Parts Data to external.          MSGACTK2
      *                                                                 MSGACTK2
               MOVE Z1DIDM OF ZRCDDTL1-WS-O                             CBLUFNK1
                 TO U-DTM-CYM         OF U-UFDCNVDTMS                   CBLUFNK1
               MOVE CORR U-DTM-CYM-X  OF U-UFDCNVDTMS                   CBLUFNK1
                 TO U-DTM-MCY-X       OF U-UFDCNVDTMS                   CBLUFNK1
               MOVE U-DTM-MCY         OF U-UFDCNVDTMS                   CBLUFNK1
                 TO ZA0020                                              CBLUFNK1
      *.End.of.user.source.for.DTM.field.processing.................... CBLUFNK1
      *            Send message 'Value required (*Numeric)'             SNDMSGK1
      *            Message ID                                           SNDMSGK1
                   MOVE 'USR1374' TO ZAMSID                             SNDMSGK1
                   PERFORM ZASNMS                                       SNDMSGK1
                   SET C-INDICATOR-ON(99) TO TRUE                       SNDMSGK2
                   SET C-INDICATOR-ON(31) TO TRUE                       SNDMSGK2
      *                                                                 SNDMSGK2
               ELSE                                                     MSGACTK2
      *            CASE: *OTHERWISE                                     MSGACTK2
      *            Rtv FB Run Status - FB Run Control  *                CBLRTVK2
                   PERFORM SB4RVGN                                      CBLRTVK2
      *            CASE: DTL.U:Process Inv/Crd is Yes                   MSGACTK2
      *            *IF                                                  CBLIFXK1
                   IF (ZDUPRCINV OF ZRCDDTL1-WS-O = 'Y') THEN           CBLIFXK1
      *                Check status is validated                        MSGACTK2
      *                CASE: DTL.FB Run Status is Validated             MSGACTK2
      *                *IF                                              CBLIFXK1
                       IF (ZDRUNSTAT OF ZRCDDTL1-WS-O = 'F' OR          CBLIFXK1
                           ZDRUNSTAT OF ZRCDDTL1-WS-O = 'A') THEN       CBLIFXK1
      *                    OK ready for invoicing                       MSGACTK2
                           CONTINUE                                     MSGACTK2
                       ELSE                                             MSGACTK2
      *                    CASE: *OTHERWISE                             MSGACTK2
      *                    Send message 'Status not valid for act.'     SNDMSGK1
      *                    Message ID                                   SNDMSGK1
                           MOVE 'USR6032' TO ZAMSID                     SNDMSGK1
                           PERFORM ZASNMS                               SNDMSGK1
                           SET C-INDICATOR-ON(99) TO TRUE               SNDMSGK2
      *                                                                 SNDMSGK2
                       END-IF                                           MSGACTK2
                   ELSE                                                 MSGACTK2
      *                CASE: DTL.U:Process Posting to A/Cs is Yes       MSGACTK2
      *                *IF                                              CBLIFXK1
                       IF (ZDUPRCPOST OF ZRCDDTL1-WS-O = 'Y') THEN      CBLIFXK1
      *                    Check status is dealer credits complete      MSGACTK2
      *                    CASE: DTL.FB Run Status is Dealer Credit     MSGACTK2
      *                      Complete                                   MSGACTK2
      *                    *IF                                          CBLIFXK1
                           IF (ZDRUNSTAT OF ZRCDDTL1-WS-O = '9') THEN   CBLIFXK1
      *                        OK ready for posting                     MSGACTK2
                               CONTINUE                                 MSGACTK2
                           ELSE                                         MSGACTK2
      *                        CASE: *OTHERWISE                         MSGACTK2
      *                        Send message 'Status not valid for act.' SNDMSGK1
      *                        Message ID                               SNDMSGK1
                               MOVE 'USR6032' TO ZAMSID                 SNDMSGK1
                               PERFORM ZASNMS                           SNDMSGK1
                               SET C-INDICATOR-ON(99) TO TRUE           SNDMSGK2
      *                                                                 SNDMSGK2
                           END-IF                                       MSGACTK2
                       ELSE                                             MSGACTK2
      *                    CASE: DTL.U:Process Extract & Email is Yes   MSGACTK2
      *                    *IF                                          CBLIFXK1
                           IF (ZDUPRCEXT OF ZRCDDTL1-WS-O = 'Y') THEN   CBLIFXK1
      *                        Check status is sent to accounting systemMSGACTK2
      *                        CASE: DTL.FB Run Status is Sent to       MSGACTK2
      *                          Accounting System                      MSGACTK2
      *                        *IF                                      CBLIFXK1
                               IF (ZDRUNSTAT OF ZRCDDTL1-WS-O = 'Y')    CBLIFXK1
                                 THEN                                   CBLIFXK1
      *                        OK ready for extract                     MSGACTK2
                               CONTINUE                                 MSGACTK2
                               ELSE                                     MSGACTK2
      *                        CASE: *OTHERWISE                         MSGACTK2
      *                        Send message 'Status not valid for act.' SNDMSGK1
      *                        Message ID                               SNDMSGK1
                               MOVE 'USR6032' TO ZAMSID                 SNDMSGK1
                               PERFORM ZASNMS                           SNDMSGK1
                               SET C-INDICATOR-ON(99) TO TRUE           SNDMSGK2
      *                                                                 SNDMSGK2
                               END-IF                                   MSGACTK2
                           END-IF                                       MSGACTK2
                       END-IF                                           MSGACTK2
                   END-IF                                               MSGACTK2
               END-IF                                                   MSGACTK2
      *        DTL.U:Condition name = Condition name of DTL.FB Run      CBLCNMK1
      *          Status                                                 CBLCNMK1
               MOVE 1642396 TO Y2LSTN                                   CBLCNMK1
               MOVE ZDRUNSTAT OF ZRCDDTL1-WS-O TO W0INVL                CBLCNMK1
               MOVE ' ' TO W0VLMP                                       CBLCNMK1
               CALL 'RARVC2R' USING                                     CBLCNMK1
      *        Return code                                              CBLCNMK1
                 W0RTN                                                  CBLCNMK1
      *        List number                                              CBLCNMK1
                 Y2LSTN                                                 CBLCNMK1
      *        FB Run Status                                            CBLCNMK1
                 W0INVL                                                 CBLCNMK1
      *        Value mapped                                             CBLCNMK1
                 W0VLMP                                                 CBLCNMK1
      *        U:Condition name                                         CBLCNMK1
                 W0CNNM                                                 CBLCNMK1
               END-CALL                                                 CBLCNMK1
               MOVE W0CNNM TO ZDGPTX OF ZRCDDTL1-WS-O                   CBLCNMK1
      *                                                                 CBLCNMK1
      *        Error on program call will terminate run unit            CBLCNMK1
      *                                                                 CBLCNMK1
           END-IF                                                       PMTVALK1
      *    Bypass ref file checks if error already detected             PMTVALK1
           IF (C-INDICATOR-ON(99)) THEN                                 PMTVALK1
             GO DBEXIT                                                  PMTVALK1
           END-IF                                                       PMTVALK1
      *                                                                 CHKRELK2
      *    CHECK REFERENCE TO FB Run Control.                           CHKRELK2
           PERFORM VA1CKRL                                              CHKRELK2
           IF (W0RTN NOT = SPACES AND                                   CHKRELK2
               YPMTFD = SPACES) THEN                                    CHKRELK2
               SET C-INDICATOR-ON(99) TO TRUE                           CHKRELK2
               SET C-INDICATOR-ON(31) TO TRUE                           CHKRELK2
           END-IF                                                       CHKRELK2
      *                                                                 CHKRELK2
           IF (YPMTFD = SPACES) THEN                                    PMTVALK1
      *        USER: Validate relations                                 MSGACTK2
      *        U:Display (Y/N)                                          CBLMOVK1
               MOVE 'N' TO YL0003 OF WORK-CONTEXT                       CBLMOVK1
      *        Chk actions ready to prc - FB Action  *                  CBLRTVK2
               PERFORM SB5RVGN                                          CBLRTVK2
      *        CASE: PGM.*Return code is *Normal                        MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (W0RTN = SPACES) THEN                                 CBLIFXK1
      *            Send message 'FB Action              EX'             SNDMSGK1
      *            Message ID                                           SNDMSGK1
                   MOVE 'USR6517' TO ZAMSID                             SNDMSGK1
                   PERFORM ZASNMS                                       SNDMSGK1
                   SET C-INDICATOR-ON(99) TO TRUE                       SNDMSGK2
      *                                                                 SNDMSGK2
      *            U:Display (Y/N)                                      CBLMOVK1
                   MOVE 'Y' TO YL0003 OF WORK-CONTEXT                   CBLMOVK1
               END-IF                                                   MSGACTK2
           END-IF                                                       PMTVALK1
      *    FB Month of Parts Data required                              PMTVALK1
           IF (Z1DIDM OF ZRCDDTL1-WS-O = ZERO AND                       PMTVALK1
               YPMTFD = SPACES) THEN                                    PMTVALK1
               SET C-INDICATOR-ON(99) TO TRUE                           PMTVALK1
               SET C-INDICATOR-ON(31) TO TRUE                           PMTVALK1
      *        Send message '*Value required'                           SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'Y2U0001' TO ZAMSID                                 SNDMSGK1
      *        Message file                                             SNDMSGK1
               MOVE 'Y2USRMSG' TO ZAMSGF                                SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
           END-IF                                                       PMTVALK1
      *    U:Process Inv/Crd required                                   PMTVALK1
           IF (ZDUPRCINV OF ZRCDDTL1-WS-O = SPACES AND                  PMTVALK1
               YPMTFD = SPACES) THEN                                    PMTVALK1
               SET C-INDICATOR-ON(99) TO TRUE                           PMTVALK1
               SET C-INDICATOR-ON(32) TO TRUE                           PMTVALK1
      *        Send message '*Value required'                           SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'Y2U0001' TO ZAMSID                                 SNDMSGK1
      *        Message file                                             SNDMSGK1
               MOVE 'Y2USRMSG' TO ZAMSGF                                SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
           END-IF                                                       PMTVALK1
      *    U:Process Posting to A/Cs required                           PMTVALK1
           IF (ZDUPRCPOST OF ZRCDDTL1-WS-O = SPACES AND                 PMTVALK1
               YPMTFD = SPACES) THEN                                    PMTVALK1
               SET C-INDICATOR-ON(99) TO TRUE                           PMTVALK1
               SET C-INDICATOR-ON(33) TO TRUE                           PMTVALK1
      *        Send message '*Value required'                           SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'Y2U0001' TO ZAMSID                                 SNDMSGK1
      *        Message file                                             SNDMSGK1
               MOVE 'Y2USRMSG' TO ZAMSGF                                SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
           END-IF                                                       PMTVALK1
      *    U:Process Extract & Email required                           PMTVALK1
           IF (ZDUPRCEXT OF ZRCDDTL1-WS-O = SPACES AND                  PMTVALK1
               YPMTFD = SPACES) THEN                                    PMTVALK1
               SET C-INDICATOR-ON(99) TO TRUE                           PMTVALK1
               SET C-INDICATOR-ON(34) TO TRUE                           PMTVALK1
      *        Send message '*Value required'                           SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'Y2U0001' TO ZAMSID                                 SNDMSGK1
      *        Message file                                             SNDMSGK1
               MOVE 'Y2USRMSG' TO ZAMSGF                                SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
           END-IF                                                       PMTVALK1
      *==============================================================   PMTVALK1
           CONTINUE.                                                    PMTVALK1
       DBEXIT.                                                          PMTVALK1
           EXIT.                                                        PMTVALK1
      /EJECT                                                            PMTVALK1
       DHPMCF SECTION.                                                  PMTVALK1
      *==============================================================   PMTVALK1
      *    Prompt for confirmation                                      PMTVALK1
      *==============================================================   PMTVALK1
      *    Convert fields to external form                              PMTVALK1
           PERFORM MNCVZ1                                               PMTVALK1
      *    Set screen conditioning indicators                           PMTVALK1
           PERFORM GADSA1                                               PMTVALK1
      *    Enable PUTOVR                                                PMTVALK1
           SET C-INDICATOR-ON(86) TO TRUE                               PMTVALK1
      *    Refresh screen                                               PMTVALK1
           MOVE 'N' TO ZZCFCD OF AABCCCCCDD-WS-O                        CNFPMTK2
      *    Save CMD keys                                                CNFPMTK2
           MOVE INDICS TO WN30-A                                        CNFPMTK2
      *    Convert *CONFIRM to external value                           CVTSTSK1
      *    List number                                                  CVTSTSK1
           MOVE 1001713 TO Y2LSNO OF KINEX                              CVTSTSK1
      *    Internal value                                               CVTSTSK1
           MOVE SPACES TO Y2INVL OF KINEX                               CVTSTSK1
      *    *CONFIRM                                                     CVTSTSK1
           MOVE ZZCFCD OF AABCCCCCDD-WS-O TO Y2INVL OF KINEX            CVTSTSK1
           MOVE CORRESPONDING                                           CVTSTSK1
             KINEX TO                                                   CVTSTSK1
             YY2INEX OF RAVLLSL9-R                                      CVTSTSK1
           MOVE 'Y' TO Y2VLMP OF YY2INEX                                CVTSTSK1
           READ RAVLLSL9                                                CVTSTSK1
             FORMAT IS 'YY2INEX'                                        CVTSTSK1
           END-READ                                                     CVTSTSK1
           IF (C-NO-RECORD) THEN                                        CVTSTSK1
               SET C-INDICATOR-ON(90) TO TRUE                           CVTSTSK1
           ELSE                                                         CVTSTSK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CVTSTSK1
           END-IF                                                       CVTSTSK1
      *                                                                 CVTSTSK1
           IF (C-INDICATOR-OFF(90)) THEN                                CVTSTSK1
      *        *CONFIRM                                                 CVTSTSK1
               MOVE Y2EXVL OF YY2INEX OF RAVLLSL9 TO VZCFCD OF          CVTSTSK1
                 AABCCCCCDD-WS-O                                        CVTSTSK1
           END-IF                                                       CVTSTSK1
      *                                                                 CVTSTSK1
           SET C-UNTIL-FALSE TO TRUE                                    CNFPMTK2
           PERFORM UNTIL (C-UNTIL-TRUE)                                 CNFPMTK2
               SET C-INDICATOR-OFF(29) TO TRUE                          CNFPMTK2
               WRITE AABCCCCCDD-F FROM ZMSGCTL-WS-O                     CBLEXFK1
                 FORMAT IS 'ZMSGCTL' INDICATORS ARE INDICS              CBLEXFK1
               END-WRITE                                                CBLEXFK1
               WRITE AABCCCCCDD-F FROM ZCMDTXT1-WS-O                    CBLEXFK1
                 FORMAT IS 'ZCMDTXT1' INDICATORS ARE INDICS             CBLEXFK1
               END-WRITE                                                CBLEXFK1
               WRITE AABCCCCCDD-F FROM ZRCDDTL1-WS-O                    CBLEXFK1
                 FORMAT IS 'ZRCDDTL1' INDICATORS ARE INDICS             CBLEXFK1
               END-WRITE                                                CBLEXFK1
               WRITE AABCCCCCDD-F FROM ZCONFIRM-WS-O                    CBLEXFK1
                 FORMAT IS 'ZCONFIRM' INDICATORS ARE INDICS             CBLEXFK1
               END-WRITE                                                CBLEXFK1
               READ AABCCCCCDD                                          CBLEXFK1
                 FORMAT IS 'ZCONFIRM' INDICATORS ARE INDICS             CBLEXFK1
               END-READ                                                 CBLEXFK1
               MOVE AABCCCCCDD-F TO                                     CBLEXFK1
                 ZCONFIRM-WS-I                                          CBLEXFK1
               MOVE CORRESPONDING                                       CBLEXFK1
                 ZCONFIRM-I OF ZCONFIRM-WS-I TO                         CBLEXFK1
                 ZCONFIRM-O OF ZCONFIRM-WS-O                            CBLEXFK1
      *        Reset help request                                       DSPHLPK1
      *        Clear set cursor DDS indicator                           DSPHLPK1
               IF (WCSRLC = 'OFF') THEN                                 DSPHLPK1
                   SET C-INDICATOR-OFF(94) TO TRUE                      DSPHLPK1
               END-IF                                                   DSPHLPK1
               MOVE SPACES TO WCSRLC                                    DSPHLPK1
      *        If help requested, display help text                     DSPHLPK1
               IF (C-INDICATOR-ON(25)) THEN                             DSPHLPK1
                   PERFORM ZHHPKY                                       DSPHLPK1
               END-IF                                                   DSPHLPK1
      *        Validate *CONFIRM                                        CHKSTSK1
               MOVE SPACES TO W0RTN                                     CHKSTSK1
      *        Name search required?                                    CHKSTSK1
      *        *CONFIRM                                                 CHKSTSK1
               MOVE VZCFCD OF AABCCCCCDD-WS-O TO W0NSRQ                 CHKSTSK1
      *        Search required                                          CHKSTSK1
               IF (W0NSRQ = '?' OR                                      CHKSTSK1
                   'VZCFCD OF ' = YPMTFD) THEN                          CHKSTSK1
                   MOVE VZCFCD OF AABCCCCCDD-WS-O TO W0EXVL             CHKSTSK1
                   MOVE 1001713 TO Y2LSNO OF KEXIN                      CHKSTSK1
                   SET C-INDICATOR-OFF(90) TO TRUE                      CHKSTSK1
                   CALL 'RAVLLSR' USING                                 CHKSTSK1
      *            Return code                                          CHKSTSK1
                     W0RTN                                              CHKSTSK1
      *            List number                                          CHKSTSK1
                     Y2LSNO OF KEXIN                                    CHKSTSK1
      *            *CONFIRM                                             CHKSTSK1
                     W0EXVL                                             CHKSTSK1
                        ON OVERFLOW                                     CHKSTSK1
                           SET C-INDICATOR-ON(90) TO TRUE               CHKSTSK1
                   END-CALL                                             CHKSTSK1
      *                                                                 CHKSTSK1
                   IF (C-INDICATOR-ON(90)) THEN                         CHKSTSK1
                       MOVE 'Y2U0021' TO W0RTN                          CHKSTSK1
                   END-IF                                               CHKSTSK1
      *            Error on program call will terminate run unit        CHKSTSK1
                   MOVE W0EXVL TO VZCFCD OF AABCCCCCDD-WS-O             CHKSTSK1
      *            Defer confirm                                        CHKSTSK1
                   MOVE 'Y' TO W0DCF                                    CHKSTSK1
                   IF (W0NSRQ NOT = '?') THEN                           CHKSTSK1
                       MOVE '*DONE' TO YPMTFD                           CHKSTSK1
                   END-IF                                               CHKSTSK1
               END-IF                                                   CHKSTSK1
      *        Check external value of *CONFIRM                         CHKSTSK1
      *        Convert *CONFIRM to internal value                       CHKSTSK1
      *        List number                                              CHKSTSK1
               MOVE 1001713 TO Y2LSNO OF KEXIN                          CHKSTSK1
      *        External value                                           CHKSTSK1
               MOVE SPACES TO Y2EXVL OF KEXIN                           CHKSTSK1
      *        *CONFIRM                                                 CHKSTSK1
               MOVE VZCFCD OF AABCCCCCDD-WS-O TO Y2EXVL OF KEXIN        CHKSTSK1
               MOVE CORRESPONDING                                       CHKSTSK1
                 KEXIN TO                                               CHKSTSK1
                 YY2EXIN OF RAVLLSL9-R                                  CHKSTSK1
               READ RAVLLSL9                                            CHKSTSK1
                 FORMAT IS 'YY2EXIN'                                    CHKSTSK1
               END-READ                                                 CHKSTSK1
               MOVE CORRESPONDING                                       CHKSTSK1
                 YY2EXIN OF RAVLLSL9-R TO                               CHKSTSK1
                 KINEX                                                  CHKSTSK1
               IF (C-NO-RECORD) THEN                                    CHKSTSK1
                   SET C-INDICATOR-ON(90) TO TRUE                       CHKSTSK1
               ELSE                                                     CHKSTSK1
                   SET C-INDICATOR-OFF(90) TO TRUE                      CHKSTSK1
               END-IF                                                   CHKSTSK1
      *                                                                 CHKSTSK1
      *                                                                 CHKSTSK1
               IF (C-INDICATOR-ON(90)) THEN                             CHKSTSK1
      *            Not found                                            CHKSTSK1
                   MOVE SPACES TO ZZCFCD OF AABCCCCCDD-WS-O             CHKSTSK1
                   IF (YPMTFD = SPACES) THEN                            CHKSTSK1
                       SET C-INDICATOR-ON(96) TO TRUE                   CHKSTSK1
                       WRITE AABCCCCCDD-F FROM ZCONFIRM-WS-O            CHKSTSK1
                         FORMAT IS 'ZCONFIRM' INDICATORS ARE INDICS     CHKSTSK1
                       END-WRITE                                        CHKSTSK1
                       SET C-INDICATOR-OFF(96) TO TRUE                  CHKSTSK1
                   END-IF                                               CHKSTSK1
               ELSE                                                     CHKSTSK1
      *            *CONFIRM                                             CHKSTSK1
                   MOVE Y2INVL OF KINEX TO ZZCFCD OF AABCCCCCDD-WS-O    CHKSTSK1
               END-IF                                                   CHKSTSK1
      *                                                                 CHKSTSK1
           IF (W0HLP = 'N' AND                                          CNFPMTK2
               C-INDICATOR-OFF(90) AND                                  CNFPMTK2
               C-INDICATOR-OFF(29))                                     CNFPMTK2
             SET C-UNTIL-TRUE TO TRUE                                   CNFPMTK2
           END-IF                                                       CNFPMTK2
           END-PERFORM                                                  CNFPMTK2
      *    Restore CMD keys                                             CNFPMTK2
           MOVE 1 TO IND-COUNT                                          CNFPMTK2
           SET C-UNTIL-FALSE TO TRUE                                    CNFPMTK2
           PERFORM UNTIL (C-UNTIL-TRUE)                                 CNFPMTK2
               MOVE WN30(IND-COUNT) TO IND(IND-COUNT)                   CNFPMTK2
               ADD 1 TO IND-COUNT                                       CNFPMTK2
           IF (IND-COUNT > 30)                                          CNFPMTK2
             SET C-UNTIL-TRUE TO TRUE                                   CNFPMTK2
           END-IF                                                       CNFPMTK2
           END-PERFORM                                                  CNFPMTK2
      *    Update job time                                              CNFPMTK2
           ACCEPT ZZTIME FROM TIME                                      CNFPMTK2
           MOVE ZZHNS TO ZZJTM OF JOB-CONTEXT                           CNFPMTK2
           IF (ZZCFCD OF AABCCCCCDD-WS-O NOT = 'Y') THEN                CNFPMTK2
                 SET C-INDICATOR-ON(99) TO TRUE                         CNFPMTK2
           ELSE                                                         CNFPMTK2
      *        Clear messages from program message queue                CNFPMTK2
               MOVE ZZPGM OF JOB-CONTEXT TO ZAPGMQ                      CNFPMTK2
               MOVE '*SAME' TO ZAPGRL                                   CNFPMTK2
               CALL 'Y2CLMSC' USING                                     CNFPMTK2
                 ZAPGMQ                                                 CNFPMTK2
                 ZAPGRL                                                 CNFPMTK2
               END-CALL                                                 CNFPMTK2
      *        Reset first message only flag                            CNFPMTK2
               MOVE 'Y' TO ZAFSMS                                       CNFPMTK2
                 SET C-INDICATOR-OFF(99) TO TRUE                        CNFPMTK2
           END-IF                                                       CNFPMTK2
      *==============================================================   PMTVALK1
           CONTINUE.                                                    PMTVALK1
       DHEXIT.                                                          PMTVALK1
           EXIT.                                                        PMTVALK1
      /EJECT                                                            PMTVALK1
       GADSA1 SECTION.                                                  PMTVALK1
      *==============================================================   PMTVALK1
      *    Set display attributes for screen                            PMTVALK1
      *==============================================================   PMTVALK1
           SET C-INDICATOR-OFF(79) TO TRUE                              SCRCNDK1
      *    *IF                                                          CBLIFXK1
           IF (YL0003 OF WORK-CONTEXT = 'N') THEN                       CBLIFXK1
               SET C-INDICATOR-ON(79) TO TRUE                           SCRCNDK1
           END-IF                                                       SCRCNDK1
      *==============================================================   PMTVALK1
           CONTINUE.                                                    PMTVALK1
       GAEXIT.                                                          PMTVALK1
           EXIT.                                                        PMTVALK1
      /EJECT                                                            PMTVALK1
       MALDSC SECTION.                                                  PMTVALK1
      *==============================================================   PMTVALK1
      *    Load screen from passed parameters                           PMTVALK1
      *==============================================================   PMTVALK1
           MOVE ZERO TO Z1ACTDTE OF ZRCDDTL1-WS-O                       PMTVALK1
           MOVE ZERO TO Z1ACTTIME OF ZRCDDTL1-WS-O                      PMTVALK1
           MOVE P1FLOPNO TO Z1FLOPNO OF ZRCDDTL1-WS-O                   PMTVALK1
           MOVE SPACES TO ZDCMPNYNM OF ZRCDDTL1-WS-O                    PMTVALK1
           MOVE ZERO TO Z1DIDM OF ZRCDDTL1-WS-O                         PMTVALK1
      *    Clear external version also                                  PMTVALK1
           MOVE ZEROS TO V1DIDM OF ZRCDDTL1-WS-O                        PMTVALK1
           MOVE SPACES TO ZDRUNSTAT OF ZRCDDTL1-WS-O                    PMTVALK1
           MOVE SPACES TO ZDGPTX OF ZRCDDTL1-WS-O                       PMTVALK1
           MOVE SPACES TO ZDUPRCINV OF ZRCDDTL1-WS-O                    PMTVALK1
           MOVE SPACES TO ZDUPGM1 OF ZRCDDTL1-WS-O                      PMTVALK1
           MOVE SPACES TO ZDUPGM2 OF ZRCDDTL1-WS-O                      PMTVALK1
           MOVE SPACES TO ZDUPRCPOST OF ZRCDDTL1-WS-O                   PMTVALK1
           MOVE SPACES TO ZDUPGM3 OF ZRCDDTL1-WS-O                      PMTVALK1
           MOVE SPACES TO ZDUPGM4 OF ZRCDDTL1-WS-O                      PMTVALK1
           MOVE SPACES TO ZDUPRCEXT OF ZRCDDTL1-WS-O                    PMTVALK1
           MOVE SPACES TO ZDUPGM5 OF ZRCDDTL1-WS-O                      PMTVALK1
      *    USER: Load screen                                            MSGACTK2
      *    Fleet Operator Number                                        CBLMOVK1
           MOVE P1FLOPNO TO Z1FLOPNO OF ZRCDDTL1-WS-O                   CBLMOVK1
      *    Rtv Fleet Operator A/C - FB Fleet Operator Account  *        CBLRTVK2
           PERFORM SB6RVGN                                              CBLRTVK2
      *    DTL.FB Action Date = JOB.*Job date                           CVTDTMK1
           IF (ZZJDT OF JOB-CONTEXT = ZERO) THEN                        CVTDTMK1
               MOVE ZEROS TO Z1ACTDTE OF ZRCDDTL1-WS-O                  CVTDTMK1
           ELSE                                                         CVTDTMK1
               ADD 19000000 TO ZZJDT OF JOB-CONTEXT GIVING Z1ACTDTE OF  CVTDTMK1
                 ZRCDDTL1-WS-O                                          CVTDTMK1
           END-IF                                                       CVTDTMK1
      *    FB Action Time                                               CBLMOVK1
           MOVE ZZJTM OF JOB-CONTEXT TO Z1ACTTIME OF ZRCDDTL1-WS-O      CBLMOVK1
      *    Rtv current month - FB Run Control  *                        CBLRTVK2
           PERFORM SB7RVGN                                              CBLRTVK2
      *    Set up flags and programs to run                             MSGACTK2
           PERFORM UA1SUBR                                              MSGACTK2
      *    DTL.U:Condition name = Condition name of DTL.FB Run Status   CBLCNMK1
           MOVE 1642396 TO Y2LSTN                                       CBLCNMK1
           MOVE ZDRUNSTAT OF ZRCDDTL1-WS-O TO W0INVL                    CBLCNMK1
           MOVE ' ' TO W0VLMP                                           CBLCNMK1
           CALL 'RARVC2R' USING                                         CBLCNMK1
      *    Return code                                                  CBLCNMK1
             W0RTN                                                      CBLCNMK1
      *    List number                                                  CBLCNMK1
             Y2LSTN                                                     CBLCNMK1
      *    FB Run Status                                                CBLCNMK1
             W0INVL                                                     CBLCNMK1
      *    Value mapped                                                 CBLCNMK1
             W0VLMP                                                     CBLCNMK1
      *    U:Condition name                                             CBLCNMK1
             W0CNNM                                                     CBLCNMK1
           END-CALL                                                     CBLCNMK1
           MOVE W0CNNM TO ZDGPTX OF ZRCDDTL1-WS-O                       CBLCNMK1
      *                                                                 CBLCNMK1
      *    Error on program call will terminate run unit                CBLCNMK1
      *                                                                 CBLCNMK1
      *    U:Display (Y/N)                                              CBLMOVK1
           MOVE 'N' TO YL0003 OF WORK-CONTEXT                           CBLMOVK1
      *==============================================================   PMTVALK1
           CONTINUE.                                                    PMTVALK1
       MAEXIT.                                                          PMTVALK1
           EXIT.                                                        PMTVALK1
      /EJECT                                                            PMTVALK1
       MNCVZ1 SECTION.                                                  PMTVALK1
      *==============================================================   PMTVALK1
      *    Convert fields into external form                            PMTVALK1
      *==============================================================   PMTVALK1
      *    Convert FB Month of Parts Data to external.                  MSGACTK2
      *                                                                 MSGACTK2
               MOVE Z1DIDM OF ZRCDDTL1-WS-O                             CBLUFNK1
                 TO U-DTM-CYM         OF U-UFDCNVDTMS                   CBLUFNK1
               MOVE CORR U-DTM-CYM-X  OF U-UFDCNVDTMS                   CBLUFNK1
                 TO U-DTM-MCY-X       OF U-UFDCNVDTMS                   CBLUFNK1
               MOVE U-DTM-MCY         OF U-UFDCNVDTMS                   CBLUFNK1
                 TO V1DIDM OF ZRCDDTL1-WS-O                             CBLUFNK1
      *.End.of.user.source.for.DTM.field.processing.................... CBLUFNK1
      *==============================================================   PMTVALK1
           CONTINUE.                                                    PMTVALK1
       MNEXIT.                                                          PMTVALK1
           EXIT.                                                        PMTVALK1
      /EJECT                                                            CBLCRTK1
       SA1CRRC SECTION.                                                 CBLCRTK1
      *==============================================================   CBLCRTK1
      *    Create FB Action - FB Action  *                              CBLCRTK1
      *==============================================================   CBLCRTK1
      *    Initialize return code                                       CBLCRTK1
           MOVE SPACES TO W0RTN                                         CBLCRTK1
      *                                                                 CBLCRTK1
      *    Move all fields to FACTIDP                                   CBLCRTK1
      *    Fleet Operator Number                                        CBLCRTK1
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FBFLOPNO OF FBACTIONL0-R   CBLCRTK1
      *    FB Month of Parts Data                                       CBLCRTK1
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FBDIDM OF FBACTIONL0-R       CBLCRTK1
      *    FB Action Date                                               CBLCRTK1
           MOVE Z1ACTDTE OF ZRCDDTL1-WS-O TO FBACTDTE OF FBACTIONL0-R   CBLCRTK1
      *    FB Action Time                                               CBLCRTK1
           MOVE Z1ACTTIME OF ZRCDDTL1-WS-O TO FBACTTIME OF FBACTIONL0-R CBLCRTK1
      *    Program Name                                                 CBLCRTK1
           MOVE ZDUPGM1 OF ZRCDDTL1-WS-O TO FBPGMNAM OF FBACTIONL0-R    CBLCRTK1
      *    FB Action Status                                             CBLCRTK1
           MOVE 'R' TO FBFBSTS OF FBACTIONL0-R                          CBLCRTK1
      *    Job Start TS#                                                CBLCRTK1
           MOVE '0001-01-01-00.00.00.00000' TO FBJOBSTR OF FBACTIONL0-R CBLCRTK1
      *    Job End TS#                                                  CBLCRTK1
           MOVE '0001-01-01-00.00.00.00000' TO FBJOBEND OF FBACTIONL0-R CBLCRTK1
      *    FB Frequency                                                 CBLCRTK1
           MOVE 'M' TO FBFREQ OF FBACTIONL0-R                           CBLCRTK1
      *    FB Days to Delay                                             CBLCRTK1
           MOVE ZEROS TO FBDELAY OF FBACTIONL0-R                        CBLCRTK1
      *    FB Delay incl Non-WrkDays                                    CBLCRTK1
           MOVE 'N' TO FBNONWRK OF FBACTIONL0-R                         CBLCRTK1
      *    Next Program Name                                            CBLCRTK1
           MOVE SPACES TO FBW8CE OF FBACTIONL0-R                        CBLCRTK1
      *    Create Date D8#                                              CBLCRTK1
           MOVE ZEROS TO FBCRTDTD8 OF FBACTIONL0-R                      CBLCRTK1
      *    Create Time                                                  CBLCRTK1
           MOVE ZEROS TO FBCRTTME OF FBACTIONL0-R                       CBLCRTK1
      *    Create User                                                  CBLCRTK1
           MOVE SPACES TO FBCRTUSER OF FBACTIONL0-R                     CBLCRTK1
      *    Create Program                                               CBLCRTK1
           MOVE SPACES TO FBCRTPGM OF FBACTIONL0-R                      CBLCRTK1
      *    Create Job                                                   CBLCRTK1
           MOVE SPACES TO FBCRTJOB OF FBACTIONL0-R                      CBLCRTK1
      *    Date Last Changed D8#                                        CBLCRTK1
           MOVE ZEROS TO FBCHGDT8 OF FBACTIONL0-R                       CBLCRTK1
      *    Time Last Changed                                            CBLCRTK1
           MOVE ZEROS TO FBCHGTME OF FBACTIONL0-R                       CBLCRTK1
      *    User Last Changed                                            CBLCRTK1
           MOVE SPACES TO FBUSERCHGD OF FBACTIONL0-R                    CBLCRTK1
      *    Program Last Changed                                         CBLCRTK1
           MOVE SPACES TO FBPGMCHG OF FBACTIONL0-R                      CBLCRTK1
      *    Job Last Changed                                             CBLCRTK1
           MOVE SPACES TO FBJOBCHG OF FBACTIONL0-R                      CBLCRTK1
      *    USER: Processing before Data update                          MSGACTK2
      *    Rtn Update Audit for Crt                                     MSGACTK2
      *    Function details                                             MSGACTK2
      *    CASE: *OTHERWISE                                             MSGACTK2
      *    -------------------------------------------------------------MSGACTK2
      *    Maintenance:-                                                MSGACTK2
      *    07/04/2010  RN-INC-479183         Maurice Mead               MSGACTK2
      *    D8# date now loaded directly from the job date field.        MSGACTK2
      *    -------------------------------------------------------------MSGACTK2
      *    LCL.U:Job date D8# = JOB.*Job date                           CVTDTMK1
           IF (ZZJDT OF JOB-CONTEXT = ZERO) THEN                        CVTDTMK1
               MOVE ZEROS TO YL0001 OF WORK-CONTEXT                     CVTDTMK1
           ELSE                                                         CVTDTMK1
               ADD 19000000 TO ZZJDT OF JOB-CONTEXT GIVING YL0001 OF    CVTDTMK1
                 WORK-CONTEXT                                           CVTDTMK1
           END-IF                                                       CVTDTMK1
      *    Create Time                                                  CBLMOVK1
           MOVE ZZJTM OF JOB-CONTEXT TO FBCRTTME OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create User                                                  CBLMOVK1
           MOVE ZZUSR OF JOB-CONTEXT TO FBCRTUSER OF FACTIDP OF         CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Date D8#                                              CBLMOVK1
           MOVE YL0001 OF WORK-CONTEXT TO FBCRTDTD8 OF FACTIDP OF       CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Program                                               CBLMOVK1
           MOVE ZZPGM OF JOB-CONTEXT TO FBCRTPGM OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Job                                                   CBLMOVK1
           MOVE ZZJOB OF JOB-CONTEXT TO FBCRTJOB OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Date Last Changed D8#                                        CBLMOVK1
           MOVE YL0001 OF WORK-CONTEXT TO FBCHGDT8 OF FACTIDP OF        CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Time Last Changed                                            CBLMOVK1
           MOVE ZZJTM OF JOB-CONTEXT TO FBCHGTME OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    User Last Changed                                            CBLMOVK1
           MOVE ZZUSR OF JOB-CONTEXT TO FBUSERCHGD OF FACTIDP OF        CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Program Last Changed                                         CBLMOVK1
           MOVE ZZPGM OF JOB-CONTEXT TO FBPGMCHG OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Job Last Changed                                             CBLMOVK1
           MOVE ZZJOB OF JOB-CONTEXT TO FBJOBCHG OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    WRK.U:Date = JOB.*System time stamp                          CVTDTMK1
           PERFORM XSTMS                                                CVTDTMK1
           MOVE ZZTMS OF JOB-CONTEXT TO XDITSM                          CVTDTMK1
           MOVE XDITSD TO XDI2DT                                        CVTDTMK1
           PERFORM XCVTE                                                CVTDTMK1
           IF (XDINDT = ZERO) THEN                                      CVTDTMK1
               MOVE ZEROS TO WUDATE OF WORK-CONTEXT                     CVTDTMK1
           ELSE                                                         CVTDTMK1
               SUBTRACT 1000000 FROM XDINDT GIVING WUDATE OF            CVTDTMK1
                 WORK-CONTEXT                                           CVTDTMK1
           END-IF                                                       CVTDTMK1
      *    Cvt DTE to DTX Format                                        MSGACTK2
      *    CASE: PAR.U:Date is < 01/01/40                               MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (WUDATE OF WORK-CONTEXT < 400101) THEN                    CBLIFXK1
      *        CASE: PAR.U:Date is *Zero                                MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (WUDATE OF WORK-CONTEXT = ZEROS) THEN                 CBLIFXK1
      *            U:Date YYYYMMDD                                      CBLMOVK1
                   MOVE ZEROS TO FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R   CBLMOVK1
               ELSE                                                     MSGACTK2
      *            CASE: *OTHERWISE                                     MSGACTK2
      *            U:Date YYYYMMDD                                      CBLADDK1
                   ADD WUDATE OF WORK-CONTEXT, 20000000 GIVING          CBLADDK1
                     FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R               CBLADDK1
               END-IF                                                   MSGACTK2
           ELSE                                                         MSGACTK2
      *        CASE: *OTHERWISE                                         MSGACTK2
      *        U:Date YYYYMMDD                                          CBLADDK1
               ADD WUDATE OF WORK-CONTEXT, 19000000 GIVING FBCRTDTD8 OF CBLADDK1
                 FACTIDP OF FBACTIONL0-R                                CBLADDK1
           END-IF                                                       MSGACTK2
      *    Date Last Changed D8#                                        CBLMOVK1
           MOVE FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R TO FBCHGDT8 OF     CBLMOVK1
             FACTIDP OF FBACTIONL0-R                                    CBLMOVK1
      *    Check for duplicate primary key                              CBLCRTK1
           START FBACTIONL0 KEY = EXTERNALLY-DESCRIBED-KEY              CBLCRTK1
             FORMAT IS 'FACTIDP'                                        CBLCRTK1
           END-START                                                    CBLCRTK1
           IF (NOT C-NO-RECORD) THEN                                    CBLCRTK1
               SET C-INDICATOR-ON(90) TO TRUE                           CBLCRTK1
           ELSE                                                         CBLCRTK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLCRTK1
           END-IF                                                       CBLCRTK1
           IF (C-INDICATOR-ON(90)) THEN                                 CBLCRTK1
               MOVE 'USR6517' TO W0RTN                                  CBLCRTK1
      *        Send message 'FB Action              EX'                 SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'USR6517' TO ZAMSID                                 SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
               GO SA1EXIT                                               CBLCRTK1
           END-IF                                                       CBLCRTK1
      *                                                                 CBLCRTK1
           WRITE FBACTIONL0-R END-WRITE                                 CBLCRTK1
           IF (C-IO-ERR) THEN                                           CBLCRTK1
               SET C-INDICATOR-ON(91) TO TRUE                           CBLCRTK1
           ELSE                                                         CBLCRTK1
               SET C-INDICATOR-OFF(91) TO TRUE                          CBLCRTK1
           END-IF                                                       CBLCRTK1
      *                                                                 CBLCRTK1
           IF (C-INDICATOR-ON(91)) THEN                                 CBLCRTK1
      *        Write error detected                                     CBLCRTK1
               MOVE 'Y2U0004' TO W0RTN                                  CBLCRTK1
           ELSE                                                         CBLCRTK1
      *        DBF write successful                                     CBLCRTK1
               CONTINUE                                                 CBLCRTK1
           END-IF                                                       CBLCRTK1
      *==============================================================   CBLCRTK1
           CONTINUE.                                                    CBLCRTK1
       SA1EXIT.                                                         CBLCRTK1
           EXIT.                                                        CBLCRTK1
      /EJECT                                                            CBLRTVK2
       SA2RVGN SECTION.                                                 CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Rtv all fields - FB Action  *                                CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Initialize return code                                       CBLRTVK2
           MOVE SPACES TO W0RTN                                         CBLRTVK2
      *    Setup key                                                    CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FBFLOPNO OF KRSSA2         CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FBDIDM OF KRSSA2             CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           MOVE Z1ACTDTE OF ZRCDDTL1-WS-O TO FBACTDTE OF KRSSA2         CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           MOVE Z1ACTTIME OF ZRCDDTL1-WS-O TO FBACTTIME OF KRSSA2       CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           MOVE ZDUPGM1 OF ZRCDDTL1-WS-O TO FBPGMNAM OF KRSSA2          CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FBFLOPNO OF EXTSA2                        CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE -999999 TO FBDIDM OF EXTSA2                             CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           MOVE -99999999 TO FBACTDTE OF EXTSA2                         CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           MOVE -999999 TO FBACTTIME OF EXTSA2                          CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           MOVE LOW-VALUES TO FBPGMNAM OF EXTSA2                        CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             KRSSA2 TO                                                  CBLRTVK2
             FACTIDQ OF FBACTIONL1-R                                    CBLRTVK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CBLRTVK2
           READ FBACTIONL1                                              CBLRTVK2
             FORMAT IS 'FACTIDQ'                                        CBLRTVK2
           END-READ                                                     CBLRTVK2
           IF (C-NO-RECORD) THEN                                        CBLRTVK2
               SET C-INDICATOR-ON(90) TO TRUE                           CBLRTVK2
           ELSE                                                         CBLRTVK2
               IF (C-IO-ERR) THEN                                       CBLRTVK2
                   STOP RUN                                             CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-IF                                                       CBLRTVK2
           IF (C-INDICATOR-ON(90)) THEN                                 CBLRTVK2
      *        Data record not found                                    CBLRTVK2
               MOVE 'USR6516' TO W0RTN                                  CBLRTVK2
      *        USER: Processing if Data record not found                MSGACTK2
      *        PAR = CON By name                                        CBLMCXK1
      *        FB Action Status                                         CBLMCXK1
               MOVE SPACES TO YL0002 OF WORK-CONTEXT                    CBLMCXK1
      *        Job Start TS#                                            CBLMCXK1
               MOVE '0001-01-01-00.00.00.000000' TO YN0001 OF           CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job End TS#                                              CBLMCXK1
               MOVE '0001-01-01-00.00.00.000000' TO YN0002 OF           CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Frequency                                             CBLMCXK1
               MOVE SPACES TO YN0003 OF WORK-CONTEXT                    CBLMCXK1
      *        FB Days to Delay                                         CBLMCXK1
               MOVE ZEROS TO YN0004 OF WORK-CONTEXT                     CBLMCXK1
      *        FB Delay incl Non-WrkDays                                CBLMCXK1
               MOVE SPACES TO YN0005 OF WORK-CONTEXT                    CBLMCXK1
      *        Next Program Name                                        CBLMCXK1
               MOVE SPACES TO YN0006 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Date D8#                                          CBLMCXK1
               MOVE ZEROS TO YN0007 OF WORK-CONTEXT                     CBLMCXK1
      *        Create Time                                              CBLMCXK1
               MOVE ZEROS TO YN0008 OF WORK-CONTEXT                     CBLMCXK1
      *        Create User                                              CBLMCXK1
               MOVE SPACES TO YN0009 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Program                                           CBLMCXK1
               MOVE SPACES TO YN0010 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Job                                               CBLMCXK1
               MOVE SPACES TO YN0011 OF WORK-CONTEXT                    CBLMCXK1
      *        Date Last Changed D8#                                    CBLMCXK1
               MOVE ZEROS TO YN0012 OF WORK-CONTEXT                     CBLMCXK1
      *        Time Last Changed                                        CBLMCXK1
               MOVE ZEROS TO YN0013 OF WORK-CONTEXT                     CBLMCXK1
      *        User Last Changed                                        CBLMCXK1
               MOVE SPACES TO YN0014 OF WORK-CONTEXT                    CBLMCXK1
      *        Program Last Changed                                     CBLMCXK1
               MOVE SPACES TO YN0015 OF WORK-CONTEXT                    CBLMCXK1
      *        Job Last Changed                                         CBLMCXK1
               MOVE SPACES TO YN0016 OF WORK-CONTEXT                    CBLMCXK1
               GO SA2EXIT                                               CBLRTVK2
           END-IF                                                       CBLRTVK2
      *                                                                 CBLRTVK2
           IF (C-INDICATOR-OFF(90)) THEN                                CBLRTVK2
      *        USER: Process Data record                                MSGACTK2
      *        PAR = DB1 By name                                        CBLMCXK1
      *        FB Action Status                                         CBLMCXK1
               MOVE FBFBSTS OF FACTIDQ OF FBACTIONL1-R TO YL0002 OF     CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job Start TS#                                            CBLMCXK1
               MOVE FBJOBSTR OF FACTIDQ OF FBACTIONL1-R TO YN0001 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job End TS#                                              CBLMCXK1
               MOVE FBJOBEND OF FACTIDQ OF FBACTIONL1-R TO YN0002 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Frequency                                             CBLMCXK1
               MOVE FBFREQ OF FACTIDQ OF FBACTIONL1-R TO YN0003 OF      CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Days to Delay                                         CBLMCXK1
               MOVE FBDELAY OF FACTIDQ OF FBACTIONL1-R TO YN0004 OF     CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Delay incl Non-WrkDays                                CBLMCXK1
               MOVE FBNONWRK OF FACTIDQ OF FBACTIONL1-R TO YN0005 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Next Program Name                                        CBLMCXK1
               MOVE FBW8CE OF FACTIDQ OF FBACTIONL1-R TO YN0006 OF      CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Date D8#                                          CBLMCXK1
               MOVE FBCRTDTD8 OF FACTIDQ OF FBACTIONL1-R TO YN0007 OF   CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Time                                              CBLMCXK1
               MOVE FBCRTTME OF FACTIDQ OF FBACTIONL1-R TO YN0008 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create User                                              CBLMCXK1
               MOVE FBCRTUSER OF FACTIDQ OF FBACTIONL1-R TO YN0009 OF   CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Program                                           CBLMCXK1
               MOVE FBCRTPGM OF FACTIDQ OF FBACTIONL1-R TO YN0010 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Job                                               CBLMCXK1
               MOVE FBCRTJOB OF FACTIDQ OF FBACTIONL1-R TO YN0011 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Date Last Changed D8#                                    CBLMCXK1
               MOVE FBCHGDT8 OF FACTIDQ OF FBACTIONL1-R TO YN0012 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Time Last Changed                                        CBLMCXK1
               MOVE FBCHGTME OF FACTIDQ OF FBACTIONL1-R TO YN0013 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        User Last Changed                                        CBLMCXK1
               MOVE FBUSERCHGD OF FACTIDQ OF FBACTIONL1-R TO YN0014 OF  CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Program Last Changed                                     CBLMCXK1
               MOVE FBPGMCHG OF FACTIDQ OF FBACTIONL1-R TO YN0015 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job Last Changed                                         CBLMCXK1
               MOVE FBJOBCHG OF FACTIDQ OF FBACTIONL1-R TO YN0016 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
           END-IF                                                       CBLRTVK2
      *==============================================================   CBLRTVK2
           CONTINUE.                                                    CBLRTVK2
       SA2EXIT.                                                         CBLRTVK2
           EXIT.                                                        CBLRTVK2
      /EJECT                                                            CBLCRTK1
       SA3CRRC SECTION.                                                 CBLCRTK1
      *==============================================================   CBLCRTK1
      *    Create FB Action - FB Action  *                              CBLCRTK1
      *==============================================================   CBLCRTK1
      *    Initialize return code                                       CBLCRTK1
           MOVE SPACES TO W0RTN                                         CBLCRTK1
      *                                                                 CBLCRTK1
      *    Move all fields to FACTIDP                                   CBLCRTK1
      *    Fleet Operator Number                                        CBLCRTK1
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FBFLOPNO OF FBACTIONL0-R   CBLCRTK1
      *    FB Month of Parts Data                                       CBLCRTK1
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FBDIDM OF FBACTIONL0-R       CBLCRTK1
      *    FB Action Date                                               CBLCRTK1
           MOVE Z1ACTDTE OF ZRCDDTL1-WS-O TO FBACTDTE OF FBACTIONL0-R   CBLCRTK1
      *    FB Action Time                                               CBLCRTK1
           MOVE Z1ACTTIME OF ZRCDDTL1-WS-O TO FBACTTIME OF FBACTIONL0-R CBLCRTK1
      *    Program Name                                                 CBLCRTK1
           MOVE ZDUPGM2 OF ZRCDDTL1-WS-O TO FBPGMNAM OF FBACTIONL0-R    CBLCRTK1
      *    FB Action Status                                             CBLCRTK1
           MOVE 'R' TO FBFBSTS OF FBACTIONL0-R                          CBLCRTK1
      *    Job Start TS#                                                CBLCRTK1
           MOVE '0001-01-01-00.00.00.00000' TO FBJOBSTR OF FBACTIONL0-R CBLCRTK1
      *    Job End TS#                                                  CBLCRTK1
           MOVE '0001-01-01-00.00.00.00000' TO FBJOBEND OF FBACTIONL0-R CBLCRTK1
      *    FB Frequency                                                 CBLCRTK1
           MOVE 'M' TO FBFREQ OF FBACTIONL0-R                           CBLCRTK1
      *    FB Days to Delay                                             CBLCRTK1
           MOVE ZEROS TO FBDELAY OF FBACTIONL0-R                        CBLCRTK1
      *    FB Delay incl Non-WrkDays                                    CBLCRTK1
           MOVE 'N' TO FBNONWRK OF FBACTIONL0-R                         CBLCRTK1
      *    Next Program Name                                            CBLCRTK1
           MOVE SPACES TO FBW8CE OF FBACTIONL0-R                        CBLCRTK1
      *    Create Date D8#                                              CBLCRTK1
           MOVE ZEROS TO FBCRTDTD8 OF FBACTIONL0-R                      CBLCRTK1
      *    Create Time                                                  CBLCRTK1
           MOVE ZEROS TO FBCRTTME OF FBACTIONL0-R                       CBLCRTK1
      *    Create User                                                  CBLCRTK1
           MOVE SPACES TO FBCRTUSER OF FBACTIONL0-R                     CBLCRTK1
      *    Create Program                                               CBLCRTK1
           MOVE SPACES TO FBCRTPGM OF FBACTIONL0-R                      CBLCRTK1
      *    Create Job                                                   CBLCRTK1
           MOVE SPACES TO FBCRTJOB OF FBACTIONL0-R                      CBLCRTK1
      *    Date Last Changed D8#                                        CBLCRTK1
           MOVE ZEROS TO FBCHGDT8 OF FBACTIONL0-R                       CBLCRTK1
      *    Time Last Changed                                            CBLCRTK1
           MOVE ZEROS TO FBCHGTME OF FBACTIONL0-R                       CBLCRTK1
      *    User Last Changed                                            CBLCRTK1
           MOVE SPACES TO FBUSERCHGD OF FBACTIONL0-R                    CBLCRTK1
      *    Program Last Changed                                         CBLCRTK1
           MOVE SPACES TO FBPGMCHG OF FBACTIONL0-R                      CBLCRTK1
      *    Job Last Changed                                             CBLCRTK1
           MOVE SPACES TO FBJOBCHG OF FBACTIONL0-R                      CBLCRTK1
      *    USER: Processing before Data update                          MSGACTK2
      *    Rtn Update Audit for Crt                                     MSGACTK2
      *    Function details                                             MSGACTK2
      *    CASE: *OTHERWISE                                             MSGACTK2
      *    -------------------------------------------------------------MSGACTK2
      *    Maintenance:-                                                MSGACTK2
      *    07/04/2010  RN-INC-479183         Maurice Mead               MSGACTK2
      *    D8# date now loaded directly from the job date field.        MSGACTK2
      *    -------------------------------------------------------------MSGACTK2
      *    LCL.U:Job date D8# = JOB.*Job date                           CVTDTMK1
           IF (ZZJDT OF JOB-CONTEXT = ZERO) THEN                        CVTDTMK1
               MOVE ZEROS TO YL0001 OF WORK-CONTEXT                     CVTDTMK1
           ELSE                                                         CVTDTMK1
               ADD 19000000 TO ZZJDT OF JOB-CONTEXT GIVING YL0001 OF    CVTDTMK1
                 WORK-CONTEXT                                           CVTDTMK1
           END-IF                                                       CVTDTMK1
      *    Create Time                                                  CBLMOVK1
           MOVE ZZJTM OF JOB-CONTEXT TO FBCRTTME OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create User                                                  CBLMOVK1
           MOVE ZZUSR OF JOB-CONTEXT TO FBCRTUSER OF FACTIDP OF         CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Date D8#                                              CBLMOVK1
           MOVE YL0001 OF WORK-CONTEXT TO FBCRTDTD8 OF FACTIDP OF       CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Program                                               CBLMOVK1
           MOVE ZZPGM OF JOB-CONTEXT TO FBCRTPGM OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Job                                                   CBLMOVK1
           MOVE ZZJOB OF JOB-CONTEXT TO FBCRTJOB OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Date Last Changed D8#                                        CBLMOVK1
           MOVE YL0001 OF WORK-CONTEXT TO FBCHGDT8 OF FACTIDP OF        CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Time Last Changed                                            CBLMOVK1
           MOVE ZZJTM OF JOB-CONTEXT TO FBCHGTME OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    User Last Changed                                            CBLMOVK1
           MOVE ZZUSR OF JOB-CONTEXT TO FBUSERCHGD OF FACTIDP OF        CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Program Last Changed                                         CBLMOVK1
           MOVE ZZPGM OF JOB-CONTEXT TO FBPGMCHG OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Job Last Changed                                             CBLMOVK1
           MOVE ZZJOB OF JOB-CONTEXT TO FBJOBCHG OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    WRK.U:Date = JOB.*System time stamp                          CVTDTMK1
           PERFORM XSTMS                                                CVTDTMK1
           MOVE ZZTMS OF JOB-CONTEXT TO XDITSM                          CVTDTMK1
           MOVE XDITSD TO XDI2DT                                        CVTDTMK1
           PERFORM XCVTE                                                CVTDTMK1
           IF (XDINDT = ZERO) THEN                                      CVTDTMK1
               MOVE ZEROS TO WUDATE OF WORK-CONTEXT                     CVTDTMK1
           ELSE                                                         CVTDTMK1
               SUBTRACT 1000000 FROM XDINDT GIVING WUDATE OF            CVTDTMK1
                 WORK-CONTEXT                                           CVTDTMK1
           END-IF                                                       CVTDTMK1
      *    Cvt DTE to DTX Format                                        MSGACTK2
      *    CASE: PAR.U:Date is < 01/01/40                               MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (WUDATE OF WORK-CONTEXT < 400101) THEN                    CBLIFXK1
      *        CASE: PAR.U:Date is *Zero                                MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (WUDATE OF WORK-CONTEXT = ZEROS) THEN                 CBLIFXK1
      *            U:Date YYYYMMDD                                      CBLMOVK1
                   MOVE ZEROS TO FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R   CBLMOVK1
               ELSE                                                     MSGACTK2
      *            CASE: *OTHERWISE                                     MSGACTK2
      *            U:Date YYYYMMDD                                      CBLADDK1
                   ADD WUDATE OF WORK-CONTEXT, 20000000 GIVING          CBLADDK1
                     FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R               CBLADDK1
               END-IF                                                   MSGACTK2
           ELSE                                                         MSGACTK2
      *        CASE: *OTHERWISE                                         MSGACTK2
      *        U:Date YYYYMMDD                                          CBLADDK1
               ADD WUDATE OF WORK-CONTEXT, 19000000 GIVING FBCRTDTD8 OF CBLADDK1
                 FACTIDP OF FBACTIONL0-R                                CBLADDK1
           END-IF                                                       MSGACTK2
      *    Date Last Changed D8#                                        CBLMOVK1
           MOVE FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R TO FBCHGDT8 OF     CBLMOVK1
             FACTIDP OF FBACTIONL0-R                                    CBLMOVK1
      *    Check for duplicate primary key                              CBLCRTK1
           START FBACTIONL0 KEY = EXTERNALLY-DESCRIBED-KEY              CBLCRTK1
             FORMAT IS 'FACTIDP'                                        CBLCRTK1
           END-START                                                    CBLCRTK1
           IF (NOT C-NO-RECORD) THEN                                    CBLCRTK1
               SET C-INDICATOR-ON(90) TO TRUE                           CBLCRTK1
           ELSE                                                         CBLCRTK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLCRTK1
           END-IF                                                       CBLCRTK1
           IF (C-INDICATOR-ON(90)) THEN                                 CBLCRTK1
               MOVE 'USR6517' TO W0RTN                                  CBLCRTK1
      *        Send message 'FB Action              EX'                 SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'USR6517' TO ZAMSID                                 SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
               GO SA3EXIT                                               CBLCRTK1
           END-IF                                                       CBLCRTK1
      *                                                                 CBLCRTK1
           WRITE FBACTIONL0-R END-WRITE                                 CBLCRTK1
           IF (C-IO-ERR) THEN                                           CBLCRTK1
               SET C-INDICATOR-ON(91) TO TRUE                           CBLCRTK1
           ELSE                                                         CBLCRTK1
               SET C-INDICATOR-OFF(91) TO TRUE                          CBLCRTK1
           END-IF                                                       CBLCRTK1
      *                                                                 CBLCRTK1
           IF (C-INDICATOR-ON(91)) THEN                                 CBLCRTK1
      *        Write error detected                                     CBLCRTK1
               MOVE 'Y2U0004' TO W0RTN                                  CBLCRTK1
           ELSE                                                         CBLCRTK1
      *        DBF write successful                                     CBLCRTK1
               CONTINUE                                                 CBLCRTK1
           END-IF                                                       CBLCRTK1
      *==============================================================   CBLCRTK1
           CONTINUE.                                                    CBLCRTK1
       SA3EXIT.                                                         CBLCRTK1
           EXIT.                                                        CBLCRTK1
      /EJECT                                                            CBLRTVK2
       SA4RVGN SECTION.                                                 CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Rtv all fields - FB Action  *                                CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Initialize return code                                       CBLRTVK2
           MOVE SPACES TO W0RTN                                         CBLRTVK2
      *    Setup key                                                    CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FBFLOPNO OF KRSSA4         CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FBDIDM OF KRSSA4             CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           MOVE Z1ACTDTE OF ZRCDDTL1-WS-O TO FBACTDTE OF KRSSA4         CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           MOVE Z1ACTTIME OF ZRCDDTL1-WS-O TO FBACTTIME OF KRSSA4       CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           MOVE ZDUPGM2 OF ZRCDDTL1-WS-O TO FBPGMNAM OF KRSSA4          CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FBFLOPNO OF EXTSA4                        CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE -999999 TO FBDIDM OF EXTSA4                             CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           MOVE -99999999 TO FBACTDTE OF EXTSA4                         CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           MOVE -999999 TO FBACTTIME OF EXTSA4                          CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           MOVE LOW-VALUES TO FBPGMNAM OF EXTSA4                        CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             KRSSA4 TO                                                  CBLRTVK2
             FACTIDQ OF FBACTIONL1-R                                    CBLRTVK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CBLRTVK2
           READ FBACTIONL1                                              CBLRTVK2
             FORMAT IS 'FACTIDQ'                                        CBLRTVK2
           END-READ                                                     CBLRTVK2
           IF (C-NO-RECORD) THEN                                        CBLRTVK2
               SET C-INDICATOR-ON(90) TO TRUE                           CBLRTVK2
           ELSE                                                         CBLRTVK2
               IF (C-IO-ERR) THEN                                       CBLRTVK2
                   STOP RUN                                             CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-IF                                                       CBLRTVK2
           IF (C-INDICATOR-ON(90)) THEN                                 CBLRTVK2
      *        Data record not found                                    CBLRTVK2
               MOVE 'USR6516' TO W0RTN                                  CBLRTVK2
      *        USER: Processing if Data record not found                MSGACTK2
      *        PAR = CON By name                                        CBLMCXK1
      *        FB Action Status                                         CBLMCXK1
               MOVE SPACES TO YL0002 OF WORK-CONTEXT                    CBLMCXK1
      *        Job Start TS#                                            CBLMCXK1
               MOVE '0001-01-01-00.00.00.000000' TO YN0001 OF           CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job End TS#                                              CBLMCXK1
               MOVE '0001-01-01-00.00.00.000000' TO YN0002 OF           CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Frequency                                             CBLMCXK1
               MOVE SPACES TO YN0003 OF WORK-CONTEXT                    CBLMCXK1
      *        FB Days to Delay                                         CBLMCXK1
               MOVE ZEROS TO YN0004 OF WORK-CONTEXT                     CBLMCXK1
      *        FB Delay incl Non-WrkDays                                CBLMCXK1
               MOVE SPACES TO YN0005 OF WORK-CONTEXT                    CBLMCXK1
      *        Next Program Name                                        CBLMCXK1
               MOVE SPACES TO YN0006 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Date D8#                                          CBLMCXK1
               MOVE ZEROS TO YN0007 OF WORK-CONTEXT                     CBLMCXK1
      *        Create Time                                              CBLMCXK1
               MOVE ZEROS TO YN0008 OF WORK-CONTEXT                     CBLMCXK1
      *        Create User                                              CBLMCXK1
               MOVE SPACES TO YN0009 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Program                                           CBLMCXK1
               MOVE SPACES TO YN0010 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Job                                               CBLMCXK1
               MOVE SPACES TO YN0011 OF WORK-CONTEXT                    CBLMCXK1
      *        Date Last Changed D8#                                    CBLMCXK1
               MOVE ZEROS TO YN0012 OF WORK-CONTEXT                     CBLMCXK1
      *        Time Last Changed                                        CBLMCXK1
               MOVE ZEROS TO YN0013 OF WORK-CONTEXT                     CBLMCXK1
      *        User Last Changed                                        CBLMCXK1
               MOVE SPACES TO YN0014 OF WORK-CONTEXT                    CBLMCXK1
      *        Program Last Changed                                     CBLMCXK1
               MOVE SPACES TO YN0015 OF WORK-CONTEXT                    CBLMCXK1
      *        Job Last Changed                                         CBLMCXK1
               MOVE SPACES TO YN0016 OF WORK-CONTEXT                    CBLMCXK1
               GO SA4EXIT                                               CBLRTVK2
           END-IF                                                       CBLRTVK2
      *                                                                 CBLRTVK2
           IF (C-INDICATOR-OFF(90)) THEN                                CBLRTVK2
      *        USER: Process Data record                                MSGACTK2
      *        PAR = DB1 By name                                        CBLMCXK1
      *        FB Action Status                                         CBLMCXK1
               MOVE FBFBSTS OF FACTIDQ OF FBACTIONL1-R TO YL0002 OF     CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job Start TS#                                            CBLMCXK1
               MOVE FBJOBSTR OF FACTIDQ OF FBACTIONL1-R TO YN0001 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job End TS#                                              CBLMCXK1
               MOVE FBJOBEND OF FACTIDQ OF FBACTIONL1-R TO YN0002 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Frequency                                             CBLMCXK1
               MOVE FBFREQ OF FACTIDQ OF FBACTIONL1-R TO YN0003 OF      CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Days to Delay                                         CBLMCXK1
               MOVE FBDELAY OF FACTIDQ OF FBACTIONL1-R TO YN0004 OF     CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Delay incl Non-WrkDays                                CBLMCXK1
               MOVE FBNONWRK OF FACTIDQ OF FBACTIONL1-R TO YN0005 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Next Program Name                                        CBLMCXK1
               MOVE FBW8CE OF FACTIDQ OF FBACTIONL1-R TO YN0006 OF      CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Date D8#                                          CBLMCXK1
               MOVE FBCRTDTD8 OF FACTIDQ OF FBACTIONL1-R TO YN0007 OF   CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Time                                              CBLMCXK1
               MOVE FBCRTTME OF FACTIDQ OF FBACTIONL1-R TO YN0008 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create User                                              CBLMCXK1
               MOVE FBCRTUSER OF FACTIDQ OF FBACTIONL1-R TO YN0009 OF   CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Program                                           CBLMCXK1
               MOVE FBCRTPGM OF FACTIDQ OF FBACTIONL1-R TO YN0010 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Job                                               CBLMCXK1
               MOVE FBCRTJOB OF FACTIDQ OF FBACTIONL1-R TO YN0011 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Date Last Changed D8#                                    CBLMCXK1
               MOVE FBCHGDT8 OF FACTIDQ OF FBACTIONL1-R TO YN0012 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Time Last Changed                                        CBLMCXK1
               MOVE FBCHGTME OF FACTIDQ OF FBACTIONL1-R TO YN0013 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        User Last Changed                                        CBLMCXK1
               MOVE FBUSERCHGD OF FACTIDQ OF FBACTIONL1-R TO YN0014 OF  CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Program Last Changed                                     CBLMCXK1
               MOVE FBPGMCHG OF FACTIDQ OF FBACTIONL1-R TO YN0015 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job Last Changed                                         CBLMCXK1
               MOVE FBJOBCHG OF FACTIDQ OF FBACTIONL1-R TO YN0016 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
           END-IF                                                       CBLRTVK2
      *==============================================================   CBLRTVK2
           CONTINUE.                                                    CBLRTVK2
       SA4EXIT.                                                         CBLRTVK2
           EXIT.                                                        CBLRTVK2
      /EJECT                                                            CBLRTVK2
       SA5RVGN SECTION.                                                 CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Rtv FB Run Status - FB Run Control  *                        CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Initialize return code                                       CBLRTVK2
           MOVE SPACES TO W0RTN                                         CBLRTVK2
      *    Setup key                                                    CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FDDIDM OF KRSSA5             CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FDFLOPNO OF KRSSA5         CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE -999999 TO FDDIDM OF EXTSA5                             CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FDFLOPNO OF EXTSA5                        CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             EXTSA5 TO                                                  CBLRTVK2
             FRUNCG2 OF FBRUNCONL2-R                                    CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             KRSSA5 TO                                                  CBLRTVK2
             FRUNCG2 OF FBRUNCONL2-R                                    CBLRTVK2
           START FBRUNCONL2 KEY NOT < EXTERNALLY-DESCRIBED-KEY          CBLRTVK2
             FORMAT IS 'FRUNCG2'                                        CBLRTVK2
           END-START                                                    CBLRTVK2
           IF (C-IO-ERR) THEN                                           CBLRTVK2
               STOP RUN                                                 CBLRTVK2
           END-IF                                                       CBLRTVK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CBLRTVK2
           READ FBRUNCONL2 NEXT                                         CBLRTVK2
             FORMAT IS 'FRUNCG2'                                        CBLRTVK2
           END-READ                                                     CBLRTVK2
           IF (C-EOF) THEN                                              CBLRTVK2
               SET C-INDICATOR-ON(90) TO TRUE                           CBLRTVK2
           ELSE                                                         CBLRTVK2
               IF (C-IO-ERR) THEN                                       CBLRTVK2
                   STOP RUN                                             CBLRTVK2
               ELSE                                                     CBLRTVK2
                   MOVE CORRESPONDING                                   CBLRTVK2
                     FRUNCG2 OF FBRUNCONL2-R TO                         CBLRTVK2
                     EXTSA5                                             CBLRTVK2
                   MOVE EXTSA5 TO KRSSA5-TMP                            CBLRTVK2
                   IF (KRSSA5 NOT = KRSSA5-TMP) THEN                    CBLRTVK2
                       SET C-INDICATOR-ON(90) TO TRUE                   CBLRTVK2
                   END-IF                                               CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-IF                                                       CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE -999999 TO FDDIDM OF EXTSA5                             CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FDFLOPNO OF EXTSA5                        CBLRTVK2
           IF (C-INDICATOR-ON(90)) THEN                                 CBLRTVK2
      *        Data record not found                                    CBLRTVK2
               MOVE 'USR6520' TO W0RTN                                  CBLRTVK2
      *        USER: Processing if Data record not found                MSGACTK2
      *        PAR = CON By name                                        CBLMCXK1
      *        FB Run Status                                            CBLMCXK1
               MOVE SPACES TO ZDRUNSTAT OF ZRCDDTL1-WS-O                CBLMCXK1
               GO SA5EXIT                                               CBLRTVK2
           END-IF                                                       CBLRTVK2
      *                                                                 CBLRTVK2
           PERFORM UNTIL NOT (C-INDICATOR-OFF(90))                      CBLRTVK2
      *        USER: Process Data record                                MSGACTK2
      *        PAR = DB1 By name                                        CBLMCXK1
      *        FB Run Status                                            CBLMCXK1
               MOVE FDRUNSTAT OF FRUNCG2 OF FBRUNCONL2-R TO ZDRUNSTAT   CBLMCXK1
                 OF ZRCDDTL1-WS-O                                       CBLMCXK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLRTVK2
               READ FBRUNCONL2 NEXT                                     CBLRTVK2
                 FORMAT IS 'FRUNCG2'                                    CBLRTVK2
               END-READ                                                 CBLRTVK2
               IF (C-EOF) THEN                                          CBLRTVK2
                   SET C-INDICATOR-ON(90) TO TRUE                       CBLRTVK2
               ELSE                                                     CBLRTVK2
                   IF (C-IO-ERR) THEN                                   CBLRTVK2
                       STOP RUN                                         CBLRTVK2
                   ELSE                                                 CBLRTVK2
                       MOVE CORRESPONDING                               CBLRTVK2
                         FRUNCG2 OF FBRUNCONL2-R TO                     CBLRTVK2
                         EXTSA5                                         CBLRTVK2
                       MOVE EXTSA5 TO KRSSA5-TMP                        CBLRTVK2
                       IF (KRSSA5 NOT = KRSSA5-TMP) THEN                CBLRTVK2
                           SET C-INDICATOR-ON(90) TO TRUE               CBLRTVK2
                       END-IF                                           CBLRTVK2
                   END-IF                                               CBLRTVK2
               END-IF                                                   CBLRTVK2
      *        Initialise Full Externally Described Keylist             CBLRTVK2
      *        FB Month of Parts Data                                   CBLRTVK2
               MOVE -999999 TO FDDIDM OF EXTSA5                         CBLRTVK2
      *        Fleet Operator Number                                    CBLRTVK2
               MOVE LOW-VALUES TO FDFLOPNO OF EXTSA5                    CBLRTVK2
           END-PERFORM                                                  CBLRTVK2
      *==============================================================   CBLRTVK2
           CONTINUE.                                                    CBLRTVK2
       SA5EXIT.                                                         CBLRTVK2
           EXIT.                                                        CBLRTVK2
      /EJECT                                                            CBLCRTK1
       SA6CRRC SECTION.                                                 CBLCRTK1
      *==============================================================   CBLCRTK1
      *    Create FB Action - FB Action  *                              CBLCRTK1
      *==============================================================   CBLCRTK1
      *    Initialize return code                                       CBLCRTK1
           MOVE SPACES TO W0RTN                                         CBLCRTK1
      *                                                                 CBLCRTK1
      *    Move all fields to FACTIDP                                   CBLCRTK1
      *    Fleet Operator Number                                        CBLCRTK1
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FBFLOPNO OF FBACTIONL0-R   CBLCRTK1
      *    FB Month of Parts Data                                       CBLCRTK1
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FBDIDM OF FBACTIONL0-R       CBLCRTK1
      *    FB Action Date                                               CBLCRTK1
           MOVE Z1ACTDTE OF ZRCDDTL1-WS-O TO FBACTDTE OF FBACTIONL0-R   CBLCRTK1
      *    FB Action Time                                               CBLCRTK1
           MOVE Z1ACTTIME OF ZRCDDTL1-WS-O TO FBACTTIME OF FBACTIONL0-R CBLCRTK1
      *    Program Name                                                 CBLCRTK1
           MOVE ZDUPGM3 OF ZRCDDTL1-WS-O TO FBPGMNAM OF FBACTIONL0-R    CBLCRTK1
      *    FB Action Status                                             CBLCRTK1
           MOVE 'R' TO FBFBSTS OF FBACTIONL0-R                          CBLCRTK1
      *    Job Start TS#                                                CBLCRTK1
           MOVE '0001-01-01-00.00.00.00000' TO FBJOBSTR OF FBACTIONL0-R CBLCRTK1
      *    Job End TS#                                                  CBLCRTK1
           MOVE '0001-01-01-00.00.00.00000' TO FBJOBEND OF FBACTIONL0-R CBLCRTK1
      *    FB Frequency                                                 CBLCRTK1
           MOVE 'M' TO FBFREQ OF FBACTIONL0-R                           CBLCRTK1
      *    FB Days to Delay                                             CBLCRTK1
           MOVE ZEROS TO FBDELAY OF FBACTIONL0-R                        CBLCRTK1
      *    FB Delay incl Non-WrkDays                                    CBLCRTK1
           MOVE 'N' TO FBNONWRK OF FBACTIONL0-R                         CBLCRTK1
      *    Next Program Name                                            CBLCRTK1
           MOVE SPACES TO FBW8CE OF FBACTIONL0-R                        CBLCRTK1
      *    Create Date D8#                                              CBLCRTK1
           MOVE ZEROS TO FBCRTDTD8 OF FBACTIONL0-R                      CBLCRTK1
      *    Create Time                                                  CBLCRTK1
           MOVE ZEROS TO FBCRTTME OF FBACTIONL0-R                       CBLCRTK1
      *    Create User                                                  CBLCRTK1
           MOVE SPACES TO FBCRTUSER OF FBACTIONL0-R                     CBLCRTK1
      *    Create Program                                               CBLCRTK1
           MOVE SPACES TO FBCRTPGM OF FBACTIONL0-R                      CBLCRTK1
      *    Create Job                                                   CBLCRTK1
           MOVE SPACES TO FBCRTJOB OF FBACTIONL0-R                      CBLCRTK1
      *    Date Last Changed D8#                                        CBLCRTK1
           MOVE ZEROS TO FBCHGDT8 OF FBACTIONL0-R                       CBLCRTK1
      *    Time Last Changed                                            CBLCRTK1
           MOVE ZEROS TO FBCHGTME OF FBACTIONL0-R                       CBLCRTK1
      *    User Last Changed                                            CBLCRTK1
           MOVE SPACES TO FBUSERCHGD OF FBACTIONL0-R                    CBLCRTK1
      *    Program Last Changed                                         CBLCRTK1
           MOVE SPACES TO FBPGMCHG OF FBACTIONL0-R                      CBLCRTK1
      *    Job Last Changed                                             CBLCRTK1
           MOVE SPACES TO FBJOBCHG OF FBACTIONL0-R                      CBLCRTK1
      *    USER: Processing before Data update                          MSGACTK2
      *    Rtn Update Audit for Crt                                     MSGACTK2
      *    Function details                                             MSGACTK2
      *    CASE: *OTHERWISE                                             MSGACTK2
      *    -------------------------------------------------------------MSGACTK2
      *    Maintenance:-                                                MSGACTK2
      *    07/04/2010  RN-INC-479183         Maurice Mead               MSGACTK2
      *    D8# date now loaded directly from the job date field.        MSGACTK2
      *    -------------------------------------------------------------MSGACTK2
      *    LCL.U:Job date D8# = JOB.*Job date                           CVTDTMK1
           IF (ZZJDT OF JOB-CONTEXT = ZERO) THEN                        CVTDTMK1
               MOVE ZEROS TO YL0001 OF WORK-CONTEXT                     CVTDTMK1
           ELSE                                                         CVTDTMK1
               ADD 19000000 TO ZZJDT OF JOB-CONTEXT GIVING YL0001 OF    CVTDTMK1
                 WORK-CONTEXT                                           CVTDTMK1
           END-IF                                                       CVTDTMK1
      *    Create Time                                                  CBLMOVK1
           MOVE ZZJTM OF JOB-CONTEXT TO FBCRTTME OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create User                                                  CBLMOVK1
           MOVE ZZUSR OF JOB-CONTEXT TO FBCRTUSER OF FACTIDP OF         CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Date D8#                                              CBLMOVK1
           MOVE YL0001 OF WORK-CONTEXT TO FBCRTDTD8 OF FACTIDP OF       CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Program                                               CBLMOVK1
           MOVE ZZPGM OF JOB-CONTEXT TO FBCRTPGM OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Job                                                   CBLMOVK1
           MOVE ZZJOB OF JOB-CONTEXT TO FBCRTJOB OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Date Last Changed D8#                                        CBLMOVK1
           MOVE YL0001 OF WORK-CONTEXT TO FBCHGDT8 OF FACTIDP OF        CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Time Last Changed                                            CBLMOVK1
           MOVE ZZJTM OF JOB-CONTEXT TO FBCHGTME OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    User Last Changed                                            CBLMOVK1
           MOVE ZZUSR OF JOB-CONTEXT TO FBUSERCHGD OF FACTIDP OF        CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Program Last Changed                                         CBLMOVK1
           MOVE ZZPGM OF JOB-CONTEXT TO FBPGMCHG OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Job Last Changed                                             CBLMOVK1
           MOVE ZZJOB OF JOB-CONTEXT TO FBJOBCHG OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    WRK.U:Date = JOB.*System time stamp                          CVTDTMK1
           PERFORM XSTMS                                                CVTDTMK1
           MOVE ZZTMS OF JOB-CONTEXT TO XDITSM                          CVTDTMK1
           MOVE XDITSD TO XDI2DT                                        CVTDTMK1
           PERFORM XCVTE                                                CVTDTMK1
           IF (XDINDT = ZERO) THEN                                      CVTDTMK1
               MOVE ZEROS TO WUDATE OF WORK-CONTEXT                     CVTDTMK1
           ELSE                                                         CVTDTMK1
               SUBTRACT 1000000 FROM XDINDT GIVING WUDATE OF            CVTDTMK1
                 WORK-CONTEXT                                           CVTDTMK1
           END-IF                                                       CVTDTMK1
      *    Cvt DTE to DTX Format                                        MSGACTK2
      *    CASE: PAR.U:Date is < 01/01/40                               MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (WUDATE OF WORK-CONTEXT < 400101) THEN                    CBLIFXK1
      *        CASE: PAR.U:Date is *Zero                                MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (WUDATE OF WORK-CONTEXT = ZEROS) THEN                 CBLIFXK1
      *            U:Date YYYYMMDD                                      CBLMOVK1
                   MOVE ZEROS TO FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R   CBLMOVK1
               ELSE                                                     MSGACTK2
      *            CASE: *OTHERWISE                                     MSGACTK2
      *            U:Date YYYYMMDD                                      CBLADDK1
                   ADD WUDATE OF WORK-CONTEXT, 20000000 GIVING          CBLADDK1
                     FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R               CBLADDK1
               END-IF                                                   MSGACTK2
           ELSE                                                         MSGACTK2
      *        CASE: *OTHERWISE                                         MSGACTK2
      *        U:Date YYYYMMDD                                          CBLADDK1
               ADD WUDATE OF WORK-CONTEXT, 19000000 GIVING FBCRTDTD8 OF CBLADDK1
                 FACTIDP OF FBACTIONL0-R                                CBLADDK1
           END-IF                                                       MSGACTK2
      *    Date Last Changed D8#                                        CBLMOVK1
           MOVE FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R TO FBCHGDT8 OF     CBLMOVK1
             FACTIDP OF FBACTIONL0-R                                    CBLMOVK1
      *    Check for duplicate primary key                              CBLCRTK1
           START FBACTIONL0 KEY = EXTERNALLY-DESCRIBED-KEY              CBLCRTK1
             FORMAT IS 'FACTIDP'                                        CBLCRTK1
           END-START                                                    CBLCRTK1
           IF (NOT C-NO-RECORD) THEN                                    CBLCRTK1
               SET C-INDICATOR-ON(90) TO TRUE                           CBLCRTK1
           ELSE                                                         CBLCRTK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLCRTK1
           END-IF                                                       CBLCRTK1
           IF (C-INDICATOR-ON(90)) THEN                                 CBLCRTK1
               MOVE 'USR6517' TO W0RTN                                  CBLCRTK1
      *        Send message 'FB Action              EX'                 SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'USR6517' TO ZAMSID                                 SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
               GO SA6EXIT                                               CBLCRTK1
           END-IF                                                       CBLCRTK1
      *                                                                 CBLCRTK1
           WRITE FBACTIONL0-R END-WRITE                                 CBLCRTK1
           IF (C-IO-ERR) THEN                                           CBLCRTK1
               SET C-INDICATOR-ON(91) TO TRUE                           CBLCRTK1
           ELSE                                                         CBLCRTK1
               SET C-INDICATOR-OFF(91) TO TRUE                          CBLCRTK1
           END-IF                                                       CBLCRTK1
      *                                                                 CBLCRTK1
           IF (C-INDICATOR-ON(91)) THEN                                 CBLCRTK1
      *        Write error detected                                     CBLCRTK1
               MOVE 'Y2U0004' TO W0RTN                                  CBLCRTK1
           ELSE                                                         CBLCRTK1
      *        DBF write successful                                     CBLCRTK1
               CONTINUE                                                 CBLCRTK1
           END-IF                                                       CBLCRTK1
      *==============================================================   CBLCRTK1
           CONTINUE.                                                    CBLCRTK1
       SA6EXIT.                                                         CBLCRTK1
           EXIT.                                                        CBLCRTK1
      /EJECT                                                            CBLRTVK2
       SA7RVGN SECTION.                                                 CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Rtv all fields - FB Action  *                                CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Initialize return code                                       CBLRTVK2
           MOVE SPACES TO W0RTN                                         CBLRTVK2
      *    Setup key                                                    CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FBFLOPNO OF KRSSA7         CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FBDIDM OF KRSSA7             CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           MOVE Z1ACTDTE OF ZRCDDTL1-WS-O TO FBACTDTE OF KRSSA7         CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           MOVE Z1ACTTIME OF ZRCDDTL1-WS-O TO FBACTTIME OF KRSSA7       CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           MOVE ZDUPGM3 OF ZRCDDTL1-WS-O TO FBPGMNAM OF KRSSA7          CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FBFLOPNO OF EXTSA7                        CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE -999999 TO FBDIDM OF EXTSA7                             CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           MOVE -99999999 TO FBACTDTE OF EXTSA7                         CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           MOVE -999999 TO FBACTTIME OF EXTSA7                          CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           MOVE LOW-VALUES TO FBPGMNAM OF EXTSA7                        CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             KRSSA7 TO                                                  CBLRTVK2
             FACTIDQ OF FBACTIONL1-R                                    CBLRTVK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CBLRTVK2
           READ FBACTIONL1                                              CBLRTVK2
             FORMAT IS 'FACTIDQ'                                        CBLRTVK2
           END-READ                                                     CBLRTVK2
           IF (C-NO-RECORD) THEN                                        CBLRTVK2
               SET C-INDICATOR-ON(90) TO TRUE                           CBLRTVK2
           ELSE                                                         CBLRTVK2
               IF (C-IO-ERR) THEN                                       CBLRTVK2
                   STOP RUN                                             CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-IF                                                       CBLRTVK2
           IF (C-INDICATOR-ON(90)) THEN                                 CBLRTVK2
      *        Data record not found                                    CBLRTVK2
               MOVE 'USR6516' TO W0RTN                                  CBLRTVK2
      *        USER: Processing if Data record not found                MSGACTK2
      *        PAR = CON By name                                        CBLMCXK1
      *        FB Action Status                                         CBLMCXK1
               MOVE SPACES TO YL0002 OF WORK-CONTEXT                    CBLMCXK1
      *        Job Start TS#                                            CBLMCXK1
               MOVE '0001-01-01-00.00.00.000000' TO YN0001 OF           CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job End TS#                                              CBLMCXK1
               MOVE '0001-01-01-00.00.00.000000' TO YN0002 OF           CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Frequency                                             CBLMCXK1
               MOVE SPACES TO YN0003 OF WORK-CONTEXT                    CBLMCXK1
      *        FB Days to Delay                                         CBLMCXK1
               MOVE ZEROS TO YN0004 OF WORK-CONTEXT                     CBLMCXK1
      *        FB Delay incl Non-WrkDays                                CBLMCXK1
               MOVE SPACES TO YN0005 OF WORK-CONTEXT                    CBLMCXK1
      *        Next Program Name                                        CBLMCXK1
               MOVE SPACES TO YN0006 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Date D8#                                          CBLMCXK1
               MOVE ZEROS TO YN0007 OF WORK-CONTEXT                     CBLMCXK1
      *        Create Time                                              CBLMCXK1
               MOVE ZEROS TO YN0008 OF WORK-CONTEXT                     CBLMCXK1
      *        Create User                                              CBLMCXK1
               MOVE SPACES TO YN0009 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Program                                           CBLMCXK1
               MOVE SPACES TO YN0010 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Job                                               CBLMCXK1
               MOVE SPACES TO YN0011 OF WORK-CONTEXT                    CBLMCXK1
      *        Date Last Changed D8#                                    CBLMCXK1
               MOVE ZEROS TO YN0012 OF WORK-CONTEXT                     CBLMCXK1
      *        Time Last Changed                                        CBLMCXK1
               MOVE ZEROS TO YN0013 OF WORK-CONTEXT                     CBLMCXK1
      *        User Last Changed                                        CBLMCXK1
               MOVE SPACES TO YN0014 OF WORK-CONTEXT                    CBLMCXK1
      *        Program Last Changed                                     CBLMCXK1
               MOVE SPACES TO YN0015 OF WORK-CONTEXT                    CBLMCXK1
      *        Job Last Changed                                         CBLMCXK1
               MOVE SPACES TO YN0016 OF WORK-CONTEXT                    CBLMCXK1
               GO SA7EXIT                                               CBLRTVK2
           END-IF                                                       CBLRTVK2
      *                                                                 CBLRTVK2
           IF (C-INDICATOR-OFF(90)) THEN                                CBLRTVK2
      *        USER: Process Data record                                MSGACTK2
      *        PAR = DB1 By name                                        CBLMCXK1
      *        FB Action Status                                         CBLMCXK1
               MOVE FBFBSTS OF FACTIDQ OF FBACTIONL1-R TO YL0002 OF     CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job Start TS#                                            CBLMCXK1
               MOVE FBJOBSTR OF FACTIDQ OF FBACTIONL1-R TO YN0001 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job End TS#                                              CBLMCXK1
               MOVE FBJOBEND OF FACTIDQ OF FBACTIONL1-R TO YN0002 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Frequency                                             CBLMCXK1
               MOVE FBFREQ OF FACTIDQ OF FBACTIONL1-R TO YN0003 OF      CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Days to Delay                                         CBLMCXK1
               MOVE FBDELAY OF FACTIDQ OF FBACTIONL1-R TO YN0004 OF     CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Delay incl Non-WrkDays                                CBLMCXK1
               MOVE FBNONWRK OF FACTIDQ OF FBACTIONL1-R TO YN0005 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Next Program Name                                        CBLMCXK1
               MOVE FBW8CE OF FACTIDQ OF FBACTIONL1-R TO YN0006 OF      CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Date D8#                                          CBLMCXK1
               MOVE FBCRTDTD8 OF FACTIDQ OF FBACTIONL1-R TO YN0007 OF   CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Time                                              CBLMCXK1
               MOVE FBCRTTME OF FACTIDQ OF FBACTIONL1-R TO YN0008 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create User                                              CBLMCXK1
               MOVE FBCRTUSER OF FACTIDQ OF FBACTIONL1-R TO YN0009 OF   CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Program                                           CBLMCXK1
               MOVE FBCRTPGM OF FACTIDQ OF FBACTIONL1-R TO YN0010 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Job                                               CBLMCXK1
               MOVE FBCRTJOB OF FACTIDQ OF FBACTIONL1-R TO YN0011 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Date Last Changed D8#                                    CBLMCXK1
               MOVE FBCHGDT8 OF FACTIDQ OF FBACTIONL1-R TO YN0012 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Time Last Changed                                        CBLMCXK1
               MOVE FBCHGTME OF FACTIDQ OF FBACTIONL1-R TO YN0013 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        User Last Changed                                        CBLMCXK1
               MOVE FBUSERCHGD OF FACTIDQ OF FBACTIONL1-R TO YN0014 OF  CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Program Last Changed                                     CBLMCXK1
               MOVE FBPGMCHG OF FACTIDQ OF FBACTIONL1-R TO YN0015 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job Last Changed                                         CBLMCXK1
               MOVE FBJOBCHG OF FACTIDQ OF FBACTIONL1-R TO YN0016 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
           END-IF                                                       CBLRTVK2
      *==============================================================   CBLRTVK2
           CONTINUE.                                                    CBLRTVK2
       SA7EXIT.                                                         CBLRTVK2
           EXIT.                                                        CBLRTVK2
      /EJECT                                                            CBLCRTK1
       SA8CRRC SECTION.                                                 CBLCRTK1
      *==============================================================   CBLCRTK1
      *    Create FB Action - FB Action  *                              CBLCRTK1
      *==============================================================   CBLCRTK1
      *    Initialize return code                                       CBLCRTK1
           MOVE SPACES TO W0RTN                                         CBLCRTK1
      *                                                                 CBLCRTK1
      *    Move all fields to FACTIDP                                   CBLCRTK1
      *    Fleet Operator Number                                        CBLCRTK1
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FBFLOPNO OF FBACTIONL0-R   CBLCRTK1
      *    FB Month of Parts Data                                       CBLCRTK1
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FBDIDM OF FBACTIONL0-R       CBLCRTK1
      *    FB Action Date                                               CBLCRTK1
           MOVE Z1ACTDTE OF ZRCDDTL1-WS-O TO FBACTDTE OF FBACTIONL0-R   CBLCRTK1
      *    FB Action Time                                               CBLCRTK1
           MOVE Z1ACTTIME OF ZRCDDTL1-WS-O TO FBACTTIME OF FBACTIONL0-R CBLCRTK1
      *    Program Name                                                 CBLCRTK1
           MOVE ZDUPGM4 OF ZRCDDTL1-WS-O TO FBPGMNAM OF FBACTIONL0-R    CBLCRTK1
      *    FB Action Status                                             CBLCRTK1
           MOVE 'R' TO FBFBSTS OF FBACTIONL0-R                          CBLCRTK1
      *    Job Start TS#                                                CBLCRTK1
           MOVE '0001-01-01-00.00.00.00000' TO FBJOBSTR OF FBACTIONL0-R CBLCRTK1
      *    Job End TS#                                                  CBLCRTK1
           MOVE '0001-01-01-00.00.00.00000' TO FBJOBEND OF FBACTIONL0-R CBLCRTK1
      *    FB Frequency                                                 CBLCRTK1
           MOVE 'M' TO FBFREQ OF FBACTIONL0-R                           CBLCRTK1
      *    FB Days to Delay                                             CBLCRTK1
           MOVE ZEROS TO FBDELAY OF FBACTIONL0-R                        CBLCRTK1
      *    FB Delay incl Non-WrkDays                                    CBLCRTK1
           MOVE 'N' TO FBNONWRK OF FBACTIONL0-R                         CBLCRTK1
      *    Next Program Name                                            CBLCRTK1
           MOVE SPACES TO FBW8CE OF FBACTIONL0-R                        CBLCRTK1
      *    Create Date D8#                                              CBLCRTK1
           MOVE ZEROS TO FBCRTDTD8 OF FBACTIONL0-R                      CBLCRTK1
      *    Create Time                                                  CBLCRTK1
           MOVE ZEROS TO FBCRTTME OF FBACTIONL0-R                       CBLCRTK1
      *    Create User                                                  CBLCRTK1
           MOVE SPACES TO FBCRTUSER OF FBACTIONL0-R                     CBLCRTK1
      *    Create Program                                               CBLCRTK1
           MOVE SPACES TO FBCRTPGM OF FBACTIONL0-R                      CBLCRTK1
      *    Create Job                                                   CBLCRTK1
           MOVE SPACES TO FBCRTJOB OF FBACTIONL0-R                      CBLCRTK1
      *    Date Last Changed D8#                                        CBLCRTK1
           MOVE ZEROS TO FBCHGDT8 OF FBACTIONL0-R                       CBLCRTK1
      *    Time Last Changed                                            CBLCRTK1
           MOVE ZEROS TO FBCHGTME OF FBACTIONL0-R                       CBLCRTK1
      *    User Last Changed                                            CBLCRTK1
           MOVE SPACES TO FBUSERCHGD OF FBACTIONL0-R                    CBLCRTK1
      *    Program Last Changed                                         CBLCRTK1
           MOVE SPACES TO FBPGMCHG OF FBACTIONL0-R                      CBLCRTK1
      *    Job Last Changed                                             CBLCRTK1
           MOVE SPACES TO FBJOBCHG OF FBACTIONL0-R                      CBLCRTK1
      *    USER: Processing before Data update                          MSGACTK2
      *    Rtn Update Audit for Crt                                     MSGACTK2
      *    Function details                                             MSGACTK2
      *    CASE: *OTHERWISE                                             MSGACTK2
      *    -------------------------------------------------------------MSGACTK2
      *    Maintenance:-                                                MSGACTK2
      *    07/04/2010  RN-INC-479183         Maurice Mead               MSGACTK2
      *    D8# date now loaded directly from the job date field.        MSGACTK2
      *    -------------------------------------------------------------MSGACTK2
      *    LCL.U:Job date D8# = JOB.*Job date                           CVTDTMK1
           IF (ZZJDT OF JOB-CONTEXT = ZERO) THEN                        CVTDTMK1
               MOVE ZEROS TO YL0001 OF WORK-CONTEXT                     CVTDTMK1
           ELSE                                                         CVTDTMK1
               ADD 19000000 TO ZZJDT OF JOB-CONTEXT GIVING YL0001 OF    CVTDTMK1
                 WORK-CONTEXT                                           CVTDTMK1
           END-IF                                                       CVTDTMK1
      *    Create Time                                                  CBLMOVK1
           MOVE ZZJTM OF JOB-CONTEXT TO FBCRTTME OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create User                                                  CBLMOVK1
           MOVE ZZUSR OF JOB-CONTEXT TO FBCRTUSER OF FACTIDP OF         CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Date D8#                                              CBLMOVK1
           MOVE YL0001 OF WORK-CONTEXT TO FBCRTDTD8 OF FACTIDP OF       CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Program                                               CBLMOVK1
           MOVE ZZPGM OF JOB-CONTEXT TO FBCRTPGM OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Job                                                   CBLMOVK1
           MOVE ZZJOB OF JOB-CONTEXT TO FBCRTJOB OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Date Last Changed D8#                                        CBLMOVK1
           MOVE YL0001 OF WORK-CONTEXT TO FBCHGDT8 OF FACTIDP OF        CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Time Last Changed                                            CBLMOVK1
           MOVE ZZJTM OF JOB-CONTEXT TO FBCHGTME OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    User Last Changed                                            CBLMOVK1
           MOVE ZZUSR OF JOB-CONTEXT TO FBUSERCHGD OF FACTIDP OF        CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Program Last Changed                                         CBLMOVK1
           MOVE ZZPGM OF JOB-CONTEXT TO FBPGMCHG OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Job Last Changed                                             CBLMOVK1
           MOVE ZZJOB OF JOB-CONTEXT TO FBJOBCHG OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    WRK.U:Date = JOB.*System time stamp                          CVTDTMK1
           PERFORM XSTMS                                                CVTDTMK1
           MOVE ZZTMS OF JOB-CONTEXT TO XDITSM                          CVTDTMK1
           MOVE XDITSD TO XDI2DT                                        CVTDTMK1
           PERFORM XCVTE                                                CVTDTMK1
           IF (XDINDT = ZERO) THEN                                      CVTDTMK1
               MOVE ZEROS TO WUDATE OF WORK-CONTEXT                     CVTDTMK1
           ELSE                                                         CVTDTMK1
               SUBTRACT 1000000 FROM XDINDT GIVING WUDATE OF            CVTDTMK1
                 WORK-CONTEXT                                           CVTDTMK1
           END-IF                                                       CVTDTMK1
      *    Cvt DTE to DTX Format                                        MSGACTK2
      *    CASE: PAR.U:Date is < 01/01/40                               MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (WUDATE OF WORK-CONTEXT < 400101) THEN                    CBLIFXK1
      *        CASE: PAR.U:Date is *Zero                                MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (WUDATE OF WORK-CONTEXT = ZEROS) THEN                 CBLIFXK1
      *            U:Date YYYYMMDD                                      CBLMOVK1
                   MOVE ZEROS TO FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R   CBLMOVK1
               ELSE                                                     MSGACTK2
      *            CASE: *OTHERWISE                                     MSGACTK2
      *            U:Date YYYYMMDD                                      CBLADDK1
                   ADD WUDATE OF WORK-CONTEXT, 20000000 GIVING          CBLADDK1
                     FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R               CBLADDK1
               END-IF                                                   MSGACTK2
           ELSE                                                         MSGACTK2
      *        CASE: *OTHERWISE                                         MSGACTK2
      *        U:Date YYYYMMDD                                          CBLADDK1
               ADD WUDATE OF WORK-CONTEXT, 19000000 GIVING FBCRTDTD8 OF CBLADDK1
                 FACTIDP OF FBACTIONL0-R                                CBLADDK1
           END-IF                                                       MSGACTK2
      *    Date Last Changed D8#                                        CBLMOVK1
           MOVE FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R TO FBCHGDT8 OF     CBLMOVK1
             FACTIDP OF FBACTIONL0-R                                    CBLMOVK1
      *    Check for duplicate primary key                              CBLCRTK1
           START FBACTIONL0 KEY = EXTERNALLY-DESCRIBED-KEY              CBLCRTK1
             FORMAT IS 'FACTIDP'                                        CBLCRTK1
           END-START                                                    CBLCRTK1
           IF (NOT C-NO-RECORD) THEN                                    CBLCRTK1
               SET C-INDICATOR-ON(90) TO TRUE                           CBLCRTK1
           ELSE                                                         CBLCRTK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLCRTK1
           END-IF                                                       CBLCRTK1
           IF (C-INDICATOR-ON(90)) THEN                                 CBLCRTK1
               MOVE 'USR6517' TO W0RTN                                  CBLCRTK1
      *        Send message 'FB Action              EX'                 SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'USR6517' TO ZAMSID                                 SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
               GO SA8EXIT                                               CBLCRTK1
           END-IF                                                       CBLCRTK1
      *                                                                 CBLCRTK1
           WRITE FBACTIONL0-R END-WRITE                                 CBLCRTK1
           IF (C-IO-ERR) THEN                                           CBLCRTK1
               SET C-INDICATOR-ON(91) TO TRUE                           CBLCRTK1
           ELSE                                                         CBLCRTK1
               SET C-INDICATOR-OFF(91) TO TRUE                          CBLCRTK1
           END-IF                                                       CBLCRTK1
      *                                                                 CBLCRTK1
           IF (C-INDICATOR-ON(91)) THEN                                 CBLCRTK1
      *        Write error detected                                     CBLCRTK1
               MOVE 'Y2U0004' TO W0RTN                                  CBLCRTK1
           ELSE                                                         CBLCRTK1
      *        DBF write successful                                     CBLCRTK1
               CONTINUE                                                 CBLCRTK1
           END-IF                                                       CBLCRTK1
      *==============================================================   CBLCRTK1
           CONTINUE.                                                    CBLCRTK1
       SA8EXIT.                                                         CBLCRTK1
           EXIT.                                                        CBLCRTK1
      /EJECT                                                            CBLRTVK2
       SA9RVGN SECTION.                                                 CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Rtv all fields - FB Action  *                                CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Initialize return code                                       CBLRTVK2
           MOVE SPACES TO W0RTN                                         CBLRTVK2
      *    Setup key                                                    CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FBFLOPNO OF KRSSA9         CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FBDIDM OF KRSSA9             CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           MOVE Z1ACTDTE OF ZRCDDTL1-WS-O TO FBACTDTE OF KRSSA9         CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           MOVE Z1ACTTIME OF ZRCDDTL1-WS-O TO FBACTTIME OF KRSSA9       CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           MOVE ZDUPGM4 OF ZRCDDTL1-WS-O TO FBPGMNAM OF KRSSA9          CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FBFLOPNO OF EXTSA9                        CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE -999999 TO FBDIDM OF EXTSA9                             CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           MOVE -99999999 TO FBACTDTE OF EXTSA9                         CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           MOVE -999999 TO FBACTTIME OF EXTSA9                          CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           MOVE LOW-VALUES TO FBPGMNAM OF EXTSA9                        CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             KRSSA9 TO                                                  CBLRTVK2
             FACTIDQ OF FBACTIONL1-R                                    CBLRTVK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CBLRTVK2
           READ FBACTIONL1                                              CBLRTVK2
             FORMAT IS 'FACTIDQ'                                        CBLRTVK2
           END-READ                                                     CBLRTVK2
           IF (C-NO-RECORD) THEN                                        CBLRTVK2
               SET C-INDICATOR-ON(90) TO TRUE                           CBLRTVK2
           ELSE                                                         CBLRTVK2
               IF (C-IO-ERR) THEN                                       CBLRTVK2
                   STOP RUN                                             CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-IF                                                       CBLRTVK2
           IF (C-INDICATOR-ON(90)) THEN                                 CBLRTVK2
      *        Data record not found                                    CBLRTVK2
               MOVE 'USR6516' TO W0RTN                                  CBLRTVK2
      *        USER: Processing if Data record not found                MSGACTK2
      *        PAR = CON By name                                        CBLMCXK1
      *        FB Action Status                                         CBLMCXK1
               MOVE SPACES TO YL0002 OF WORK-CONTEXT                    CBLMCXK1
      *        Job Start TS#                                            CBLMCXK1
               MOVE '0001-01-01-00.00.00.000000' TO YN0001 OF           CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job End TS#                                              CBLMCXK1
               MOVE '0001-01-01-00.00.00.000000' TO YN0002 OF           CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Frequency                                             CBLMCXK1
               MOVE SPACES TO YN0003 OF WORK-CONTEXT                    CBLMCXK1
      *        FB Days to Delay                                         CBLMCXK1
               MOVE ZEROS TO YN0004 OF WORK-CONTEXT                     CBLMCXK1
      *        FB Delay incl Non-WrkDays                                CBLMCXK1
               MOVE SPACES TO YN0005 OF WORK-CONTEXT                    CBLMCXK1
      *        Next Program Name                                        CBLMCXK1
               MOVE SPACES TO YN0006 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Date D8#                                          CBLMCXK1
               MOVE ZEROS TO YN0007 OF WORK-CONTEXT                     CBLMCXK1
      *        Create Time                                              CBLMCXK1
               MOVE ZEROS TO YN0008 OF WORK-CONTEXT                     CBLMCXK1
      *        Create User                                              CBLMCXK1
               MOVE SPACES TO YN0009 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Program                                           CBLMCXK1
               MOVE SPACES TO YN0010 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Job                                               CBLMCXK1
               MOVE SPACES TO YN0011 OF WORK-CONTEXT                    CBLMCXK1
      *        Date Last Changed D8#                                    CBLMCXK1
               MOVE ZEROS TO YN0012 OF WORK-CONTEXT                     CBLMCXK1
      *        Time Last Changed                                        CBLMCXK1
               MOVE ZEROS TO YN0013 OF WORK-CONTEXT                     CBLMCXK1
      *        User Last Changed                                        CBLMCXK1
               MOVE SPACES TO YN0014 OF WORK-CONTEXT                    CBLMCXK1
      *        Program Last Changed                                     CBLMCXK1
               MOVE SPACES TO YN0015 OF WORK-CONTEXT                    CBLMCXK1
      *        Job Last Changed                                         CBLMCXK1
               MOVE SPACES TO YN0016 OF WORK-CONTEXT                    CBLMCXK1
               GO SA9EXIT                                               CBLRTVK2
           END-IF                                                       CBLRTVK2
      *                                                                 CBLRTVK2
           IF (C-INDICATOR-OFF(90)) THEN                                CBLRTVK2
      *        USER: Process Data record                                MSGACTK2
      *        PAR = DB1 By name                                        CBLMCXK1
      *        FB Action Status                                         CBLMCXK1
               MOVE FBFBSTS OF FACTIDQ OF FBACTIONL1-R TO YL0002 OF     CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job Start TS#                                            CBLMCXK1
               MOVE FBJOBSTR OF FACTIDQ OF FBACTIONL1-R TO YN0001 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job End TS#                                              CBLMCXK1
               MOVE FBJOBEND OF FACTIDQ OF FBACTIONL1-R TO YN0002 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Frequency                                             CBLMCXK1
               MOVE FBFREQ OF FACTIDQ OF FBACTIONL1-R TO YN0003 OF      CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Days to Delay                                         CBLMCXK1
               MOVE FBDELAY OF FACTIDQ OF FBACTIONL1-R TO YN0004 OF     CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Delay incl Non-WrkDays                                CBLMCXK1
               MOVE FBNONWRK OF FACTIDQ OF FBACTIONL1-R TO YN0005 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Next Program Name                                        CBLMCXK1
               MOVE FBW8CE OF FACTIDQ OF FBACTIONL1-R TO YN0006 OF      CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Date D8#                                          CBLMCXK1
               MOVE FBCRTDTD8 OF FACTIDQ OF FBACTIONL1-R TO YN0007 OF   CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Time                                              CBLMCXK1
               MOVE FBCRTTME OF FACTIDQ OF FBACTIONL1-R TO YN0008 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create User                                              CBLMCXK1
               MOVE FBCRTUSER OF FACTIDQ OF FBACTIONL1-R TO YN0009 OF   CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Program                                           CBLMCXK1
               MOVE FBCRTPGM OF FACTIDQ OF FBACTIONL1-R TO YN0010 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Job                                               CBLMCXK1
               MOVE FBCRTJOB OF FACTIDQ OF FBACTIONL1-R TO YN0011 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Date Last Changed D8#                                    CBLMCXK1
               MOVE FBCHGDT8 OF FACTIDQ OF FBACTIONL1-R TO YN0012 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Time Last Changed                                        CBLMCXK1
               MOVE FBCHGTME OF FACTIDQ OF FBACTIONL1-R TO YN0013 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        User Last Changed                                        CBLMCXK1
               MOVE FBUSERCHGD OF FACTIDQ OF FBACTIONL1-R TO YN0014 OF  CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Program Last Changed                                     CBLMCXK1
               MOVE FBPGMCHG OF FACTIDQ OF FBACTIONL1-R TO YN0015 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job Last Changed                                         CBLMCXK1
               MOVE FBJOBCHG OF FACTIDQ OF FBACTIONL1-R TO YN0016 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
           END-IF                                                       CBLRTVK2
      *==============================================================   CBLRTVK2
           CONTINUE.                                                    CBLRTVK2
       SA9EXIT.                                                         CBLRTVK2
           EXIT.                                                        CBLRTVK2
      /EJECT                                                            CBLRTVK2
       SB1RVGN SECTION.                                                 CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Rtv FB Run Status - FB Run Control  *                        CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Initialize return code                                       CBLRTVK2
           MOVE SPACES TO W0RTN                                         CBLRTVK2
      *    Setup key                                                    CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FDDIDM OF KRSSB1             CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FDFLOPNO OF KRSSB1         CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE -999999 TO FDDIDM OF EXTSB1                             CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FDFLOPNO OF EXTSB1                        CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             EXTSB1 TO                                                  CBLRTVK2
             FRUNCG2 OF FBRUNCONL2-R                                    CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             KRSSB1 TO                                                  CBLRTVK2
             FRUNCG2 OF FBRUNCONL2-R                                    CBLRTVK2
           START FBRUNCONL2 KEY NOT < EXTERNALLY-DESCRIBED-KEY          CBLRTVK2
             FORMAT IS 'FRUNCG2'                                        CBLRTVK2
           END-START                                                    CBLRTVK2
           IF (C-IO-ERR) THEN                                           CBLRTVK2
               STOP RUN                                                 CBLRTVK2
           END-IF                                                       CBLRTVK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CBLRTVK2
           READ FBRUNCONL2 NEXT                                         CBLRTVK2
             FORMAT IS 'FRUNCG2'                                        CBLRTVK2
           END-READ                                                     CBLRTVK2
           IF (C-EOF) THEN                                              CBLRTVK2
               SET C-INDICATOR-ON(90) TO TRUE                           CBLRTVK2
           ELSE                                                         CBLRTVK2
               IF (C-IO-ERR) THEN                                       CBLRTVK2
                   STOP RUN                                             CBLRTVK2
               ELSE                                                     CBLRTVK2
                   MOVE CORRESPONDING                                   CBLRTVK2
                     FRUNCG2 OF FBRUNCONL2-R TO                         CBLRTVK2
                     EXTSB1                                             CBLRTVK2
                   MOVE EXTSB1 TO KRSSB1-TMP                            CBLRTVK2
                   IF (KRSSB1 NOT = KRSSB1-TMP) THEN                    CBLRTVK2
                       SET C-INDICATOR-ON(90) TO TRUE                   CBLRTVK2
                   END-IF                                               CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-IF                                                       CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE -999999 TO FDDIDM OF EXTSB1                             CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FDFLOPNO OF EXTSB1                        CBLRTVK2
           IF (C-INDICATOR-ON(90)) THEN                                 CBLRTVK2
      *        Data record not found                                    CBLRTVK2
               MOVE 'USR6520' TO W0RTN                                  CBLRTVK2
      *        USER: Processing if Data record not found                MSGACTK2
      *        PAR = CON By name                                        CBLMCXK1
      *        FB Run Status                                            CBLMCXK1
               MOVE SPACES TO ZDRUNSTAT OF ZRCDDTL1-WS-O                CBLMCXK1
               GO SB1EXIT                                               CBLRTVK2
           END-IF                                                       CBLRTVK2
      *                                                                 CBLRTVK2
           PERFORM UNTIL NOT (C-INDICATOR-OFF(90))                      CBLRTVK2
      *        USER: Process Data record                                MSGACTK2
      *        PAR = DB1 By name                                        CBLMCXK1
      *        FB Run Status                                            CBLMCXK1
               MOVE FDRUNSTAT OF FRUNCG2 OF FBRUNCONL2-R TO ZDRUNSTAT   CBLMCXK1
                 OF ZRCDDTL1-WS-O                                       CBLMCXK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLRTVK2
               READ FBRUNCONL2 NEXT                                     CBLRTVK2
                 FORMAT IS 'FRUNCG2'                                    CBLRTVK2
               END-READ                                                 CBLRTVK2
               IF (C-EOF) THEN                                          CBLRTVK2
                   SET C-INDICATOR-ON(90) TO TRUE                       CBLRTVK2
               ELSE                                                     CBLRTVK2
                   IF (C-IO-ERR) THEN                                   CBLRTVK2
                       STOP RUN                                         CBLRTVK2
                   ELSE                                                 CBLRTVK2
                       MOVE CORRESPONDING                               CBLRTVK2
                         FRUNCG2 OF FBRUNCONL2-R TO                     CBLRTVK2
                         EXTSB1                                         CBLRTVK2
                       MOVE EXTSB1 TO KRSSB1-TMP                        CBLRTVK2
                       IF (KRSSB1 NOT = KRSSB1-TMP) THEN                CBLRTVK2
                           SET C-INDICATOR-ON(90) TO TRUE               CBLRTVK2
                       END-IF                                           CBLRTVK2
                   END-IF                                               CBLRTVK2
               END-IF                                                   CBLRTVK2
      *        Initialise Full Externally Described Keylist             CBLRTVK2
      *        FB Month of Parts Data                                   CBLRTVK2
               MOVE -999999 TO FDDIDM OF EXTSB1                         CBLRTVK2
      *        Fleet Operator Number                                    CBLRTVK2
               MOVE LOW-VALUES TO FDFLOPNO OF EXTSB1                    CBLRTVK2
           END-PERFORM                                                  CBLRTVK2
      *==============================================================   CBLRTVK2
           CONTINUE.                                                    CBLRTVK2
       SB1EXIT.                                                         CBLRTVK2
           EXIT.                                                        CBLRTVK2
      /EJECT                                                            CBLCRTK1
       SB2CRRC SECTION.                                                 CBLCRTK1
      *==============================================================   CBLCRTK1
      *    Create FB Action - FB Action  *                              CBLCRTK1
      *==============================================================   CBLCRTK1
      *    Initialize return code                                       CBLCRTK1
           MOVE SPACES TO W0RTN                                         CBLCRTK1
      *                                                                 CBLCRTK1
      *    Move all fields to FACTIDP                                   CBLCRTK1
      *    Fleet Operator Number                                        CBLCRTK1
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FBFLOPNO OF FBACTIONL0-R   CBLCRTK1
      *    FB Month of Parts Data                                       CBLCRTK1
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FBDIDM OF FBACTIONL0-R       CBLCRTK1
      *    FB Action Date                                               CBLCRTK1
           MOVE Z1ACTDTE OF ZRCDDTL1-WS-O TO FBACTDTE OF FBACTIONL0-R   CBLCRTK1
      *    FB Action Time                                               CBLCRTK1
           MOVE Z1ACTTIME OF ZRCDDTL1-WS-O TO FBACTTIME OF FBACTIONL0-R CBLCRTK1
      *    Program Name                                                 CBLCRTK1
           MOVE ZDUPGM5 OF ZRCDDTL1-WS-O TO FBPGMNAM OF FBACTIONL0-R    CBLCRTK1
      *    FB Action Status                                             CBLCRTK1
           MOVE 'R' TO FBFBSTS OF FBACTIONL0-R                          CBLCRTK1
      *    Job Start TS#                                                CBLCRTK1
           MOVE '0001-01-01-00.00.00.00000' TO FBJOBSTR OF FBACTIONL0-R CBLCRTK1
      *    Job End TS#                                                  CBLCRTK1
           MOVE '0001-01-01-00.00.00.00000' TO FBJOBEND OF FBACTIONL0-R CBLCRTK1
      *    FB Frequency                                                 CBLCRTK1
           MOVE 'M' TO FBFREQ OF FBACTIONL0-R                           CBLCRTK1
      *    FB Days to Delay                                             CBLCRTK1
           MOVE ZEROS TO FBDELAY OF FBACTIONL0-R                        CBLCRTK1
      *    FB Delay incl Non-WrkDays                                    CBLCRTK1
           MOVE 'N' TO FBNONWRK OF FBACTIONL0-R                         CBLCRTK1
      *    Next Program Name                                            CBLCRTK1
           MOVE SPACES TO FBW8CE OF FBACTIONL0-R                        CBLCRTK1
      *    Create Date D8#                                              CBLCRTK1
           MOVE ZEROS TO FBCRTDTD8 OF FBACTIONL0-R                      CBLCRTK1
      *    Create Time                                                  CBLCRTK1
           MOVE ZEROS TO FBCRTTME OF FBACTIONL0-R                       CBLCRTK1
      *    Create User                                                  CBLCRTK1
           MOVE SPACES TO FBCRTUSER OF FBACTIONL0-R                     CBLCRTK1
      *    Create Program                                               CBLCRTK1
           MOVE SPACES TO FBCRTPGM OF FBACTIONL0-R                      CBLCRTK1
      *    Create Job                                                   CBLCRTK1
           MOVE SPACES TO FBCRTJOB OF FBACTIONL0-R                      CBLCRTK1
      *    Date Last Changed D8#                                        CBLCRTK1
           MOVE ZEROS TO FBCHGDT8 OF FBACTIONL0-R                       CBLCRTK1
      *    Time Last Changed                                            CBLCRTK1
           MOVE ZEROS TO FBCHGTME OF FBACTIONL0-R                       CBLCRTK1
      *    User Last Changed                                            CBLCRTK1
           MOVE SPACES TO FBUSERCHGD OF FBACTIONL0-R                    CBLCRTK1
      *    Program Last Changed                                         CBLCRTK1
           MOVE SPACES TO FBPGMCHG OF FBACTIONL0-R                      CBLCRTK1
      *    Job Last Changed                                             CBLCRTK1
           MOVE SPACES TO FBJOBCHG OF FBACTIONL0-R                      CBLCRTK1
      *    USER: Processing before Data update                          MSGACTK2
      *    Rtn Update Audit for Crt                                     MSGACTK2
      *    Function details                                             MSGACTK2
      *    CASE: *OTHERWISE                                             MSGACTK2
      *    -------------------------------------------------------------MSGACTK2
      *    Maintenance:-                                                MSGACTK2
      *    07/04/2010  RN-INC-479183         Maurice Mead               MSGACTK2
      *    D8# date now loaded directly from the job date field.        MSGACTK2
      *    -------------------------------------------------------------MSGACTK2
      *    LCL.U:Job date D8# = JOB.*Job date                           CVTDTMK1
           IF (ZZJDT OF JOB-CONTEXT = ZERO) THEN                        CVTDTMK1
               MOVE ZEROS TO YL0001 OF WORK-CONTEXT                     CVTDTMK1
           ELSE                                                         CVTDTMK1
               ADD 19000000 TO ZZJDT OF JOB-CONTEXT GIVING YL0001 OF    CVTDTMK1
                 WORK-CONTEXT                                           CVTDTMK1
           END-IF                                                       CVTDTMK1
      *    Create Time                                                  CBLMOVK1
           MOVE ZZJTM OF JOB-CONTEXT TO FBCRTTME OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create User                                                  CBLMOVK1
           MOVE ZZUSR OF JOB-CONTEXT TO FBCRTUSER OF FACTIDP OF         CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Date D8#                                              CBLMOVK1
           MOVE YL0001 OF WORK-CONTEXT TO FBCRTDTD8 OF FACTIDP OF       CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Program                                               CBLMOVK1
           MOVE ZZPGM OF JOB-CONTEXT TO FBCRTPGM OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Create Job                                                   CBLMOVK1
           MOVE ZZJOB OF JOB-CONTEXT TO FBCRTJOB OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Date Last Changed D8#                                        CBLMOVK1
           MOVE YL0001 OF WORK-CONTEXT TO FBCHGDT8 OF FACTIDP OF        CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Time Last Changed                                            CBLMOVK1
           MOVE ZZJTM OF JOB-CONTEXT TO FBCHGTME OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    User Last Changed                                            CBLMOVK1
           MOVE ZZUSR OF JOB-CONTEXT TO FBUSERCHGD OF FACTIDP OF        CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Program Last Changed                                         CBLMOVK1
           MOVE ZZPGM OF JOB-CONTEXT TO FBPGMCHG OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    Job Last Changed                                             CBLMOVK1
           MOVE ZZJOB OF JOB-CONTEXT TO FBJOBCHG OF FACTIDP OF          CBLMOVK1
             FBACTIONL0-R                                               CBLMOVK1
      *    WRK.U:Date = JOB.*System time stamp                          CVTDTMK1
           PERFORM XSTMS                                                CVTDTMK1
           MOVE ZZTMS OF JOB-CONTEXT TO XDITSM                          CVTDTMK1
           MOVE XDITSD TO XDI2DT                                        CVTDTMK1
           PERFORM XCVTE                                                CVTDTMK1
           IF (XDINDT = ZERO) THEN                                      CVTDTMK1
               MOVE ZEROS TO WUDATE OF WORK-CONTEXT                     CVTDTMK1
           ELSE                                                         CVTDTMK1
               SUBTRACT 1000000 FROM XDINDT GIVING WUDATE OF            CVTDTMK1
                 WORK-CONTEXT                                           CVTDTMK1
           END-IF                                                       CVTDTMK1
      *    Cvt DTE to DTX Format                                        MSGACTK2
      *    CASE: PAR.U:Date is < 01/01/40                               MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (WUDATE OF WORK-CONTEXT < 400101) THEN                    CBLIFXK1
      *        CASE: PAR.U:Date is *Zero                                MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (WUDATE OF WORK-CONTEXT = ZEROS) THEN                 CBLIFXK1
      *            U:Date YYYYMMDD                                      CBLMOVK1
                   MOVE ZEROS TO FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R   CBLMOVK1
               ELSE                                                     MSGACTK2
      *            CASE: *OTHERWISE                                     MSGACTK2
      *            U:Date YYYYMMDD                                      CBLADDK1
                   ADD WUDATE OF WORK-CONTEXT, 20000000 GIVING          CBLADDK1
                     FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R               CBLADDK1
               END-IF                                                   MSGACTK2
           ELSE                                                         MSGACTK2
      *        CASE: *OTHERWISE                                         MSGACTK2
      *        U:Date YYYYMMDD                                          CBLADDK1
               ADD WUDATE OF WORK-CONTEXT, 19000000 GIVING FBCRTDTD8 OF CBLADDK1
                 FACTIDP OF FBACTIONL0-R                                CBLADDK1
           END-IF                                                       MSGACTK2
      *    Date Last Changed D8#                                        CBLMOVK1
           MOVE FBCRTDTD8 OF FACTIDP OF FBACTIONL0-R TO FBCHGDT8 OF     CBLMOVK1
             FACTIDP OF FBACTIONL0-R                                    CBLMOVK1
      *    Check for duplicate primary key                              CBLCRTK1
           START FBACTIONL0 KEY = EXTERNALLY-DESCRIBED-KEY              CBLCRTK1
             FORMAT IS 'FACTIDP'                                        CBLCRTK1
           END-START                                                    CBLCRTK1
           IF (NOT C-NO-RECORD) THEN                                    CBLCRTK1
               SET C-INDICATOR-ON(90) TO TRUE                           CBLCRTK1
           ELSE                                                         CBLCRTK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLCRTK1
           END-IF                                                       CBLCRTK1
           IF (C-INDICATOR-ON(90)) THEN                                 CBLCRTK1
               MOVE 'USR6517' TO W0RTN                                  CBLCRTK1
      *        Send message 'FB Action              EX'                 SNDMSGK1
      *        Message ID                                               SNDMSGK1
               MOVE 'USR6517' TO ZAMSID                                 SNDMSGK1
               PERFORM ZASNMS                                           SNDMSGK1
               GO SB2EXIT                                               CBLCRTK1
           END-IF                                                       CBLCRTK1
      *                                                                 CBLCRTK1
           WRITE FBACTIONL0-R END-WRITE                                 CBLCRTK1
           IF (C-IO-ERR) THEN                                           CBLCRTK1
               SET C-INDICATOR-ON(91) TO TRUE                           CBLCRTK1
           ELSE                                                         CBLCRTK1
               SET C-INDICATOR-OFF(91) TO TRUE                          CBLCRTK1
           END-IF                                                       CBLCRTK1
      *                                                                 CBLCRTK1
           IF (C-INDICATOR-ON(91)) THEN                                 CBLCRTK1
      *        Write error detected                                     CBLCRTK1
               MOVE 'Y2U0004' TO W0RTN                                  CBLCRTK1
           ELSE                                                         CBLCRTK1
      *        DBF write successful                                     CBLCRTK1
               CONTINUE                                                 CBLCRTK1
           END-IF                                                       CBLCRTK1
      *==============================================================   CBLCRTK1
           CONTINUE.                                                    CBLCRTK1
       SB2EXIT.                                                         CBLCRTK1
           EXIT.                                                        CBLCRTK1
      /EJECT                                                            CBLRTVK2
       SB3RVGN SECTION.                                                 CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Rtv all fields - FB Action  *                                CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Initialize return code                                       CBLRTVK2
           MOVE SPACES TO W0RTN                                         CBLRTVK2
      *    Setup key                                                    CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FBFLOPNO OF KRSSB3         CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FBDIDM OF KRSSB3             CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           MOVE Z1ACTDTE OF ZRCDDTL1-WS-O TO FBACTDTE OF KRSSB3         CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           MOVE Z1ACTTIME OF ZRCDDTL1-WS-O TO FBACTTIME OF KRSSB3       CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           MOVE ZDUPGM5 OF ZRCDDTL1-WS-O TO FBPGMNAM OF KRSSB3          CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FBFLOPNO OF EXTSB3                        CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE -999999 TO FBDIDM OF EXTSB3                             CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           MOVE -99999999 TO FBACTDTE OF EXTSB3                         CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           MOVE -999999 TO FBACTTIME OF EXTSB3                          CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           MOVE LOW-VALUES TO FBPGMNAM OF EXTSB3                        CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             KRSSB3 TO                                                  CBLRTVK2
             FACTIDQ OF FBACTIONL1-R                                    CBLRTVK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CBLRTVK2
           READ FBACTIONL1                                              CBLRTVK2
             FORMAT IS 'FACTIDQ'                                        CBLRTVK2
           END-READ                                                     CBLRTVK2
           IF (C-NO-RECORD) THEN                                        CBLRTVK2
               SET C-INDICATOR-ON(90) TO TRUE                           CBLRTVK2
           ELSE                                                         CBLRTVK2
               IF (C-IO-ERR) THEN                                       CBLRTVK2
                   STOP RUN                                             CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-IF                                                       CBLRTVK2
           IF (C-INDICATOR-ON(90)) THEN                                 CBLRTVK2
      *        Data record not found                                    CBLRTVK2
               MOVE 'USR6516' TO W0RTN                                  CBLRTVK2
      *        USER: Processing if Data record not found                MSGACTK2
      *        PAR = CON By name                                        CBLMCXK1
      *        FB Action Status                                         CBLMCXK1
               MOVE SPACES TO YL0002 OF WORK-CONTEXT                    CBLMCXK1
      *        Job Start TS#                                            CBLMCXK1
               MOVE '0001-01-01-00.00.00.000000' TO YN0001 OF           CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job End TS#                                              CBLMCXK1
               MOVE '0001-01-01-00.00.00.000000' TO YN0002 OF           CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Frequency                                             CBLMCXK1
               MOVE SPACES TO YN0003 OF WORK-CONTEXT                    CBLMCXK1
      *        FB Days to Delay                                         CBLMCXK1
               MOVE ZEROS TO YN0004 OF WORK-CONTEXT                     CBLMCXK1
      *        FB Delay incl Non-WrkDays                                CBLMCXK1
               MOVE SPACES TO YN0005 OF WORK-CONTEXT                    CBLMCXK1
      *        Next Program Name                                        CBLMCXK1
               MOVE SPACES TO YN0006 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Date D8#                                          CBLMCXK1
               MOVE ZEROS TO YN0007 OF WORK-CONTEXT                     CBLMCXK1
      *        Create Time                                              CBLMCXK1
               MOVE ZEROS TO YN0008 OF WORK-CONTEXT                     CBLMCXK1
      *        Create User                                              CBLMCXK1
               MOVE SPACES TO YN0009 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Program                                           CBLMCXK1
               MOVE SPACES TO YN0010 OF WORK-CONTEXT                    CBLMCXK1
      *        Create Job                                               CBLMCXK1
               MOVE SPACES TO YN0011 OF WORK-CONTEXT                    CBLMCXK1
      *        Date Last Changed D8#                                    CBLMCXK1
               MOVE ZEROS TO YN0012 OF WORK-CONTEXT                     CBLMCXK1
      *        Time Last Changed                                        CBLMCXK1
               MOVE ZEROS TO YN0013 OF WORK-CONTEXT                     CBLMCXK1
      *        User Last Changed                                        CBLMCXK1
               MOVE SPACES TO YN0014 OF WORK-CONTEXT                    CBLMCXK1
      *        Program Last Changed                                     CBLMCXK1
               MOVE SPACES TO YN0015 OF WORK-CONTEXT                    CBLMCXK1
      *        Job Last Changed                                         CBLMCXK1
               MOVE SPACES TO YN0016 OF WORK-CONTEXT                    CBLMCXK1
               GO SB3EXIT                                               CBLRTVK2
           END-IF                                                       CBLRTVK2
      *                                                                 CBLRTVK2
           IF (C-INDICATOR-OFF(90)) THEN                                CBLRTVK2
      *        USER: Process Data record                                MSGACTK2
      *        PAR = DB1 By name                                        CBLMCXK1
      *        FB Action Status                                         CBLMCXK1
               MOVE FBFBSTS OF FACTIDQ OF FBACTIONL1-R TO YL0002 OF     CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job Start TS#                                            CBLMCXK1
               MOVE FBJOBSTR OF FACTIDQ OF FBACTIONL1-R TO YN0001 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job End TS#                                              CBLMCXK1
               MOVE FBJOBEND OF FACTIDQ OF FBACTIONL1-R TO YN0002 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Frequency                                             CBLMCXK1
               MOVE FBFREQ OF FACTIDQ OF FBACTIONL1-R TO YN0003 OF      CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Days to Delay                                         CBLMCXK1
               MOVE FBDELAY OF FACTIDQ OF FBACTIONL1-R TO YN0004 OF     CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        FB Delay incl Non-WrkDays                                CBLMCXK1
               MOVE FBNONWRK OF FACTIDQ OF FBACTIONL1-R TO YN0005 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Next Program Name                                        CBLMCXK1
               MOVE FBW8CE OF FACTIDQ OF FBACTIONL1-R TO YN0006 OF      CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Date D8#                                          CBLMCXK1
               MOVE FBCRTDTD8 OF FACTIDQ OF FBACTIONL1-R TO YN0007 OF   CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Time                                              CBLMCXK1
               MOVE FBCRTTME OF FACTIDQ OF FBACTIONL1-R TO YN0008 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create User                                              CBLMCXK1
               MOVE FBCRTUSER OF FACTIDQ OF FBACTIONL1-R TO YN0009 OF   CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Program                                           CBLMCXK1
               MOVE FBCRTPGM OF FACTIDQ OF FBACTIONL1-R TO YN0010 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Create Job                                               CBLMCXK1
               MOVE FBCRTJOB OF FACTIDQ OF FBACTIONL1-R TO YN0011 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Date Last Changed D8#                                    CBLMCXK1
               MOVE FBCHGDT8 OF FACTIDQ OF FBACTIONL1-R TO YN0012 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Time Last Changed                                        CBLMCXK1
               MOVE FBCHGTME OF FACTIDQ OF FBACTIONL1-R TO YN0013 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        User Last Changed                                        CBLMCXK1
               MOVE FBUSERCHGD OF FACTIDQ OF FBACTIONL1-R TO YN0014 OF  CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Program Last Changed                                     CBLMCXK1
               MOVE FBPGMCHG OF FACTIDQ OF FBACTIONL1-R TO YN0015 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        Job Last Changed                                         CBLMCXK1
               MOVE FBJOBCHG OF FACTIDQ OF FBACTIONL1-R TO YN0016 OF    CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
           END-IF                                                       CBLRTVK2
      *==============================================================   CBLRTVK2
           CONTINUE.                                                    CBLRTVK2
       SB3EXIT.                                                         CBLRTVK2
           EXIT.                                                        CBLRTVK2
      /EJECT                                                            CBLRTVK2
       SB4RVGN SECTION.                                                 CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Rtv FB Run Status - FB Run Control  *                        CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Initialize return code                                       CBLRTVK2
           MOVE SPACES TO W0RTN                                         CBLRTVK2
      *    Setup key                                                    CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FDDIDM OF KRSSB4             CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FDFLOPNO OF KRSSB4         CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE -999999 TO FDDIDM OF EXTSB4                             CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FDFLOPNO OF EXTSB4                        CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             EXTSB4 TO                                                  CBLRTVK2
             FRUNCG2 OF FBRUNCONL2-R                                    CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             KRSSB4 TO                                                  CBLRTVK2
             FRUNCG2 OF FBRUNCONL2-R                                    CBLRTVK2
           START FBRUNCONL2 KEY NOT < EXTERNALLY-DESCRIBED-KEY          CBLRTVK2
             FORMAT IS 'FRUNCG2'                                        CBLRTVK2
           END-START                                                    CBLRTVK2
           IF (C-IO-ERR) THEN                                           CBLRTVK2
               STOP RUN                                                 CBLRTVK2
           END-IF                                                       CBLRTVK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CBLRTVK2
           READ FBRUNCONL2 NEXT                                         CBLRTVK2
             FORMAT IS 'FRUNCG2'                                        CBLRTVK2
           END-READ                                                     CBLRTVK2
           IF (C-EOF) THEN                                              CBLRTVK2
               SET C-INDICATOR-ON(90) TO TRUE                           CBLRTVK2
           ELSE                                                         CBLRTVK2
               IF (C-IO-ERR) THEN                                       CBLRTVK2
                   STOP RUN                                             CBLRTVK2
               ELSE                                                     CBLRTVK2
                   MOVE CORRESPONDING                                   CBLRTVK2
                     FRUNCG2 OF FBRUNCONL2-R TO                         CBLRTVK2
                     EXTSB4                                             CBLRTVK2
                   MOVE EXTSB4 TO KRSSB4-TMP                            CBLRTVK2
                   IF (KRSSB4 NOT = KRSSB4-TMP) THEN                    CBLRTVK2
                       SET C-INDICATOR-ON(90) TO TRUE                   CBLRTVK2
                   END-IF                                               CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-IF                                                       CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE -999999 TO FDDIDM OF EXTSB4                             CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FDFLOPNO OF EXTSB4                        CBLRTVK2
           IF (C-INDICATOR-ON(90)) THEN                                 CBLRTVK2
      *        Data record not found                                    CBLRTVK2
               MOVE 'USR6520' TO W0RTN                                  CBLRTVK2
      *        USER: Processing if Data record not found                MSGACTK2
      *        PAR = CON By name                                        CBLMCXK1
      *        FB Run Status                                            CBLMCXK1
               MOVE SPACES TO ZDRUNSTAT OF ZRCDDTL1-WS-O                CBLMCXK1
               GO SB4EXIT                                               CBLRTVK2
           END-IF                                                       CBLRTVK2
      *                                                                 CBLRTVK2
           PERFORM UNTIL NOT (C-INDICATOR-OFF(90))                      CBLRTVK2
      *        USER: Process Data record                                MSGACTK2
      *        PAR = DB1 By name                                        CBLMCXK1
      *        FB Run Status                                            CBLMCXK1
               MOVE FDRUNSTAT OF FRUNCG2 OF FBRUNCONL2-R TO ZDRUNSTAT   CBLMCXK1
                 OF ZRCDDTL1-WS-O                                       CBLMCXK1
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLRTVK2
               READ FBRUNCONL2 NEXT                                     CBLRTVK2
                 FORMAT IS 'FRUNCG2'                                    CBLRTVK2
               END-READ                                                 CBLRTVK2
               IF (C-EOF) THEN                                          CBLRTVK2
                   SET C-INDICATOR-ON(90) TO TRUE                       CBLRTVK2
               ELSE                                                     CBLRTVK2
                   IF (C-IO-ERR) THEN                                   CBLRTVK2
                       STOP RUN                                         CBLRTVK2
                   ELSE                                                 CBLRTVK2
                       MOVE CORRESPONDING                               CBLRTVK2
                         FRUNCG2 OF FBRUNCONL2-R TO                     CBLRTVK2
                         EXTSB4                                         CBLRTVK2
                       MOVE EXTSB4 TO KRSSB4-TMP                        CBLRTVK2
                       IF (KRSSB4 NOT = KRSSB4-TMP) THEN                CBLRTVK2
                           SET C-INDICATOR-ON(90) TO TRUE               CBLRTVK2
                       END-IF                                           CBLRTVK2
                   END-IF                                               CBLRTVK2
               END-IF                                                   CBLRTVK2
      *        Initialise Full Externally Described Keylist             CBLRTVK2
      *        FB Month of Parts Data                                   CBLRTVK2
               MOVE -999999 TO FDDIDM OF EXTSB4                         CBLRTVK2
      *        Fleet Operator Number                                    CBLRTVK2
               MOVE LOW-VALUES TO FDFLOPNO OF EXTSB4                    CBLRTVK2
           END-PERFORM                                                  CBLRTVK2
      *==============================================================   CBLRTVK2
           CONTINUE.                                                    CBLRTVK2
       SB4EXIT.                                                         CBLRTVK2
           EXIT.                                                        CBLRTVK2
      /EJECT                                                            CBLRTVK2
       SB5RVGN SECTION.                                                 CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Chk actions ready to prc - FB Action  *                      CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Initialize return code                                       CBLRTVK2
           MOVE SPACES TO W0RTN                                         CBLRTVK2
      *    Setup key                                                    CBLRTVK2
      *    FB Action Status                                             CBLRTVK2
           MOVE 'R' TO FBFBSTS OF KRSSB5                                CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    FB Action Status                                             CBLRTVK2
           MOVE LOW-VALUES TO FBFBSTS OF EXTSB5                         CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           MOVE -99999999 TO FBACTDTE OF EXTSB5                         CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           MOVE -999999 TO FBACTTIME OF EXTSB5                          CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FBFLOPNO OF EXTSB5                        CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           MOVE LOW-VALUES TO FBPGMNAM OF EXTSB5                        CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             EXTSB5 TO                                                  CBLRTVK2
             FACTID6 OF FBACTIONL2-R                                    CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             KRSSB5 TO                                                  CBLRTVK2
             FACTID6 OF FBACTIONL2-R                                    CBLRTVK2
           START FBACTIONL2 KEY NOT < EXTERNALLY-DESCRIBED-KEY          CBLRTVK2
             FORMAT IS 'FACTID6'                                        CBLRTVK2
           END-START                                                    CBLRTVK2
           IF (C-IO-ERR) THEN                                           CBLRTVK2
               STOP RUN                                                 CBLRTVK2
           END-IF                                                       CBLRTVK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CBLRTVK2
           READ FBACTIONL2 NEXT                                         CBLRTVK2
             FORMAT IS 'FACTID6'                                        CBLRTVK2
           END-READ                                                     CBLRTVK2
           IF (C-EOF) THEN                                              CBLRTVK2
               SET C-INDICATOR-ON(90) TO TRUE                           CBLRTVK2
           ELSE                                                         CBLRTVK2
               IF (C-IO-ERR) THEN                                       CBLRTVK2
                   STOP RUN                                             CBLRTVK2
               ELSE                                                     CBLRTVK2
                   MOVE CORRESPONDING                                   CBLRTVK2
                     FACTID6 OF FBACTIONL2-R TO                         CBLRTVK2
                     EXTSB5                                             CBLRTVK2
                   MOVE EXTSB5 TO KRSSB5-TMP                            CBLRTVK2
                   IF (KRSSB5 NOT = KRSSB5-TMP) THEN                    CBLRTVK2
                       SET C-INDICATOR-ON(90) TO TRUE                   CBLRTVK2
                   END-IF                                               CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-IF                                                       CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    FB Action Status                                             CBLRTVK2
           MOVE LOW-VALUES TO FBFBSTS OF EXTSB5                         CBLRTVK2
      *    FB Action Date                                               CBLRTVK2
           MOVE -99999999 TO FBACTDTE OF EXTSB5                         CBLRTVK2
      *    FB Action Time                                               CBLRTVK2
           MOVE -999999 TO FBACTTIME OF EXTSB5                          CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FBFLOPNO OF EXTSB5                        CBLRTVK2
      *    Program Name                                                 CBLRTVK2
           MOVE LOW-VALUES TO FBPGMNAM OF EXTSB5                        CBLRTVK2
           IF (C-INDICATOR-ON(90)) THEN                                 CBLRTVK2
      *        Data record not found                                    CBLRTVK2
               MOVE 'USR6516' TO W0RTN                                  CBLRTVK2
           END-IF                                                       CBLRTVK2
      *==============================================================   CBLRTVK2
           CONTINUE.                                                    CBLRTVK2
       SB5EXIT.                                                         CBLRTVK2
           EXIT.                                                        CBLRTVK2
      /EJECT                                                            CBLRTVK2
       SB6RVGN SECTION.                                                 CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Rtv Fleet Operator A/C - FB Fleet Operator Account  *        CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Initialize return code                                       CBLRTVK2
           MOVE SPACES TO W0RTN                                         CBLRTVK2
      *    Setup key                                                    CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO GTFLOPNO OF KRSSB6         CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO GTFLOPNO OF EXTSB6                        CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             KRSSB6 TO                                                  CBLRTVK2
             FBFLTACCF1 OF FBFLTACCL1-R                                 CBLRTVK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CBLRTVK2
           READ FBFLTACCL1                                              CBLRTVK2
             FORMAT IS 'FBFLTACCF1'                                     CBLRTVK2
           END-READ                                                     CBLRTVK2
           IF (C-NO-RECORD) THEN                                        CBLRTVK2
               SET C-INDICATOR-ON(90) TO TRUE                           CBLRTVK2
           ELSE                                                         CBLRTVK2
               IF (C-IO-ERR) THEN                                       CBLRTVK2
                   STOP RUN                                             CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-IF                                                       CBLRTVK2
           IF (C-INDICATOR-ON(90)) THEN                                 CBLRTVK2
      *        Data record not found                                    CBLRTVK2
               MOVE 'USR6670' TO W0RTN                                  CBLRTVK2
      *        USER: Processing if Data record not found                MSGACTK2
      *        PAR = CON By name                                        CBLMCXK1
      *        Fleet Operator Short Name                                CBLMCXK1
               MOVE SPACES TO ZDCMPNYNM OF ZRCDDTL1-WS-O                CBLMCXK1
      *        Account Number                                           CBLMCXK1
               MOVE ZEROS TO YN0017 OF WORK-CONTEXT                     CBLMCXK1
      *        SAP Tax Code                                             CBLMCXK1
               MOVE SPACES TO YN0018 OF WORK-CONTEXT                    CBLMCXK1
      *        Active Status(Y/N)                                       CBLMCXK1
               MOVE SPACES TO YN0019 OF WORK-CONTEXT                    CBLMCXK1
               GO SB6EXIT                                               CBLRTVK2
           END-IF                                                       CBLRTVK2
      *                                                                 CBLRTVK2
           IF (C-INDICATOR-OFF(90)) THEN                                CBLRTVK2
      *        USER: Process Data record                                MSGACTK2
      *        PAR = DB1 By name                                        CBLMCXK1
      *        Fleet Operator Short Name                                CBLMCXK1
               MOVE GTFLSHNM OF FBFLTACCF1 OF FBFLTACCL1-R TO ZDCMPNYNM CBLMCXK1
                 OF ZRCDDTL1-WS-O                                       CBLMCXK1
      *        Account Number                                           CBLMCXK1
               MOVE GTACCNBR OF FBFLTACCF1 OF FBFLTACCL1-R TO YN0017 OF CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
      *        SAP Tax Code                                             CBLMCXK1
               MOVE GTSAPTAXCD OF FBFLTACCF1 OF FBFLTACCL1-R TO YN0018  CBLMCXK1
                 OF WORK-CONTEXT                                        CBLMCXK1
      *        Active Status(Y/N)                                       CBLMCXK1
               MOVE GTACTSTS OF FBFLTACCF1 OF FBFLTACCL1-R TO YN0019 OF CBLMCXK1
                 WORK-CONTEXT                                           CBLMCXK1
           END-IF                                                       CBLRTVK2
      *==============================================================   CBLRTVK2
           CONTINUE.                                                    CBLRTVK2
       SB6EXIT.                                                         CBLRTVK2
           EXIT.                                                        CBLRTVK2
      /EJECT                                                            CBLRTVK2
       SB7RVGN SECTION.                                                 CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Rtv current month - FB Run Control  *                        CBLRTVK2
      *==============================================================   CBLRTVK2
      *    Initialize return code                                       CBLRTVK2
           MOVE SPACES TO W0RTN                                         CBLRTVK2
      *    USER: Initialize routine                                     MSGACTK2
      *    U:Month of Parts Data                                        CBLMOVK1
           MOVE ZEROS TO Z1DIDM OF ZRCDDTL1-WS-O                        CBLMOVK1
      *    Setup key                                                    CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE 999912 TO FDDIDM OF KPSSB7                              CBLRTVK2
      *    Initialise Full Externally Described Keylist                 CBLRTVK2
      *    FB Month of Parts Data                                       CBLRTVK2
           MOVE 999999 TO FDDIDM OF EXTSB7                              CBLRTVK2
      *    Fleet Operator Number                                        CBLRTVK2
           MOVE LOW-VALUES TO FDFLOPNO OF EXTSB7                        CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             EXTSB7 TO                                                  CBLRTVK2
             FRUNCK6 OF FBRUNCONL3-R                                    CBLRTVK2
           MOVE CORRESPONDING                                           CBLRTVK2
             KPSSB7 TO                                                  CBLRTVK2
             FRUNCK6 OF FBRUNCONL3-R                                    CBLRTVK2
           START FBRUNCONL3 KEY NOT < EXTERNALLY-DESCRIBED-KEY          CBLRTVK2
             FORMAT IS 'FRUNCK6'                                        CBLRTVK2
           END-START                                                    CBLRTVK2
           IF (C-IO-ERR) THEN                                           CBLRTVK2
               STOP RUN                                                 CBLRTVK2
           END-IF                                                       CBLRTVK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CBLRTVK2
           READ FBRUNCONL3 NEXT                                         CBLRTVK2
             FORMAT IS 'FRUNCK6'                                        CBLRTVK2
           END-READ                                                     CBLRTVK2
           IF (C-EOF) THEN                                              CBLRTVK2
               SET C-INDICATOR-ON(90) TO TRUE                           CBLRTVK2
           ELSE                                                         CBLRTVK2
               IF (C-IO-ERR) THEN                                       CBLRTVK2
                   STOP RUN                                             CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-IF                                                       CBLRTVK2
           IF (C-INDICATOR-ON(90)) THEN                                 CBLRTVK2
      *        Data record not found                                    CBLRTVK2
               MOVE 'USR6520' TO W0RTN                                  CBLRTVK2
           END-IF                                                       CBLRTVK2
           PERFORM UNTIL NOT (C-INDICATOR-OFF(90))                      CBLRTVK2
      *        USER: Process Data record                                MSGACTK2
      *        CASE: PAR.Fleet Operator Number EQ DB1.Fleet Operator    MSGACTK2
      *          Number                                                 MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (Z1FLOPNO OF ZRCDDTL1-WS-O = FDFLOPNO OF FRUNCK6 OF   CBLIFXK1
                 FBRUNCONL3-R) THEN                                     CBLIFXK1
      *            PAR = DB1 By name                                    CBLMCXK1
      *            FB Run Status                                        CBLMCXK1
                   MOVE FDRUNSTAT OF FRUNCK6 OF FBRUNCONL3-R TO         CBLMCXK1
                     ZDRUNSTAT OF ZRCDDTL1-WS-O                         CBLMCXK1
      *            U:Month of Parts Data                                CBLMOVK1
                   MOVE FDDIDM OF FRUNCK6 OF FBRUNCONL3-R TO Z1DIDM OF  CBLMOVK1
                     ZRCDDTL1-WS-O                                      CBLMOVK1
      *            *QUIT                                                CBLQUTK1
                   GO SB7EXIT                                           CBLQUTK1
               END-IF                                                   MSGACTK2
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLRTVK2
               READ FBRUNCONL3 NEXT                                     CBLRTVK2
                 FORMAT IS 'FRUNCK6'                                    CBLRTVK2
               END-READ                                                 CBLRTVK2
               IF (C-EOF) THEN                                          CBLRTVK2
                   SET C-INDICATOR-ON(90) TO TRUE                       CBLRTVK2
               ELSE                                                     CBLRTVK2
                   IF (C-IO-ERR) THEN                                   CBLRTVK2
                       STOP RUN                                         CBLRTVK2
                   END-IF                                               CBLRTVK2
               END-IF                                                   CBLRTVK2
           END-PERFORM                                                  CBLRTVK2
      *==============================================================   CBLRTVK2
           CONTINUE.                                                    CBLRTVK2
       SB7EXIT.                                                         CBLRTVK2
           EXIT.                                                        CBLRTVK2
      /EJECT                                                            MSGACTK2
       UA1SUBR SECTION.                                                 MSGACTK2
      *==============================================================   MSGACTK2
      *    Set up flags and programs to run                             MSGACTK2
      *==============================================================   MSGACTK2
      *    U:Program 1                                                  CBLMOVK1
           MOVE 'FBB001000C' TO ZDUPGM1 OF ZRCDDTL1-WS-O                CBLMOVK1
      *    U:Program 2                                                  CBLMOVK1
           MOVE 'FBD001000C' TO ZDUPGM2 OF ZRCDDTL1-WS-O                CBLMOVK1
      *    U:Program 3                                                  CBLMOVK1
           MOVE 'FBB001500S' TO ZDUPGM3 OF ZRCDDTL1-WS-O                CBLMOVK1
      *    U:Program 4                                                  CBLMOVK1
           MOVE 'FBD001500S' TO ZDUPGM4 OF ZRCDDTL1-WS-O                CBLMOVK1
      *    U:Program 5                                                  CBLMOVK1
           MOVE 'FBB001400C' TO ZDUPGM5 OF ZRCDDTL1-WS-O                CBLMOVK1
      *    U:Process Inv/Crd                                            CBLMOVK1
           MOVE 'N' TO ZDUPRCINV OF ZRCDDTL1-WS-O                       CBLMOVK1
      *    U:Process Posting to A/Cs                                    CBLMOVK1
           MOVE 'N' TO ZDUPRCPOST OF ZRCDDTL1-WS-O                      CBLMOVK1
      *    U:Process Extract & Email                                    CBLMOVK1
           MOVE 'N' TO ZDUPRCEXT OF ZRCDDTL1-WS-O                       CBLMOVK1
      *    CASE: DTL.FB Run Status is Validated                         MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (ZDRUNSTAT OF ZRCDDTL1-WS-O = 'F' OR                      CBLIFXK1
               ZDRUNSTAT OF ZRCDDTL1-WS-O = 'A') THEN                   CBLIFXK1
      *        Run all post-validation actions                          MSGACTK2
      *        U:Process Inv/Crd                                        CBLMOVK1
               MOVE 'Y' TO ZDUPRCINV OF ZRCDDTL1-WS-O                   CBLMOVK1
      *        U:Process Posting to A/Cs                                CBLMOVK1
               MOVE 'Y' TO ZDUPRCPOST OF ZRCDDTL1-WS-O                  CBLMOVK1
      *        U:Process Extract & Email                                CBLMOVK1
               MOVE 'Y' TO ZDUPRCEXT OF ZRCDDTL1-WS-O                   CBLMOVK1
      *        *Set Cursor: DTL.U:Process Inv/Crd  (*Override=*NO)      CBLSETK1
               MOVE 011 TO W0ROW0                                       CBLSETK1
               MOVE 031 TO W0COL0                                       CBLSETK1
               MOVE '0' TO W0OVR0                                       CBLSETK1
           ELSE                                                         MSGACTK2
      *        CASE: DTL.FB Run Status is Dealer Credit Complete        MSGACTK2
      *        *IF                                                      CBLIFXK1
               IF (ZDRUNSTAT OF ZRCDDTL1-WS-O = '9') THEN               CBLIFXK1
      *            Run posting and BT extract                           MSGACTK2
      *            U:Process Posting to A/Cs                            CBLMOVK1
                   MOVE 'Y' TO ZDUPRCPOST OF ZRCDDTL1-WS-O              CBLMOVK1
      *            U:Process Extract & Email                            CBLMOVK1
                   MOVE 'Y' TO ZDUPRCEXT OF ZRCDDTL1-WS-O               CBLMOVK1
      *            *Set Cursor: DTL.U:Process Posting to A/Cs           CBLSETK1
      *              (*Override=*NO)                                    CBLSETK1
                   MOVE 012 TO W0ROW0                                   CBLSETK1
                   MOVE 031 TO W0COL0                                   CBLSETK1
                   MOVE '0' TO W0OVR0                                   CBLSETK1
               END-IF                                                   MSGACTK2
           END-IF                                                       MSGACTK2
      *==============================================================   MSGACTK2
           CONTINUE.                                                    MSGACTK2
       UA1EXIT.                                                         MSGACTK2
           EXIT.                                                        MSGACTK2
      /EJECT                                                            MSGACTK2
       UA2SUBR SECTION.                                                 MSGACTK2
      *==============================================================   MSGACTK2
      *    Program Details                                              MSGACTK2
      *==============================================================   MSGACTK2
      *    Function Created on  : 02/06/10                              MSGACTK2
      *    Created by           : Catherine Kelly                       MSGACTK2
      *    Project/Incident     : Parts Trade Programme 2               MSGACTK2
      *    Description          : One stop prompt to make processing    MSGACTK2
      *      easier.                                                    MSGACTK2
      *    ------------------------------------------------------------ MSGACTK2
      *      -------                                                    MSGACTK2
      *    Function Changed on  : 15/11/2011                            MSGACTK2
      *    Changed by           :C Kelly                                MSGACTK2
      *    Description          : Remove call to Fleet Database         MSGACTK2
      *==============================================================   MSGACTK2
           CONTINUE.                                                    MSGACTK2
       UA2EXIT.                                                         MSGACTK2
           EXIT.                                                        MSGACTK2
      /EJECT                                                            CHKRELK2
       VA1CKRL SECTION.                                                 CHKRELK2
      *==============================================================   CHKRELK2
      *    CHECK REFERENCE TO FB Run Control.                           CHKRELK2
      *==============================================================   CHKRELK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CHKRELK2
           MOVE SPACES TO W0RTN                                         CHKRELK2
      *    Name search required?                                        CHKRELK2
      *    Fleet Operator Number                                        CHKRELK2
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO WK1X01                     CHKRELK2
      *    Fleet Operator Number                                        CHKRELK2
           IF (WK1X01 = '?' OR                                          CHKRELK2
               WK1X01 = '?' OR                                          CHKRELK2
               YPMTFD = 'Z1FLOPNO O' OR                                 CHKRELK2
               YPMTFD = 'Z1DIDM OF ') THEN                              CHKRELK2
     W* Y2W0053 - One or more arguments defaulted to available contexts CBLERRK1
      *        Field '(DTL) Z1FLOPNO OF ZRCDDTL1-WS-O' defaulted for    CHKRELK2
      *          'Fleet Operator Number'.                               CHKRELK2
      *        Field '(DTL) Z1DIDM OF ZRCDDTL1-WS-O' defaulted for 'FB  CHKRELK2
      *          Month of Parts Data'.                                  CHKRELK2
               SET C-INDICATOR-OFF(90) TO TRUE                          CBLCLLK1
               MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO WQ0001                 CBLCLLK1
               MOVE Z1DIDM OF ZRCDDTL1-WS-O TO WQ0002                   CBLCLLK1
      *                                                                 CBLCLLK1
               CALL 'FBC001400S' USING                                  CBLCLLK1
      *        Return code                                              CBLCLLK1
                 W0RTN                                                  CBLCLLK1
      *        Fleet Operator Number                                    CBLCLLK1
                 WQ0001                                                 CBLCLLK1
      *        FB Month of Parts Data                                   CBLCLLK1
                 WQ0002                                                 CBLCLLK1
                        ON OVERFLOW                                     CBLCLLK1
                        SET C-INDICATOR-ON(90) TO TRUE                  CBLCLLK1
               END-CALL                                                 CBLCLLK1
      *                                                                 CBLCLLK1
               MOVE WQ0001 TO Z1FLOPNO OF ZRCDDTL1-WS-O                 CBLCLLK1
               MOVE WQ0002 TO Z1DIDM OF ZRCDDTL1-WS-O                   CBLCLLK1
      *                                                                 CBLCLLK1
      *        Error on program call will terminate run unit            CBLCLLK1
               IF (C-INDICATOR-ON(90)) THEN                             CBLCLLK1
                   MOVE 'Y2U0032' TO W0RTN                              CBLCLLK1
                   MOVE 'FBC001400S' TO W0CLPG                          CBLCLLK1
      *            Send message '*Error occured on CALL...'             SNDMSGK1
      *            Message ID                                           SNDMSGK1
                   MOVE 'Y2U0032' TO ZAMSID                             SNDMSGK1
      *            Message file                                         SNDMSGK1
                   MOVE 'Y2USRMSG' TO ZAMSGF                            SNDMSGK1
      *            Message data                                         SNDMSGK1
                   MOVE W0CLPG TO ZAMSDA                                SNDMSGK1
                   PERFORM ZASNMS                                       SNDMSGK1
               END-IF                                                   CBLCLLK1
      *        Error detected?                                          CBLCLLK1
               IF (W0RTN        NOT = SPACES AND                        CBLCLLK1
                   W0RTN        NOT = 'Y2U0016') THEN                   CBLCLLK1
                   SET C-INDICATOR-ON(99) TO TRUE                       CBLCLLK1
                   SET C-INDICATOR-ON(31) TO TRUE                       CBLCLLK1
               END-IF                                                   CBLCLLK1
      *                                                                 CHKRELK2
      *                                                                 CHKRELK2
      *                                                                 CHKRELK2
      *        Fleet Operator Number                                    CHKRELK2
               IF (Z1FLOPNO OF ZRCDDTL1-WS-O NOT = SPACES AND           CHKRELK2
                   YPMTFD NOT = SPACES AND                              CHKRELK2
                   W0RTN = SPACES AND                                   CHKRELK2
                   WK1X01 NOT = '?') THEN                               CHKRELK2
                   MOVE '*DONE' TO YPMTFD                               CHKRELK2
               END-IF                                                   CHKRELK2
      *                                                                 CHKRELK2
               IF (Z1DIDM OF ZRCDDTL1-WS-O NOT = ZEROS AND              CHKRELK2
                   YPMTFD NOT = SPACES AND                              CHKRELK2
                   W0RTN = SPACES) THEN                                 CHKRELK2
                   MOVE '*DONE' TO YPMTFD                               CHKRELK2
               END-IF                                                   CHKRELK2
      *        Defer confirm                                            CHKRELK2
               MOVE 'Y' TO W0DCF                                        CHKRELK2
      *        No value selected, exit                                  CHKRELK2
               IF (W0RTN NOT = SPACES AND                               CHKRELK2
                   YPMTFD = SPACES) THEN                                CHKRELK2
                   GO VA1EXIT                                           CHKRELK2
               END-IF                                                   CHKRELK2
           END-IF                                                       CHKRELK2
      *..............................................................   CHKRELK2
      *    If all low order keys not entered, exit                      CHKRELK2
      *    Fleet Operator Number                                        CHKRELK2
      *    FB Month of Parts Data                                       CHKRELK2
           IF (Z1FLOPNO OF ZRCDDTL1-WS-O = SPACES AND                   CHKRELK2
               Z1DIDM OF ZRCDDTL1-WS-O = ZEROS) THEN                    CHKRELK2
             GO VA1EXIT                                                 CHKRELK2
           END-IF                                                       CHKRELK2
      *                                                                 CHKRELK2
      *    Setup key                                                    KEYLSTK1
      *    Fleet Operator Number                                        KEYLSTK1
           MOVE Z1FLOPNO OF ZRCDDTL1-WS-O TO FDFLOPNO OF KLVA1F         KEYLSTK1
      *    FB Month of Parts Data                                       KEYLSTK1
           MOVE Z1DIDM OF ZRCDDTL1-WS-O TO FDDIDM OF KLVA1F             KEYLSTK1
      *    Initialise Full Externally Described Keylist                 CHKRELK2
      *    Fleet Operator Number                                        CHKRELK2
           MOVE SPACES TO FBFLOPNO OF KLVA1F-EXT                        CHKRELK2
      *    FB Month of Parts Data                                       CHKRELK2
           MOVE ZEROS TO FBDIDM OF KLVA1F-EXT                           CHKRELK2
      *    FB Action Date                                               CHKRELK2
           MOVE ZEROS TO FBACTDTE OF KLVA1F-EXT                         CHKRELK2
      *    FB Action Time                                               CHKRELK2
           MOVE ZEROS TO FBACTTIME OF KLVA1F-EXT                        CHKRELK2
      *    Program Name                                                 CHKRELK2
           MOVE SPACES TO FBPGMNAM OF KLVA1F-EXT                        CHKRELK2
           MOVE CORRESPONDING                                           CHKRELK2
             KLVA1F TO                                                  CHKRELK2
             FRUNCDU OF FBRUNCONL0-R                                    CHKRELK2
           SET C-INDICATOR-OFF(90) TO TRUE                              CHKRELK2
           SET C-INDICATOR-OFF(91) TO TRUE                              CHKRELK2
           READ FBRUNCONL0                                              CHKRELK2
             FORMAT IS 'FRUNCDU'                                        CHKRELK2
           END-READ                                                     CHKRELK2
           IF (C-NO-RECORD) THEN                                        CHKRELK2
               SET C-INDICATOR-ON(90) TO TRUE                           CHKRELK2
           ELSE                                                         CHKRELK2
               IF (C-IO-ERR) THEN                                       CHKRELK2
                   SET C-INDICATOR-ON(91) TO TRUE                       CHKRELK2
               END-IF                                                   CHKRELK2
           END-IF                                                       CHKRELK2
           IF (C-INDICATOR-OFF(90)) THEN                                CHKRELK2
      *        Record found - move back any virtuals                    CHKRELK2
               GO VA1EXIT                                               CHKRELK2
           END-IF                                                       CHKRELK2
           IF (YPMTFD NOT = SPACES) THEN                                CHKRELK2
               SET C-INDICATOR-OFF(90) TO TRUE                          CHKRELK2
               SET C-INDICATOR-OFF(91) TO TRUE                          CHKRELK2
               GO VA1EXIT                                               CHKRELK2
           END-IF                                                       CHKRELK2
      *    Send message 'FB Run Control         NF'                     SNDMSGK1
      *    Message ID                                                   SNDMSGK1
           MOVE 'USR6520' TO ZAMSID                                     SNDMSGK1
           PERFORM ZASNMS                                               SNDMSGK1
           MOVE 'USR6520' TO W0RTN                                      SNDMSGK1
      *==============================================================   CHKRELK2
           CONTINUE.                                                    CHKRELK2
       VA1EXIT.                                                         CHKRELK2
           EXIT.                                                        CHKRELK2
      /EJECT                                                            CVTDTMK1
       XCVTE  SECTION.                                                  CVTDTMK1
      *==============================================================   CVTDTMK1
      *    Convert date to DTE format.                                  CVTDTMK1
      *==============================================================   CVTDTMK1
           IF (XDI2CY < 1800) THEN                                      CVTDTMK1
               MOVE ZEROS TO XDINDT                                     CVTDTMK1
           ELSE                                                         CVTDTMK1
               SUBTRACT 1800 FROM XDI2CY GIVING XDINYY                  CVTDTMK1
               MOVE XDI2MM TO XDINMM                                    CVTDTMK1
               MOVE XDI2DD TO XDINDD                                    CVTDTMK1
           END-IF                                                       CVTDTMK1
      *==============================================================   CVTDTMK1
           CONTINUE.                                                    CVTDTMK1
       XCVTEE.                                                          CVTDTMK1
           EXIT.                                                        CVTDTMK1
      /EJECT                                                            CVTDTMK1
       XSTMS  SECTION.                                                  CVTDTMK1
      *==============================================================   CVTDTMK1
      *    Refresh System timestamp                                     CVTDTMK1
      *==============================================================   CVTDTMK1
           CALL 'Y2RTTSK' USING                                         CVTDTMK1
             ZZTMS OF JOB-CONTEXT                                       CVTDTMK1
           END-CALL                                                     CVTDTMK1
      *==============================================================   CVTDTMK1
           CONTINUE.                                                    CVTDTMK1
       XSTMSE.                                                          CVTDTMK1
           EXIT.                                                        CVTDTMK1
      /EJECT                                                            CBLSETK2
       Y0SET  SECTION.                                                  CBLSETK2
      *==============================================================   CBLSETK2
      *    Set cursor by *SET CURSOR data                               CBLSETK2
      *==============================================================   CBLSETK2
           IF (C-INDICATOR-OFF(25)) THEN                                CBLSETK2
      *        Bypass when help done                                    CBLSETK2
               SET C-INDICATOR-OFF(94) TO TRUE                          CBLSETK2
               IF (W0OVR0 = '1' OR                                      CBLSETK2
                   W0OVR0 = '0' AND                                     CBLSETK2
                   C-INDICATOR-OFF(99)) THEN                            CBLSETK2
      *            If override or no error                              CBLSETK2
                   SET C-INDICATOR-ON(94) TO TRUE                       CBLSETK2
                   MOVE W0ROW0 TO ZZCSRW OF ZRCDDTL1-WS-O               CBLSETK2
                   MOVE W0COL0 TO ZZCSCL OF ZRCDDTL1-WS-O               CBLSETK2
               END-IF                                                   CBLSETK2
           END-IF                                                       CBLSETK2
      *==============================================================   CBLSETK2
           CONTINUE.                                                    CBLSETK2
       Y0EXIT.                                                          CBLSETK2
           EXIT.                                                        CBLSETK2
      /EJECT                                                            CBLCSRK1
       Y8TST  SECTION.                                                  CBLCSRK1
      *==============================================================   CBLCSRK1
      *    Test cursor                                                  CBLCSRK1
      *==============================================================   CBLCSRK1
           ACCEPT AABCCCCCDD-I-O-DSPF FROM I-O-FEEDBACK-AREA            CBLCSRK1
            FOR AABCCCCCDD                                              CBLCSRK1
           MOVE ZZRWCL OF AABCCCCCDD-I-O-DSPF TO ZINPOS                 CBLCSRK1
           MOVE SPACES TO W0CFL                                         CBLCSRK1
           DIVIDE ZINPOS BY 256 GIVING W0CRW REMAINDER W0CCL            CBLCSRK1
      *==============================================================   CBLCSRK1
           CONTINUE.                                                    CBLCSRK1
       Y8EXIT.                                                          CBLCSRK1
           EXIT.                                                        CBLCSRK1
      /EJECT                                                            CBLSETK2
       Y9CLR  SECTION.                                                  CBLSETK2
      *==============================================================   CBLSETK2
      *    Clear *SET CURSOR data                                       CBLSETK2
      *==============================================================   CBLSETK2
           SET C-INDICATOR-OFF(94) TO TRUE                              CBLSETK2
           MOVE 0 TO W0ROW0                                             CBLSETK2
           MOVE 0 TO W0COL0                                             CBLSETK2
           MOVE '2' TO W0OVR0                                           CBLSETK2
      *==============================================================   CBLSETK2
           CONTINUE.                                                    CBLSETK2
       Y9EXIT.                                                          CBLSETK2
           EXIT.                                                        CBLSETK2
      /EJECT                                                            CBLUPDK1
       ZASNMS SECTION.                                                  CBLUPDK1
      *==============================================================   CBLUPDK1
      *    Send message to program's message queue                      CBLUPDK1
      *==============================================================   CBLUPDK1
      *    Send if first error message or not an error message          CBLUPDK1
           IF (ZAMSTP NOT = SPACES OR                                   CBLUPDK1
               ZAFSMS NOT = 'N') THEN                                   CBLUPDK1
               IF (ZAMSTP = SPACES) THEN                                CBLUPDK1
      *            Signal first error message sent                      CBLUPDK1
                   MOVE 'N' TO ZAFSMS                                   CBLUPDK1
               END-IF                                                   CBLUPDK1
               IF (ZAPGMQ = SPACES) THEN                                CBLUPDK1
                   MOVE ZZPGM OF JOB-CONTEXT TO ZAPGMQ                  CBLUPDK1
               END-IF                                                   CBLUPDK1
      *        If no message file specified, use default                CBLUPDK1
               IF (ZAMSGF = SPACES) THEN                                CBLUPDK1
                   MOVE ZADFMF TO ZAMSGF                                CBLUPDK1
               END-IF                                                   CBLUPDK1
               CALL 'Y2SNMGC' USING                                     CBLUPDK1
      *        Program queue                                            CBLUPDK1
                 ZAPGMQ                                                 CBLUPDK1
      *        Relative queue                                           CBLUPDK1
                 ZAPGRL                                                 CBLUPDK1
      *        Message ID                                               CBLUPDK1
                 ZAMSID                                                 CBLUPDK1
      *        Message file                                             CBLUPDK1
                 ZAMSGF                                                 CBLUPDK1
      *        Message data                                             CBLUPDK1
                 ZAMSDA                                                 CBLUPDK1
      *        Message type                                             CBLUPDK1
                 ZAMSTP                                                 CBLUPDK1
               END-CALL                                                 CBLUPDK1
           END-IF                                                       CBLUPDK1
      *    Clear all fields for default mechanism next time             CBLUPDK1
      *    Program queue                                                CBLUPDK1
           MOVE SPACES TO ZAPGMQ                                        CBLUPDK1
      *    Relative queue                                               CBLUPDK1
           MOVE SPACES TO ZAPGRL                                        CBLUPDK1
      *    Message ID                                                   CBLUPDK1
           MOVE SPACES TO ZAMSID                                        CBLUPDK1
      *    Message file                                                 CBLUPDK1
           MOVE SPACES TO ZAMSGF                                        CBLUPDK1
      *    Message data                                                 CBLUPDK1
           MOVE SPACES TO ZAMSDA                                        CBLUPDK1
      *    Message type                                                 CBLUPDK1
           MOVE SPACES TO ZAMSTP                                        CBLUPDK1
      *==============================================================   CBLUPDK1
           CONTINUE.                                                    CBLUPDK1
       ZAEXIT.                                                          CBLUPDK1
           EXIT.                                                        CBLUPDK1
      /EJECT                                                            GENF4K10
       ZDVPMT SECTION.                                                  GENF4K10
      *==============================================================   GENF4K10
      *    Process prompt request                                       GENF4K10
      *==============================================================   GENF4K10
      *                                                                 GENF4K10
      *    Initialise prompt workfields                                 GENF4K10
           MOVE SPACES TO YPMTFD                                        GENF4K10
           MOVE ZERO TO YAFSCH                                          GENF4K10
           MOVE ZERO TO YPMRRN                                          GENF4K10
      *                                                                 GENF4K10
           IF (C-INDICATOR-ON(04)) THEN                                 GENF4K10
               SET C-INDICATOR-ON(04) TO TRUE                           GENF4K10
      *                                                                 GENF4K10
      *        Extract cursor row and column                            GENF4K10
               ACCEPT AABCCCCCDD-I-O-DSPF                               GENF4K10
               FROM I-O-FEEDBACK-AREA FOR AABCCCCCDD                    GENF4K10
               DIVIDE ZZRWCL BY 256 GIVING ZHCSRW REMAINDER ZHCSCL      GENF4K10
      *        Save cursor position for redisplay                       GENF4K10
      *        Row                                                      GENF4K10
               MOVE ZEROS TO ZZZCSRW                                    GENF4K10
               MOVE ZHCSRW TO ZZZCSRW                                   GENF4K10
      *        Column                                                   GENF4K10
               MOVE ZEROS TO ZZZCSCL                                    GENF4K10
               MOVE ZHCSCL TO ZZZCSCL                                   GENF4K10
      *                                                                 GENF4K10
               IF (ZHCSRW = 005 AND                                     GENF4K10
                   ZHCSCL NOT < 029 AND                                 GENF4K10
                   ZHCSCL NOT > 035 AND                                 GENF4K10
                   ZZDFMT = 'ZRCDDTL1') THEN                            GENF4K10
      *            FB Month of Parts Data                               GENF4K10
                   MOVE 'Z1DIDM OF ' TO YPMTFD                          GENF4K10
               END-IF                                                   GENF4K10
      *                                                                 GENF4K10
               IF (ZHCSRW = 011 AND                                     GENF4K10
                   ZHCSCL = 031 AND                                     GENF4K10
                   ZZDFMT = 'ZRCDDTL1') THEN                            GENF4K10
      *            U:Process Inv/Crd                                    GENF4K10
                   MOVE 'ZDUPRCINV ' TO YPMTFD                          GENF4K10
               END-IF                                                   GENF4K10
      *                                                                 GENF4K10
               IF (ZHCSRW = 012 AND                                     GENF4K10
                   ZHCSCL = 031 AND                                     GENF4K10
                   ZZDFMT = 'ZRCDDTL1') THEN                            GENF4K10
      *            U:Process Posting to A/Cs                            GENF4K10
                   MOVE 'ZDUPRCPOST' TO YPMTFD                          GENF4K10
               END-IF                                                   GENF4K10
      *                                                                 GENF4K10
               IF (ZHCSRW = 013 AND                                     GENF4K10
                   ZHCSCL = 031 AND                                     GENF4K10
                   ZZDFMT = 'ZRCDDTL1') THEN                            GENF4K10
      *            U:Process Extract & Email                            GENF4K10
                   MOVE 'ZDUPRCEXT ' TO YPMTFD                          GENF4K10
               END-IF                                                   GENF4K10
      *                                                                 GENF4K10
               IF (YPMTFD = SPACES) THEN                                GENF4K10
      *            Error if user defined prompting is not specified.    GENF4K10
                   IF (W0PMT = 'N') THEN                                GENF4K10
                       MOVE '*NONE' TO YPMTFD                           GENF4K10
                       MOVE 'Y' TO W0HLP                                GENF4K10
                       MOVE 'Y' TO ZAFSMS                               GENF4K10
      *                Send error message.                              SNDMSGK1
      *                Message ID                                       SNDMSGK1
                       MOVE 'Y2U0101' TO ZAMSID                         SNDMSGK1
      *                Message file                                     SNDMSGK1
                       MOVE 'Y2USRMSG' TO ZAMSGF                        SNDMSGK1
                       PERFORM ZASNMS                                   SNDMSGK1
                   END-IF                                               GENF4K10
               END-IF                                                   GENF4K10
      *                                                                 GENF4K10
           END-IF                                                       GENF4K10
      *==============================================================   GENF4K10
           CONTINUE.                                                    GENF4K10
       ZDEXIT.                                                          GENF4K10
           EXIT.                                                        GENF4K10
      /EJECT                                                            DSPHLPK1
       ZHHPKY SECTION.                                                  DSPHLPK1
      *==============================================================   DSPHLPK1
      *    Display HELP text                                            DSPHLPK1
      *==============================================================   DSPHLPK1
      *    Signal help request                                          DSPHLPK1
           MOVE 'Y' TO W0HLP                                            DSPHLPK1
      *                                                                 DSPHLPK1
      *    Extract cursor row and column                                DSPHLPK1
           ACCEPT AABCCCCCDD-I-O-DSPF FROM I-O-FEEDBACK-AREA FOR        DSPHLPK1
             AABCCCCCDD                                                 DSPHLPK1
           DIVIDE ZZRWCL BY 256 GIVING ZHCSRW REMAINDER ZHCSCL          DSPHLPK1
      *                                                                 DSPHLPK1
      *    Save cursor position for redisplay                           DSPHLPK1
      *    Row                                                          DSPHLPK1
           MOVE ZEROS TO ZZZCSRW                                        DSPHLPK1
           ADD ZHCSRW TO ZZZCSRW                                        DSPHLPK1
      *    Column                                                       DSPHLPK1
           MOVE ZEROS TO ZZZCSCL                                        DSPHLPK1
           ADD ZHCSCL TO ZZZCSCL                                        DSPHLPK1
      *                                                                 DSPHLPK1
           MOVE '' TO W0HPMB                                            DSPHLPK1
           MOVE SPACES TO YYHPFL                                        DSPHLPK1
           MOVE SPACES TO YYHPLB                                        DSPHLPK1
           MOVE '*CSRLOC' TO YYHLVN                                     DSPHLPK1
           MOVE '*NORMAL' TO YYUSOP                                     DSPHLPK1
           MOVE ZHCSRW TO YYRW                                          DSPHLPK1
           MOVE ZHCSCL TO YYCL                                          DSPHLPK1
           MOVE ZEROS  TO YYLGCT                                        DSPHLPK1
           MOVE SPACES TO YYLGVN                                        DSPHLPK1
           CALL 'YDDSHPR' USING                                         DSPHLPK1
     E* Y2V0277 - Help text member name has not been specified.         CBLERRK1
      *    Member name                                                  DSPHLPK1
             W0HPMB                                                     DSPHLPK1
      *    *DFT text file                                               DSPHLPK1
             YYHPFL                                                     DSPHLPK1
      *    Help text library                                            DSPHLPK1
             YYHPLB                                                     DSPHLPK1
      *    Return code                                                  DSPHLPK1
             W0RTN                                                      DSPHLPK1
      *    Help label                                                   DSPHLPK1
             YYHLVN                                                     DSPHLPK1
      *    Options                                                      DSPHLPK1
             YYUSOP                                                     DSPHLPK1
      *    Row                                                          DSPHLPK1
             YYRW                                                       DSPHLPK1
      *    Column                                                       DSPHLPK1
             YYCL                                                       DSPHLPK1
      *    # of grps                                                    DSPHLPK1
             YYLGCT                                                     DSPHLPK1
      *    Label grps                                                   DSPHLPK1
             YYLGVN                                                     DSPHLPK1
           END-CALL                                                     DSPHLPK1
      *                                                                 DSPHLPK1
      *    Clear set cursor DDS indicator                               DSPHLPK1
           IF (C-INDICATOR-OFF(94)) THEN                                DSPHLPK1
               MOVE 'OFF' TO WCSRLC                                     DSPHLPK1
               SET C-INDICATOR-ON(94) TO TRUE                           DSPHLPK1
           END-IF                                                       DSPHLPK1
      *==============================================================   DSPHLPK1
           CONTINUE.                                                    DSPHLPK1
       ZHEXIT.                                                          DSPHLPK1
           EXIT.                                                        DSPHLPK1
      /EJECT                                                            PMTVALK1
       ZXEXPG SECTION.                                                  PMTVALK1
      *==============================================================   PMTVALK1
      *    Cancel & exit program                                        PMTVALK1
      *==============================================================   PMTVALK1
      *    USER: Exit program processing                                MSGACTK2
      *    * F3 from this screen.                                       MSGACTK2
      *    CASE: DTL.*CMD key is *Fast exit                             MSGACTK2
      *    *IF                                                          CBLIFXK1
           IF (C-INDICATOR-ON(03)) THEN                                 CBLIFXK1
      *        *Return code                                             CBLEXTK1
               MOVE 'Y2U9999' TO P0RTN                                  CBLEXTK1
               PERFORM ZYEXPG                                           CBLEXTK1
           END-IF                                                       MSGACTK2
           MOVE SPACES TO P0RTN                                         PMTVALK1
           PERFORM ZYEXPG                                               PMTVALK1
      *==============================================================   PMTVALK1
           CONTINUE.                                                    PMTVALK1
       ZXEXIT.                                                          PMTVALK1
           EXIT.                                                        PMTVALK1
      /EJECT                                                            CBLUPDK1
       ZYEXPG SECTION.                                                  CBLUPDK1
      *==============================================================   CBLUPDK1
      *    Exit program: Direct                                         CBLUPDK1
      *==============================================================   CBLUPDK1
      *    Copy any undisplayed messages back to caller                 CBLUPDK1
           CALL 'Y2CPMSC' USING                                         CBLUPDK1
             ZZPGM OF JOB-CONTEXT                                       CBLUPDK1
           END-CALL                                                     CBLUPDK1
      *                                                                 CBLUPDK1
      *    Reset entry parameters as appropriate                        CBLUPDK1
           PERFORM ZZEXPM.                                              CBLUPDK1
      *    Exit program                                                 CBLUPDK1
           CONTINUE.                                                    CBLUPDK1
       ZYEXPG-EXIT.                                                     CBLUPDK1
           GOBACK.                                                      CBLUPDK1
      *==============================================================   CBLUPDK1
           CONTINUE.                                                    CBLUPDK1
       ZYEXIT.                                                          CBLUPDK1
           EXIT.                                                        CBLUPDK1
      /EJECT                                                            DCLPARK1
       ZZEXPM SECTION.                                                  DCLPARK1
      *==============================================================   DCLPARK1
      *    Return parameters from work fields                           DCLPARK1
      *==============================================================   DCLPARK1
      *==============================================================   DCLPARK1
           CONTINUE.                                                    DCLPARK1
       ZZPEXT.                                                          DCLPARK1
           EXIT.                                                        DCLPARK1
      /EJECT                                                            CBLHDRK1
       ZZINIT SECTION.                                                  CBLHDRK1
      *==============================================================   CBLHDRK1
      *    Initialisation                                               CBLHDRK1
      *==============================================================   CBLHDRK1
           IF (W0ICL = SPACES) THEN                                     CBLHDRK1
      *        *Initial call                                            CBLHDRK1
               MOVE 'Y' TO W0ICL                                        CBLHDRK1
           ELSE                                                         CBLHDRK1
               MOVE 'N' TO W0ICL                                        CBLHDRK1
           END-IF                                                       CBLHDRK1
           MOVE SPACES TO P0RTN                                         CBLHDRK1
           MOVE SPACES TO W0RTN                                         CBLHDRK1
           MOVE ZEROS  TO W0RTW                                         CBLHDRK1
           MOVE SPACES TO W0RSF                                         CBLHDRK1
           MOVE '400' TO W0ENV                                          CBLHDRK1
           MOVE ALL B'0' TO INDICS                                      CBLHDRK1
      *    Initialise indicators for re-entry                           CBLHDRK1
           MOVE ALL B'0' TO INDICS                                      CBLHDRK1
           MOVE SPACES TO ZZPGM OF JOB-CONTEXT                          CBLHDRK1
      *    Retrieve job attributes                                      CBLHDRK1
           CALL 'Y2RTJCR' USING                                         CBLHDRK1
             JOB-CONTEXT                                                CBLHDRK1
           END-CALL                                                     CBLHDRK1
      *    Setup job date/time                                          CBLHDRK1
           MOVE ZZSD7 OF JOB-CONTEXT TO ZZJDT                           CBLHDRK1
           ACCEPT ZZTIME FROM TIME                                      CBLHDRK1
           MOVE ZZHNS TO ZZJTM OF JOB-CONTEXT                           CBLHDRK1
           MOVE 'AABCCCCCDS' TO ZZPGM OF JOB-CONTEXT                    CBLHDRK1
           MOVE ZEROS TO ZZCSRW OF ZRCDDTL1-WS-O                        CBLEXFK1
           MOVE ZEROS TO ZZCSCL OF ZRCDDTL1-WS-O                        CBLEXFK1
      *    Define work field U:Date                                     ACTCTXK4
           MOVE ZERO TO WUDATE OF WORK-CONTEXT                          ACTCTXK4
      *    Define work field U:DTM valid ?                              ACTCTXK4
           MOVE SPACES TO WUUDTMVLD OF WORK-CONTEXT                     ACTCTXK4
           OPEN INPUT RAVLLSL9                                          CVTSTSK1
      *                                                                 CBLSETK2
      *    Initialize array variables                                   CBLSETK2
      *    Initialize *SET CURSOR data                                  CBLSETK2
           MOVE 'Y' TO YSETCS                                           CBLSETK2
           PERFORM Y9CLR                                                CBLSETK2
           MOVE SPACES TO WCSRLC                                        CBLSETK2
      *                                                                 CBLSETK2
      *    Obtain default message file                                  CBLUPDK1
           MOVE 'RAMGFLA' TO DATA-AREA-NAME                             CBLUPDK1
           CALL 'Y2RTDAC' USING                                         CBLUPDK1
             DATA-AREA-NAME                                             CBLUPDK1
             ZADFMF                                                     CBLUPDK1
           END-CALL                                                     CBLUPDK1
      *    Signal first error message outstanding                       CBLUPDK1
           MOVE 'Y' TO ZAFSMS                                           CBLUPDK1
      *    Open files first time only                                   CBLUPDK1
           IF (W0OPN = SPACES) THEN                                     CBLUPDK1
               OPEN I-O AABCCCCCDD                                      CBLUPDK1
               OPEN I-O FBACTIONL0                                      CBLUPDK1
               ACCEPT FBACTIONL0-OPEN FROM OPEN-FEEDBACK-AREA FOR       CBLUPDK1
                 FBACTIONL0                                             CBLUPDK1
      *        Move main file information to JOB context                CBLUPDK1
               MOVE CORRESPONDING OPENFA OF FBACTIONL0-OPEN TO          CBLUPDK1
                 JOB-CONTEXT                                            CBLUPDK1
               CALL 'Y2QLVNR' USING                                     CBLUPDK1
                 ZZFFL OF JOB-CONTEXT                                   CBLUPDK1
                 ZZFLB OF JOB-CONTEXT                                   CBLUPDK1
                 ZZFQL OF JOB-CONTEXT                                   CBLUPDK1
               END-CALL                                                 CBLUPDK1
               OPEN INPUT FBACTIONL1                                    CBLUPDK1
               ACCEPT FBACTIONL1-OPEN FROM OPEN-FEEDBACK-AREA FOR       CBLUPDK1
                 FBACTIONL1                                             CBLUPDK1
               OPEN INPUT FBRUNCONL2                                    CBLUPDK1
               ACCEPT FBRUNCONL2-OPEN FROM OPEN-FEEDBACK-AREA FOR       CBLUPDK1
                 FBRUNCONL2                                             CBLUPDK1
               OPEN INPUT FBRUNCONL0                                    CBLUPDK1
               ACCEPT FBRUNCONL0-OPEN FROM OPEN-FEEDBACK-AREA FOR       CBLUPDK1
                 FBRUNCONL0                                             CBLUPDK1
               OPEN INPUT FBACTIONL2                                    CBLUPDK1
               ACCEPT FBACTIONL2-OPEN FROM OPEN-FEEDBACK-AREA FOR       CBLUPDK1
                 FBACTIONL2                                             CBLUPDK1
               OPEN INPUT FBFLTACCL1                                    CBLUPDK1
               ACCEPT FBFLTACCL1-OPEN FROM OPEN-FEEDBACK-AREA FOR       CBLUPDK1
                 FBFLTACCL1                                             CBLUPDK1
               OPEN INPUT FBRUNCONL3                                    CBLUPDK1
               ACCEPT FBRUNCONL3-OPEN FROM OPEN-FEEDBACK-AREA FOR       CBLUPDK1
                 FBRUNCONL3                                             CBLUPDK1
               MOVE 'Y' TO W0OPN                                        CBLUPDK1
           END-IF                                                       CBLUPDK1
           MOVE 'N' TO W0PMT                                            CBLUPDK1
      *    Define local work field U:Job date D8#                       ACTCTXK4
           MOVE ZERO TO YL0001 OF WORK-CONTEXT                          ACTCTXK4
      *    Define local work field FB Action Status                     ACTCTXK4
           MOVE SPACES TO YL0002 OF WORK-CONTEXT                        ACTCTXK4
      *    Define local work field Job Start TS#                        ACTCTXK4
           MOVE '0001-01-01-00.00.00.000000' TO YN0001 OF WORK-CONTEXT  ACTCTXK4
      *    Define local work field Job End TS#                          ACTCTXK4
           MOVE '0001-01-01-00.00.00.000000' TO YN0002 OF WORK-CONTEXT  ACTCTXK4
      *    Define local work field FB Frequency                         ACTCTXK4
           MOVE SPACES TO YN0003 OF WORK-CONTEXT                        ACTCTXK4
      *    Define local work field FB Days to Delay                     ACTCTXK4
           MOVE ZERO TO YN0004 OF WORK-CONTEXT                          ACTCTXK4
      *    Define local work field FB Delay incl Non-WrkDays            ACTCTXK4
           MOVE SPACES TO YN0005 OF WORK-CONTEXT                        ACTCTXK4
      *    Define local work field Next Program Name                    ACTCTXK4
           MOVE SPACES TO YN0006 OF WORK-CONTEXT                        ACTCTXK4
      *    Define local work field Create Date D8#                      ACTCTXK4
           MOVE ZERO TO YN0007 OF WORK-CONTEXT                          ACTCTXK4
      *    Define local work field Create Time                          ACTCTXK4
           MOVE ZERO TO YN0008 OF WORK-CONTEXT                          ACTCTXK4
      *    Define local work field Create User                          ACTCTXK4
           MOVE SPACES TO YN0009 OF WORK-CONTEXT                        ACTCTXK4
      *    Define local work field Create Program                       ACTCTXK4
           MOVE SPACES TO YN0010 OF WORK-CONTEXT                        ACTCTXK4
      *    Define local work field Create Job                           ACTCTXK4
           MOVE SPACES TO YN0011 OF WORK-CONTEXT                        ACTCTXK4
      *    Define local work field Date Last Changed D8#                ACTCTXK4
           MOVE ZERO TO YN0012 OF WORK-CONTEXT                          ACTCTXK4
      *    Define local work field Time Last Changed                    ACTCTXK4
           MOVE ZERO TO YN0013 OF WORK-CONTEXT                          ACTCTXK4
      *    Define local work field User Last Changed                    ACTCTXK4
           MOVE SPACES TO YN0014 OF WORK-CONTEXT                        ACTCTXK4
      *    Define local work field Program Last Changed                 ACTCTXK4
           MOVE SPACES TO YN0015 OF WORK-CONTEXT                        ACTCTXK4
      *    Define local work field Job Last Changed                     ACTCTXK4
           MOVE SPACES TO YN0016 OF WORK-CONTEXT                        ACTCTXK4
      *    Define local work field U:Display (Y/N)                      ACTCTXK4
           MOVE SPACES TO YL0003 OF WORK-CONTEXT                        ACTCTXK4
      *    Define local work field Account Number                       ACTCTXK4
           MOVE ZERO TO YN0017 OF WORK-CONTEXT                          ACTCTXK4
      *    Define local work field SAP Tax Code                         ACTCTXK4
           MOVE SPACES TO YN0018 OF WORK-CONTEXT                        ACTCTXK4
      *    Define local work field Active Status(Y/N)                   ACTCTXK4
           MOVE SPACES TO YN0019 OF WORK-CONTEXT                        ACTCTXK4
      *    *DTAARA = System Dat                                         PMTVALK1
           MOVE 'SYSNAME   ' TO DATA-AREA-NAME                          PMTVALK1
           CALL 'Y2RTDAC' USING                                         PMTVALK1
             DATA-AREA-NAME                                             PMTVALK1
             ZZSYSNME OF AABCCCCCDD-WS-O                                PMTVALK1
           END-CALL                                                     PMTVALK1
           MOVE 'AABCCCCCDS' TO ZZPGM OF ZRCDDTL1-WS-O                  PMTVALK1
           MOVE ZZUSR OF JOB-CONTEXT TO ZZUSR OF AABCCCCCDD-WS-O        PMTVALK1
           MOVE ZZJOB OF JOB-CONTEXT TO ZZJOB OF AABCCCCCDD-WS-O        PMTVALK1
           MOVE ZZPGM OF JOB-CONTEXT TO ZZPGM OF ZMSGCTL-WS-O           PMTVALK1
      *..............................................................   PMTVALK1
      *    USER: Initialize program                                     MSGACTK2
      *    Program Details                                              MSGACTK2
           PERFORM UA2SUBR                                              MSGACTK2
      *    Utl @Copyright                                               MSGACTK2
      *    ------------------------------------------------------------ MSGACTK2
      *    COPYRIGHT                                                    MSGACTK2
      *    This program is copyright of RENAULT UK LTD 2012.            MSGACTK2
      *    Reproduction not allowed without prior permission            MSGACTK2
      *    ------------------------------------------------------------ MSGACTK2
      *    Load screen                                                  PMTVALK1
           PERFORM MALDSC                                               PMTVALK1
      *==============================================================   CBLHDRK1
           CONTINUE.                                                    CBLHDRK1
       ZZEXIT.                                                          CBLHDRK1
           EXIT.                                                        CBLHDRK1
       U-UFDCHKDTMS SECTION.                                            CBLUFNK1
      **-------------------------------------------------------------** CBLUFNK1
      **   Validate the year and months numbers, if no errors are    ** CBLUFNK1
      **     found the date is converted to CYM format.  Note that   ** CBLUFNK1
      **     this routine will treat a zero date as valid.           ** CBLUFNK1
      **-------------------------------------------------------------** CBLUFNK1
       U-UFDCHKDTMS-010.                                                CBLUFNK1
           SET U-DTM-VALID  OF U-UFDCNVDTMS          TO TRUE.           CBLUFNK1
      *                                                                 CBLUFNK1
           EVALUATE TRUE                                                CBLUFNK1
             WHEN  ZEROS  =  U-CCYY OF U-DTM-MCY-X OF U-UFDCNVDTMS      CBLUFNK1
                         OR  U-MM   OF U-DTM-MCY-X OF U-UFDCNVDTMS      CBLUFNK1
               SET U-DTM-INVALID OF U-UFDCNVDTMS     TO TRUE            CBLUFNK1
      *                                                                 CBLUFNK1
             WHEN   U-MM OF U-DTM-MCY-X OF U-UFDCNVDTMS  >  12          CBLUFNK1
               SET U-DTM-INVALID OF U-UFDCNVDTMS     TO TRUE            CBLUFNK1
      *                                                                 CBLUFNK1
           END-EVALUATE.                                                CBLUFNK1
      *                                                                 CBLUFNK1
           MOVE CORR U-DTM-MCY-X  OF U-UFDCNVDTMS                       CBLUFNK1
             TO U-DTM-CYM-X       OF U-UFDCNVDTMS.                      CBLUFNK1
      *                                                                 CBLUFNK1
       U-UFDCHKDTMS-990.                                                CBLUFNK1
           EXIT.                                                        CBLUFNK1
